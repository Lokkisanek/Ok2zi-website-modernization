;/*FB_PKG_DELIM*/

__d("CometComposerNodes",["CometLexicalDelightNode","CometLexicalEmojiNode","CometLexicalGenericEntityNode","LexicalHashtag","LexicalLink","LexicalOverflow"],(function(t,n,r,o,a,i,l){"use strict";var e=[o("CometLexicalGenericEntityNode").CometLexicalGenericEntityNode,o("CometLexicalEmojiNode").EmojiNode,o("LexicalLink").LinkNode,o("LexicalLink").AutoLinkNode,o("LexicalHashtag").HashtagNode,o("LexicalOverflow").OverflowNode,o("CometLexicalDelightNode").CometLexicalDelightNode];l.COMET_NODES=e}),98);
__d("FeedComposerCometTextStyleContext",["react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react")),u=s.createContext({color:"primary-text",fontSize:24});l.default=u}),98);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<15dc0f2916f9ba5ebba30f9ace2aba04>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("Lexical.prod",[],(function $module_Lexical_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _I,_F;function t(t){var n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",t);for(var _len=arguments.length,e=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){e[_key-1]=arguments[_key];}for(var _t2 of e)r.append("v",_t2);throw n.search=r.toString(),Error("Minified Lexical error #"+t+"; visit "+n.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}function e(t){for(var _len2=arguments.length,e=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){e[_key2-1]=arguments[_key2];}var n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",t);for(var _t3 of e)r.append("v",_t3);n.search=r.toString(),console.warn("Minified Lexical warning #"+t+"; visit "+n.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}var n="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,r=n&&"documentMode"in document?document.documentMode:null,o=n&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),i=n&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),s=!(!n||!("InputEvent"in window)||r)&&"getTargetRanges"in new window.InputEvent("input"),l=n&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),c=n&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,a=n&&/Android/.test(navigator.userAgent),u=n&&/^(?=.*Chrome).*/i.test(navigator.userAgent),f=n&&a&&u,d=n&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&o&&!u;function h(){var e=[];for(var _len3=arguments.length,t=new Array(_len3),_key3=0;_key3<_len3;_key3++){t[_key3]=arguments[_key3];}for(var _n2 of t)if(_n2&&"string"==typeof _n2)for(var _ref2 of _n2.matchAll(/\S+/g)){var _t4=_ref2[0];e.push(_t4);}return e;}var g=0,_=1,p=2,y=128,m=1,x=2,C=3,S=4,N=5,T=6,v=l||c||d?" ":"​",k="\n\n",E=i?" ":v,O="֑-߿יִ-﷽ﹰ-ﻼ",b="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",M=new RegExp("^[^"+b+"]*["+O+"]"),A=new RegExp("^[^"+O+"]*["+b+"]"),w={bold:1,capitalize:1024,code:16,highlight:y,italic:2,lowercase:256,strikethrough:4,subscript:32,superscript:64,underline:8,uppercase:512},D={directionless:1,unmergeable:2},P={center:2,end:6,justify:4,left:1,right:3,start:5},I=(_I={},_I[x]="center",_I[T]="end",_I[S]="justify",_I[m]="left",_I[C]="right",_I[N]="start",_I),L={normal:0,segmented:2,token:1},F=(_F={},_F[g]="normal",_F[p]="segmented",_F[_]="token",_F),R="$config";function K(t,e,n,r,o,i){var s=t.getFirstChild();for(;null!==s;){var _t5=s.__key;s.__parent===e&&(co(s)&&K(s,_t5,n,r,o,i),n.has(_t5)||i["delete"](_t5),o.push(_t5)),s=s.getNextSibling();}}var B=!1,z=0;function W(t){z=t.timeStamp;}function $(t,e,n){var r="BR"===t.nodeName,o=e.__lexicalLineBreak;return o&&(t===o||r&&t.previousSibling===o)||r&&void 0!==Zo(t,n);}function U(t,e,n){var r=Ji(Li(n));var o=null,i=null;null!==r&&r.anchorNode===t&&(o=r.anchorOffset,i=r.focusOffset);var s=t.nodeValue;null!==s&&di(e,s,o,i,!1);}function J(t,e,n){if(ar(t)){var _e2=t.anchor.getNode();if(_e2.is(n)&&t.format!==_e2.getFormat())return!1;}return $o(e)&&n.isAttached();}function Y(t,e,n,r){for(var _o2=t;_o2&&!os(_o2);_o2=Mi(_o2)){var _t6=Zo(_o2,e);if(void 0!==_t6){var _e3=Xo(_t6,n);if(_e3)return fo(_e3)||!ji(_o2)?void 0:[_o2,_e3];}else if(_o2===r)return[r,oi(n)];}}function j(t,e,n){B=!0;var r=performance.now()-z>100;try{oo(t,function(){var o=kr()||function(t){return t.getEditorState().read(function(){var t=kr();return null!==t?t.clone():null;});}(t),s=new Map(),l=t.getRootElement(),c=t._editorState,a=t._blockCursorElement;var u=!1,f="";for(var _n3=0;_n3<e.length;_n3++){var _d=e[_n3],_h=_d.type,_g=_d.target,_2=Y(_g,t,c,l);if(!_2)continue;var _p=_2[0],_y=_2[1];if("characterData"===_h)r&&Zn(_y)&&$o(_g)&&J(o,_g,_y)&&U(_g,_y,t);else if("childList"===_h){u=!0;var _e4=_d.addedNodes;for(var _n4=0;_n4<_e4.length;_n4++){var _r2=_e4[_n4],_o3=Qo(_r2),_s4=_r2.parentNode;if(null!=_s4&&_r2!==a&&null===_o3&&!$(_r2,_s4,t)){if(i){var _t7=(ji(_r2)?_r2.innerText:null)||_r2.nodeValue;_t7&&(f+=_t7);}_s4.removeChild(_r2);}}var _n5=_d.removedNodes,_r3=_n5.length;if(_r3>0){var _e5=0;for(var _o4=0;_o4<_r3;_o4++){var _r4=_n5[_o4];($(_r4,_g,t)||a===_r4)&&(_g.appendChild(_r4),_e5++);}_r3!==_e5&&s.set(_p,_y);}}}if(s.size>0)for(var _ref4 of s){var _e6=_ref4[0];var _n6=_ref4[1];_n6.reconcileObservedMutation(_e6,t);}var d=n.takeRecords();if(d.length>0){for(var _e7=0;_e7<d.length;_e7++){var _n7=d[_e7],_r5=_n7.addedNodes,_o5=_n7.target;for(var _e8=0;_e8<_r5.length;_e8++){var _n8=_r5[_e8],_i2=_n8.parentNode;null==_i2||"BR"!==_n8.nodeName||$(_n8,_o5,t)||_i2.removeChild(_n8);}}n.takeRecords();}null!==o&&(u&&ii(o),i&&ki(t)&&o.insertRawText(f));});}finally{B=!1;}}function H(t){var e=t._observer;if(null!==e){j(t,e.takeRecords(),e);}}function V(t){!function(t){0===z&&Li(t).addEventListener("textInput",W,!0);}(t),t._observer=new MutationObserver(function(e,n){j(t,e,n);});}var G=function G(t,e){this.key=t,this.parse=e.parse.bind(e),this.unparse=(e.unparse||nt).bind(e),this.isEqual=(e.isEqual||Object.is).bind(e),this.defaultValue=this.parse(void 0);};function q(t,e,n){if(n===void 0){n="latest";}var r=("latest"===n?t.getLatest():t).__state;return r?r.getValue(e):e.defaultValue;}function X(t){var e=new Map(),n=new Set();for(var _r6="function"==typeof t?t:t.replace;_r6.prototype&&void 0!==_r6.prototype.getType;_r6=Object.getPrototypeOf(_r6)){var _ss=ss(_r6),_t8=_ss.ownNodeConfig;if(_t8&&_t8.stateConfigs)for(var _r7 of _t8.stateConfigs){var _t9=void 0;"stateConfig"in _r7?(_t9=_r7.stateConfig,_r7.flat&&n.add(_t9.key)):_t9=_r7,e.set(_t9.key,_t9);}}return{flatKeys:n,sharedConfigMap:e};}var _Q=function(){function Q(t,e,n,r,o){if(n===void 0){n=void 0;}if(r===void 0){r=new Map();}if(o===void 0){o=void 0;}this.node=t,this.sharedNodeState=e,this.unknownState=n,this.knownState=r;var i=this.sharedNodeState.sharedConfigMap,s=void 0!==o?o:function(t,e,n){var r=n.size;if(e)for(var _o6 in e){var _e9=t.get(_o6);_e9&&n.has(_e9)||r++;}return r;}(i,n,r);this.size=s;}var _proto=Q.prototype;_proto.getValue=function getValue(t){var e=this.knownState.get(t);if(void 0!==e)return e;this.sharedNodeState.sharedConfigMap.set(t.key,t);var n=t.defaultValue;if(this.unknownState&&t.key in this.unknownState){var _e0=this.unknownState[t.key];void 0!==_e0&&(n=t.parse(_e0)),this.updateFromKnown(t,n);}return n;};_proto.getInternalState=function getInternalState(){return[this.unknownState,this.knownState];};_proto.toJSON=function toJSON(){var t=babelHelpers["extends"]({},this.unknownState),e={};for(var _ref6 of this.knownState){var _e1=_ref6[0];var _n9=_ref6[1];_e1.isEqual(_n9,_e1.defaultValue)?delete t[_e1.key]:t[_e1.key]=_e1.unparse(_n9);}for(var _n0 of this.sharedNodeState.flatKeys)_n0 in t&&(e[_n0]=t[_n0],delete t[_n0]);return et(t)&&(e.$=t),e;};_proto.getWritable=function getWritable(t){if(this.node===t)return this;var e=this.sharedNodeState,n=this.unknownState,r=new Map(this.knownState);return new Q(t,e,function(t,e,n){var r;if(n)for(var _ref8 of Object.entries(n)){var _o7=_ref8[0];var _i3=_ref8[1];{var _n1=t.get(_o7);_n1?e.has(_n1)||e.set(_n1,_n1.parse(_i3)):(r=r||{},r[_o7]=_i3);}}return r;}(e.sharedConfigMap,r,n),r,this.size);};_proto.updateFromKnown=function updateFromKnown(t,e){var n=t.key;this.sharedNodeState.sharedConfigMap.set(n,t);var r=this.knownState,o=this.unknownState;r.has(t)||o&&n in o||(o&&(delete o[n],this.unknownState=et(o)),this.size++),r.set(t,e);};_proto.updateFromUnknown=function updateFromUnknown(t,e){var n=this.sharedNodeState.sharedConfigMap.get(t);n?this.updateFromKnown(n,n.parse(e)):(this.unknownState=this.unknownState||{},t in this.unknownState||this.size++,this.unknownState[t]=e);};_proto.updateFromJSON=function updateFromJSON(t){var e=this.knownState;for(var _t0 of e.keys())e.set(_t0,_t0.defaultValue);if(this.size=e.size,this.unknownState=void 0,t)for(var _ref0 of Object.entries(t)){var _e10=_ref0[0];var _n10=_ref0[1];this.updateFromUnknown(_e10,_n10);}};return Q;}();function Z(t){var e=t.getWritable(),n=e.__state?e.__state.getWritable(e):new _Q(e,tt(e));return e.__state=n,n;}function tt(t){return t.__state?t.__state.sharedNodeState:wo(Qi(),t.getType()).sharedNodeState;}function et(t){if(t)for(var _e11 in t)return t;}function nt(t){return t;}function rt(t,e,n){for(var _ref10 of e.knownState){var _r8=_ref10[0];var _o8=_ref10[1];{if(t.has(_r8.key))continue;t.add(_r8.key);var _e12=n?n.getValue(_r8):_r8.defaultValue;if(_e12!==_o8&&!_r8.isEqual(_e12,_o8))return!0;}}return!1;}function ot(t,e,n){var r=e.unknownState,o=n?n.unknownState:void 0;if(r)for(var _ref12 of Object.entries(r)){var _e13=_ref12[0];var _n11=_ref12[1];if(t.has(_e13))continue;t.add(_e13);if(_n11!==(o?o[_e13]:void 0))return!0;}return!1;}function it(t,e){var n=t.__state;return n&&n.node===t?n.getWritable(e):n;}function st(t,e){var n=t.__mode,r=t.__format,o=t.__style,i=e.__mode,s=e.__format,l=e.__style,c=t.__state,a=e.__state;return(null===n||n===i)&&(null===r||r===s)&&(null===o||o===l)&&(null===t.__state||c===a||function(t,e){if(t===e)return!0;if(t&&e&&t.size!==e.size)return!1;var n=new Set();return!(t&&rt(n,t,e)||e&&rt(n,e,t)||t&&ot(n,t,e)||e&&ot(n,e,t));}(c,a));}function lt(t,e){var n=t.mergeWithSibling(e),r=jr()._normalizedNodes;return r.add(t.__key),r.add(e.__key),n;}function ct(t){var e,n,r=t;if(""!==r.__text||!r.isSimpleText()||r.isUnmergeable()){for(;null!==(e=r.getPreviousSibling())&&Zn(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(""!==e.__text){if(st(e,r)){r=lt(e,r);break;}break;}e.remove();}for(;null!==(n=r.getNextSibling())&&Zn(n)&&n.isSimpleText()&&!n.isUnmergeable();){if(""!==n.__text){if(st(r,n)){r=lt(r,n);break;}break;}n.remove();}}else r.remove();}function at(t){return ut(t.anchor),ut(t.focus),t;}function ut(t){for(;"element"===t.type;){var _e14=t.getNode(),_n12=t.offset;var _r9=void 0,_o9=void 0;if(_n12===_e14.getChildrenSize()?(_r9=_e14.getChildAtIndex(_n12-1),_o9=!0):(_r9=_e14.getChildAtIndex(_n12),_o9=!1),Zn(_r9)){t.set(_r9.__key,_o9?_r9.getTextContentSize():0,"text",!0);break;}if(!co(_r9))break;t.set(_r9.__key,_o9?_r9.getChildrenSize():0,"element",!0);}}var ft,dt,ht,gt,_t,pt,yt,mt,xt,Ct,St="",Nt=null,Tt=null,vt="",kt=!1,Et=!1;function Ot(t,e){var n=yt.get(t);if(null!==e){var _n13=Jt(t);_n13.parentNode===e&&e.removeChild(_n13);}if(mt.has(t)||dt._keyToDOMMap["delete"](t),co(n)){var _t1=Bt(n,yt);bt(_t1,0,_t1.length-1,null);}void 0!==n&&Ni(Ct,ht,gt,n,"destroyed");}function bt(t,e,n,r){var o=e;for(;o<=n;++o){var _e15=t[o];void 0!==_e15&&Ot(_e15,r);}}function Mt(t,e){t.setProperty("text-align",e);}var At="40px";function wt(t,e){var n=ft.theme.indent;if("string"==typeof n){var _r0=t.classList.contains(n);e>0&&!_r0?t.classList.add(n):e<1&&_r0&&t.classList.remove(n);}var r=getComputedStyle(t).getPropertyValue("--lexical-indent-base-value")||At;t.style.setProperty("padding-inline-start",0===e?"":"calc("+e+" * "+r+")");}function Dt(t,e){var n=t.style;0===e?Mt(n,""):1===e?Mt(n,"left"):2===e?Mt(n,"center"):3===e?Mt(n,"right"):4===e?Mt(n,"justify"):5===e?Mt(n,"start"):6===e&&Mt(n,"end");}function Pt(t,e){var n=function(t){var e=t.__dir;if(null!==e)return e;if(go(t))return null;var n=t.getParentOrThrow();return go(n)&&null===n.__dir?"auto":null;}(e);null!==n?t.dir=n:t.removeAttribute("dir");}function It(e,n){var r=mt.get(e);void 0===r&&t(60);var o=r.createDOM(ft,dt);if(function(t,e,n){var r=n._keyToDOMMap;(function(t,e,n){var r="__lexicalKey_"+e._key;t[r]=n;})(e,n,t),r.set(t,e);}(e,o,dt),Zn(r)?o.setAttribute("data-lexical-text","true"):fo(r)&&o.setAttribute("data-lexical-decorator","true"),co(r)){var _t10=r.__indent,_e16=r.__size;if(Pt(o,r),0!==_t10&&wt(o,_t10),0!==_e16){var _t11=_e16-1;Lt(Bt(r,mt),r,0,_t11,r.getDOMSlot(o));}var _n14=r.__format;0!==_n14&&Dt(o,_n14),r.isInline()||Rt(null,r,o),Oi(r)&&(St+=k,vt+=k);}else{var _t12=r.getTextContent();if(fo(r)){var _t13=r.decorate(dt,ft);null!==_t13&&Wt(e,_t13),o.contentEditable="false";}St+=_t12,vt+=_t12;}return null!==n&&n.insertChild(o),Ni(Ct,ht,gt,r,"created"),o;}function Lt(t,e,n,r,o){var i=St;St="";var s=n;for(;s<=r;++s){It(t[s],o);var _e17=mt.get(t[s]);null!==_e17&&Zn(_e17)&&null===Nt&&(Nt=_e17.getFormat(),Tt=_e17.getStyle());}Oi(e)&&(St+=k);o.element.__lexicalTextContent=St,St=i+St;}function Ft(t,e){if(t){var _n15=t.__last;if(_n15){var _t14=e.get(_n15);if(_t14)return Ln(_t14)?"line-break":fo(_t14)&&_t14.isInline()?"decorator":null;}return"empty";}return null;}function Rt(t,e,n){var r=Ft(t,yt),o=Ft(e,mt);r!==o&&e.getDOMSlot(n).setManagedLineBreak(o);}function Kt(e,n,r){var o;Nt=null,Tt=null,function(e,n,r){var o=St,i=e.__size,s=n.__size;St="";var l=r.element;if(1===i&&1===s){var _t15=e.__first,_r1=n.__first;if(_t15===_r1)zt(_t15,l);else{var _e18=Jt(_t15),_n16=It(_r1,null);try{l.replaceChild(_n16,_e18);}catch(o){if("object"==typeof o&&null!=o){var _i4=o.toString()+" Parent: "+l.tagName+", new child: {tag: "+_n16.tagName+" key: "+_r1+"}, old child: {tag: "+_e18.tagName+", key: "+_t15+"}.";throw new Error(_i4);}throw o;}Ot(_t15,null);}var _o0=mt.get(_r1);Zn(_o0)&&null===Nt&&(Nt=_o0.getFormat(),Tt=_o0.getStyle());}else{var _o1=Bt(e,yt),_c=Bt(n,mt);if(_o1.length!==i&&t(227),_c.length!==s&&t(228),0===i)0!==s&&Lt(_c,n,0,s-1,r);else if(0===s){if(0!==i){var _t16=null==r.after&&null==r.before&&null==r.element.__lexicalLineBreak;bt(_o1,0,i-1,_t16?null:l),_t16&&(l.textContent="");}}else!function(t,e,n,r,o,i){var s=r-1,l=o-1;var c,a,u=i.getFirstChild(),f=0,d=0;for(;f<=s&&d<=l;){var _t17=e[f],_r10=n[d];if(_t17===_r10)u=$t(zt(_r10,i.element)),f++,d++;else{void 0===c&&(c=new Set(e)),void 0===a&&(a=new Set(n));var _o10=a.has(_t17),_s5=c.has(_r10);if(_o10){if(_s5){var _t18=bi(dt,_r10);_t18===u?u=$t(zt(_r10,i.element)):(i.withBefore(u).insertChild(_t18),zt(_r10,i.element)),f++,d++;}else It(_r10,i.withBefore(u)),d++;}else u=$t(Jt(_t17)),Ot(_t17,i.element),f++;}var _o11=mt.get(_r10);null!==_o11&&Zn(_o11)&&null===Nt&&(Nt=_o11.getFormat(),Tt=_o11.getStyle());}var h=f>s,g=d>l;if(h&&!g){var _e19=n[l+1],_r11=void 0===_e19?null:dt.getElementByKey(_e19);Lt(n,t,d,l,i.withBefore(_r11));}else g&&!h&&bt(e,f,s,i.element);}(n,_o1,_c,i,s,r);}Oi(n)&&(St+=k);l.__lexicalTextContent=St,St=o+St;}(e,n,n.getDOMSlot(r)),o=n,null==Nt||Nt===o.__textFormat||Et||o.setTextFormat(Nt),function(t){null==Tt||Tt===t.__textStyle||Et||t.setTextStyle(Tt);}(n);}function Bt(e,n){var r=[];var o=e.__first;for(;null!==o;){var _e20=n.get(o);void 0===_e20&&t(101),r.push(o),o=_e20.__next;}return r;}function zt(e,n){var r=yt.get(e);var o=mt.get(e);void 0!==r&&void 0!==o||t(61);var i=kt||pt.has(e)||_t.has(e),s=bi(dt,e);if(r===o&&!i){if(co(r)){var _t19=s.__lexicalTextContent;void 0!==_t19&&(St+=_t19,vt+=_t19);}else{var _t20=r.getTextContent();vt+=_t20,St+=_t20;}return s;}if(r!==o&&i&&Ni(Ct,ht,gt,o,"updated"),o.updateDOM(r,s,ft)){var _r12=It(e,null);return null===n&&t(62),n.replaceChild(_r12,s),Ot(e,null),_r12;}if(co(r)&&co(o)){var _t21=o.__indent;(kt||_t21!==r.__indent)&&wt(s,_t21);var _e21=o.__format;if((kt||_e21!==r.__format)&&Dt(s,_e21),i&&(Kt(r,o,s),go(o)||o.isInline()||Rt(r,o,s)),Oi(o)&&(St+=k,vt+=k),(kt||o.__dir!==r.__dir)&&(Pt(s,o),go(o)&&!kt))for(var _t22 of o.getChildren())if(co(_t22)){Pt(bi(dt,_t22.getKey()),_t22);}}else{var _t23=o.getTextContent();if(fo(o)){var _t24=o.decorate(dt,ft);null!==_t24&&Wt(e,_t24);}St+=_t23,vt+=_t23;}if(!Et&&go(o)&&o.__cachedText!==vt){var _t25=o.getWritable();_t25.__cachedText=vt,o=_t25;}return s;}function Wt(t,e){var n=dt._pendingDecorators;var r=dt._decorators;if(null===n){if(r[t]===e)return;n=ei(dt);}n[t]=e;}function $t(t){var e=t.nextSibling;return null!==e&&e===dt._blockCursorElement&&(e=e.nextSibling),e;}function Ut(t,e,n,r,o,i){St="",vt="",kt=2===r,dt=n,ft=n._config,ht=n._nodes,gt=dt._listeners.mutation,_t=o,pt=i,yt=t._nodeMap,mt=e._nodeMap,Et=e._readOnly,xt=new Map(n._keyToDOMMap);var s=new Map();return Ct=s,zt("root",null),dt=void 0,ht=void 0,_t=void 0,pt=void 0,yt=void 0,mt=void 0,ft=void 0,xt=void 0,Ct=void 0,s;}function Jt(e){var n=xt.get(e);return void 0===n&&t(75,e),n;}function Yt(t){return{type:t};}var jt=Yt("SELECTION_CHANGE_COMMAND"),Ht=Yt("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),Vt=Yt("CLICK_COMMAND"),Gt=Yt("BEFORE_INPUT_COMMAND"),qt=Yt("INPUT_COMMAND"),Xt=Yt("COMPOSITION_START_COMMAND"),Qt=Yt("COMPOSITION_END_COMMAND"),Zt=Yt("DELETE_CHARACTER_COMMAND"),te=Yt("INSERT_LINE_BREAK_COMMAND"),ee=Yt("INSERT_PARAGRAPH_COMMAND"),ne=Yt("CONTROLLED_TEXT_INSERTION_COMMAND"),re=Yt("PASTE_COMMAND"),oe=Yt("REMOVE_TEXT_COMMAND"),ie=Yt("DELETE_WORD_COMMAND"),se=Yt("DELETE_LINE_COMMAND"),le=Yt("FORMAT_TEXT_COMMAND"),ce=Yt("UNDO_COMMAND"),ae=Yt("REDO_COMMAND"),ue=Yt("KEYDOWN_COMMAND"),fe=Yt("KEY_ARROW_RIGHT_COMMAND"),de=Yt("MOVE_TO_END"),he=Yt("KEY_ARROW_LEFT_COMMAND"),ge=Yt("MOVE_TO_START"),_e=Yt("KEY_ARROW_UP_COMMAND"),pe=Yt("KEY_ARROW_DOWN_COMMAND"),ye=Yt("KEY_ENTER_COMMAND"),me=Yt("KEY_SPACE_COMMAND"),xe=Yt("KEY_BACKSPACE_COMMAND"),Ce=Yt("KEY_ESCAPE_COMMAND"),Se=Yt("KEY_DELETE_COMMAND"),Ne=Yt("KEY_TAB_COMMAND"),Te=Yt("INSERT_TAB_COMMAND"),ve=Yt("INDENT_CONTENT_COMMAND"),ke=Yt("OUTDENT_CONTENT_COMMAND"),Ee=Yt("DROP_COMMAND"),Oe=Yt("FORMAT_ELEMENT_COMMAND"),be=Yt("DRAGSTART_COMMAND"),Me=Yt("DRAGOVER_COMMAND"),Ae=Yt("DRAGEND_COMMAND"),we=Yt("COPY_COMMAND"),De=Yt("CUT_COMMAND"),Pe=Yt("SELECT_ALL_COMMAND"),Ie=Yt("CLEAR_EDITOR_COMMAND"),Le=Yt("CLEAR_HISTORY_COMMAND"),Fe=Yt("CAN_REDO_COMMAND"),Re=Yt("CAN_UNDO_COMMAND"),Ke=Yt("FOCUS_COMMAND"),Be=Yt("BLUR_COMMAND"),ze=Yt("KEY_MODIFIER_COMMAND"),We=Object.freeze({}),$e=[["keydown",function(t,e){if(Ue=t.timeStamp,Je=t.key,e.isComposing())return;Ei(e,ue,t);}],["pointerdown",function(t,e){var n=t.target,r=t.pointerType;Hi(n)&&"touch"!==r&&"pen"!==r&&0===t.button&&oo(e,function(){Io(n)||(qe=!0);});}],["compositionstart",function(t,e){Ei(e,Xt,t);}],["compositionend",function(t,e){i?Qe=!0:c||!l&&!d?Ei(e,Qt,t):(Ze=!0,tn=t.data);}],["input",function(t,e){t.stopPropagation(),oo(e,function(){e.dispatchCommand(qt,t);},{event:t}),je=null;}],["click",function(t,e){oo(e,function(){var n=kr(),r=Ji(Li(e)),o=Er();if(r)if(ar(n)){var _e22=n.anchor,_i5=_e22.getNode();if("element"===_e22.type&&0===_e22.offset&&n.isCollapsed()&&!go(_i5)&&1===ri().getChildrenSize()&&_i5.getTopLevelElementOrThrow().isEmpty()&&null!==o&&n.is(o))r.removeAllRanges(),n.dirty=!0;else if(3===t.detail&&!n.isCollapsed()){if(_i5!==n.focus.getNode()){var _t26=ls(_i5,function(t){return co(t)&&!t.isInline();});co(_t26)&&_t26.select(0);}}}else if("touch"===t.pointerType||"pen"===t.pointerType){var _n17=r.anchorNode;if(ji(_n17)||$o(_n17)){ii(vr(o,r,e,t));}}Ei(e,Vt,t);});}],["cut",We],["copy",We],["dragstart",We],["dragover",We],["dragend",We],["paste",We],["focus",We],["blur",We],["drop",We]];s&&$e.push(["beforeinput",function(t,e){return function(t,e){var n=t.inputType;if("deleteCompositionText"===n||i&&ki(e))return;if("insertCompositionText"===n)return;Ei(e,Gt,t);}(t,e);}]);var Ue=0,Je=null,Ye=0,je=null;var He=new WeakMap(),Ve=new WeakMap();var Ge=!1,qe=!1,Xe=!1,Qe=!1,Ze=!1,tn="",en=null,nn=[0,"",0,"root",0];function rn(t,e,n,r,o){var i=t.anchor,l=t.focus,c=i.getNode(),a=jr(),u=Ji(Li(a)),f=null!==u?u.anchorNode:null,d=i.key,h=a.getElementByKey(d),g=n.length;return d!==l.key||!Zn(c)||(!o&&(!s||Ye<r+50)||c.isDirty()&&g<2||li(n))&&i.offset!==l.offset&&!c.isComposing()||Wo(c)||c.isDirty()&&g>1||(o||!s)&&null!==h&&!c.isComposing()&&f!==Jo(h)||null!==u&&null!==e&&(!e.collapsed||e.startContainer!==u.anchorNode||e.startOffset!==u.anchorOffset)||c.getFormat()!==t.format||c.getStyle()!==t.style||function(t,e){if(e.isSegmented())return!0;if(!t.isCollapsed())return!1;var n=t.anchor.offset,r=e.getParentOrThrow(),o=zo(e);return 0===n?!e.canInsertTextBefore()||!r.canInsertTextBefore()&&!e.isComposing()||o||function(t){var e=t.getPreviousSibling();return(Zn(e)||co(e)&&e.isInline())&&!e.canInsertTextAfter();}(e):n===e.getTextContentSize()&&(!e.canInsertTextAfter()||!r.canInsertTextAfter()&&!e.isComposing()||o);}(t,c);}function on(t,e){return $o(t)&&null!==t.nodeValue&&0!==e&&e!==t.nodeValue.length;}function sn(e,n,r){var o=e.anchorNode,i=e.anchorOffset,s=e.focusNode,l=e.focusOffset;Ge&&(Ge=!1,on(o,i)&&on(s,l)&&!en)||oo(n,function(){if(!r)return void ii(null);if(!Fo(n,o,s))return;var c=kr();if(en&&ar(c)&&c.isCollapsed()){var _t27=c.anchor,_e23=en.anchor;(_t27.key===_e23.key&&_t27.offset===_e23.offset+1||1===_t27.offset&&_e23.getNode().is(_t27.getNode().getPreviousSibling()))&&(c=en.clone(),ii(c));}if(en=null,ar(c)){var _r13=c.anchor,_o12=_r13.getNode();if(c.isCollapsed()){"Range"===e.type&&e.anchorNode===e.focusNode&&(c.dirty=!0);var _i6=Li(n).event,_s6=_i6?_i6.timeStamp:performance.now(),_nn=nn,_l=_nn[0],_a=_nn[1],_u=_nn[2],_f=_nn[3],_d2=_nn[4],_h2=ri(),_g2=!1===n.isComposing()&&""===_h2.getTextContent();if(_s6<_d2+200&&_r13.offset===_u&&_r13.key===_f)ln(c,_l,_a);else if("text"===_r13.type)Zn(_o12)||t(141),cn(c,_o12);else if("element"===_r13.type&&!_g2){co(_o12)||t(259);var _e24=_r13.getNode();_e24.isEmpty()?function(t,e){var n=e.getTextFormat(),r=e.getTextStyle();ln(t,n,r);}(c,_e24):ln(c,0,"");}}else{var _t28=_r13.key,_e25=c.focus.key,_n18=c.getNodes(),_o13=_n18.length,_s7=c.isBackward(),_a2=_s7?l:i,_u2=_s7?i:l,_f2=_s7?_e25:_t28,_d3=_s7?_t28:_e25;var _h3=2047,_g3=!1;for(var _t29=0;_t29<_o13;_t29++){var _e26=_n18[_t29],_r14=_e26.getTextContentSize();if(Zn(_e26)&&0!==_r14&&!(0===_t29&&_e26.__key===_f2&&_a2===_r14||_t29===_o13-1&&_e26.__key===_d3&&0===_u2)&&(_g3=!0,_h3&=_e26.getFormat(),0===_h3))break;}c.format=_g3?_h3:0;}}Ei(n,jt,void 0);});}function ln(t,e,n){t.format===e&&t.style===n||(t.format=e,t.style=n,t.dirty=!0);}function cn(t,e){ln(t,e.getFormat(),e.getStyle());}function an(t){if(!t.getTargetRanges)return null;var e=t.getTargetRanges();return 0===e.length?null:e[0];}function un(e){var n=e.inputType,r=an(e),o=jr(),i=kr();if("deleteContentBackward"===n){if(null===i){var _t30=Er();if(!ar(_t30))return!0;ii(_t30.clone());}if(ar(i)){var _n19=i.anchor.key===i.focus.key;if(s=e.timeStamp,"MediaLast"===Je&&s<Ue+30&&o.isComposing()&&_n19){if(Go(null),Ue=0,setTimeout(function(){oo(o,function(){Go(null);});},30),ar(i)){var _e27=i.anchor.getNode();_e27.markDirty(),Zn(_e27)||t(142),cn(i,_e27);}}else{Go(null),e.preventDefault();var _t31=i.anchor.getNode(),_r15=_t31.getTextContent(),_s8=_t31.canInsertTextAfter(),_l2=0===i.anchor.offset&&i.focus.offset===_r15.length;var _c2=f&&_n19&&!_l2&&_s8;if(_c2&&i.isCollapsed()&&(_c2=!fo(vi(i.anchor,!0))),!_c2){Ei(o,Zt,!0);var _t32=kr();f&&ar(_t32)&&_t32.isCollapsed()&&(en=_t32,setTimeout(function(){return en=null;}));}}return!0;}}var s;if(!ar(i))return!0;var l=e.data;null!==je&&fi(!1,o,je),i.dirty&&null===je||!i.isCollapsed()||go(i.anchor.getNode())||null===r||i.applyDOMRange(r),je=null;var a=i.anchor,u=i.focus,d=a.getNode(),h=u.getNode();if("insertText"===n||"insertTranspose"===n){if("\n"===l)e.preventDefault(),Ei(o,te,!1);else if(l===k)e.preventDefault(),Ei(o,ee,void 0);else if(null==l&&e.dataTransfer){var _t33=e.dataTransfer.getData("text/plain");e.preventDefault(),i.insertRawText(_t33);}else null!=l&&rn(i,r,l,e.timeStamp,!0)?(e.preventDefault(),Ei(o,ne,l)):je=l;return Ye=e.timeStamp,!0;}switch(e.preventDefault(),n){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Ei(o,ne,e);break;case"insertFromComposition":Go(null),Ei(o,ne,e);break;case"insertLineBreak":Go(null),Ei(o,te,!1);break;case"insertParagraph":Go(null),Xe&&!c?(Xe=!1,Ei(o,te,!1)):Ei(o,ee,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Ei(o,re,e);break;case"deleteByComposition":(function(t,e){return t!==e||co(t)||co(e)||!zo(t)||!zo(e);})(d,h)&&Ei(o,oe,e);break;case"deleteByDrag":case"deleteByCut":Ei(o,oe,e);break;case"deleteContent":Ei(o,Zt,!1);break;case"deleteWordBackward":Ei(o,ie,!0);break;case"deleteWordForward":Ei(o,ie,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Ei(o,se,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Ei(o,se,!1);break;case"formatStrikeThrough":Ei(o,le,"strikethrough");break;case"formatBold":Ei(o,le,"bold");break;case"formatItalic":Ei(o,le,"italic");break;case"formatUnderline":Ei(o,le,"underline");break;case"historyUndo":Ei(o,ce,void 0);break;case"historyRedo":Ei(o,ae,void 0);}return!0;}function fn(t){if(ji(t.target)&&Io(t.target))return!0;var e=jr(),n=kr(),r=t.data,o=an(t);if(null!=r&&ar(n)&&rn(n,o,r,t.timeStamp,!1)){Qe&&(gn(e,r),Qe=!1);var _o14=n.anchor.getNode(),_a3=Ji(Li(e));if(null===_a3)return!0;var _u3=n.isBackward(),_f3=_u3?n.anchor.offset:n.focus.offset,_h4=_u3?n.focus.offset:n.anchor.offset;s&&!n.isCollapsed()&&Zn(_o14)&&null!==_a3.anchorNode&&_o14.getTextContent().slice(0,_f3)+r+_o14.getTextContent().slice(_f3+_h4)===ui(_a3.anchorNode)||Ei(e,ne,r);var _g4=r.length;i&&_g4>1&&"insertCompositionText"===t.inputType&&!e.isComposing()&&(n.anchor.offset-=_g4),l||c||d||!e.isComposing()||(Ue=0,Go(null));}else{fi(!1,e,null!==r?r:void 0),Qe&&(gn(e,r||void 0),Qe=!1);}return function(){Ur();var t=jr();H(t);}(),!0;}function dn(t){var e=jr(),n=kr();if(ar(n)&&!e.isComposing()){var _r16=n.anchor,_o15=n.anchor.getNode();Go(_r16.key),(t.timeStamp<Ue+30||"element"===_r16.type||!n.isCollapsed()||_o15.getFormat()!==n.format||Zn(_o15)&&_o15.getStyle()!==n.style)&&Ei(e,ne,E);}return!0;}function hn(t){return gn(jr(),t.data),!0;}function gn(t,e){var n=t._compositionKey;if(Go(null),null!==n&&null!=e){if(""===e){var _e28=Xo(n),_r17=Jo(t.getElementByKey(n));return void(null!==_r17&&null!==_r17.nodeValue&&Zn(_e28)&&di(_e28,_r17.nodeValue,null,null,!0));}if("\n"===e[e.length-1]){var _e29=kr();if(ar(_e29)){var _n20=_e29.focus;return _e29.anchor.set(_n20.key,_n20.offset,_n20.type),void Ei(t,ye,null);}}}fi(!0,t,e);}function _n(t){var e=jr();if(null==t.key)return!0;if(Ze&&xi(t))return oo(e,function(){gn(e,tn);}),Ze=!1,tn="",!0;if(function(t){return pi(t,"ArrowRight",{shiftKey:"any"});}(t))Ei(e,fe,t);else if(function(t){return pi(t,"ArrowRight",yi);}(t))Ei(e,de,t);else if(function(t){return pi(t,"ArrowLeft",{shiftKey:"any"});}(t))Ei(e,he,t);else if(function(t){return pi(t,"ArrowLeft",yi);}(t))Ei(e,ge,t);else if(function(t){return pi(t,"ArrowUp",{altKey:"any",shiftKey:"any"});}(t))Ei(e,_e,t);else if(function(t){return pi(t,"ArrowDown",{altKey:"any",shiftKey:"any"});}(t))Ei(e,pe,t);else if(function(t){return pi(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0});}(t))Xe=!0,Ei(e,ye,t);else if(function(t){return" "===t.key;}(t))Ei(e,me,t);else if(function(t){return o&&pi(t,"o",{ctrlKey:!0});}(t))t.preventDefault(),Xe=!0,Ei(e,te,!0);else if(function(t){return pi(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"});}(t))Xe=!1,Ei(e,ye,t);else if(function(t){return pi(t,"Backspace",{shiftKey:"any"})||o&&pi(t,"h",{ctrlKey:!0});}(t))xi(t)?Ei(e,xe,t):(t.preventDefault(),Ei(e,Zt,!0));else if(function(t){return"Escape"===t.key;}(t))Ei(e,Ce,t);else if(function(t){return pi(t,"Delete",{})||o&&pi(t,"d",{ctrlKey:!0});}(t))!function(t){return"Delete"===t.key;}(t)?(t.preventDefault(),Ei(e,Zt,!1)):Ei(e,Se,t);else if(function(t){return pi(t,"Backspace",mi);}(t))t.preventDefault(),Ei(e,ie,!0);else if(function(t){return pi(t,"Delete",mi);}(t))t.preventDefault(),Ei(e,ie,!1);else if(function(t){return o&&pi(t,"Backspace",{metaKey:!0});}(t))t.preventDefault(),Ei(e,se,!0);else if(function(t){return o&&(pi(t,"Delete",{metaKey:!0})||pi(t,"k",{ctrlKey:!0}));}(t))t.preventDefault(),Ei(e,se,!1);else if(function(t){return pi(t,"b",yi);}(t))t.preventDefault(),Ei(e,le,"bold");else if(function(t){return pi(t,"u",yi);}(t))t.preventDefault(),Ei(e,le,"underline");else if(function(t){return pi(t,"i",yi);}(t))t.preventDefault(),Ei(e,le,"italic");else if(function(t){return pi(t,"Tab",{shiftKey:"any"});}(t))Ei(e,Ne,t);else if(function(t){return pi(t,"z",yi);}(t))t.preventDefault(),Ei(e,ce,void 0);else if(function(t){if(o)return pi(t,"z",{metaKey:!0,shiftKey:!0});return pi(t,"y",{ctrlKey:!0})||pi(t,"z",{ctrlKey:!0,shiftKey:!0});}(t))t.preventDefault(),Ei(e,ae,void 0);else{var _n21=e._editorState._selection;null===_n21||ar(_n21)?Ci(t)&&(t.preventDefault(),Ei(e,Pe,t)):!function(t){return pi(t,"c",yi);}(t)?!function(t){return pi(t,"x",yi);}(t)?Ci(t)&&(t.preventDefault(),Ei(e,Pe,t)):(t.preventDefault(),Ei(e,De,t)):(t.preventDefault(),Ei(e,we,t));}return function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey;}(t)&&e.dispatchCommand(ze,t),!0;}function pn(t){var e=t.__lexicalEventHandles;return void 0===e&&(e=[],t.__lexicalEventHandles=e),e;}var yn=new Map();function mn(t){var e=Yi(t.target);if(null===e)return;var n=Ko(e.anchorNode);if(null===n)return;qe&&(qe=!1,oo(n,function(){var r=Er(),o=e.anchorNode;if(ji(o)||$o(o)){ii(vr(r,e,n,t));}}));var r=ci(n),o=r[r.length-1],i=o._key,s=yn.get(i),l=s||o;l!==n&&sn(e,l,!1),sn(e,n,!0),n!==o?yn.set(i,n):s&&yn["delete"](i);}function xn(t){t._lexicalHandled=!0;}function Cn(t){return!0===t._lexicalHandled;}var Sn=function Sn(){};function Nn(e){var n=He.get(e);if(void 0===n)return void Sn();var r=Ve.get(n);if(void 0===r)return void Sn();var o=r-1;o>=0||t(164),He["delete"](e),Ve.set(n,o),0===o&&n.removeEventListener("selectionchange",mn);var i=Bo(e);Ro(i)?(!function(t){if(null!==t._parentEditor){var _e30=ci(t),_n22=_e30[_e30.length-1]._key;yn.get(_n22)===t&&yn["delete"](_n22);}else yn["delete"](t._key);}(i),e.__lexicalEditor=null):i&&t(198);var s=pn(e);for(var _t34=0;_t34<s.length;_t34++)s[_t34]();e.__lexicalEventHandles=[];}function Tn(t,e,n){Ur();var r=t.__key,o=t.getParent();if(null===o)return;var i=function(t){var e=kr();if(!ar(e)||!co(t))return e;var n=e.anchor,r=e.focus,o=n.getNode(),i=r.getNode();Pi(o,t)&&n.set(t.__key,0,"element");Pi(i,t)&&r.set(t.__key,0,"element");return e;}(t);var s=!1;if(ar(i)&&e){var _e31=i.anchor,_n23=i.focus;_e31.key===r&&(Mr(_e31,t,o,t.getPreviousSibling(),t.getNextSibling()),s=!0),_n23.key===r&&(Mr(_n23,t,o,t.getPreviousSibling(),t.getNextSibling()),s=!0);}else fr(i)&&e&&t.isSelected()&&t.selectPrevious();if(ar(i)&&e&&!s){var _e32=t.getIndexWithinParent();Ho(t),Or(i,o,_e32,-1);}else Ho(t);n||Ri(o)||o.canBeEmpty()||!o.isEmpty()||Tn(o,e),e&&i&&go(o)&&o.isEmpty()&&o.selectEnd();}var vn=Symbol["for"]("ephemeral");function kn(t){return t[vn]||!1;}var _En5=function(){function En(t){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),jo(this,t);}En.getType=function getType(){var _ss2=ss(this),e=_ss2.ownNodeType;return void 0===e&&t(64,this.name),e;};En.clone=function clone(e){t(65,this.name);};var _proto2=En.prototype;_proto2.$config=function $config(){return{};};_proto2.config=function config(t,e){var _ref13;var n=e["extends"]||Object.getPrototypeOf(this.constructor);return Object.assign(e,{"extends":n,type:t}),_ref13={},_ref13[t]=e,_ref13;};_proto2.afterCloneFrom=function afterCloneFrom(t){this.__key===t.__key?(this.__parent=t.__parent,this.__next=t.__next,this.__prev=t.__prev,this.__state=t.__state):t.__state&&(this.__state=t.__state.getWritable(this));};_proto2.getType=function getType(){return this.__type;};_proto2.isInline=function isInline(){t(137,this.constructor.name);};_proto2.isAttached=function isAttached(){var t=this.__key;for(;null!==t;){if("root"===t)return!0;var _e33=Xo(t);if(null===_e33)break;t=_e33.__parent;}return!1;};_proto2.isSelected=function isSelected(t){var _this12=this;var e=t||kr();if(null==e)return!1;var n=e.getNodes().some(function(t){return t.__key===_this12.__key;});if(Zn(this))return n;if(ar(e)&&"element"===e.anchor.type&&"element"===e.focus.type){if(e.isCollapsed())return!1;var _t35=this.getParent();if(fo(this)&&this.isInline()&&_t35){var _n24=e.isBackward()?e.focus:e.anchor;if(_t35.is(_n24.getNode())&&_n24.offset===_t35.getChildrenSize()&&this.is(_t35.getLastChild()))return!1;}}return n;};_proto2.getKey=function getKey(){return this.__key;};_proto2.getIndexWithinParent=function getIndexWithinParent(){var t=this.getParent();if(null===t)return-1;var e=t.getFirstChild(),n=0;for(;null!==e;){if(this.is(e))return n;n++,e=e.getNextSibling();}return-1;};_proto2.getParent=function getParent(){var t=this.getLatest().__parent;return null===t?null:Xo(t);};_proto2.getParentOrThrow=function getParentOrThrow(){var e=this.getParent();return null===e&&t(66,this.__key),e;};_proto2.getTopLevelElement=function getTopLevelElement(){var e=this;for(;null!==e;){var _n25=e.getParent();if(Ri(_n25))return co(e)||e===this&&fo(e)||t(194),e;e=_n25;}return null;};_proto2.getTopLevelElementOrThrow=function getTopLevelElementOrThrow(){var e=this.getTopLevelElement();return null===e&&t(67,this.__key),e;};_proto2.getParents=function getParents(){var t=[];var e=this.getParent();for(;null!==e;)t.push(e),e=e.getParent();return t;};_proto2.getParentKeys=function getParentKeys(){var t=[];var e=this.getParent();for(;null!==e;)t.push(e.__key),e=e.getParent();return t;};_proto2.getPreviousSibling=function getPreviousSibling(){var t=this.getLatest().__prev;return null===t?null:Xo(t);};_proto2.getPreviousSiblings=function getPreviousSiblings(){var t=[],e=this.getParent();if(null===e)return t;var n=e.getFirstChild();for(;null!==n&&!n.is(this);)t.push(n),n=n.getNextSibling();return t;};_proto2.getNextSibling=function getNextSibling(){var t=this.getLatest().__next;return null===t?null:Xo(t);};_proto2.getNextSiblings=function getNextSiblings(){var t=[];var e=this.getNextSibling();for(;null!==e;)t.push(e),e=e.getNextSibling();return t;};_proto2.getCommonAncestor=function getCommonAncestor(t){var e=co(this)?this:this.getParent(),n=co(t)?t:t.getParent(),r=e&&n?Bs(e,n):null;return r?r.commonAncestor:null;};_proto2.is=function is(t){return null!=t&&this.__key===t.__key;};_proto2.isBefore=function isBefore(e){var n=Bs(this,e);return null!==n&&("descendant"===n.type||("branch"===n.type?-1===Fs(n):("same"!==n.type&&"ancestor"!==n.type&&t(279),!1)));};_proto2.isParentOf=function isParentOf(t){var e=Bs(this,t);return null!==e&&"ancestor"===e.type;};_proto2.getNodesBetween=function getNodesBetween(e){var n=this.isBefore(e),r=[],o=new Set();var i=this;for(;null!==i;){var _s9=i.__key;if(o.has(_s9)||(o.add(_s9),r.push(i)),i===e)break;var _l3=co(i)?n?i.getFirstChild():i.getLastChild():null;if(null!==_l3){i=_l3;continue;}var _c3=n?i.getNextSibling():i.getPreviousSibling();if(null!==_c3){i=_c3;continue;}var _a4=i.getParentOrThrow();if(o.has(_a4.__key)||r.push(_a4),_a4===e)break;var _u4=null,_f4=_a4;do{if(null===_f4&&t(68),_u4=n?_f4.getNextSibling():_f4.getPreviousSibling(),_f4=_f4.getParent(),null===_f4)break;null!==_u4||o.has(_f4.__key)||r.push(_f4);}while(null===_u4);i=_u4;}return n||r.reverse(),r;};_proto2.isDirty=function isDirty(){var t=jr()._dirtyLeaves;return null!==t&&t.has(this.__key);};_proto2.getLatest=function getLatest(){if(kn(this))return this;var e=Xo(this.__key);return null===e&&t(113),e;};_proto2.getWritable=function getWritable(){if(kn(this))return this;Ur();var t=Yr(),e=jr(),n=t._nodeMap,r=this.__key,o=this.getLatest(),i=e._cloneNotNeeded,s=kr();if(null!==s&&s.setCachedNodes(null),i.has(r))return Vo(o),o;var l=ns(o);return i.add(r),Vo(l),n.set(r,l),l;};_proto2.getTextContent=function getTextContent(){return"";};_proto2.getTextContentSize=function getTextContentSize(){return this.getTextContent().length;};_proto2.createDOM=function createDOM(e,n){t(70);};_proto2.updateDOM=function updateDOM(e,n,r){t(71);};_proto2.exportDOM=function exportDOM(t){return{element:this.createDOM(t._config,t)};};_proto2.exportJSON=function exportJSON(){var t=this.__state?this.__state.toJSON():void 0;return babelHelpers["extends"]({type:this.__type,version:1},t);};En.importJSON=function importJSON(e){t(18,this.name);};_proto2.updateFromJSON=function updateFromJSON(t){return function(t,e){var n=t.getWritable(),r=e.$;var o=r;for(var _t36 of tt(n).flatKeys)_t36 in e&&(void 0!==o&&o!==r||(o=babelHelpers["extends"]({},r)),o[_t36]=e[_t36]);return(n.__state||o)&&Z(t).updateFromJSON(o),n;}(this,t);};En.transform=function transform(){return null;};_proto2.remove=function remove(t){Tn(this,!0,t);};_proto2.replace=function replace(e,n){Ur();var r=kr();null!==r&&(r=r.clone()),zi(this,e);var o=this.getLatest(),i=this.__key,s=e.__key,l=e.getWritable(),c=this.getParentOrThrow().getWritable(),a=c.__size;Ho(l);var u=o.getPreviousSibling(),f=o.getNextSibling(),d=o.__prev,h=o.__next,g=o.__parent;if(Tn(o,!1,!0),null===u)c.__first=s;else{u.getWritable().__next=s;}if(l.__prev=d,null===f)c.__last=s;else{f.getWritable().__prev=s;}if(l.__next=h,l.__parent=g,c.__size=a,n&&(co(this)&&co(l)||t(139),this.getChildren().forEach(function(t){l.append(t);})),ar(r)){ii(r);var _t37=r.anchor,_e34=r.focus;_t37.key===i&&lr(_t37,l),_e34.key===i&&lr(_e34,l);}return qo()===i&&Go(s),l;};_proto2.insertAfter=function insertAfter(t,e){if(e===void 0){e=!0;}Ur(),zi(this,t);var n=this.getWritable(),r=t.getWritable(),o=r.getParent(),i=kr();var s=!1,l=!1;if(null!==o){var _e35=t.getIndexWithinParent();if(Ho(r),ar(i)){var _t38=o.__key,_n26=i.anchor,_r18=i.focus;s="element"===_n26.type&&_n26.key===_t38&&_n26.offset===_e35+1,l="element"===_r18.type&&_r18.key===_t38&&_r18.offset===_e35+1;}}var c=this.getNextSibling(),a=this.getParentOrThrow().getWritable(),u=r.__key,f=n.__next;if(null===c)a.__last=u;else{c.getWritable().__prev=u;}if(a.__size++,n.__next=u,r.__next=f,r.__prev=n.__key,r.__parent=n.__parent,e&&ar(i)){var _t39=this.getIndexWithinParent();Or(i,a,_t39+1);var _e36=a.__key;s&&i.anchor.set(_e36,_t39+2,"element"),l&&i.focus.set(_e36,_t39+2,"element");}return t;};_proto2.insertBefore=function insertBefore(t,e){if(e===void 0){e=!0;}Ur(),zi(this,t);var n=this.getWritable(),r=t.getWritable(),o=r.__key;Ho(r);var i=this.getPreviousSibling(),s=this.getParentOrThrow().getWritable(),l=n.__prev,c=this.getIndexWithinParent();if(null===i)s.__first=o;else{i.getWritable().__next=o;}s.__size++,n.__prev=o,r.__prev=l,r.__next=n.__key,r.__parent=n.__parent;var a=kr();if(e&&ar(a)){Or(a,this.getParentOrThrow(),c);}return t;};_proto2.isParentRequired=function isParentRequired(){return!1;};_proto2.createParentElementNode=function createParentElementNode(){return No();};_proto2.selectStart=function selectStart(){return this.selectPrevious();};_proto2.selectEnd=function selectEnd(){return this.selectNext(0,0);};_proto2.selectPrevious=function selectPrevious(t,e){Ur();var n=this.getPreviousSibling(),r=this.getParentOrThrow();if(null===n)return r.select(0,0);if(co(n))return n.select();if(!Zn(n)){var _t40=n.getIndexWithinParent()+1;return r.select(_t40,_t40);}return n.select(t,e);};_proto2.selectNext=function selectNext(t,e){Ur();var n=this.getNextSibling(),r=this.getParentOrThrow();if(null===n)return r.select();if(co(n))return n.select(0,0);if(!Zn(n)){var _t41=n.getIndexWithinParent();return r.select(_t41,_t41);}return n.select(t,e);};_proto2.markDirty=function markDirty(){this.getWritable();};_proto2.reconcileObservedMutation=function reconcileObservedMutation(t,e){this.markDirty();};return En;}();var On="history-merge",bn="collaboration",Mn="skip-scroll-into-view",An="skip-dom-selection",wn="skip-selection-focus";var _Dn=function(_En){function Dn(t){return _En.call(this,t)||this;}babelHelpers.inheritsLoose(Dn,_En);Dn.getType=function getType(){return"linebreak";};Dn.clone=function clone(t){return new Dn(t.__key);};var _proto3=Dn.prototype;_proto3.getTextContent=function getTextContent(){return"\n";};_proto3.createDOM=function createDOM(){return document.createElement("br");};_proto3.updateDOM=function updateDOM(){return!1;};_proto3.isInline=function isInline(){return!0;};Dn.importDOM=function importDOM(){return{br:function br(t){return function(t){var e=t.parentElement;if(null!==e&&qi(e)){var _n27=e.firstChild;if(_n27===t||_n27.nextSibling===t&&Fn(_n27)){var _n28=e.lastChild;if(_n28===t||_n28.previousSibling===t&&Fn(_n28))return!0;}}return!1;}(t)||function(t){var e=t.parentElement;if(null!==e&&qi(e)){var _n29=e.firstChild;if(_n29===t||_n29.nextSibling===t&&Fn(_n29))return!1;var _r19=e.lastChild;if(_r19===t||_r19.previousSibling===t&&Fn(_r19))return!0;}return!1;}(t)?null:{conversion:Pn,priority:0};}};};Dn.importJSON=function importJSON(t){return In().updateFromJSON(t);};return Dn;}(_En5);function Pn(t){return{node:In()};}function In(){return Bi(new _Dn());}function Ln(t){return t instanceof _Dn;}function Fn(t){return $o(t)&&/^( |\t|\r?\n)+$/.test(t.textContent||"");}function Rn(t,e){return 16&e?"code":e&y?"mark":32&e?"sub":64&e?"sup":null;}function Kn(t,e){return 1&e?"strong":2&e?"em":"span";}function Bn(t,e,n,r,o){var i=r.classList;var s=Si(o,"base");void 0!==s&&i.add.apply(i,s),s=Si(o,"underlineStrikethrough");var l=!1;var c=8&e&&4&e;void 0!==s&&(8&n&&4&n?(l=!0,c||i.add.apply(i,s)):c&&i.remove.apply(i,s));for(var _t42 in w){var _r20=w[_t42];if(s=Si(o,_t42),void 0!==s)if(n&_r20){if(l&&("underline"===_t42||"strikethrough"===_t42)){e&_r20&&i.remove.apply(i,s);continue;}(0===(e&_r20)||c&&"underline"===_t42||"strikethrough"===_t42)&&i.add.apply(i,s);}else e&_r20&&i.remove.apply(i,s);}}function zn(t,e,n){var r=e.firstChild,o=n.isComposing(),s=t+(o?v:"");if(null==r)e.textContent=s;else{var _t43=r.nodeValue;if(_t43!==s)if(o||i){var _ref14=function(t,e){var n=t.length,r=e.length;var o=0,i=0;for(;o<n&&o<r&&t[o]===e[o];)o++;for(;i+o<n&&i+o<r&&t[n-i-1]===e[r-i-1];)i++;return[o,n-o-i,e.slice(o,r-i)];}(_t43,s),_e37=_ref14[0],_n30=_ref14[1],_o16=_ref14[2];0!==_n30&&r.deleteData(_e37,_n30),r.insertData(_e37,_o16);}else r.nodeValue=s;}}function Wn(t,e,n,r,o,i){zn(o,t,e);var s=i.theme.text;void 0!==s&&Bn(0,0,r,t,s);}function $n(t,e){var n=document.createElement(e);return n.appendChild(t),n;}var _Un2=function(_En2){function Un(t,e){var _this;if(t===void 0){t="";}_this=_En2.call(this,e)||this,_this.__text=t,_this.__format=0,_this.__style="",_this.__mode=0,_this.__detail=0;return _this;}babelHelpers.inheritsLoose(Un,_En2);Un.getType=function getType(){return"text";};Un.clone=function clone(t){return new Un(t.__text,t.__key);};var _proto4=Un.prototype;_proto4.afterCloneFrom=function afterCloneFrom(t){_En2.prototype.afterCloneFrom.call(this,t),this.__text=t.__text,this.__format=t.__format,this.__style=t.__style,this.__mode=t.__mode,this.__detail=t.__detail;};_proto4.getFormat=function getFormat(){return this.getLatest().__format;};_proto4.getDetail=function getDetail(){return this.getLatest().__detail;};_proto4.getMode=function getMode(){var t=this.getLatest();return F[t.__mode];};_proto4.getStyle=function getStyle(){return this.getLatest().__style;};_proto4.isToken=function isToken(){return 1===this.getLatest().__mode;};_proto4.isComposing=function isComposing(){return this.__key===qo();};_proto4.isSegmented=function isSegmented(){return 2===this.getLatest().__mode;};_proto4.isDirectionless=function isDirectionless(){return!!(1&this.getLatest().__detail);};_proto4.isUnmergeable=function isUnmergeable(){return!!(2&this.getLatest().__detail);};_proto4.hasFormat=function hasFormat(t){var e=w[t];return 0!==(this.getFormat()&e);};_proto4.isSimpleText=function isSimpleText(){return"text"===this.__type&&0===this.__mode;};_proto4.getTextContent=function getTextContent(){return this.getLatest().__text;};_proto4.getFormatFlags=function getFormatFlags(t,e){return Yo(this.getLatest().__format,t,e);};_proto4.canHaveFormat=function canHaveFormat(){return!0;};_proto4.isInline=function isInline(){return!0;};_proto4.createDOM=function createDOM(t,e){var n=this.__format,r=Rn(0,n),o=Kn(0,n),i=null===r?o:r,s=document.createElement(i);var l=s;this.hasFormat("code")&&s.setAttribute("spellcheck","false"),null!==r&&(l=document.createElement(o),s.appendChild(l));Wn(l,this,0,n,this.__text,t);var c=this.__style;return""!==c&&(s.style.cssText=c),s;};_proto4.updateDOM=function updateDOM(e,n,r){var o=this.__text,i=e.__format,s=this.__format,l=Rn(0,i),c=Rn(0,s),a=Kn(0,i),u=Kn(0,s);if((null===l?a:l)!==(null===c?u:c))return!0;if(l===c&&a!==u){var _e38=n.firstChild;null==_e38&&t(48);var _i7=document.createElement(u);return Wn(_i7,this,0,s,o,r),n.replaceChild(_i7,_e38),!1;}var f=n;null!==c&&null!==l&&(f=n.firstChild,null==f&&t(49)),zn(o,f,this);var d=r.theme.text;void 0!==d&&i!==s&&Bn(0,i,s,f,d);var h=e.__style,g=this.__style;return h!==g&&(n.style.cssText=g),!1;};Un.importDOM=function importDOM(){return{"#text":function text(){return{conversion:Vn,priority:0};},b:function b(){return{conversion:Yn,priority:0};},code:function code(){return{conversion:Xn,priority:0};},em:function em(){return{conversion:Xn,priority:0};},i:function i(){return{conversion:Xn,priority:0};},mark:function mark(){return{conversion:Xn,priority:0};},s:function s(){return{conversion:Xn,priority:0};},span:function span(){return{conversion:Jn,priority:0};},strong:function strong(){return{conversion:Xn,priority:0};},sub:function sub(){return{conversion:Xn,priority:0};},sup:function sup(){return{conversion:Xn,priority:0};},u:function u(){return{conversion:Xn,priority:0};}};};Un.importJSON=function importJSON(t){return Qn().updateFromJSON(t);};_proto4.updateFromJSON=function updateFromJSON(t){return _En2.prototype.updateFromJSON.call(this,t).setTextContent(t.text).setFormat(t.format).setDetail(t.detail).setMode(t.mode).setStyle(t.style);};_proto4.exportDOM=function exportDOM(e){var _En2$prototype$export=_En2.prototype.exportDOM.call(this,e),n=_En2$prototype$export.element;return ji(n)||t(132),n.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?n.style.textTransform="lowercase":this.hasFormat("uppercase")?n.style.textTransform="uppercase":this.hasFormat("capitalize")&&(n.style.textTransform="capitalize"),this.hasFormat("bold")&&(n=$n(n,"b")),this.hasFormat("italic")&&(n=$n(n,"i")),this.hasFormat("strikethrough")&&(n=$n(n,"s")),this.hasFormat("underline")&&(n=$n(n,"u")),{element:n};};_proto4.exportJSON=function exportJSON(){return babelHelpers["extends"]({detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent()},_En2.prototype.exportJSON.call(this));};_proto4.selectionTransform=function selectionTransform(t,e){};_proto4.setFormat=function setFormat(t){var e=this.getWritable();return e.__format="string"==typeof t?w[t]:t,e;};_proto4.setDetail=function setDetail(t){var e=this.getWritable();return e.__detail="string"==typeof t?D[t]:t,e;};_proto4.setStyle=function setStyle(t){var e=this.getWritable();return e.__style=t,e;};_proto4.toggleFormat=function toggleFormat(t){var e=Yo(this.getFormat(),t,null);return this.setFormat(e);};_proto4.toggleDirectionless=function toggleDirectionless(){var t=this.getWritable();return t.__detail^=1,t;};_proto4.toggleUnmergeable=function toggleUnmergeable(){var t=this.getWritable();return t.__detail^=2,t;};_proto4.setMode=function setMode(t){var e=L[t];if(this.__mode===e)return this;var n=this.getWritable();return n.__mode=e,n;};_proto4.setTextContent=function setTextContent(t){if(this.__text===t)return this;var e=this.getWritable();return e.__text=t,e;};_proto4.select=function select(t,e){Ur();var n=t,r=e;var o=kr(),i=this.getTextContent(),s=this.__key;if("string"==typeof i){var _t44=i.length;void 0===n&&(n=_t44),void 0===r&&(r=_t44);}else n=0,r=0;if(!ar(o))return Sr(s,n,s,r,"text","text");{var _t45=qo();_t45!==o.anchor.key&&_t45!==o.focus.key||Go(s),o.setTextNodeRange(this,n,this,r);}return o;};_proto4.selectStart=function selectStart(){return this.select(0,0);};_proto4.selectEnd=function selectEnd(){var t=this.getTextContentSize();return this.select(t,t);};_proto4.spliceText=function spliceText(t,e,n,r){var o=this.getWritable(),i=o.__text,s=n.length;var l=t;l<0&&(l=s+l,l<0&&(l=0));var c=kr();if(r&&ar(c)){var _e39=t+s;c.setTextNodeRange(o,_e39,o,_e39);}var a=i.slice(0,l)+n+i.slice(l+e);return o.__text=a,o;};_proto4.canInsertTextBefore=function canInsertTextBefore(){return!0;};_proto4.canInsertTextAfter=function canInsertTextAfter(){return!0;};_proto4.splitText=function splitText(){Ur();var e=this.getLatest(),n=e.getTextContent();if(""===n)return[];var r=e.__key,o=qo(),i=n.length;for(var _len4=arguments.length,t=new Array(_len4),_key4=0;_key4<_len4;_key4++){t[_key4]=arguments[_key4];}t.sort(function(t,e){return t-e;}),t.push(i);var s=[],l=t.length;for(var _e40=0,_r21=0;_e40<i&&_r21<=l;_r21++){var _o17=t[_r21];_o17>_e40&&(s.push(n.slice(_e40,_o17)),_e40=_o17);}var c=s.length;if(1===c)return[e];var a=s[0],u=e.getParent();var f;var d=e.getFormat(),h=e.getStyle(),g=e.__detail;var _=!1,p=null,y=null;var m=kr();if(ar(m)){var _ref15=m.isBackward()?[m.focus,m.anchor]:[m.anchor,m.focus],_t46=_ref15[0],_e41=_ref15[1];"text"===_t46.type&&_t46.key===r&&(p=_t46),"text"===_e41.type&&_e41.key===r&&(y=_e41);}e.isSegmented()?(f=Qn(a),f.__format=d,f.__style=h,f.__detail=g,f.__state=it(e,f),_=!0):f=e.setTextContent(a);var x=[f];for(var _t47=1;_t47<c;_t47++){var _n31=Qn(s[_t47]);_n31.__format=d,_n31.__style=h,_n31.__detail=g,_n31.__state=it(e,_n31);var _i8=_n31.__key;o===r&&Go(_i8),x.push(_n31);}var C=p?p.offset:null,S=y?y.offset:null;var N=0;for(var _t48 of x){if(!p&&!y)break;var _e42=N+_t48.getTextContentSize();if(null!==p&&null!==C&&C<=_e42&&C>=N&&(p.set(_t48.getKey(),C-N,"text"),C<_e42&&(p=null)),null!==y&&null!==S&&S<=_e42&&S>=N){y.set(_t48.getKey(),S-N,"text");break;}N=_e42;}if(null!==u){!function(t){var e=t.getPreviousSibling(),n=t.getNextSibling();null!==e&&Vo(e);null!==n&&Vo(n);}(this);var _t49=u.getWritable(),_e43=this.getIndexWithinParent();_?(_t49.splice(_e43,0,x),this.remove()):_t49.splice(_e43,1,x),ar(m)&&Or(m,u,_e43,c-1);}return x;};_proto4.mergeWithSibling=function mergeWithSibling(e){var n=e===this.getPreviousSibling();n||e===this.getNextSibling()||t(50);var r=this.__key,o=e.__key,i=this.__text,s=i.length;qo()===o&&Go(r);var l=kr();if(ar(l)){var _t50=l.anchor,_i9=l.focus;null!==_t50&&_t50.key===o&&Ar(_t50,n,r,e,s),null!==_i9&&_i9.key===o&&Ar(_i9,n,r,e,s);}var c=e.__text,a=n?c+i:i+c;this.setTextContent(a);var u=this.getWritable();return e.remove(),u;};_proto4.isTextEntity=function isTextEntity(){return!1;};return Un;}(_En5);function Jn(t){return{forChild:tr(t.style),node:null};}function Yn(t){var e=t,n="normal"===e.style.fontWeight;return{forChild:tr(e.style,n?void 0:"bold"),node:null};}var jn=new WeakMap();function Hn(t){if(!ji(t))return!1;if("PRE"===t.nodeName)return!0;var e=t.style.whiteSpace;return"string"==typeof e&&e.startsWith("pre");}function Vn(e){var n=e;null===e.parentElement&&t(129);var r=n.textContent||"";if(null!==function(t){var e,n=t.parentNode;var r=[t];for(;null!==n&&void 0===(e=jn.get(n))&&!Hn(n);)r.push(n),n=n.parentNode;var o=void 0===e?n:e;for(var _t51=0;_t51<r.length;_t51++)jn.set(r[_t51],o);return o;}(n)){var _t52=r.split(/(\r?\n|\t)/),_e44=[],_n32=_t52.length;for(var _r22=0;_r22<_n32;_r22++){var _n33=_t52[_r22];"\n"===_n33||"\r\n"===_n33?_e44.push(In()):"\t"===_n33?_e44.push(nr()):""!==_n33&&_e44.push(Qn(_n33));}return{node:_e44};}if(r=r.replace(/\r/g,"").replace(/[ \t\n]+/g," "),""===r)return{node:null};if(" "===r[0]){var _t53=n,_e45=!0;for(;null!==_t53&&null!==(_t53=Gn(_t53,!1));){var _n34=_t53.textContent||"";if(_n34.length>0){/[ \t\n]$/.test(_n34)&&(r=r.slice(1)),_e45=!1;break;}}_e45&&(r=r.slice(1));}if(" "===r[r.length-1]){var _t54=n,_e46=!0;for(;null!==_t54&&null!==(_t54=Gn(_t54,!0));){if((_t54.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){_e46=!1;break;}}_e46&&(r=r.slice(0,r.length-1));}return""===r?{node:null}:{node:Qn(r)};}function Gn(t,e){var n=t;for(;;){var _t55=void 0;for(;null===(_t55=e?n.nextSibling:n.previousSibling);){var _t56=n.parentElement;if(null===_t56)return null;n=_t56;}if(n=_t55,ji(n)){var _t57=n.style.display;if(""===_t57&&!Gi(n)||""!==_t57&&!_t57.startsWith("inline"))return null;}var _r23=n;for(;null!==(_r23=e?n.firstChild:n.lastChild);)n=_r23;if($o(n))return n;if("BR"===n.nodeName)return null;}}var qn={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function Xn(t){var e=qn[t.nodeName.toLowerCase()];return void 0===e?{node:null}:{forChild:tr(t.style,e),node:null};}function Qn(t){if(t===void 0){t="";}return Bi(new _Un2(t));}function Zn(t){return t instanceof _Un2;}function tr(t,e){var n=t.fontWeight,r=t.textDecoration.split(" "),o="700"===n||"bold"===n,i=r.includes("line-through"),s="italic"===t.fontStyle,l=r.includes("underline"),c=t.verticalAlign;return function(t){return Zn(t)?(o&&!t.hasFormat("bold")&&t.toggleFormat("bold"),i&&!t.hasFormat("strikethrough")&&t.toggleFormat("strikethrough"),s&&!t.hasFormat("italic")&&t.toggleFormat("italic"),l&&!t.hasFormat("underline")&&t.toggleFormat("underline"),"sub"!==c||t.hasFormat("subscript")||t.toggleFormat("subscript"),"super"!==c||t.hasFormat("superscript")||t.toggleFormat("superscript"),e&&!t.hasFormat(e)&&t.toggleFormat(e),t):t;};}var _er=function(_Un){function er(t){var _this2;_this2=_Un.call(this,"\t",t)||this,_this2.__detail=2;return _this2;}babelHelpers.inheritsLoose(er,_Un);er.getType=function getType(){return"tab";};er.clone=function clone(t){return new er(t.__key);};er.importDOM=function importDOM(){return null;};var _proto5=er.prototype;_proto5.createDOM=function createDOM(t){var e=_Un.prototype.createDOM.call(this,t),n=Si(t.theme,"tab");if(void 0!==n){var _e$classList;(_e$classList=e.classList).add.apply(_e$classList,n);}return e;};er.importJSON=function importJSON(t){return nr().updateFromJSON(t);};_proto5.setTextContent=function setTextContent(t){return"\t"!==t&&""!==t&&e(126),_Un.prototype.setTextContent.call(this,"\t");};_proto5.spliceText=function spliceText(e,n,r,o){return""===r&&0===n||"\t"===r&&1===n||t(286),this;};_proto5.setDetail=function setDetail(e){return 2!==e&&t(127),this;};_proto5.setMode=function setMode(e){return"normal"!==e&&t(128),this;};_proto5.canInsertTextBefore=function canInsertTextBefore(){return!1;};_proto5.canInsertTextAfter=function canInsertTextAfter(){return!1;};return er;}(_Un2);function nr(){return Bi(new _er());}function rr(t){return t instanceof _er;}var _or=function(){function or(t,e,n){this._selection=null,this.key=t,this.offset=e,this.type=n;}var _proto6=or.prototype;_proto6.is=function is(t){return this.key===t.key&&this.offset===t.offset&&this.type===t.type;};_proto6.isBefore=function isBefore(t){if(this.key===t.key)return this.offset<t.offset;return Ls(Gs(zs(this,"next")),Gs(zs(t,"next")))<0;};_proto6.getNode=function getNode(){var e=Xo(this.key);return null===e&&t(20),e;};_proto6.set=function set(t,e,n,r){var o=this._selection,i=this.key;r&&this.key===t&&this.offset===e&&this.type===n||(this.key=t,this.offset=e,this.type=n,$r()||(qo()===i&&Go(t),null!==o&&(o.setCachedNodes(null),o.dirty=!0)));};return or;}();function ir(t,e,n){return new _or(t,e,n);}function sr(t,e){var n=e.__key,r=t.offset,o="element";if(Zn(e)){o="text";var _t58=e.getTextContentSize();r>_t58&&(r=_t58);}else if(!co(e)){var _t59=e.getNextSibling();if(Zn(_t59))n=_t59.__key,r=0,o="text";else{var _t60=e.getParent();_t60&&(n=_t60.__key,r=e.getIndexWithinParent()+1);}}t.set(n,r,o);}function lr(t,e){if(co(e)){var _n35=e.getLastDescendant();co(_n35)||Zn(_n35)?sr(t,_n35):sr(t,e);}else sr(t,e);}var _cr=function(){function cr(t){this._cachedNodes=null,this._nodes=t,this.dirty=!1;}var _proto7=cr.prototype;_proto7.getCachedNodes=function getCachedNodes(){return this._cachedNodes;};_proto7.setCachedNodes=function setCachedNodes(t){this._cachedNodes=t;};_proto7.is=function is(t){if(!fr(t))return!1;var e=this._nodes,n=t._nodes;return e.size===n.size&&Array.from(e).every(function(t){return n.has(t);});};_proto7.isCollapsed=function isCollapsed(){return!1;};_proto7.isBackward=function isBackward(){return!1;};_proto7.getStartEndPoints=function getStartEndPoints(){return null;};_proto7.add=function add(t){this.dirty=!0,this._nodes.add(t),this._cachedNodes=null;};_proto7["delete"]=function _delete(t){this.dirty=!0,this._nodes["delete"](t),this._cachedNodes=null;};_proto7.clear=function clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null;};_proto7.has=function has(t){return this._nodes.has(t);};_proto7.clone=function clone(){return new cr(new Set(this._nodes));};_proto7.extract=function extract(){return this.getNodes();};_proto7.insertRawText=function insertRawText(t){};_proto7.insertText=function insertText(){};_proto7.insertNodes=function insertNodes(t){var e=this.getNodes(),n=e.length,r=e[n-1];var o;if(Zn(r))o=r.select();else{var _t61=r.getIndexWithinParent()+1;o=r.getParentOrThrow().select(_t61,_t61);}o.insertNodes(t);for(var _t62=0;_t62<n;_t62++)e[_t62].remove();};_proto7.getNodes=function getNodes(){var t=this._cachedNodes;if(null!==t)return t;var e=this._nodes,n=[];for(var _t63 of e){var _e47=Xo(_t63);null!==_e47&&n.push(_e47);}return $r()||(this._cachedNodes=n),n;};_proto7.getTextContent=function getTextContent(){var t=this.getNodes();var e="";for(var _n36=0;_n36<t.length;_n36++)e+=t[_n36].getTextContent();return e;};_proto7.deleteNodes=function deleteNodes(){var t=this.getNodes();if((kr()||Er())===this&&t[0]){var _e48=Ns(t[0],"next");$s(Ps(_e48,_e48));}for(var _e49 of t)_e49.remove();};return cr;}();function ar(t){return t instanceof _ur;}var _ur=function(){function ur(t,e,n,r){this.anchor=t,this.focus=e,t._selection=this,e._selection=this,this._cachedNodes=null,this.format=n,this.style=r,this.dirty=!1;}var _proto8=ur.prototype;_proto8.getCachedNodes=function getCachedNodes(){return this._cachedNodes;};_proto8.setCachedNodes=function setCachedNodes(t){this._cachedNodes=t;};_proto8.is=function is(t){return!!ar(t)&&this.anchor.is(t.anchor)&&this.focus.is(t.focus)&&this.format===t.format&&this.style===t.style;};_proto8.isCollapsed=function isCollapsed(){return this.anchor.is(this.focus);};_proto8.getNodes=function getNodes(){var t=this._cachedNodes;if(null!==t)return t;var e=function(t){var e=[],_t$getTextSlices=t.getTextSlices(),n=_t$getTextSlices[0],r=_t$getTextSlices[1];n&&e.push(n.caret.origin);var o=new Set(),i=new Set();for(var _n37 of t)if(ms(_n37)){var _t64=_n37.origin;0===e.length?o.add(_t64):(i.add(_t64),e.push(_t64));}else{var _t65=_n37.origin;co(_t65)&&i.has(_t65)||e.push(_t65);}r&&e.push(r.caret.origin);if(ys(t.focus)&&co(t.focus.origin)&&null===t.focus.getNodeAtCaret())for(var _n38=Es(t.focus.origin,"previous");ms(_n38)&&o.has(_n38.origin)&&!_n38.origin.isEmpty()&&_n38.origin.is(e[e.length-1]);_n38=bs(_n38))o["delete"](_n38.origin),e.pop();for(;e.length>1;){var _t66=e[e.length-1];if(!co(_t66)||i.has(_t66)||_t66.isEmpty()||o.has(_t66))break;e.pop();}if(0===e.length&&t.isCollapsed()){var _n39=Gs(t.anchor),_r24=Gs(t.anchor.getFlipped()),_o18=function _o18(t){return ps(t)?t.origin:t.getNodeAtCaret();},_i0=_o18(_n39)||_o18(_r24)||(t.anchor.getNodeAtCaret()?_n39.origin:_r24.origin);e.push(_i0);}return e;}(Qs(Js(this),"next"));return $r()||(this._cachedNodes=e),e;};_proto8.setTextNodeRange=function setTextNodeRange(t,e,n,r){this.anchor.set(t.__key,e,"text"),this.focus.set(n.__key,r,"text");};_proto8.getTextContent=function getTextContent(){var t=this.getNodes();if(0===t.length)return"";var e=t[0],n=t[t.length-1],r=this.anchor,o=this.focus,i=r.isBefore(o),_hr=hr(this),s=_hr[0],l=_hr[1];var c="",a=!0;for(var _u5=0;_u5<t.length;_u5++){var _f5=t[_u5];if(co(_f5)&&!_f5.isInline())a||(c+="\n"),a=!_f5.isEmpty();else if(a=!1,Zn(_f5)){var _t67=_f5.getTextContent();_f5===e?_f5===n?"element"===r.type&&"element"===o.type&&o.offset!==r.offset||(_t67=s<l?_t67.slice(s,l):_t67.slice(l,s)):_t67=i?_t67.slice(s):_t67.slice(l):_f5===n&&(_t67=i?_t67.slice(0,l):_t67.slice(0,s)),c+=_t67;}else!fo(_f5)&&!Ln(_f5)||_f5===n&&this.isCollapsed()||(c+=_f5.getTextContent());}return c;};_proto8.applyDOMRange=function applyDOMRange(t){var e=jr(),n=e.getEditorState()._selection,r=Cr(t.startContainer,t.startOffset,t.endContainer,t.endOffset,e,n);if(null===r)return;var o=r[0],i=r[1];this.anchor.set(o.key,o.offset,o.type,!0),this.focus.set(i.key,i.offset,i.type,!0),at(this);};_proto8.clone=function clone(){var t=this.anchor,e=this.focus;return new ur(ir(t.key,t.offset,t.type),ir(e.key,e.offset,e.type),this.format,this.style);};_proto8.toggleFormat=function toggleFormat(t){this.format=Yo(this.format,t,null),this.dirty=!0;};_proto8.setFormat=function setFormat(t){this.format=t,this.dirty=!0;};_proto8.setStyle=function setStyle(t){this.style=t,this.dirty=!0;};_proto8.hasFormat=function hasFormat(t){var e=w[t];return 0!==(this.format&e);};_proto8.insertRawText=function insertRawText(t){var e=t.split(/(\r?\n|\t)/),n=[],r=e.length;for(var _t68=0;_t68<r;_t68++){var _r25=e[_t68];"\n"===_r25||"\r\n"===_r25?n.push(In()):"\t"===_r25?n.push(nr()):n.push(Qn(_r25));}this.insertNodes(n);};_proto8.insertText=function insertText(e){var n=this.anchor,r=this.focus,o=this.format,i=this.style;var s=n,l=r;!this.isCollapsed()&&r.isBefore(n)&&(s=r,l=n),"element"===s.type&&function(t,e,n,r){var o=t.getNode(),i=o.getChildAtIndex(t.offset),s=Qn();if(s.setFormat(n),s.setStyle(r),To(i))i.splice(0,0,[s]);else{var _t69=go(o)?No().append(s):s;null===i?o.append(_t69):i.insertBefore(_t69);}t.is(e)&&e.set(s.__key,0,"text"),t.set(s.__key,0,"text");}(s,l,o,i),"element"===l.type&&Ws(l,Gs(zs(l,"next")));var c=s.offset;var a=l.offset;var u=this.getNodes(),f=u.length;var d=u[0];Zn(d)||t(26);var h=d.getTextContent().length,g=d.getParentOrThrow();var _=u[f-1];if(1===f&&"element"===l.type&&(a=h,l.set(s.key,a,"text")),this.isCollapsed()&&c===h&&(Wo(d)||!d.canInsertTextAfter()||!g.canInsertTextAfter()&&null===d.getNextSibling())){var _t70=d.getNextSibling();if(Zn(_t70)&&_t70.canInsertTextBefore()&&!Wo(_t70)||(_t70=Qn(),_t70.setFormat(o),_t70.setStyle(i),g.canInsertTextAfter()?d.insertAfter(_t70):g.insertAfter(_t70)),_t70.select(0,0),d=_t70,""!==e)return void this.insertText(e);}else if(this.isCollapsed()&&0===c&&(Wo(d)||!d.canInsertTextBefore()||!g.canInsertTextBefore()&&null===d.getPreviousSibling())){var _t71=d.getPreviousSibling();if(Zn(_t71)&&!Wo(_t71)||(_t71=Qn(),_t71.setFormat(o),g.canInsertTextBefore()?d.insertBefore(_t71):g.insertBefore(_t71)),_t71.select(),d=_t71,""!==e)return void this.insertText(e);}else if(d.isSegmented()&&c!==h){var _t72=Qn(d.getTextContent());_t72.setFormat(o),d.replace(_t72),d=_t72;}else if(!this.isCollapsed()&&""!==e){var _t73=_.getParent();if(!g.canInsertTextBefore()||!g.canInsertTextAfter()||co(_t73)&&(!_t73.canInsertTextBefore()||!_t73.canInsertTextAfter()))return this.insertText(""),xr(this.anchor,this.focus,null),void this.insertText(e);}if(1===f){if(zo(d)){var _t74=Qn(e);return _t74.select(),void d.replace(_t74);}var _t75=d.getFormat(),_n40=d.getStyle();if(c!==a||_t75===o&&_n40===i){if(rr(d)){var _t76=Qn(e);return _t76.setFormat(o),_t76.setStyle(i),_t76.select(),void d.replace(_t76);}}else{if(""!==d.getTextContent()){var _t77=Qn(e);if(_t77.setFormat(o),_t77.setStyle(i),_t77.select(),0===c)d.insertBefore(_t77,!1);else{var _d$splitText=d.splitText(c),_e50=_d$splitText[0];_e50.insertAfter(_t77,!1);}return void(_t77.isComposing()&&"text"===this.anchor.type&&(this.anchor.offset-=e.length));}d.setFormat(o),d.setStyle(i);}var _r26=a-c;d=d.spliceText(c,_r26,e,!0),""===d.getTextContent()?d.remove():"text"===this.anchor.type&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=_t75,this.style=_n40));}else{var _t78=new Set([].concat(d.getParentKeys(),_.getParentKeys())),_n41=co(d)?d:d.getParentOrThrow();var _r27=co(_)?_:_.getParentOrThrow(),_o19=_;if(!_n41.is(_r27)&&_r27.isInline())do{_o19=_r27,_r27=_r27.getParentOrThrow();}while(_r27.isInline());if("text"===l.type&&(0!==a||""===_.getTextContent())||"element"===l.type&&_.getIndexWithinParent()<a){if(Zn(_)&&!zo(_)&&a!==_.getTextContentSize()){if(_.isSegmented()){var _t79=Qn(_.getTextContent());_.replace(_t79),_=_t79;}go(l.getNode())||"text"!==l.type||(_=_.spliceText(0,a,"")),_t78.add(_.__key);}else{var _t80=_.getParentOrThrow();_t80.canBeEmpty()||1!==_t80.getChildrenSize()?_.remove():_t80.remove();}}else _t78.add(_.__key);var _i1=_r27.getChildren(),_s0=new Set(u),_g5=_n41.is(_r27),_p2=_n41.isInline()&&null===d.getNextSibling()?_n41:d;for(var _t81=_i1.length-1;_t81>=0;_t81--){var _e51=_i1[_t81];if(_e51.is(d)||co(_e51)&&_e51.isParentOf(d))break;_e51.isAttached()&&(!_s0.has(_e51)||_e51.is(_o19)?_g5||_p2.insertAfter(_e51,!1):_e51.remove());}if(!_g5){var _e52=_r27,_n42=null;for(;null!==_e52;){var _r28=_e52.getChildren(),_o20=_r28.length;(0===_o20||_r28[_o20-1].is(_n42))&&(_t78["delete"](_e52.__key),_n42=_e52),_e52=_e52.getParent();}}if(zo(d)){if(c===h)d.select();else{var _t82=Qn(e);_t82.select(),d.replace(_t82);}}else d=d.spliceText(c,h-c,e,!0),""===d.getTextContent()?d.remove():"text"===this.anchor.type&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=d.getFormat(),this.style=d.getStyle()));for(var _e53=1;_e53<f;_e53++){var _n43=u[_e53],_r29=_n43.__key;_t78.has(_r29)||_n43.remove();}}};_proto8.removeText=function removeText(){var t=kr()===this;Us(this,Vs(Js(this))),t&&kr()!==this&&ii(this);};_proto8.formatText=function formatText(t,e){var _d$splitText2,_p$splitText;if(e===void 0){e=null;}if(this.isCollapsed())return this.toggleFormat(t),void Go(null);var n=this.getNodes(),r=[];for(var _t83 of n)Zn(_t83)&&r.push(_t83);var o=function o(e){n.forEach(function(n){if(co(n)){var _r30=n.getFormatFlags(t,e);n.setTextFormat(_r30);}});},i=r.length;if(0===i)return this.toggleFormat(t),Go(null),void o(e);var s=this.anchor,l=this.focus,c=this.isBackward(),a=c?l:s,u=c?s:l;var f=0,d=r[0],h="element"===a.type?0:a.offset;if("text"===a.type&&h===d.getTextContentSize()&&(f=1,d=r[1],h=0),null==d)return;var g=d.getFormatFlags(t,e);o(g);var _=i-1;var p=r[_];var y="text"===u.type?u.offset:p.getTextContentSize();if(d.is(p)){if(h===y)return;if(Wo(d)||0===h&&y===d.getTextContentSize())d.setFormat(g);else{var _t84=d.splitText(h,y),_e54=0===h?_t84[0]:_t84[1];_e54.setFormat(g),"text"===a.type&&a.set(_e54.__key,0,"text"),"text"===u.type&&u.set(_e54.__key,y-h,"text");}return void(this.format=g);}0===h||Wo(d)||(_d$splitText2=d.splitText(h),d=_d$splitText2[1],h=0),d.setFormat(g);var m=p.getFormatFlags(t,g);y>0&&(y===p.getTextContentSize()||Wo(p)||(_p$splitText=p.splitText(y),p=_p$splitText[0],_p$splitText),p.setFormat(m));for(var _e55=f+1;_e55<_;_e55++){var _n44=r[_e55],_o21=_n44.getFormatFlags(t,m);_n44.setFormat(_o21);}"text"===a.type&&a.set(d.__key,h,"text"),"text"===u.type&&u.set(p.__key,y,"text"),this.format=g|m;};_proto8.insertNodes=function insertNodes(e){if(0===e.length)return;if(this.isCollapsed()||this.removeText(),"root"===this.anchor.key){this.insertParagraph();var _n45=kr();return ar(_n45)||t(134),_n45.insertNodes(e);}var n=(this.isBackward()?this.focus:this.anchor).getNode(),r=ls(n,Xi),o=e[e.length-1];if(co(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{var _t85=Pr(this);r.splice(_t85,0,e),o.selectEnd();}return;}if(!e.some(function(t){return(co(t)||fo(t))&&!t.isInline();})){co(r)||t(211,n.constructor.name,n.getType());var _i10=Pr(this);return r.splice(_i10,0,e),void o.selectEnd();}var i=function(t){var e=No();var n=null;for(var _r31=0;_r31<t.length;_r31++){var _o22=t[_r31],_i11=Ln(_o22);if(_i11||fo(_o22)&&_o22.isInline()||co(_o22)&&_o22.isInline()||Zn(_o22)||_o22.isParentRequired()){if(null===n&&(n=_o22.createParentElementNode(),e.append(n),_i11))continue;null!==n&&n.append(_o22);}else e.append(_o22),n=null;}return e;}(e),s=i.getLastDescendant(),l=i.getChildren(),c=!co(r)||!r.isEmpty()?this.insertParagraph():null,a=l[l.length-1];var u=l[0];var f;co(f=u)&&Xi(f)&&!f.isEmpty()&&co(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(co(r)||t(211,n.constructor.name,n.getType()),r.append.apply(r,u.getChildren()),u=l[1]),u&&(null===r&&t(212,n.constructor.name,n.getType()),function(e,n){var r=n.getParentOrThrow().getLastChild();var o=n;var i=[n];for(;o!==r;)o.getNextSibling()||t(140),o=o.getNextSibling(),i.push(o);var s=e;for(var _t86 of i)s=s.insertAfter(_t86);}(r,u));var d=ls(s,Xi);c&&co(d)&&(c.canMergeWhenEmpty()||Xi(a))&&(d.append.apply(d,c.getChildren()),c.remove()),co(r)&&r.isEmpty()&&r.remove(),s.selectEnd();var h=co(r)?r.getLastChild():null;Ln(h)&&d!==r&&h.remove();};_proto8.insertParagraph=function insertParagraph(){if("root"===this.anchor.key){var _t87=No();return ri().splice(this.anchor.offset,0,[_t87]),_t87.select(),_t87;}var e=Pr(this),n=ls(this.anchor.getNode(),Xi);co(n)||t(213);var r=n.getChildAtIndex(e),o=r?[r].concat(r.getNextSiblings()):[],i=n.insertNewAfter(this,!1);return i?(i.append.apply(i,o),i.selectStart(),i):null;};_proto8.insertLineBreak=function insertLineBreak(t){var e=In();if(this.insertNodes([e]),t){var _t88=e.getParentOrThrow(),_n46=e.getIndexWithinParent();_t88.select(_n46,_n46);}};_proto8.extract=function extract(){var _n$splitText;var t=[].concat(this.getNodes()),e=t.length;var n=t[0],r=t[e-1];var _hr2=hr(this),o=_hr2[0],i=_hr2[1],s=this.isBackward(),_ref16=s?[this.focus,this.anchor]:[this.anchor,this.focus],l=_ref16[0],c=_ref16[1],_ref17=s?[i,o]:[o,i],a=_ref17[0],u=_ref17[1];if(0===e)return[];if(1===e){if(Zn(n)&&!this.isCollapsed()){var _t89=n.splitText(a,u),_e56=0===a?_t89[0]:_t89[1];return _e56?(l.set(_e56.getKey(),0,"text"),c.set(_e56.getKey(),_e56.getTextContentSize(),"text"),[_e56]):[];}return[n];}if(Zn(n)&&(a===n.getTextContentSize()?t.shift():0!==a&&(_n$splitText=n.splitText(a),n=_n$splitText[1],t[0]=n,l.set(n.getKey(),0,"text"))),Zn(r)){var _r$splitText;var _e57=r.getTextContent().length;0===u?t.pop():u!==_e57&&(_r$splitText=r.splitText(u),r=_r$splitText[0],t[t.length-1]=r,c.set(r.getKey(),r.getTextContentSize(),"text"));}return t;};_proto8.modify=function modify(t,e,n){if(Lr(this,t,e,n))return;var r="move"===t,o=jr(),i=Ji(Li(o));if(!i)return;var s=o._blockCursorElement,l=o._rootElement,c=this.focus.getNode();if(null===l||null===s||!co(c)||c.isInline()||c.canBeEmpty()||Ui(s,o,l),this.dirty){var _t90=bi(o,this.anchor.key),_e58=bi(o,this.focus.key);"text"===this.anchor.type&&(_t90=Jo(_t90)),"text"===this.focus.type&&(_e58=Jo(_e58)),_t90&&_e58&&wr(i,_t90,this.anchor.offset,_e58,this.focus.offset);}if(function(t,e,n,r){t.modify(e,n,r);}(i,t,e?"backward":"forward",n),i.rangeCount>0){var _t91=i.getRangeAt(0),_n47=this.anchor.getNode(),_o23=go(_n47)?_n47:Fi(_n47);if(this.applyDOMRange(_t91),this.dirty=!0,!r){var _n48=this.getNodes(),_r32=[];var _s1=!1;for(var _t92=0;_t92<_n48.length;_t92++){var _e59=_n48[_t92];Pi(_e59,_o23)?_r32.push(_e59):_s1=!0;}if(_s1&&_r32.length>0)if(e){var _t93=_r32[0];co(_t93)?_t93.selectStart():_t93.getParentOrThrow().selectStart();}else{var _t94=_r32[_r32.length-1];co(_t94)?_t94.selectEnd():_t94.getParentOrThrow().selectEnd();}i.anchorNode===_t91.startContainer&&i.anchorOffset===_t91.startOffset||function(t){var e=t.focus,n=t.anchor,r=n.key,o=n.offset,i=n.type;n.set(e.key,e.offset,e.type,!0),e.set(r,o,i,!0);}(this);}}"lineboundary"===n&&Lr(this,t,e,n,"decorators");};_proto8.forwardDeletion=function forwardDeletion(t,e,n){if(!n&&("element"===t.type&&co(e)&&t.offset===e.getChildrenSize()||"text"===t.type&&t.offset===e.getTextContentSize())){var _t95=e.getParent(),_n49=e.getNextSibling()||(null===_t95?null:_t95.getNextSibling());if(co(_n49)&&_n49.isShadowRoot())return!0;}return!1;};_proto8.deleteCharacter=function deleteCharacter(t){var e=this.isCollapsed();if(this.isCollapsed()){var _e60=this.anchor;var _n50=_e60.getNode();if(this.forwardDeletion(_e60,_n50,t))return;var _r33=ws(zs(_e60,t?"previous":"next"));if(_r33.getTextSlices().every(function(t){return null===t||0===t.distance;})){var _t96={type:"initial"};for(var _e61 of _r33.iterNodeCarets("shadowRoot"))if(ms(_e61)){if(_e61.origin.isInline());else{if(_e61.origin.isShadowRoot()){if("merge-block"===_t96.type)break;if(co(_r33.anchor.origin)&&_r33.anchor.origin.isEmpty()){var _t97=Gs(_e61);Us(this,Ps(_t97,_t97)),_r33.anchor.origin.remove();}return;}"merge-next-block"!==_t96.type&&"merge-block"!==_t96.type||(_t96={block:_t96.block,caret:_e61,type:"merge-block"});}}else{if("merge-block"===_t96.type)break;if(ys(_e61)){if(co(_e61.origin)){if(_e61.origin.isInline()){if(!_e61.origin.isParentOf(_r33.anchor.origin))break;}else _t96={block:_e61.origin,type:"merge-next-block"};continue;}if(fo(_e61.origin)){if(_e61.origin.isIsolated());else if("merge-next-block"===_t96.type&&(_e61.origin.isKeyboardSelectable()||!_e61.origin.isInline())&&co(_r33.anchor.origin)&&_r33.anchor.origin.isEmpty()){_r33.anchor.origin.remove();var _t98=Tr();_t98.add(_e61.origin.getKey()),ii(_t98);}else _e61.origin.remove();return;}break;}}if("merge-block"===_t96.type){var _t99=_t96,_e62=_t99.caret,_n51=_t99.block;return Us(this,Ps(!_e62.origin.isEmpty()&&_n51.isEmpty()?Ys(Ns(_n51,_e62.direction)):_r33.anchor,_e62)),this.removeText();}}var _o24=this.focus;if(this.modify("extend",t,"character"),this.isCollapsed()){if(t&&0===_e60.offset&&gr(this,_e60.getNode()))return;}else{var _r34="text"===_o24.type?_o24.getNode():null;if(_n50="text"===_e60.type?_e60.getNode():null,null!==_r34&&_r34.isSegmented()){var _e63=_o24.offset,_i12=_r34.getTextContentSize();if(_r34.is(_n50)||t&&_e63!==_i12||!t&&0!==_e63)return void pr(_r34,t,_e63);}else if(null!==_n50&&_n50.isSegmented()){var _o25=_e60.offset,_i13=_n50.getTextContentSize();if(_n50.is(_r34)||t&&0!==_o25||!t&&_o25!==_i13)return void pr(_n50,t,_o25);}!function(t,e){var n=t.anchor,r=t.focus,o=n.getNode(),i=r.getNode();if(o===i&&"text"===n.type&&"text"===r.type){var _t100=n.offset,_i14=r.offset,_s10=_t100<_i14,_l4=_s10?_t100:_i14,_c4=_s10?_i14:_t100,_a5=_c4-1;if(_l4!==_a5){(function(t){return!(li(t)||_r(t));})(o.getTextContent().slice(_l4,_c4))&&(e?r.set(r.key,_a5,r.type):n.set(n.key,_a5,n.type));}}}(this,t);}}if(this.removeText(),t&&!e&&this.isCollapsed()&&"element"===this.anchor.type&&0===this.anchor.offset){var _t101=this.anchor.getNode();_t101.isEmpty()&&go(_t101.getParent())&&null===_t101.getPreviousSibling()&&gr(this,_t101);}};_proto8.deleteLine=function deleteLine(t){this.isCollapsed()&&this.modify("extend",t,"lineboundary"),this.isCollapsed()?this.deleteCharacter(t):this.removeText();};_proto8.deleteWord=function deleteWord(t){if(this.isCollapsed()){var _e64=this.anchor,_n52=_e64.getNode();if(this.forwardDeletion(_e64,_n52,t))return;this.modify("extend",t,"word");}this.removeText();};_proto8.isBackward=function isBackward(){return this.focus.isBefore(this.anchor);};_proto8.getStartEndPoints=function getStartEndPoints(){return[this.anchor,this.focus];};return ur;}();function fr(t){return t instanceof _cr;}function dr(t){var e=t.offset;if("text"===t.type)return e;var n=t.getNode();return e===n.getChildrenSize()?n.getTextContent().length:0;}function hr(t){var e=t.getStartEndPoints();if(null===e)return[0,0];var n=e[0],r=e[1];return"element"===n.type&&"element"===r.type&&n.key===r.key&&n.offset===r.offset?[0,0]:[dr(n),dr(r)];}function gr(t,e){for(var _n53=e;_n53;_n53=_n53.getParent()){if(co(_n53)){if(_n53.collapseAtStart(t))return!0;if(Ri(_n53))break;}if(_n53.getPreviousSibling())break;}return!1;}var _r=function(){try{var _t102=new RegExp("\\p{Emoji}","u"),_e65=_t102.test.bind(_t102);if(_e65("❤️")&&_e65("#️⃣")&&_e65("👍"))return _e65;}catch(t){}return function(){return!1;};}();function pr(t,e,n){var r=t,o=r.getTextContent().split(/(?=\s)/g),i=o.length;var s=0,l=0;for(var _t103=0;_t103<i;_t103++){var _r35=_t103===i-1;if(l=s,s+=o[_t103].length,e&&s===n||s>n||_r35){o.splice(_t103,1),_r35&&(l=void 0);break;}}var c=o.join("").trim();""===c?r.remove():(r.setTextContent(c),r.select(l,l));}function yr(e,n,r,o){var i,s=n;if(ji(e)){var _l5=!1;var _c5=e.childNodes,_a6=_c5.length,_u6=o._blockCursorElement;s===_a6&&(_l5=!0,s=_a6-1);var _f6=_c5[s],_d4=!1;if(_f6===_u6)_f6=_c5[s+1],_d4=!0;else if(null!==_u6){var _t104=_u6.parentNode;if(e===_t104){n>Array.prototype.indexOf.call(_t104.children,_u6)&&s--;}}if(i=si(_f6),Zn(i))s=vs(i,_l5?"next":"previous");else{var _c6=si(e);if(null===_c6)return null;if(co(_c6)){var _u7$resolveChildIndex;var _a7=o.getElementByKey(_c6.getKey());null===_a7&&t(214);var _u7=_c6.getDOMSlot(_a7);_u7$resolveChildIndex=_u7.resolveChildIndex(_c6,_a7,e,n),_c6=_u7$resolveChildIndex[0],s=_u7$resolveChildIndex[1],co(_c6)||t(215),_l5&&s>=_c6.getChildrenSize()&&(s=Math.max(0,_c6.getChildrenSize()-1));var _f7=_c6.getChildAtIndex(s);if(co(_f7)&&function(t,e,n){var r=t.getParent();return null===n||null===r||!r.canBeEmpty()||r!==n.getNode();}(_f7,0,r)){var _t105=_l5?_f7.getLastDescendant():_f7.getFirstDescendant();null===_t105?_c6=_f7:(_f7=_t105,_c6=co(_f7)?_f7:_f7.getParentOrThrow()),s=0;}Zn(_f7)?(i=_f7,_c6=null,s=vs(_f7,_l5?"next":"previous")):_f7!==_c6&&_l5&&!_d4&&(co(_c6)||t(216),s=Math.min(_c6.getChildrenSize(),s+1));}else{var _t106=_c6.getIndexWithinParent();s=0===n&&fo(_c6)&&si(e)===_c6?_t106:_t106+1,_c6=_c6.getParentOrThrow();}if(co(_c6))return ir(_c6.__key,s,"element");}}else i=si(e);return Zn(i)?ir(i.__key,vs(i,s,"clamp"),"text"):null;}function mr(t,e,n){var r=t.offset,o=t.getNode();if(0===r){var _r36=o.getPreviousSibling(),_i15=o.getParent();if(e){if((n||!e)&&null===_r36&&co(_i15)&&_i15.isInline()){var _e66=_i15.getPreviousSibling();Zn(_e66)&&t.set(_e66.__key,_e66.getTextContent().length,"text");}}else co(_r36)&&!n&&_r36.isInline()?t.set(_r36.__key,_r36.getChildrenSize(),"element"):Zn(_r36)&&t.set(_r36.__key,_r36.getTextContent().length,"text");}else if(r===o.getTextContent().length){var _r37=o.getNextSibling(),_i16=o.getParent();if(e&&co(_r37)&&_r37.isInline())t.set(_r37.__key,0,"element");else if((n||e)&&null===_r37&&co(_i16)&&_i16.isInline()&&!_i16.canInsertTextAfter()){var _e67=_i16.getNextSibling();Zn(_e67)&&t.set(_e67.__key,0,"text");}}}function xr(t,e,n){if("text"===t.type&&"text"===e.type){var _r38=t.isBefore(e),_o26=t.is(e);mr(t,_r38,_o26),mr(e,!_r38,_o26),_o26&&e.set(t.key,t.offset,t.type);var _i17=jr();if(_i17.isComposing()&&_i17._compositionKey!==t.key&&ar(n)){var _r39=n.anchor,_o27=n.focus;t.set(_r39.key,_r39.offset,_r39.type,!0),e.set(_o27.key,_o27.offset,_o27.type,!0);}}}function Cr(t,e,n,r,o,i){if(null===t||null===n||!Fo(o,t,n))return null;var s=yr(t,e,ar(i)?i.anchor:null,o);if(null===s)return null;var l=yr(n,r,ar(i)?i.focus:null,o);if(null===l)return null;if("element"===s.type&&"element"===l.type){var _e68=si(t),_r40=si(n);if(fo(_e68)&&fo(_r40))return null;}return xr(s,l,i),[s,l];}function Sr(t,e,n,r,o,i){var s=Yr(),l=new _ur(ir(t,e,o),ir(n,r,i),0,"");return l.dirty=!0,s._selection=l,l;}function Nr(){var t=ir("root",0,"element"),e=ir("root",0,"element");return new _ur(t,e,0,"");}function Tr(){return new _cr(new Set());}function vr(t,e,n,r){var o=n._window;if(null===o)return null;var i=r||o.event,s=i?i.type:void 0,l="selectionchange"===s,c=!B&&(l||"beforeinput"===s||"compositionstart"===s||"compositionend"===s||"click"===s&&i&&3===i.detail||"drop"===s||void 0===s);var a,u,f,d;if(ar(t)&&!c)return t.clone();if(null===e)return null;if(a=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,(l||void 0===s)&&ar(t)&&!Fo(n,a,u))return t.clone();var h=Cr(a,f,u,d,n,t);if(null===h)return null;var g=h[0],_=h[1];return new _ur(g,_,ar(t)?t.format:0,ar(t)?t.style:"");}function kr(){return Yr()._selection;}function Er(){return jr()._editorState._selection;}function Or(t,e,n,r){if(r===void 0){r=1;}var o=t.anchor,i=t.focus,s=o.getNode(),l=i.getNode();if(!e.is(s)&&!e.is(l))return;var c=e.__key;if(t.isCollapsed()){var _e69=o.offset;if(n<=_e69&&r>0||n<_e69&&r<0){var _n54=Math.max(0,_e69+r);o.set(c,_n54,"element"),i.set(c,_n54,"element"),br(t);}}else{var _s11=t.isBackward(),_l6=_s11?i:o,_a8=_l6.getNode(),_u8=_s11?o:i,_f8=_u8.getNode();if(e.is(_a8)){var _t107=_l6.offset;(n<=_t107&&r>0||n<_t107&&r<0)&&_l6.set(c,Math.max(0,_t107+r),"element");}if(e.is(_f8)){var _t108=_u8.offset;(n<=_t108&&r>0||n<_t108&&r<0)&&_u8.set(c,Math.max(0,_t108+r),"element");}}br(t);}function br(t){var e=t.anchor,n=e.offset,r=t.focus,o=r.offset,i=e.getNode(),s=r.getNode();if(t.isCollapsed()){if(!co(i))return;var _t109=i.getChildrenSize(),_o28=n>=_t109,_s12=_o28?i.getChildAtIndex(_t109-1):i.getChildAtIndex(n);if(Zn(_s12)){var _t110=0;_o28&&(_t110=_s12.getTextContentSize()),e.set(_s12.__key,_t110,"text"),r.set(_s12.__key,_t110,"text");}return;}if(co(i)){var _t111=i.getChildrenSize(),_r41=n>=_t111,_o29=_r41?i.getChildAtIndex(_t111-1):i.getChildAtIndex(n);if(Zn(_o29)){var _t112=0;_r41&&(_t112=_o29.getTextContentSize()),e.set(_o29.__key,_t112,"text");}}if(co(s)){var _t113=s.getChildrenSize(),_e70=o>=_t113,_n55=_e70?s.getChildAtIndex(_t113-1):s.getChildAtIndex(o);if(Zn(_n55)){var _t114=0;_e70&&(_t114=_n55.getTextContentSize()),r.set(_n55.__key,_t114,"text");}}}function Mr(t,e,n,r,o){var i=null,s=0,l=null;null!==r?(i=r.__key,Zn(r)?(s=r.getTextContentSize(),l="text"):co(r)&&(s=r.getChildrenSize(),l="element")):null!==o&&(i=o.__key,Zn(o)?l="text":co(o)&&(l="element")),null!==i&&null!==l?t.set(i,s,l):(s=e.getIndexWithinParent(),-1===s&&(s=n.getChildrenSize()),t.set(n.__key,s,"element"));}function Ar(t,e,n,r,o){"text"===t.type?t.set(n,t.offset+(e?0:o),"text"):t.offset>r.getIndexWithinParent()&&t.set(t.key,t.offset-1,"element");}function wr(t,e,n,r,o){try{t.setBaseAndExtent(e,n,r,o);}catch(t){}}function Dr(t,e,n,r,o,s,l){var c=r.anchorNode,a=r.focusNode,u=r.anchorOffset,f=r.focusOffset,d=document.activeElement;if(o.has(bn)&&d!==s||null!==d&&Lo(d))return;if(!ar(e))return void(null!==t&&Fo(n,c,a)&&r.removeAllRanges());var h=e.anchor,g=e.focus,_=h.key,p=g.key,y=bi(n,_),m=bi(n,p),x=h.offset,C=g.offset,S=e.format,N=e.style,T=e.isCollapsed();var v=y,k=m,E=!1;if("text"===h.type){v=Jo(y);var _t115=h.getNode();E=_t115.getFormat()!==S||_t115.getStyle()!==N;}else ar(t)&&"text"===t.anchor.type&&(E=!0);var O,b,M,A,w;if(("text"===g.type&&(k=Jo(m)),null!==v&&null!==k)&&(T&&(null===t||E||ar(t)&&(t.format!==S||t.style!==N))&&(O=S,b=N,M=x,A=_,w=performance.now(),nn=[O,b,M,A,w]),u!==x||f!==C||c!==v||a!==k||"Range"===r.type&&T||(null!==d&&s.contains(d)||o.has(wn)||s.focus({preventScroll:!0}),"element"===h.type))){if(wr(r,v,x,k,C),!i||!e.isCollapsed()||null===s||o.has(wn)||null!==document.activeElement&&s.contains(document.activeElement)||s.focus({preventScroll:!0}),!o.has(Mn)&&e.isCollapsed()&&null!==s&&s===document.activeElement){var _t116=ar(e)&&"element"===e.anchor.type?v.childNodes[x]||null:r.rangeCount>0?r.getRangeAt(0):null;if(null!==_t116){var _e71;if(_t116 instanceof Text){var _n56=document.createRange();_n56.selectNode(_t116),_e71=_n56.getBoundingClientRect();}else _e71=_t116.getBoundingClientRect();!function(t,e,n){var r=Ai(n),o=Ii(r);if(null===r||null===o)return;var i=e.top,s=e.bottom,l=0,c=0,a=n;for(;null!==a;){var _e72=a===r.body;if(_e72)l=0,c=Li(t).innerHeight;else{var _t117=a.getBoundingClientRect();l=_t117.top,c=_t117.bottom;}var _n57=0;if(i<l?_n57=-(l-i):s>c&&(_n57=s-c),0!==_n57)if(_e72)o.scrollBy(0,_n57);else{var _t118=a.scrollTop;a.scrollTop+=_n57;var _e73=a.scrollTop-_t118;i-=_e73,s-=_e73;}if(_e72)break;a=Mi(a);}}(n,_e71,s);}}Ge=!0;}}function Pr(e){var n=e;e.isCollapsed()||n.removeText();var r=kr();ar(r)&&(n=r),ar(n)||t(161);var o=n.anchor;var i=o.getNode(),s=o.offset;for(;!Xi(i);){var _Ir;var _t119=i;if(_Ir=Ir(i,s),i=_Ir[0],s=_Ir[1],_t119.is(i))break;}return s;}function Ir(t,e){var n=t.getParent();if(!n){var _t120=No();return ri().append(_t120),_t120.select(),[ri(),0];}if(Zn(t)){var _r42=t.splitText(e);if(0===_r42.length)return[n,t.getIndexWithinParent()];var _o30=0===e?0:1;return[n,_r42[0].getIndexWithinParent()+_o30];}if(!co(t)||0===e)return[n,t.getIndexWithinParent()];var r=t.getChildAtIndex(e);if(r){var _n58=new _ur(ir(t.__key,e,"element"),ir(t.__key,e,"element"),0,""),_o31=t.insertNewAfter(_n58);_o31&&_o31.append.apply(_o31,[r].concat(r.getNextSiblings()));}return[n,t.getIndexWithinParent()+1];}function Lr(t,e,n,r,o){if(o===void 0){o="decorators-and-blocks";}if("move"===e&&"character"===r&&!t.isCollapsed()){var _ref18=n===t.isBackward()?[t.focus,t.anchor]:[t.anchor,t.focus],_e74=_ref18[0],_r43=_ref18[1];return _r43.set(_e74.key,_e74.offset,_e74.type),!0;}var i=zs(t.focus,n?"previous":"next"),s="lineboundary"===r,l="move"===e;var c=i,a="decorators-and-blocks"===o;if(!qs(c)){for(var _t121 of c){a=!1;var _e75=_t121.origin;if(!fo(_e75)||_e75.isIsolated()||(c=_t121,!s||!_e75.isInline()))break;}if(a)for(var _t122 of ws(i).iterNodeCarets("extend"===e?"shadowRoot":"root")){if(ms(_t122))_t122.origin.isInline()||(c=_t122);else{if(co(_t122.origin))continue;fo(_t122.origin)&&!_t122.origin.isInline()&&(c=_t122);}break;}}if(c===i)return!1;if(l&&!s&&fo(c.origin)&&c.origin.isKeyboardSelectable()){var _t123=Tr();return _t123.add(c.origin.getKey()),ii(_t123),!0;}return c=Gs(c),l&&Ws(t.anchor,c),Ws(t.focus,c),a||!s;}var Fr=null,Rr=null,Kr=!1,Br=!1,zr=0;var Wr={characterData:!0,childList:!0,subtree:!0};function $r(){return Kr||null!==Fr&&Fr._readOnly;}function Ur(){Kr&&t(13);}function Jr(){zr>99&&t(14);}function Yr(){return null===Fr&&t(195,Hr()),Fr;}function jr(){return null===Rr&&t(196,Hr()),Rr;}function Hr(){var t=0;var e=new Set(),n=_Oo.version;if("undefined"!=typeof window)for(var _r44 of document.querySelectorAll("[contenteditable]")){var _o32=Bo(_r44);if(Ro(_o32))t++;else if(_o32){var _t124=String(_o32.constructor.version||"<0.17.1");_t124===n&&(_t124+=" (separately built, likely a bundler configuration issue)"),e.add(_t124);}}var r=" Detected on the page: "+t+" compatible editor(s) with version "+n;return e.size&&(r+=" and incompatible editors with versions "+Array.from(e).join(", ")),r;}function Vr(){return Rr;}function Gr(t,e,n){var r=e.__type,o=wo(t,r);var i=n.get(r);void 0===i&&(i=Array.from(o.transforms),n.set(r,i));var s=i.length;for(var _t125=0;_t125<s&&(i[_t125](e),e.isAttached());_t125++);}function qr(t,e){return void 0!==t&&t.__key!==e&&t.isAttached();}function Xr(t,e){if(!e)return;var n=t._updateTags;var r=e;Array.isArray(e)||(r=[e]);for(var _t126 of r)n.add(_t126);}function Qr(e,n){var r=e.type,o=n.get(r);void 0===o&&t(17,r);var i=o.klass;e.type!==i.getType()&&t(18,i.name);var s=i.importJSON(e),l=e.children;if(co(s)&&Array.isArray(l))for(var _t127=0;_t127<l.length;_t127++){var _e76=Qr(l[_t127],n);s.append(_e76);}return s;}function Zr(t,e,n){var r=Fr,o=Kr,i=Rr;Fr=e,Kr=!0,Rr=t;try{return n();}finally{Fr=r,Kr=o,Rr=i;}}function to(t,e){var n=t._pendingEditorState,r=t._rootElement,o=t._headless||null===r;if(null===n)return;var i=t._editorState,s=i._selection,l=n._selection,c=0!==t._dirtyType,a=Fr,u=Kr,f=Rr,d=t._updating,g=t._observer;var _=null;if(t._pendingEditorState=null,t._editorState=n,!o&&c&&null!==g){Rr=t,Fr=n,Kr=!1,t._updating=!0;try{var _e77=t._dirtyType,_r45=t._dirtyElements,_o33=t._dirtyLeaves;g.disconnect(),_=Ut(i,n,t,_e77,_r45,_o33);}catch(e){if(e instanceof Error&&t._onError(e),Br)throw e;return ko(t,null,r,n),V(t),t._dirtyType=2,Br=!0,to(t,i),void(Br=!1);}finally{g.observe(r,Wr),t._updating=d,Fr=a,Kr=u,Rr=f;}}n._readOnly||(n._readOnly=!0);var p=t._dirtyLeaves,y=t._dirtyElements,m=t._normalizedNodes,x=t._updateTags,C=t._deferred;c&&(t._dirtyType=0,t._cloneNotNeeded.clear(),t._dirtyLeaves=new Set(),t._dirtyElements=new Map(),t._normalizedNodes=new Set(),t._updateTags=new Set()),function(t,e){var n=t._decorators;var r=t._pendingDecorators||n;var o=e._nodeMap;var i;for(i in r)o.has(i)||(r===n&&(r=ei(t)),delete r[i]);}(t,n);var S=o?null:Ji(Li(t));if(t._editable&&null!==S&&(c||null===l||l.dirty||!l.is(s))&&null!==r&&!x.has(An)){Rr=t,Fr=n;try{if(null!==g&&g.disconnect(),c||null===l||l.dirty){var _e78=t._blockCursorElement;null!==_e78&&Ui(_e78,t,r),Dr(s,l,t,S,x,r);}!function(t,e,n){var r=t._blockCursorElement;if(ar(n)&&n.isCollapsed()&&"element"===n.anchor.type&&e.contains(document.activeElement)){var _o34=n.anchor,_i18=_o34.getNode(),_s13=_o34.offset;var _l7=!1,_c7=null;if(_s13===_i18.getChildrenSize()){$i(_i18.getChildAtIndex(_s13-1))&&(_l7=!0);}else{var _e79=_i18.getChildAtIndex(_s13);if(null!==_e79&&$i(_e79)){var _n59=_e79.getPreviousSibling();(null===_n59||$i(_n59))&&(_l7=!0,_c7=t.getElementByKey(_e79.__key));}}if(_l7){var _n60=t.getElementByKey(_i18.__key);return null===r&&(t._blockCursorElement=r=function(t){var e=t.theme,n=document.createElement("div");n.contentEditable="false",n.setAttribute("data-lexical-cursor","true");var r=e.blockCursor;if(void 0!==r){var _n$classList;if("string"==typeof r){var _t128=h(r);r=e.blockCursor=_t128;}void 0!==r&&(_n$classList=n.classList).add.apply(_n$classList,r);}return n;}(t._config)),e.style.caretColor="transparent",void(null===_c7?_n60.appendChild(r):_n60.insertBefore(r,_c7));}}null!==r&&Ui(r,t,e);}(t,r,l);}finally{null!==g&&g.observe(r,Wr),Rr=f,Fr=a;}}null!==_&&function(t,e,n,r,o){var i=Array.from(t._listeners.mutation),s=i.length;for(var _t129=0;_t129<s;_t129++){var _i$_t=i[_t129],_s14=_i$_t[0],_l8=_i$_t[1];for(var _t130 of _l8){var _i19=e.get(_t130);void 0!==_i19&&_s14(_i19,{dirtyLeaves:r,prevEditorState:o,updateTags:n});}}}(t,_,x,p,i),ar(l)||null===l||null!==s&&s.is(l)||t.dispatchCommand(jt,void 0);var N=t._pendingDecorators;null!==N&&(t._decorators=N,t._pendingDecorators=null,eo("decorator",t,!0,N)),function(t,e,n){var r=ni(e),o=ni(n);r!==o&&eo("textcontent",t,!0,o);}(t,e||i,n),eo("update",t,!0,{dirtyElements:y,dirtyLeaves:p,editorState:n,mutatedNodes:_,normalizedNodes:m,prevEditorState:e||i,tags:x}),function(t,e){if(t._deferred=[],0!==e.length){var _n61=t._updating;t._updating=!0;try{for(var _t131=0;_t131<e.length;_t131++)e[_t131]();}finally{t._updating=_n61;}}}(t,C),function(t){var e=t._updates;if(0!==e.length){var _n62=e.shift();if(_n62){var _e80=_n62[0],_r46=_n62[1];ro(t,_e80,_r46);}}}(t);}function eo(t,e,n){var o=e._updating;e._updating=n;try{var _n63=Array.from(e._listeners[t]);for(var _len5=arguments.length,r=new Array(_len5>3?_len5-3:0),_key5=3;_key5<_len5;_key5++){r[_key5-3]=arguments[_key5];}for(var _t132=0;_t132<_n63.length;_t132++)_n63[_t132].apply(null,r);}finally{e._updating=o;}}function no(e,n){var r=e._updates;var o=n||!1;for(;0!==r.length;){var _n64=r.shift();if(_n64){var _r47=_n64[0],_i20=_n64[1],_s15=e._pendingEditorState;var _l9=void 0;void 0!==_i20&&(_l9=_i20.onUpdate,_i20.skipTransforms&&(o=!0),_i20.discrete&&(null===_s15&&t(191),_s15._flushSync=!0),_l9&&e._deferred.push(_l9),Xr(e,_i20.tag)),null==_s15?ro(e,_r47,_i20):_r47();}}return o;}function ro(e,n,r){var o=e._updateTags;var i,s=!1,l=!1;void 0!==r&&(i=r.onUpdate,Xr(e,r.tag),s=r.skipTransforms||!1,l=r.discrete||!1),i&&e._deferred.push(i);var c=e._editorState;var a=e._pendingEditorState,u=!1;(null===a||a._readOnly)&&(a=e._pendingEditorState=_o(a||c),u=!0),a._flushSync=l;var f=Fr,d=Kr,h=Rr,g=e._updating;Fr=a,Kr=!1,e._updating=!0,Rr=e;var _=e._headless||null===e.getRootElement();Mo(null);try{u&&(_?null!==c._selection&&(a._selection=c._selection.clone()):a._selection=function(t,e){var n=t.getEditorState()._selection,r=Ji(Li(t));return ar(n)||null==n?vr(n,r,t,e):n.clone();}(e,r&&r.event||null));var _o35=e._compositionKey;n(),s=no(e,s),function(t,e){var n=e.getEditorState()._selection,r=t._selection;if(ar(r)){var _t133=r.anchor,_e81=r.focus;var _o36;if("text"===_t133.type&&(_o36=_t133.getNode(),_o36.selectionTransform(n,r)),"text"===_e81.type){var _t134=_e81.getNode();_o36!==_t134&&_t134.selectionTransform(n,r);}}}(a,e),0!==e._dirtyType&&(s?function(t,e){var n=e._dirtyLeaves,r=t._nodeMap;for(var _t135 of n){var _e82=r.get(_t135);Zn(_e82)&&_e82.isAttached()&&_e82.isSimpleText()&&!_e82.isUnmergeable()&&ct(_e82);}}(a,e):function(t,e){var n=e._dirtyLeaves,r=e._dirtyElements,o=t._nodeMap,i=qo(),s=new Map();var l=n,c=l.size,a=r,u=a.size;for(;c>0||u>0;){if(c>0){e._dirtyLeaves=new Set();for(var _t136 of l){var _r48=o.get(_t136);Zn(_r48)&&_r48.isAttached()&&_r48.isSimpleText()&&!_r48.isUnmergeable()&&ct(_r48),void 0!==_r48&&qr(_r48,i)&&Gr(e,_r48,s),n.add(_t136);}if(l=e._dirtyLeaves,c=l.size,c>0){zr++;continue;}}e._dirtyLeaves=new Set(),e._dirtyElements=new Map(),a["delete"]("root")&&a.set("root",!0);for(var _t137 of a){var _n65=_t137[0],_l0=_t137[1];if(r.set(_n65,_l0),!_l0)continue;var _c8=o.get(_n65);void 0!==_c8&&qr(_c8,i)&&Gr(e,_c8,s);}l=e._dirtyLeaves,c=l.size,a=e._dirtyElements,u=a.size,zr++;}e._dirtyLeaves=n,e._dirtyElements=r;}(a,e),no(e),function(t,e,n,r){var o=t._nodeMap,i=e._nodeMap,s=[];for(var _ref20 of r){var _t138=_ref20[0];{var _e83=i.get(_t138);void 0!==_e83&&(_e83.isAttached()||(co(_e83)&&K(_e83,_t138,o,i,s,r),o.has(_t138)||r["delete"](_t138),s.push(_t138)));}}for(var _t139 of s)i["delete"](_t139);for(var _t140 of n){var _e84=i.get(_t140);void 0===_e84||_e84.isAttached()||(o.has(_t140)||n["delete"](_t140),i["delete"](_t140));}}(c,a,e._dirtyLeaves,e._dirtyElements));_o35!==e._compositionKey&&(a._flushSync=!0);var _i21=a._selection;if(ar(_i21)){var _e85=a._nodeMap,_n66=_i21.anchor.key,_r49=_i21.focus.key;void 0!==_e85.get(_n66)&&void 0!==_e85.get(_r49)||t(19);}else fr(_i21)&&0===_i21._nodes.size&&(a._selection=null);}catch(t){return t instanceof Error&&e._onError(t),e._pendingEditorState=c,e._dirtyType=2,e._cloneNotNeeded.clear(),e._dirtyLeaves=new Set(),e._dirtyElements.clear(),void to(e);}finally{Fr=f,Kr=d,Rr=h,e._updating=g,zr=0;}var p=0!==e._dirtyType||e._deferred.length>0||function(t,e){var n=e.getEditorState()._selection,r=t._selection;if(null!==r){if(r.dirty||!r.is(n))return!0;}else if(null!==n)return!0;return!1;}(a,e);p?a._flushSync?(a._flushSync=!1,to(e)):u&&Po(function(){to(e);}):(a._flushSync=!1,u&&(o.clear(),e._deferred=[],e._pendingEditorState=null));}function oo(t,e,n){Rr===t&&void 0===n?e():ro(t,e,n);}var _io=function(){function io(t,e,n){this.element=t,this.before=e||null,this.after=n||null;}var _proto9=io.prototype;_proto9.withBefore=function withBefore(t){return new io(this.element,t,this.after);};_proto9.withAfter=function withAfter(t){return new io(this.element,this.before,t);};_proto9.withElement=function withElement(t){return this.element===t?this:new io(t,this.before,this.after);};_proto9.insertChild=function insertChild(e){var n=this.before||this.getManagedLineBreak();return null!==n&&n.parentElement!==this.element&&t(222),this.element.insertBefore(e,n),this;};_proto9.removeChild=function removeChild(e){return e.parentElement!==this.element&&t(223),this.element.removeChild(e),this;};_proto9.replaceChild=function replaceChild(e,n){return n.parentElement!==this.element&&t(224),this.element.replaceChild(e,n),this;};_proto9.getFirstChild=function getFirstChild(){var t=this.after?this.after.nextSibling:this.element.firstChild;return t===this.before||t===this.getManagedLineBreak()?null:t;};_proto9.getManagedLineBreak=function getManagedLineBreak(){return this.element.__lexicalLineBreak||null;};_proto9.setManagedLineBreak=function setManagedLineBreak(t){if(null===t)this.removeManagedLineBreak();else{var _e86="decorator"===t&&(d||c||l);this.insertManagedLineBreak(_e86);}};_proto9.removeManagedLineBreak=function removeManagedLineBreak(){var t=this.getManagedLineBreak();if(t){var _e87=this.element,_n67="IMG"===t.nodeName?t.nextSibling:null;_n67&&_e87.removeChild(_n67),_e87.removeChild(t),_e87.__lexicalLineBreak=void 0;}};_proto9.insertManagedLineBreak=function insertManagedLineBreak(t){var e=this.getManagedLineBreak();if(e){if(t===("IMG"===e.nodeName))return;this.removeManagedLineBreak();}var n=this.element,r=this.before,o=document.createElement("br");if(n.insertBefore(o,r),t){var _t141=document.createElement("img");_t141.setAttribute("data-lexical-linebreak","true"),_t141.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",_t141.alt="",n.insertBefore(_t141,o),n.__lexicalLineBreak=_t141;}else n.__lexicalLineBreak=o;};_proto9.getFirstChildOffset=function getFirstChildOffset(){var t=0;for(var _e88=this.after;null!==_e88;_e88=_e88.previousSibling)t++;return t;};_proto9.resolveChildIndex=function resolveChildIndex(t,e,n,r){if(n===this.element){var _e89=this.getFirstChildOffset();return[t,Math.min(_e89+t.getChildrenSize(),Math.max(_e89,r))];}var o=so(e,n);o.push(r);var i=so(e,this.element);var s=t.getIndexWithinParent();for(var _t142=0;_t142<i.length;_t142++){var _e90=o[_t142],_n68=i[_t142];if(void 0===_e90||_e90<_n68)break;if(_e90>_n68){s+=1;break;}}return[t.getParentOrThrow(),s];};return io;}();function so(e,n){var r=[];var o=n;for(;o!==e&&null!==o;o=o.parentNode){var _t143=0;for(var _e91=o.previousSibling;null!==_e91;_e91=_e91.previousSibling)_t143++;r.push(_t143);}return o!==e&&t(225),r.reverse();}var _lo4=function(_En3){function lo(t){var _this3;_this3=_En3.call(this,t)||this,_this3.__first=null,_this3.__last=null,_this3.__size=0,_this3.__format=0,_this3.__style="",_this3.__indent=0,_this3.__dir=null,_this3.__textFormat=0,_this3.__textStyle="";return _this3;}babelHelpers.inheritsLoose(lo,_En3);var _proto0=lo.prototype;_proto0.afterCloneFrom=function afterCloneFrom(t){_En3.prototype.afterCloneFrom.call(this,t),this.__key===t.__key&&(this.__first=t.__first,this.__last=t.__last,this.__size=t.__size),this.__indent=t.__indent,this.__format=t.__format,this.__style=t.__style,this.__dir=t.__dir,this.__textFormat=t.__textFormat,this.__textStyle=t.__textStyle;};_proto0.getFormat=function getFormat(){return this.getLatest().__format;};_proto0.getFormatType=function getFormatType(){var t=this.getFormat();return I[t]||"";};_proto0.getStyle=function getStyle(){return this.getLatest().__style;};_proto0.getIndent=function getIndent(){return this.getLatest().__indent;};_proto0.getChildren=function getChildren(){var t=[];var e=this.getFirstChild();for(;null!==e;)t.push(e),e=e.getNextSibling();return t;};_proto0.getChildrenKeys=function getChildrenKeys(){var t=[];var e=this.getFirstChild();for(;null!==e;)t.push(e.__key),e=e.getNextSibling();return t;};_proto0.getChildrenSize=function getChildrenSize(){return this.getLatest().__size;};_proto0.isEmpty=function isEmpty(){return 0===this.getChildrenSize();};_proto0.isDirty=function isDirty(){var t=jr()._dirtyElements;return null!==t&&t.has(this.__key);};_proto0.isLastChild=function isLastChild(){var t=this.getLatest(),e=this.getParentOrThrow().getLastChild();return null!==e&&e.is(t);};_proto0.getAllTextNodes=function getAllTextNodes(){var t=[];var e=this.getFirstChild();for(;null!==e;){if(Zn(e)&&t.push(e),co(e)){var _n69=e.getAllTextNodes();t.push.apply(t,_n69);}e=e.getNextSibling();}return t;};_proto0.getFirstDescendant=function getFirstDescendant(){var t=this.getFirstChild();for(;co(t);){var _e92=t.getFirstChild();if(null===_e92)break;t=_e92;}return t;};_proto0.getLastDescendant=function getLastDescendant(){var t=this.getLastChild();for(;co(t);){var _e93=t.getLastChild();if(null===_e93)break;t=_e93;}return t;};_proto0.getDescendantByIndex=function getDescendantByIndex(t){var e=this.getChildren(),n=e.length;if(t>=n){var _t144=e[n-1];return co(_t144)&&_t144.getLastDescendant()||_t144||null;}var r=e[t];return co(r)&&r.getFirstDescendant()||r||null;};_proto0.getFirstChild=function getFirstChild(){var t=this.getLatest().__first;return null===t?null:Xo(t);};_proto0.getFirstChildOrThrow=function getFirstChildOrThrow(){var e=this.getFirstChild();return null===e&&t(45,this.__key),e;};_proto0.getLastChild=function getLastChild(){var t=this.getLatest().__last;return null===t?null:Xo(t);};_proto0.getLastChildOrThrow=function getLastChildOrThrow(){var e=this.getLastChild();return null===e&&t(96,this.__key),e;};_proto0.getChildAtIndex=function getChildAtIndex(t){var e=this.getChildrenSize();var n,r;if(t<e/2){for(n=this.getFirstChild(),r=0;null!==n&&r<=t;){if(r===t)return n;n=n.getNextSibling(),r++;}return null;}for(n=this.getLastChild(),r=e-1;null!==n&&r>=t;){if(r===t)return n;n=n.getPreviousSibling(),r--;}return null;};_proto0.getTextContent=function getTextContent(){var t="";var e=this.getChildren(),n=e.length;for(var _r50=0;_r50<n;_r50++){var _o37=e[_r50];t+=_o37.getTextContent(),co(_o37)&&_r50!==n-1&&!_o37.isInline()&&(t+=k);}return t;};_proto0.getTextContentSize=function getTextContentSize(){var t=0;var e=this.getChildren(),n=e.length;for(var _r51=0;_r51<n;_r51++){var _o38=e[_r51];t+=_o38.getTextContentSize(),co(_o38)&&_r51!==n-1&&!_o38.isInline()&&(t+=2);}return t;};_proto0.getDirection=function getDirection(){return this.getLatest().__dir;};_proto0.getTextFormat=function getTextFormat(){return this.getLatest().__textFormat;};_proto0.hasFormat=function hasFormat(t){if(""!==t){var _e94=P[t];return 0!==(this.getFormat()&_e94);}return!1;};_proto0.hasTextFormat=function hasTextFormat(t){var e=w[t];return 0!==(this.getTextFormat()&e);};_proto0.getFormatFlags=function getFormatFlags(t,e){return Yo(this.getLatest().__textFormat,t,e);};_proto0.getTextStyle=function getTextStyle(){return this.getLatest().__textStyle;};_proto0.select=function select(t,e){Ur();var n=kr();var r=t,o=e;var i=this.getChildrenSize();if(!this.canBeEmpty())if(0===t&&0===e){var _t145=this.getFirstChild();if(Zn(_t145)||co(_t145))return _t145.select(0,0);}else if(!(void 0!==t&&t!==i||void 0!==e&&e!==i)){var _t146=this.getLastChild();if(Zn(_t146)||co(_t146))return _t146.select();}void 0===r&&(r=i),void 0===o&&(o=i);var s=this.__key;return ar(n)?(n.anchor.set(s,r,"element"),n.focus.set(s,o,"element"),n.dirty=!0,n):Sr(s,r,s,o,"element","element");};_proto0.selectStart=function selectStart(){var t=this.getFirstDescendant();return t?t.selectStart():this.select();};_proto0.selectEnd=function selectEnd(){var t=this.getLastDescendant();return t?t.selectEnd():this.select();};_proto0.clear=function clear(){var t=this.getWritable();return this.getChildren().forEach(function(t){return t.remove();}),t;};_proto0.append=function append(){for(var _len6=arguments.length,t=new Array(_len6),_key6=0;_key6<_len6;_key6++){t[_key6]=arguments[_key6];}return this.splice(this.getChildrenSize(),0,t);};_proto0.setDirection=function setDirection(t){var e=this.getWritable();return e.__dir=t,e;};_proto0.setFormat=function setFormat(t){return this.getWritable().__format=""!==t?P[t]:0,this;};_proto0.setStyle=function setStyle(t){return this.getWritable().__style=t||"",this;};_proto0.setTextFormat=function setTextFormat(t){var e=this.getWritable();return e.__textFormat=t,e;};_proto0.setTextStyle=function setTextStyle(t){var e=this.getWritable();return e.__textStyle=t,e;};_proto0.setIndent=function setIndent(t){return this.getWritable().__indent=t,this;};_proto0.splice=function splice(e,n,r){kn(this)&&t(324,this.__key,this.__type);var o=this.getChildrenSize(),i=this.getWritable();e+n<=o||t(226,String(e),String(n),String(o));var s=i.__key,l=[],c=[],a=this.getChildAtIndex(e+n);var u=null,f=o-n+r.length;if(0!==e)if(e===o)u=this.getLastChild();else{var _t147=this.getChildAtIndex(e);null!==_t147&&(u=_t147.getPreviousSibling());}if(n>0){var _e95=null===u?this.getFirstChild():u.getNextSibling();for(var _r52=0;_r52<n;_r52++){null===_e95&&t(100);var _n70=_e95.getNextSibling(),_r53=_e95.__key;Ho(_e95.getWritable()),c.push(_r53),_e95=_n70;}}var d=u;for(var _e96 of r){null!==d&&_e96.is(d)&&(u=d=d.getPreviousSibling());var _n71=_e96.getWritable();_n71.__parent===s&&f--,Ho(_n71);var _r54=_e96.__key;if(null===d)i.__first=_r54,_n71.__prev=null;else{var _t148=d.getWritable();_t148.__next=_r54,_n71.__prev=_t148.__key;}_e96.__key===s&&t(76),_n71.__parent=s,l.push(_r54),d=_e96;}if(e+n===o){if(null!==d){d.getWritable().__next=null,i.__last=d.__key;}}else if(null!==a){var _t149=a.getWritable();if(null!==d){var _e97=d.getWritable();_t149.__prev=d.__key,_e97.__next=a.__key;}else _t149.__prev=null;}if(i.__size=f,c.length){var _t150=kr();if(ar(_t150)){var _e98=new Set(c),_n72=new Set(l),_r55=_t150.anchor,_o39=_t150.focus;ao(_r55,_e98,_n72)&&Mr(_r55,_r55.getNode(),this,u,a),ao(_o39,_e98,_n72)&&Mr(_o39,_o39.getNode(),this,u,a),0!==f||this.canBeEmpty()||Ri(this)||this.remove();}}return i;};_proto0.getDOMSlot=function getDOMSlot(t){return new _io(t);};_proto0.exportDOM=function exportDOM(t){var _En3$prototype$export=_En3.prototype.exportDOM.call(this,t),e=_En3$prototype$export.element;if(ji(e)){var _t151=this.getIndent();_t151>0&&(e.style.paddingInlineStart=40*_t151+"px");var _n73=this.getDirection();_n73&&(e.dir=_n73);}return{element:e};};_proto0.exportJSON=function exportJSON(){var t=babelHelpers["extends"]({children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent()},_En3.prototype.exportJSON.call(this)),e=this.getTextFormat(),n=this.getTextStyle();return 0===e&&""===n||Ri(this)||this.getChildren().some(Zn)||(0!==e&&(t.textFormat=e),""!==n&&(t.textStyle=n)),t;};_proto0.updateFromJSON=function updateFromJSON(t){return _En3.prototype.updateFromJSON.call(this,t).setFormat(t.format).setIndent(t.indent).setDirection(t.direction).setTextFormat(t.textFormat||0).setTextStyle(t.textStyle||"");};_proto0.insertNewAfter=function insertNewAfter(t,e){return null;};_proto0.canIndent=function canIndent(){return!0;};_proto0.collapseAtStart=function collapseAtStart(t){return!1;};_proto0.excludeFromCopy=function excludeFromCopy(t){return!1;};_proto0.canReplaceWith=function canReplaceWith(t){return!0;};_proto0.canInsertAfter=function canInsertAfter(t){return!0;};_proto0.canBeEmpty=function canBeEmpty(){return!0;};_proto0.canInsertTextBefore=function canInsertTextBefore(){return!0;};_proto0.canInsertTextAfter=function canInsertTextAfter(){return!0;};_proto0.isInline=function isInline(){return!1;};_proto0.isShadowRoot=function isShadowRoot(){return!1;};_proto0.canMergeWith=function canMergeWith(t){return!1;};_proto0.extractWithChild=function extractWithChild(t,e,n){return!1;};_proto0.canMergeWhenEmpty=function canMergeWhenEmpty(){return!1;};_proto0.reconcileObservedMutation=function reconcileObservedMutation(t,e){var n=this.getDOMSlot(t);var r=n.getFirstChild();for(var _t152=this.getFirstChild();_t152;_t152=_t152.getNextSibling()){var _o40=e.getElementByKey(_t152.getKey());null!==_o40&&(null==r?(n.insertChild(_o40),r=_o40):r!==_o40&&n.replaceChild(_o40,r),r=r.nextSibling);}};return lo;}(_En5);function co(t){return t instanceof _lo4;}function ao(t,e,n){var r=t.getNode();for(;r;){var _t153=r.__key;if(e.has(_t153)&&!n.has(_t153))return!0;r=r.getParent();}return!1;}var _uo=function(_En4){function uo(){return _En4.apply(this,arguments)||this;}babelHelpers.inheritsLoose(uo,_En4);var _proto1=uo.prototype;_proto1.decorate=function decorate(t,e){return null;};_proto1.isIsolated=function isIsolated(){return!1;};_proto1.isInline=function isInline(){return!0;};_proto1.isKeyboardSelectable=function isKeyboardSelectable(){return!0;};return uo;}(_En5);function fo(t){return t instanceof _uo;}var _ho=function(_lo){function ho(){var _this4;_this4=_lo.call(this,"root")||this,_this4.__cachedText=null;return _this4;}babelHelpers.inheritsLoose(ho,_lo);ho.getType=function getType(){return"root";};ho.clone=function clone(){return new ho();};var _proto10=ho.prototype;_proto10.getTopLevelElementOrThrow=function getTopLevelElementOrThrow(){t(51);};_proto10.getTextContent=function getTextContent(){var t=this.__cachedText;return!$r()&&0!==jr()._dirtyType||null===t?_lo.prototype.getTextContent.call(this):t;};_proto10.remove=function remove(){t(52);};_proto10.replace=function replace(e){t(53);};_proto10.insertBefore=function insertBefore(e){t(54);};_proto10.insertAfter=function insertAfter(e){t(55);};_proto10.updateDOM=function updateDOM(t,e){return!1;};_proto10.splice=function splice(e,n,r){for(var _e99 of r)co(_e99)||fo(_e99)||t(282);return _lo.prototype.splice.call(this,e,n,r);};ho.importJSON=function importJSON(t){return ri().updateFromJSON(t);};_proto10.collapseAtStart=function collapseAtStart(){return!0;};return ho;}(_lo4);function go(t){return t instanceof _ho;}function _o(t){return new _mo(new Map(t._nodeMap));}function po(){return new _mo(new Map([["root",new _ho()]]));}function yo(e){var n=e.exportJSON(),r=e.constructor;if(n.type!==r.getType()&&t(130,r.name),co(e)){var _o41=n.children;Array.isArray(_o41)||t(59,r.name);var _i22=e.getChildren();for(var _t154=0;_t154<_i22.length;_t154++){var _e100=yo(_i22[_t154]);_o41.push(_e100);}}return n;}var _mo=function(){function mo(t,e){this._nodeMap=t,this._selection=e||null,this._flushSync=!1,this._readOnly=!1;}var _proto11=mo.prototype;_proto11.isEmpty=function isEmpty(){return 1===this._nodeMap.size&&null===this._selection;};_proto11.read=function read(t,e){return Zr(e&&e.editor||null,this,t);};_proto11.clone=function clone(t){var e=new mo(this._nodeMap,void 0===t?this._selection:t);return e._readOnly=!0,e;};_proto11.toJSON=function toJSON(){return Zr(null,this,function(){return{root:yo(ri())};});};return mo;}();var _xo=function(_lo2){function xo(){return _lo2.apply(this,arguments)||this;}babelHelpers.inheritsLoose(xo,_lo2);xo.getType=function getType(){return"artificial";};var _proto12=xo.prototype;_proto12.createDOM=function createDOM(t){return document.createElement("div");};return xo;}(_lo4);var _Co=function(_lo3){function Co(){return _lo3.apply(this,arguments)||this;}babelHelpers.inheritsLoose(Co,_lo3);Co.getType=function getType(){return"paragraph";};Co.clone=function clone(t){return new Co(t.__key);};var _proto13=Co.prototype;_proto13.createDOM=function createDOM(t){var e=document.createElement("p"),n=Si(t.theme,"paragraph");if(void 0!==n){var _e$classList2;(_e$classList2=e.classList).add.apply(_e$classList2,n);}return e;};_proto13.updateDOM=function updateDOM(t,e,n){return!1;};Co.importDOM=function importDOM(){return{p:function p(t){return{conversion:So,priority:0};}};};_proto13.exportDOM=function exportDOM(t){var _lo3$prototype$export=_lo3.prototype.exportDOM.call(this,t),e=_lo3$prototype$export.element;if(ji(e)){this.isEmpty()&&e.append(document.createElement("br"));var _t155=this.getFormatType();_t155&&(e.style.textAlign=_t155);}return{element:e};};Co.importJSON=function importJSON(t){return No().updateFromJSON(t);};_proto13.exportJSON=function exportJSON(){var t=_lo3.prototype.exportJSON.call(this);if(void 0===t.textFormat||void 0===t.textStyle){var _e101=this.getChildren().find(Zn);_e101?(t.textFormat=_e101.getFormat(),t.textStyle=_e101.getStyle()):(t.textFormat=this.getTextFormat(),t.textStyle=this.getTextStyle());}return t;};_proto13.insertNewAfter=function insertNewAfter(t,e){var n=No();n.setTextFormat(t.format),n.setTextStyle(t.style);var r=this.getDirection();return n.setDirection(r),n.setFormat(this.getFormatType()),n.setStyle(this.getStyle()),this.insertAfter(n,e),n;};_proto13.collapseAtStart=function collapseAtStart(){var t=this.getChildren();if(0===t.length||Zn(t[0])&&""===t[0].getTextContent().trim()){if(null!==this.getNextSibling())return this.selectNext(),this.remove(),!0;if(null!==this.getPreviousSibling())return this.selectPrevious(),this.remove(),!0;}return!1;};return Co;}(_lo4);function So(t){var e=No();return t.style&&(e.setFormat(t.style.textAlign),rs(t,e)),{node:e};}function No(){return Bi(new _Co());}function To(t){return t instanceof _Co;}var vo=0;function ko(t,e,n,r){var o=t._keyToDOMMap;o.clear(),t._editorState=po(),t._pendingEditorState=r,t._compositionKey=null,t._dirtyType=0,t._cloneNotNeeded.clear(),t._dirtyLeaves=new Set(),t._dirtyElements.clear(),t._normalizedNodes=new Set(),t._updateTags=new Set(),t._updates=[],t._blockCursorElement=null;var i=t._observer;null!==i&&(i.disconnect(),t._observer=null),null!==e&&(e.textContent=""),null!==n&&(n.textContent="",o.set("root",n));}function Eo(t){var e=new Set(),n=new Set();var r=t;for(;r;){var _ss3=ss(r),_t156=_ss3.ownNodeConfig,_o42=r.transform;if(!n.has(_o42)){n.add(_o42);var _t157=r.transform();_t157&&e.add(_t157);}if(_t156){var _n74=_t156.$transform;_n74&&e.add(_n74),r=_t156["extends"];}else{var _t158=Object.getPrototypeOf(r);r=_t158.prototype instanceof _En5&&_t158!==_En5?_t158:void 0;}}return e;}var _Oo=function(){function Oo(t,e,n,r,o,i,s,l){this._createEditorArgs=l,this._parentEditor=e,this._rootElement=null,this._editorState=t,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map(),this._updates=[],this._updating=!1,this._listeners={decorator:new Set(),editable:new Set(),mutation:new Map(),root:new Set(),textcontent:new Set(),update:new Set()},this._commands=new Map(),this._config=r,this._nodes=n,this._decorators={},this._pendingDecorators=null,this._dirtyType=0,this._cloneNotNeeded=new Set(),this._dirtyLeaves=new Set(),this._dirtyElements=new Map(),this._normalizedNodes=new Set(),this._updateTags=new Set(),this._observer=null,this._key=ai(),this._onError=o,this._htmlConversions=i,this._editable=s,this._headless=null!==e&&e._headless,this._window=null,this._blockCursorElement=null;}var _proto14=Oo.prototype;_proto14.isComposing=function isComposing(){return null!=this._compositionKey;};_proto14.registerUpdateListener=function registerUpdateListener(t){var e=this._listeners.update;return e.add(t),function(){e["delete"](t);};};_proto14.registerEditableListener=function registerEditableListener(t){var e=this._listeners.editable;return e.add(t),function(){e["delete"](t);};};_proto14.registerDecoratorListener=function registerDecoratorListener(t){var e=this._listeners.decorator;return e.add(t),function(){e["delete"](t);};};_proto14.registerTextContentListener=function registerTextContentListener(t){var e=this._listeners.textcontent;return e.add(t),function(){e["delete"](t);};};_proto14.registerRootListener=function registerRootListener(t){var _this13=this;var e=this._listeners.root;return t(this._rootElement,null),e.add(t),function(){t(null,_this13._rootElement),e["delete"](t);};};_proto14.registerCommand=function registerCommand(e,n,r){void 0===r&&t(35);var o=this._commands;o.has(e)||o.set(e,[new Set(),new Set(),new Set(),new Set(),new Set()]);var i=o.get(e);void 0===i&&t(36,String(e));var s=i[r];return s.add(n),function(){s["delete"](n),i.every(function(t){return 0===t.size;})&&o["delete"](e);};};_proto14.registerMutationListener=function registerMutationListener(t,e,n){var r=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(t)).klass,o=this._listeners.mutation;var i=o.get(e);void 0===i&&(i=new Set(),o.set(e,i)),i.add(r);var s=n&&n.skipInitialization;return void 0!==s&&s||this.initializeMutationListener(e,r),function(){i["delete"](r),0===i.size&&o["delete"](e);};};_proto14.getRegisteredNode=function getRegisteredNode(e){var n=this._nodes.get(e.getType());return void 0===n&&t(37,e.name),n;};_proto14.resolveRegisteredNodeAfterReplacements=function resolveRegisteredNodeAfterReplacements(t){for(;t.replaceWithKlass;)t=this.getRegisteredNode(t.replaceWithKlass);return t;};_proto14.initializeMutationListener=function initializeMutationListener(t,e){var n=this._editorState,r=es(n).get(e.getType());if(!r)return;var o=new Map();for(var _t159 of r.keys())o.set(_t159,"created");o.size>0&&t(o,{dirtyLeaves:new Set(),prevEditorState:n,updateTags:new Set(["registerMutationListener"])});};_proto14.registerNodeTransformToKlass=function registerNodeTransformToKlass(t,e){var n=this.getRegisteredNode(t);return n.transforms.add(e),n;};_proto14.registerNodeTransform=function registerNodeTransform(t,e){var n=this.registerNodeTransformToKlass(t,e),r=[n],o=n.replaceWithKlass;if(null!=o){var _t160=this.registerNodeTransformToKlass(o,e);r.push(_t160);}return function(t,e){var n=es(t.getEditorState()),r=[];for(var _t161 of e){var _e102=n.get(_t161);_e102&&r.push(_e102);}if(0===r.length)return;t.update(function(){for(var _t162 of r)for(var _e103 of _t162.keys()){var _t163=Xo(_e103);_t163&&_t163.markDirty();}},null===t._pendingEditorState?{tag:On}:void 0);}(this,r.map(function(t){return t.klass.getType();})),function(){r.forEach(function(t){return t.transforms["delete"](e);});};};_proto14.hasNode=function hasNode(t){return this._nodes.has(t.getType());};_proto14.hasNodes=function hasNodes(t){return t.every(this.hasNode.bind(this));};_proto14.dispatchCommand=function dispatchCommand(t,e){return Ei(this,t,e);};_proto14.getDecorators=function getDecorators(){return this._decorators;};_proto14.getRootElement=function getRootElement(){return this._rootElement;};_proto14.getKey=function getKey(){return this._key;};_proto14.setRootElement=function setRootElement(t){var e=this._rootElement;if(t!==e){var _e$classList3;var _n75=Si(this._config.theme,"root"),_r56=this._pendingEditorState||this._editorState;if(this._rootElement=t,ko(this,e,t,_r56),null!==e&&(this._config.disableEvents||Nn(e),null!=_n75&&(_e$classList3=e.classList).remove.apply(_e$classList3,_n75)),null!==t){var _t$classList;var _e104=Ii(t),_r57=t.style;_r57.userSelect="text",_r57.whiteSpace="pre-wrap",_r57.wordBreak="break-word",t.setAttribute("data-lexical-editor","true"),this._window=_e104,this._dirtyType=2,V(this),this._updateTags.add(On),to(this),this._config.disableEvents||function(t,e,_Ve$get){var n=t.ownerDocument;He.set(t,n);var r=(_Ve$get=Ve.get(n))!=null?_Ve$get:0;r<1&&n.addEventListener("selectionchange",mn),Ve.set(n,r+1),t.__lexicalEditor=e;var o=pn(t);var _loop=function _loop(){var _$e$_n=$e[_n76],r=_$e$_n[0],i=_$e$_n[1],s="function"==typeof i?function(t){Cn(t)||(xn(t),(e.isEditable()||"click"===r)&&i(t,e));}:function(t){if(Cn(t))return;xn(t);var n=e.isEditable();switch(r){case"cut":return n&&Ei(e,De,t);case"copy":return Ei(e,we,t);case"paste":return n&&Ei(e,re,t);case"dragstart":return n&&Ei(e,be,t);case"dragover":return n&&Ei(e,Me,t);case"dragend":return n&&Ei(e,Ae,t);case"focus":return n&&Ei(e,Ke,t);case"blur":return n&&Ei(e,Be,t);case"drop":return n&&Ei(e,Ee,t);}};t.addEventListener(r,s),o.push(function(){t.removeEventListener(r,s);});};for(var _n76=0;_n76<$e.length;_n76++){_loop();}}(t,this),null!=_n75&&(_t$classList=t.classList).add.apply(_t$classList,_n75);}else this._window=null,this._updateTags.add(On),to(this);eo("root",this,!1,t,e);}};_proto14.getElementByKey=function getElementByKey(t){return this._keyToDOMMap.get(t)||null;};_proto14.getEditorState=function getEditorState(){return this._editorState;};_proto14.setEditorState=function setEditorState(e,n){e.isEmpty()&&t(38);var r=e;r._readOnly&&(r=_o(e),r._selection=e._selection?e._selection.clone():null),H(this);var o=this._pendingEditorState,i=this._updateTags,s=void 0!==n?n.tag:null;null===o||o.isEmpty()||(null!=s&&i.add(s),to(this)),this._pendingEditorState=r,this._dirtyType=2,this._dirtyElements.set("root",!1),this._compositionKey=null,null!=s&&i.add(s),this._updating||to(this);};_proto14.parseEditorState=function parseEditorState(t,e){return function(t,e,n){var r=po(),o=Fr,i=Kr,s=Rr,l=e._dirtyElements,c=e._dirtyLeaves,a=e._cloneNotNeeded,u=e._dirtyType;e._dirtyElements=new Map(),e._dirtyLeaves=new Set(),e._cloneNotNeeded=new Set(),e._dirtyType=0,Fr=r,Kr=!1,Rr=e,Mo(null);try{var _o43=e._nodes;Qr(t.root,_o43),n&&n(),r._readOnly=!0;}catch(t){t instanceof Error&&e._onError(t);}finally{e._dirtyElements=l,e._dirtyLeaves=c,e._cloneNotNeeded=a,e._dirtyType=u,Fr=o,Kr=i,Rr=s;}return r;}("string"==typeof t?JSON.parse(t):t,this,e);};_proto14.read=function read(t){return to(this),this.getEditorState().read(t,{editor:this});};_proto14.update=function update(t,e){!function(t,e,n){t._updating?t._updates.push([e,n]):ro(t,e,n);}(this,t,e);};_proto14.focus=function focus(t,e){if(e===void 0){e={};}var n=this._rootElement;null!==n&&(n.setAttribute("autocapitalize","off"),oo(this,function(){var r=kr(),o=ri();null!==r?r.dirty||ii(r.clone()):0!==o.getChildrenSize()&&("rootStart"===e.defaultSelection?o.selectStart():o.selectEnd()),wi("focus"),Di(function(){n.removeAttribute("autocapitalize"),t&&t();});}),null===this._pendingEditorState&&n.removeAttribute("autocapitalize"));};_proto14.blur=function blur(){var t=this._rootElement;null!==t&&t.blur();var e=Ji(this._window);null!==e&&e.removeAllRanges();};_proto14.isEditable=function isEditable(){return this._editable;};_proto14.setEditable=function setEditable(t){this._editable!==t&&(this._editable=t,eo("editable",this,!0,t));};_proto14.toJSON=function toJSON(){return{editorState:this._editorState.toJSON()};};return Oo;}();_Oo.version="0.39.0+prod.cjs";var bo=null;function Mo(t){bo=t;}var Ao=1;function wo(e,n){var r=Do(e,n);return void 0===r&&t(30,n),r;}function Do(t,e){return t._nodes.get(e);}var Po="function"==typeof queueMicrotask?queueMicrotask:function(t){Promise.resolve().then(t);};function Io(t){return fo(ti(t));}function Lo(t){var e=document.activeElement;if(!ji(e))return!1;var n=e.nodeName;return fo(ti(t))&&("INPUT"===n||"TEXTAREA"===n||"true"===e.contentEditable&&null==Bo(e));}function Fo(t,e,n){var r=t.getRootElement();try{return null!==r&&r.contains(e)&&r.contains(n)&&null!==e&&!Lo(e)&&Ko(e)===t;}catch(t){return!1;}}function Ro(t){return t instanceof _Oo;}function Ko(t){var e=t;for(;null!=e;){var _t164=Bo(e);if(Ro(_t164))return _t164;e=Mi(e);}return null;}function Bo(t){return t?t.__lexicalEditor:null;}function zo(t){return rr(t)||t.isToken();}function Wo(t){return zo(t)||t.isSegmented();}function $o(t){return Hi(t)&&3===t.nodeType;}function Uo(t){return Hi(t)&&9===t.nodeType;}function Jo(t){var e=t;for(;null!=e;){if($o(e))return e;e=e.firstChild;}return null;}function Yo(t,e,n){var r=w[e];if(null!==n&&(t&r)===(n&r))return t;var o=t^r;return"subscript"===e?o&=~w.superscript:"superscript"===e?o&=~w.subscript:"lowercase"===e?(o&=~w.uppercase,o&=~w.capitalize):"uppercase"===e?(o&=~w.lowercase,o&=~w.capitalize):"capitalize"===e&&(o&=~w.lowercase,o&=~w.uppercase),o;}function jo(t,e){var n=function(){var t=bo;return bo=null,t;}();if(null!=(e=e||n&&n.__key))return void(t.__key=e);Ur(),Jr();var r=jr(),o=Yr(),i=""+Ao++;o._nodeMap.set(i,t),co(t)?r._dirtyElements.set(i,!0):r._dirtyLeaves.add(i),r._cloneNotNeeded.add(i),r._dirtyType=1,t.__key=i;}function Ho(t){var e=t.getParent();if(null!==e){var _n77=t.getWritable(),_r58=e.getWritable(),_o44=t.getPreviousSibling(),_i23=t.getNextSibling(),_s16=null!==_i23?_i23.__key:null,_l1=null!==_o44?_o44.__key:null,_c9=null!==_o44?_o44.getWritable():null,_a9=null!==_i23?_i23.getWritable():null;null===_o44&&(_r58.__first=_s16),null===_i23&&(_r58.__last=_l1),null!==_c9&&(_c9.__next=_s16),null!==_a9&&(_a9.__prev=_l1),_n77.__prev=null,_n77.__next=null,_n77.__parent=null,_r58.__size--;}}function Vo(e){Jr(),kn(e)&&t(323,e.__key,e.__type);var n=e.getLatest(),r=n.__parent,o=Yr(),i=jr(),s=o._nodeMap,l=i._dirtyElements;null!==r&&function(t,e,n){var r=t;for(;null!==r;){if(n.has(r))return;var _t165=e.get(r);if(void 0===_t165)break;n.set(r,!1),r=_t165.__parent;}}(r,s,l);var c=n.__key;i._dirtyType=1,co(e)?l.set(c,!0):i._dirtyLeaves.add(c);}function Go(t){Ur();var e=jr(),n=e._compositionKey;if(t!==n){if(e._compositionKey=t,null!==n){var _t166=Xo(n);null!==_t166&&_t166.getWritable();}if(null!==t){var _e105=Xo(t);null!==_e105&&_e105.getWritable();}}}function qo(){if($r())return null;return jr()._compositionKey;}function Xo(t,e){var n=(e||Yr())._nodeMap.get(t);return void 0===n?null:n;}function Qo(t,e){var n=Zo(t,jr());return void 0!==n?Xo(n,e):null;}function Zo(t,e){return t["__lexicalKey_"+e._key];}function ti(t,e){var n=t;for(;null!=n;){var _t167=Qo(n,e);if(null!==_t167)return _t167;n=Mi(n);}return null;}function ei(t){var e=t._decorators,n=Object.assign({},e);return t._pendingDecorators=n,n;}function ni(t){return t.read(function(){return ri().getTextContent();});}function ri(){return oi(Yr());}function oi(t){return t._nodeMap.get("root");}function ii(t){Ur();var e=Yr();null!==t&&(t.dirty=!0,t.setCachedNodes(null)),e._selection=t;}function si(t){var e=jr(),n=function(t,e){var n=t;for(;null!=n;){var _t168=Zo(n,e);if(void 0!==_t168)return _t168;n=Mi(n);}return null;}(t,e);if(null===n){return t===e.getRootElement()?Xo("root"):null;}return Xo(n);}function li(t){return /[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(t);}function ci(t){var e=[];var n=t;for(;null!==n;)e.push(n),n=n._parentEditor;return e;}function ai(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5);}function ui(t){return $o(t)?t.nodeValue:null;}function fi(t,e,n){var r=Ji(Li(e));if(null===r)return;var o=r.anchorNode;var i=r.anchorOffset,s=r.focusOffset;if(null!==o){var _e106=ui(o);var _r59=ti(o);if(null!==_e106&&Zn(_r59)){if(_e106===v&&n){var _t169=n.length;_e106=n,i=_t169,s=_t169;}null!==_e106&&di(_r59,_e106,i,s,t);}}}function di(t,e,n,r,o){var i=t;if(i.isAttached()&&(o||!i.isDirty())){var _s17=i.isComposing();var _a0=e;(_s17||o)&&e[e.length-1]===v&&(_a0=e.slice(0,-1));var _u9=i.getTextContent();if(o||_a0!==_u9){if(""===_a0){if(Go(null),l||c||d)i.remove();else{var _t170=jr();setTimeout(function(){_t170.update(function(){i.isAttached()&&i.remove();});},20);}return;}var _e107=i.getParent(),_o45=Er(),_u0=i.getTextContentSize(),_f9=qo(),_h5=i.getKey();if(i.isToken()||null!==_f9&&_h5===_f9&&!_s17||ar(_o45)&&(null!==_e107&&!_e107.canInsertTextBefore()&&0===_o45.anchor.offset||_o45.anchor.key===t.__key&&0===_o45.anchor.offset&&!i.canInsertTextBefore()&&!_s17||_o45.focus.key===t.__key&&_o45.focus.offset===_u0&&!i.canInsertTextAfter()&&!_s17))return void i.markDirty();var _g6=kr();if(!ar(_g6)||null===n||null===r)return void hi(i,_a0,_g6);if(_g6.setTextNodeRange(i,n,i,r),i.isSegmented()){var _t171=Qn(i.getTextContent());i.replace(_t171),i=_t171;}hi(i,_a0,_g6);}}}function hi(t,e,n){if(t.setTextContent(e),ar(n)){var _e108=t.getKey();for(var _r60 of["anchor","focus"]){var _o46=n[_r60];"text"===_o46.type&&_o46.key===_e108&&(_o46.offset=vs(t,_o46.offset,"clamp"));}}}function gi(t,e,n){var r=e[n]||!1;return"any"===r||r===t[n];}function _i(t,e){return gi(t,e,"altKey")&&gi(t,e,"ctrlKey")&&gi(t,e,"shiftKey")&&gi(t,e,"metaKey");}function pi(t,e,n){return _i(t,n)&&t.key.toLowerCase()===e.toLowerCase();}var yi={ctrlKey:!o,metaKey:o},mi={altKey:o,ctrlKey:!o};function xi(t){return"Backspace"===t.key;}function Ci(t){return pi(t,"a",yi);}function Si(t,e){void 0===t.__lexicalClassNameCache&&(t.__lexicalClassNameCache={});var n=t.__lexicalClassNameCache,r=n[e];if(void 0!==r)return r;var o=t[e];if("string"==typeof o){var _t172=h(o);return n[e]=_t172,_t172;}return o;}function Ni(e,n,r,o,i){if(0===r.size)return;var s=o.__type,l=o.__key,c=n.get(s);void 0===c&&t(33,s);var a=c.klass;var u=e.get(a);void 0===u&&(u=new Map(),e.set(a,u));var f=u.get(l),d="destroyed"===f&&"created"===i;(void 0===f||d)&&u.set(l,d?"updated":i);}function Ti(t,e,n){var r=t.getParent();var o=n,i=t;return null!==r&&(e&&0===n?(o=i.getIndexWithinParent(),i=r):e||n!==i.getChildrenSize()||(o=i.getIndexWithinParent()+1,i=r)),i.getChildAtIndex(e?o-1:o);}function vi(t,e){var n=t.offset;if("element"===t.type){return Ti(t.getNode(),e,n);}{var _r61=t.getNode();if(e&&0===n||!e&&n===_r61.getTextContentSize()){var _t173=e?_r61.getPreviousSibling():_r61.getNextSibling();return null===_t173?Ti(_r61.getParentOrThrow(),e,_r61.getIndexWithinParent()+(e?0:1)):_t173;}}return null;}function ki(t){var e=Li(t).event,n=e&&e.inputType;return"insertFromPaste"===n||"insertFromPasteAsQuotation"===n;}function Ei(t,e,n){return function(t,e,n){var r=ci(t);for(var _o47=4;_o47>=0;_o47--){var _loop2=function _loop2(){var s=r[_i24],l=s._commands.get(e);if(void 0!==l){var _e109=l[_o47];if(void 0!==_e109){var _r62=Array.from(_e109),_o48=_r62.length;var _i25=!1;if(oo(s,function(){for(var _e110=0;_e110<_o48;_e110++)if(_r62[_e110](n,t))return void(_i25=!0);}),_i25)return{v:_i25};}}},_ret;for(var _i24=0;_i24<r.length;_i24++){_ret=_loop2();if(_ret)return _ret.v;}}return!1;}(t,e,n);}function Oi(t){return!go(t)&&!t.isLastChild()&&!t.isInline();}function bi(e,n){var r=e._keyToDOMMap.get(n);return void 0===r&&t(75,n),r;}function Mi(t){var e=t.assignedSlot||t.parentElement;return Vi(e)?e.host:e;}function Ai(t){return Uo(t)?t:ji(t)?t.ownerDocument:null;}function wi(t){Ur();jr()._updateTags.add(t);}function Di(t){Ur();jr()._deferred.push(t);}function Pi(t,e){var n=t.getParent();for(;null!==n;){if(n.is(e))return!0;n=n.getParent();}return!1;}function Ii(t){var e=Ai(t);return e?e.defaultView:null;}function Li(e){var n=e._window;return null===n&&t(78),n;}function Fi(t){var e=t.getParentOrThrow();for(;null!==e;){if(Ri(e))return e;e=e.getParentOrThrow();}return e;}function Ri(t){return go(t)||co(t)&&t.isShadowRoot();}function Ki(t){var e=t.constructor.clone(t);return jo(e,null),e.afterCloneFrom(t),e;}function Bi(e){var n=jr(),r=e.getType(),o=Do(n,r);void 0===o&&t(200,e.constructor.name,r);var i=o.replace,s=o.replaceWithKlass;if(null!==i){var _n78=i(e),_o49=_n78.constructor;return null!==s?_n78 instanceof s||t(201,s.name,s.getType(),_o49.name,_o49.getType(),e.constructor.name,r):_n78 instanceof e.constructor&&_o49!==e.constructor||t(202,_o49.name,_o49.getType(),e.constructor.name,r),_n78.__key===e.__key&&t(203,e.constructor.name,r,_o49.name,_o49.getType()),_n78;}return e;}function zi(e,n){!go(e.getParent())||co(n)||fo(n)||t(99);}function Wi(e){var n=Xo(e);return null===n&&t(63,e),n;}function $i(t){return(fo(t)||co(t)&&!t.canBeEmpty())&&!t.isInline();}function Ui(t,e,n){n.style.removeProperty("caret-color"),e._blockCursorElement=null;var r=t.parentElement;null!==r&&r.removeChild(t);}function Ji(t){return n?(t||window).getSelection():null;}function Yi(t){var e=Ii(t);return e?e.getSelection():null;}function ji(t){return Hi(t)&&1===t.nodeType;}function Hi(t){return"object"==typeof t&&null!==t&&"nodeType"in t&&"number"==typeof t.nodeType;}function Vi(t){return Hi(t)&&11===t.nodeType;}function Gi(t){var e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return null!==t.nodeName.match(e);}function qi(t){var e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return null!==t.nodeName.match(e);}function Xi(t){if(fo(t)&&!t.isInline())return!0;if(!co(t)||Ri(t))return!1;var e=t.getFirstChild(),n=null===e||Ln(e)||Zn(e)||e.isInline();return!t.isInline()&&!1!==t.canBeEmpty()&&n;}function Qi(){return jr();}var Zi=new WeakMap(),ts=new Map();function es(e){if(!e._readOnly&&e.isEmpty())return ts;e._readOnly||t(192);var n=Zi.get(e);return n||(n=function(t){var e=new Map();for(var _ref22 of t._nodeMap){var _n79=_ref22[0];var _r63=_ref22[1];{var _t174=_r63.__type;var _o50=e.get(_t174);_o50||(_o50=new Map(),e.set(_t174,_o50)),_o50.set(_n79,_r63);}}return e;}(e),Zi.set(e,n)),n;}function ns(t){var e=t.constructor.clone(t);return e.afterCloneFrom(t),e;}function rs(t,e){var n=parseInt(t.style.paddingInlineStart,10)||0,r=Math.round(n/40);e.setIndent(r);}function os(t){return!0===t.__lexicalUnmanaged;}function is(t,e){return function(t,e){return Object.prototype.hasOwnProperty.call(t,e);}(t,e)&&t[e]!==_En5[e];}function ss(e){var n=R in e.prototype?e.prototype[R]():void 0,r=function(e){if(!(e===_En5||e.prototype instanceof _En5)){var _n80="<unknown>",_r64="<unknown>";try{_n80=e.getType();}catch(t){}try{_Oo.version&&(_r64=JSON.parse(_Oo.version));}catch(t){}t(290,e.name,_n80,_r64);}return e===_uo||e===_lo4||e===_En5;}(e),o=!r&&is(e,"getType")?e.getType():void 0;var i,s=o;if(n)if(o)i=n[o];else for(var _ref24 of Object.entries(n)){var _t175=_ref24[0];var _e111=_ref24[1];s=_t175,i=_e111;}if(!r&&s&&(is(e,"getType")||(e.getType=function(){return s;}),is(e,"clone")||(e.clone=function(t){return Mo(t),new e();}),is(e,"importJSON")||(e.importJSON=i&&i.$importJSON||function(t){return new e().updateFromJSON(t);}),!is(e,"importDOM")&&i)){var _i26=i,_t176=_i26.importDOM;_t176&&(e.importDOM=function(){return _t176;});}return{ownNodeConfig:i,ownNodeType:s};}var ls=function ls(t,e){var n=t;for(;null!=n&&!go(n);){if(e(n))return n;n=n.getParent();}return null;},cs={next:"previous",previous:"next"};var _as4=function(){function as(t){this.origin=t;}var _proto15=as.prototype;_proto15[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=function(){return Is({hasNext:ys,initial:this.getAdjacentCaret(),map:function map(t){return t;},step:function step(t){return t.getAdjacentCaret();}});};_proto15.getAdjacentCaret=function getAdjacentCaret(){return Ns(this.getNodeAtCaret(),this.direction);};_proto15.getSiblingCaret=function getSiblingCaret(){return Ns(this.origin,this.direction);};_proto15.remove=function remove(){var t=this.getNodeAtCaret();return t&&t.remove(),this;};_proto15.replaceOrInsert=function replaceOrInsert(t,e){var n=this.getNodeAtCaret();return t.is(this.origin)||t.is(n)||(null===n?this.insert(t):n.replace(t,e)),this;};_proto15.splice=function splice(e,n,r){if(r===void 0){r="next";}var o=r===this.direction?n:Array.from(n).reverse();var i=this;var s=this.getParentAtCaret(),l=new Map();for(var _t177=i.getAdjacentCaret();null!==_t177&&l.size<e;_t177=_t177.getAdjacentCaret()){var _e112=_t177.origin.getWritable();l.set(_e112.getKey(),_e112);}for(var _e113 of o){if(l.size>0){var _n81=i.getNodeAtCaret();if(_n81){if(l["delete"](_n81.getKey()),l["delete"](_e113.getKey()),_n81.is(_e113)||i.origin.is(_e113));else{var _t178=_e113.getParent();_t178&&_t178.is(s)&&_e113.remove(),_n81.replace(_e113);}}else null===_n81&&t(263,Array.from(l).join(" "));}else i.insert(_e113);i=Ns(_e113,this.direction);}for(var _t179 of l.values())_t179.remove();return this;};return as;}();var _us3=function(_as){function us(){var _this5;for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7];}return(_this5=_as.call.apply(_as,[this].concat(args))||this,_this5.type="child",babelHelpers.assertThisInitialized(_this5))||babelHelpers.assertThisInitialized(_this5);}babelHelpers.inheritsLoose(us,_as);var _proto16=us.prototype;_proto16.getLatest=function getLatest(){var t=this.origin.getLatest();return t===this.origin?this:Es(t,this.direction);};_proto16.getParentCaret=function getParentCaret(t){if(t===void 0){t="root";}return Ns(hs(this.getParentAtCaret(),t),this.direction);};_proto16.getFlipped=function getFlipped(){var t=ds(this.direction);return Ns(this.getNodeAtCaret(),t)||Es(this.origin,t);};_proto16.getParentAtCaret=function getParentAtCaret(){return this.origin;};_proto16.getChildCaret=function getChildCaret(){return this;};_proto16.isSameNodeCaret=function isSameNodeCaret(t){return t instanceof us&&this.direction===t.direction&&this.origin.is(t.origin);};_proto16.isSamePointCaret=function isSamePointCaret(t){return this.isSameNodeCaret(t);};return us;}(_as4);var fs={root:go,shadowRoot:Ri};function ds(t){return cs[t];}function hs(t,e){if(e===void 0){e="root";}return fs[e](t)?null:t;}var _gs3=function(_as2){function gs(){var _this6;for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}return(_this6=_as2.call.apply(_as2,[this].concat(args))||this,_this6.type="sibling",babelHelpers.assertThisInitialized(_this6))||babelHelpers.assertThisInitialized(_this6);}babelHelpers.inheritsLoose(gs,_as2);var _proto17=gs.prototype;_proto17.getLatest=function getLatest(){var t=this.origin.getLatest();return t===this.origin?this:Ns(t,this.direction);};_proto17.getSiblingCaret=function getSiblingCaret(){return this;};_proto17.getParentAtCaret=function getParentAtCaret(){return this.origin.getParent();};_proto17.getChildCaret=function getChildCaret(){return co(this.origin)?Es(this.origin,this.direction):null;};_proto17.getParentCaret=function getParentCaret(t){if(t===void 0){t="root";}return Ns(hs(this.getParentAtCaret(),t),this.direction);};_proto17.getFlipped=function getFlipped(){var t=ds(this.direction);return Ns(this.getNodeAtCaret(),t)||Es(this.origin.getParentOrThrow(),t);};_proto17.isSamePointCaret=function isSamePointCaret(t){return t instanceof gs&&this.direction===t.direction&&this.origin.is(t.origin);};_proto17.isSameNodeCaret=function isSameNodeCaret(t){return(t instanceof gs||t instanceof _s20)&&this.direction===t.direction&&this.origin.is(t.origin);};return gs;}(_as4);var _s20=function(_as3){function _s(t,e){var _this7;_this7=_as3.call(this,t)||this,_this7.type="text",_this7.offset=e;return _this7;}babelHelpers.inheritsLoose(_s,_as3);var _proto18=_s.prototype;_proto18.getLatest=function getLatest(){var t=this.origin.getLatest();return t===this.origin?this:Ts(t,this.direction,this.offset);};_proto18.getParentAtCaret=function getParentAtCaret(){return this.origin.getParent();};_proto18.getChildCaret=function getChildCaret(){return null;};_proto18.getParentCaret=function getParentCaret(t){if(t===void 0){t="root";}return Ns(hs(this.getParentAtCaret(),t),this.direction);};_proto18.getFlipped=function getFlipped(){return Ts(this.origin,ds(this.direction),this.offset);};_proto18.isSamePointCaret=function isSamePointCaret(t){return t instanceof _s&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset;};_proto18.isSameNodeCaret=function isSameNodeCaret(t){return(t instanceof _gs3||t instanceof _s)&&this.direction===t.direction&&this.origin.is(t.origin);};_proto18.getSiblingCaret=function getSiblingCaret(){return Ns(this.origin,this.direction);};return _s;}(_as4);function ps(t){return t instanceof _s20;}function ys(t){return t instanceof _gs3;}function ms(t){return t instanceof _us3;}var xs={next:function(_s2){function _class(){var _this8;for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++){args[_key9]=arguments[_key9];}return(_this8=_s2.call.apply(_s2,[this].concat(args))||this,_this8.direction="next",babelHelpers.assertThisInitialized(_this8))||babelHelpers.assertThisInitialized(_this8);}babelHelpers.inheritsLoose(_class,_s2);var _proto19=_class.prototype;_proto19.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getNextSibling();};_proto19.insert=function insert(t){return this.origin.insertAfter(t),this;};return _class;}(_s20),previous:function(_s3){function _class3(){var _this9;for(var _len0=arguments.length,args=new Array(_len0),_key0=0;_key0<_len0;_key0++){args[_key0]=arguments[_key0];}return(_this9=_s3.call.apply(_s3,[this].concat(args))||this,_this9.direction="previous",babelHelpers.assertThisInitialized(_this9))||babelHelpers.assertThisInitialized(_this9);}babelHelpers.inheritsLoose(_class3,_s3);var _proto20=_class3.prototype;_proto20.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getPreviousSibling();};_proto20.insert=function insert(t){return this.origin.insertBefore(t),this;};return _class3;}(_s20)},Cs={next:function(_gs){function _class5(){var _this0;for(var _len1=arguments.length,args=new Array(_len1),_key1=0;_key1<_len1;_key1++){args[_key1]=arguments[_key1];}return(_this0=_gs.call.apply(_gs,[this].concat(args))||this,_this0.direction="next",babelHelpers.assertThisInitialized(_this0))||babelHelpers.assertThisInitialized(_this0);}babelHelpers.inheritsLoose(_class5,_gs);var _proto21=_class5.prototype;_proto21.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getNextSibling();};_proto21.insert=function insert(t){return this.origin.insertAfter(t),this;};return _class5;}(_gs3),previous:function(_gs2){function _class7(){var _this1;for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++){args[_key10]=arguments[_key10];}return(_this1=_gs2.call.apply(_gs2,[this].concat(args))||this,_this1.direction="previous",babelHelpers.assertThisInitialized(_this1))||babelHelpers.assertThisInitialized(_this1);}babelHelpers.inheritsLoose(_class7,_gs2);var _proto22=_class7.prototype;_proto22.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getPreviousSibling();};_proto22.insert=function insert(t){return this.origin.insertBefore(t),this;};return _class7;}(_gs3)},Ss={next:function(_us){function _class9(){var _this10;for(var _len11=arguments.length,args=new Array(_len11),_key11=0;_key11<_len11;_key11++){args[_key11]=arguments[_key11];}return(_this10=_us.call.apply(_us,[this].concat(args))||this,_this10.direction="next",babelHelpers.assertThisInitialized(_this10))||babelHelpers.assertThisInitialized(_this10);}babelHelpers.inheritsLoose(_class9,_us);var _proto23=_class9.prototype;_proto23.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getFirstChild();};_proto23.insert=function insert(t){return this.origin.splice(0,0,[t]),this;};return _class9;}(_us3),previous:function(_us2){function _class1(){var _this11;for(var _len12=arguments.length,args=new Array(_len12),_key12=0;_key12<_len12;_key12++){args[_key12]=arguments[_key12];}return(_this11=_us2.call.apply(_us2,[this].concat(args))||this,_this11.direction="previous",babelHelpers.assertThisInitialized(_this11))||babelHelpers.assertThisInitialized(_this11);}babelHelpers.inheritsLoose(_class1,_us2);var _proto24=_class1.prototype;_proto24.getNodeAtCaret=function getNodeAtCaret(){return this.origin.getLastChild();};_proto24.insert=function insert(t){return this.origin.splice(this.origin.getChildrenSize(),0,[t]),this;};return _class1;}(_us3)};function Ns(t,e){return t?new Cs[e](t):null;}function Ts(t,e,n){return t?new xs[e](t,vs(t,n)):null;}function vs(t,n,r){if(r===void 0){r="error";}var o=t.getTextContentSize();var i="next"===n?o:"previous"===n?0:n;return(i<0||i>o)&&("clamp"!==r&&e(284,String(n),String(o),t.getKey()),i=i<0?0:o),i;}function ks(t,e){return new _As(t,e);}function Es(t,e){return co(t)?new Ss[e](t):null;}function Os(t){return t&&t.getChildCaret()||t;}function bs(t){return t&&Os(t.getAdjacentCaret());}var _Ms=function(){function Ms(t,e,n){this.type="node-caret-range";this.anchor=t,this.focus=e,this.direction=n;}var _proto25=Ms.prototype;_proto25.getLatest=function getLatest(){var t=this.anchor.getLatest(),e=this.focus.getLatest();return t===this.anchor&&e===this.focus?this:new Ms(t,e,this.direction);};_proto25.isCollapsed=function isCollapsed(){return this.anchor.isSamePointCaret(this.focus);};_proto25.getTextSlices=function getTextSlices(){var _this14=this;var t=function t(_t180){var e=_this14[_t180].getLatest();return ps(e)?function(t,e){var n=t.direction,r=t.origin,o=vs(r,"focus"===e?ds(n):n);return ks(t,o-t.offset);}(e,_t180):null;},e=t("anchor"),n=t("focus");if(e&&n){var _t181=e.caret,_r65=n.caret;if(_t181.isSameNodeCaret(_r65))return[ks(_t181,_r65.offset-_t181.offset),null];}return[e,n];};_proto25.iterNodeCarets=function iterNodeCarets(t){if(t===void 0){t="root";}var e=ps(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),n=this.focus.getLatest(),r=ps(n),o=function o(e){return e.isSameNodeCaret(n)?null:bs(e)||e.getParentCaret(t);};return Is({hasNext:function hasNext(t){return null!==t&&!(r&&n.isSameNodeCaret(t));},initial:e.isSameNodeCaret(n)?null:o(e),map:function map(t){return t;},step:o});};_proto25[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=function(){return this.iterNodeCarets("root");};return Ms;}();var _As=function(){function As(t,e){this.type="slice";this.caret=t,this.distance=e;}var _proto26=As.prototype;_proto26.getSliceIndices=function getSliceIndices(){var t=this.distance,e=this.caret.offset,n=e+t;return n<e?[n,e]:[e,n];};_proto26.getTextContent=function getTextContent(){var _this$getSliceIndices=this.getSliceIndices(),t=_this$getSliceIndices[0],e=_this$getSliceIndices[1];return this.caret.origin.getTextContent().slice(t,e);};_proto26.getTextContentSize=function getTextContentSize(){return Math.abs(this.distance);};_proto26.removeTextSlice=function removeTextSlice(){var _this$caret=this.caret,t=_this$caret.origin,e=_this$caret.direction,_this$getSliceIndices2=this.getSliceIndices(),n=_this$getSliceIndices2[0],r=_this$getSliceIndices2[1],o=t.getTextContent();return Ts(t.setTextContent(o.slice(0,n)+o.slice(r)),e,n);};return As;}();function ws(t){return Ps(t,Ns(ri(),t.direction));}function Ds(t){return Ps(t,t);}function Ps(e,n){return e.direction!==n.direction&&t(265),new _Ms(e,n,e.direction);}function Is(t){var _ref25;var e=t.initial,n=t.hasNext,r=t.step,o=t.map;var i=e;return _ref25={},_ref25[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=function(){return this;},_ref25.next=function next(){if(!n(i))return{done:!0,value:void 0};var t={done:!1,value:o(i)};return i=r(i),t;},_ref25;}function Ls(e,n){var r=Bs(e.origin,n.origin);switch(null===r&&t(275,e.origin.getKey(),n.origin.getKey()),r.type){case"same":{var _t182="text"===e.type,_r66="text"===n.type;return _t182&&_r66?function(t,e){return Math.sign(t-e);}(e.offset,n.offset):e.type===n.type?0:_t182?-1:_r66?1:"child"===e.type?-1:1;}case"ancestor":return"child"===e.type?-1:1;case"descendant":return"child"===n.type?1:-1;case"branch":return Fs(r);}}function Fs(t){var e=t.a,n=t.b,r=e.__key,o=n.__key;var i=e,s=n;for(;i&&s;i=i.getNextSibling(),s=s.getNextSibling()){if(i.__key===o)return-1;if(s.__key===r)return 1;}return null===i?1:-1;}function Rs(t,e){return e.is(t);}function Ks(t){return co(t)?[t.getLatest(),null]:[t.getParent(),t.getLatest()];}function Bs(e,n){if(e.is(n))return{commonAncestor:e,type:"same"};var r=new Map();for(var _Ks=Ks(e),_t183=_Ks[0],_n82=_Ks[1];_t183;_n82=_t183,_t183=_t183.getParent())r.set(_t183,_n82);for(var _Ks2=Ks(n),_o51=_Ks2[0],_i27=_Ks2[1];_o51;_i27=_o51,_o51=_o51.getParent()){var _s18=r.get(_o51);if(void 0!==_s18)return null===_s18?(Rs(e,_o51)||t(276),{commonAncestor:_o51,type:"ancestor"}):null===_i27?(Rs(n,_o51)||t(277),{commonAncestor:_o51,type:"descendant"}):((co(_s18)||Rs(e,_s18))&&(co(_i27)||Rs(n,_i27))&&_o51.is(_s18.getParent())&&_o51.is(_i27.getParent())||t(278),{a:_s18,b:_i27,commonAncestor:_o51,type:"branch"});}return null;}function zs(e,n){var r=e.type,o=e.key,i=e.offset,s=Wi(e.key);return"text"===r?(Zn(s)||t(266,s.getType(),o),Ts(s,n,i)):(co(s)||t(267,s.getType(),o),Zs(s,e.offset,n));}function Ws(e,n){var r=n.origin,o=n.direction,i="next"===o;ps(n)?e.set(r.getKey(),n.offset,"text"):ys(n)?Zn(r)?e.set(r.getKey(),vs(r,o),"text"):e.set(r.getParentOrThrow().getKey(),r.getIndexWithinParent()+(i?1:0),"element"):(ms(n)&&co(r)||t(268),e.set(r.getKey(),i?0:r.getChildrenSize(),"element"));}function $s(t){var e=kr(),n=ar(e)?e:Nr();return Us(n,t),ii(n),n;}function Us(t,e){Ws(t.anchor,e.anchor),Ws(t.focus,e.focus);}function Js(t){var e=t.anchor,n=t.focus,r=zs(e,"next"),o=zs(n,"next"),i=Ls(r,o)<=0?"next":"previous";return Ps(Xs(r,i),Xs(o,i));}function Ys(t){var e=t.direction,n=t.origin,r=Ns(n,ds(e)).getNodeAtCaret();return r?Ns(r,e):Es(n.getParentOrThrow(),e);}function js(t,e){if(e===void 0){e="root";}var n=[t];for(var _r67=ms(t)?t.getParentCaret(e):t.getSiblingCaret();null!==_r67;_r67=_r67.getParentCaret(e))n.push(Ys(_r67));return n;}function Hs(t){return!!t&&t.origin.isAttached();}function Vs(e,n){if(n===void 0){n="removeEmptySlices";}if(e.isCollapsed())return e;var r="root",o="next";var i=n;var s=Qs(e,o),l=js(s.anchor,r),c=js(s.focus.getFlipped(),r),a=new Set(),u=[];for(var _t184 of s.iterNodeCarets(r))if(ms(_t184))a.add(_t184.origin.getKey());else if(ys(_t184)){var _e114=_t184.origin;co(_e114)&&!a.has(_e114.getKey())||u.push(_e114);}for(var _t185 of u)_t185.remove();for(var _t186 of s.getTextSlices()){if(!_t186)continue;var _e115=_t186.caret.origin,_n83=_e115.getTextContentSize(),_r68=Ys(Ns(_e115,o)),_s19=_e115.getMode();if(Math.abs(_t186.distance)===_n83&&"removeEmptySlices"===i||"token"===_s19&&0!==_t186.distance)_r68.remove();else if(0!==_t186.distance){i="removeEmptySlices";var _e116=_t186.removeTextSlice();var _n84=_t186.caret.origin;if("segmented"===_s19){var _t187=_e116.origin,_n85=Qn(_t187.getTextContent()).setStyle(_t187.getStyle()).setFormat(_t187.getFormat());_r68.replaceOrInsert(_n85),_e116=Ts(_n85,o,_e116.offset);}_n84.is(l[0].origin)&&(l[0]=_e116),_n84.is(c[0].origin)&&(c[0]=_e116.getFlipped());}}var f,d;for(var _t188 of l)if(Hs(_t188)){f=Gs(_t188);break;}for(var _t189 of c)if(Hs(_t189)){d=Gs(_t189);break;}var h=function(t,e,n){if(!t||!e)return null;var r=t.getParentAtCaret(),o=e.getParentAtCaret();if(!r||!o)return null;var i=r.getParents().reverse();i.push(r);var s=o.getParents().reverse();s.push(o);var l=Math.min(i.length,s.length);var c;for(c=0;c<l&&i[c]===s[c];c++);var a=function a(t,e){var n;for(var _r69=c;_r69<t.length;_r69++){var _o52=t[_r69];if(Ri(_o52))return;!n&&e(_o52)&&(n=_o52);}return n;},u=a(i,Xi),f=u&&a(s,function(t){return n.has(t.getKey())&&Xi(t);});return u&&f?[u,f]:null;}(f,d,a);if(h){var _t190=h[0],_e117=h[1];Es(_t190,"previous").splice(0,_e117.getChildren()),_e117.remove();}var g=[f,d].concat(l,c).find(Hs);if(g){return Ds(Xs(Gs(g),e.direction));}t(269,JSON.stringify(l.map(function(t){return t.origin.__key;})));}function Gs(t){var e=function(t){var e=t;for(;ms(e);){var _t191=bs(e);if(!ms(_t191))break;e=_t191;}return e;}(t.getLatest()),n=e.direction;if(Zn(e.origin))return ps(e)?e:Ts(e.origin,n,n);var r=e.getAdjacentCaret();return ys(r)&&Zn(r.origin)?Ts(r.origin,n,ds(n)):e;}function qs(t){return ps(t)&&t.offset!==vs(t.origin,t.direction);}function Xs(t,e){return t.direction===e?t:t.getFlipped();}function Qs(t,e){return t.direction===e?t:Ps(Xs(t.focus,e),Xs(t.anchor,e));}function Zs(t,e,n){var r=Es(t,"next");for(var _t192=0;_t192<e;_t192++){var _t193=r.getAdjacentCaret();if(null===_t193)break;r=_t193;}return Xs(r,n);}function tl(e){var n=e.origin,r=e.offset,o=e.direction;if(r===vs(n,o))return e.getSiblingCaret();if(r===vs(n,ds(o)))return Ys(e.getSiblingCaret());var _n$splitText2=n.splitText(r),i=_n$splitText2[0];return Zn(i)||t(281),Xs(Ns(i,"next"),o);}function el(t,e){return!0;}exports.$addUpdateTag=wi,exports.$applyNodeReplacement=Bi,exports.$caretFromPoint=zs,exports.$caretRangeFromSelection=Js,exports.$cloneWithProperties=ns,exports.$cloneWithPropertiesEphemeral=function(t){return(e=ns(t))[vn]=!0,e;var e;},exports.$comparePointCaretNext=Ls,exports.$copyNode=Ki,exports.$create=function(t){var e=Qi();return Ur(),new(e.resolveRegisteredNodeAfterReplacements(e.getRegisteredNode(t)).klass)();},exports.$createLineBreakNode=In,exports.$createNodeSelection=Tr,exports.$createParagraphNode=No,exports.$createPoint=ir,exports.$createRangeSelection=Nr,exports.$createRangeSelectionFromDom=function(t,e){return vr(null,t,e,null);},exports.$createTabNode=nr,exports.$createTextNode=Qn,exports.$extendCaretToRange=ws,exports.$findMatchingParent=ls,exports.$getAdjacentChildCaret=bs,exports.$getAdjacentNode=vi,exports.$getAdjacentSiblingOrParentSiblingCaret=function(t,e){if(e===void 0){e="root";}var n=0,r=t,o=bs(r);for(;null===o;){if(n--,o=r.getParentCaret(e),!o)return null;r=o,o=bs(r);}return o&&[o,n];},exports.$getCaretInDirection=Xs,exports.$getCaretRange=Ps,exports.$getCaretRangeInDirection=Qs,exports.$getCharacterOffsets=hr,exports.$getChildCaret=Es,exports.$getChildCaretAtIndex=Zs,exports.$getChildCaretOrSelf=Os,exports.$getCollapsedCaretRange=Ds,exports.$getCommonAncestor=Bs,exports.$getCommonAncestorResultBranchOrder=Fs,exports.$getEditor=Qi,exports.$getNearestNodeFromDOMNode=ti,exports.$getNearestRootOrShadowRoot=Fi,exports.$getNodeByKey=Xo,exports.$getNodeByKeyOrThrow=Wi,exports.$getNodeFromDOMNode=Qo,exports.$getPreviousSelection=Er,exports.$getRoot=ri,exports.$getSelection=kr,exports.$getSiblingCaret=Ns,exports.$getState=q,exports.$getStateChange=function(t,e,n){var r=q(t,n,"direct"),o=q(e,n,"direct");return n.isEqual(r,o)?null:[r,o];},exports.$getTextContent=function(){var t=kr();return null===t?"":t.getTextContent();},exports.$getTextNodeOffset=vs,exports.$getTextPointCaret=Ts,exports.$getTextPointCaretSlice=ks,exports.$getWritableNodeState=Z,exports.$hasAncestor=Pi,exports.$hasUpdateTag=function(t){return jr()._updateTags.has(t);},exports.$insertNodes=function(t){var e=kr()||Er();null===e&&(e=ri().selectEnd()),e.insertNodes(t);},exports.$isBlockElementNode=function(t){return co(t)&&!t.isInline();},exports.$isChildCaret=ms,exports.$isDecoratorNode=fo,exports.$isEditorState=function(t){return t instanceof _mo;},exports.$isElementNode=co,exports.$isExtendableTextPointCaret=qs,exports.$isInlineElementOrDecoratorNode=function(t){return co(t)&&t.isInline()||fo(t)&&t.isInline();},exports.$isLeafNode=function(t){return Zn(t)||Ln(t)||fo(t);},exports.$isLineBreakNode=Ln,exports.$isNodeCaret=function(t){return t instanceof _as4;},exports.$isNodeSelection=fr,exports.$isParagraphNode=To,exports.$isRangeSelection=ar,exports.$isRootNode=go,exports.$isRootOrShadowRoot=Ri,exports.$isSiblingCaret=ys,exports.$isTabNode=rr,exports.$isTextNode=Zn,exports.$isTextPointCaret=ps,exports.$isTextPointCaretSlice=function(t){return t instanceof _As;},exports.$isTokenOrSegmented=Wo,exports.$isTokenOrTab=zo,exports.$nodesOfType=function(t){var e=t.getType(),n=Yr();if(n._readOnly){var _t194=es(n).get(e);return _t194?Array.from(_t194.values()):[];}var r=n._nodeMap,o=[];for(var _ref27 of r){var _n86=_ref27[1];_n86 instanceof t&&_n86.__type===e&&_n86.isAttached()&&o.push(_n86);}return o;},exports.$normalizeCaret=Gs,exports.$normalizeSelection__EXPERIMENTAL=at,exports.$onUpdate=Di,exports.$parseSerializedNode=function(t){return Qr(t,jr()._nodes);},exports.$removeTextFromCaretRange=Vs,exports.$rewindSiblingCaret=Ys,exports.$selectAll=function(t){var e=ri();if(ar(t)){var _e118=t.anchor,_n87=t.focus,_r70=_e118.getNode().getTopLevelElementOrThrow().getParentOrThrow();return _e118.set(_r70.getKey(),0,"element"),_n87.set(_r70.getKey(),_r70.getChildrenSize(),"element"),at(t),t;}{var _t195=e.select(0,e.getChildrenSize());return ii(at(_t195)),_t195;}},exports.$setCompositionKey=Go,exports.$setPointFromCaret=Ws,exports.$setSelection=ii,exports.$setSelectionFromCaretRange=$s,exports.$setState=function(t,e,n){var r;if(Ur(),"function"==typeof n){var _o53=t.getLatest(),_i28=q(_o53,e);if(r=n(_i28),e.isEqual(_i28,r))return _o53;}else r=n;var o=t.getWritable();return Z(o).updateFromKnown(e,r),o;},exports.$splitAtPointCaretNext=function(t,_temp){var _ref28=_temp===void 0?{}:_temp,_ref28$$copyElementNo=_ref28.$copyElementNode,e=_ref28$$copyElementNo===void 0?Ki:_ref28$$copyElementNo,_ref28$$splitTextPoin=_ref28.$splitTextPointCaretNext,n=_ref28$$splitTextPoin===void 0?tl:_ref28$$splitTextPoin,_ref28$rootMode=_ref28.rootMode,r=_ref28$rootMode===void 0?"shadowRoot":_ref28$rootMode,_ref28$$shouldSplit=_ref28.$shouldSplit,o=_ref28$$shouldSplit===void 0?el:_ref28$$shouldSplit;if(ps(t))return n(t);var i=t.getParentCaret(r);if(i){var _n88=i.origin;if(ms(t)&&(!_n88.canBeEmpty()||!o(_n88,"first")))return Ys(i);var _r71=function(t){var e=[];for(var _n89=t.getAdjacentCaret();_n89;_n89=_n89.getAdjacentCaret())e.push(_n89.origin);return e;}(t);(_r71.length>0||_n88.canBeEmpty()&&o(_n88,"last"))&&i.insert(e(_n88).splice(0,0,_r71));}return i;},exports.$splitNode=function(e,n){var r=e.getChildAtIndex(n);null==r&&(r=e),Ri(e)&&t(102);var _o56=function o(e){var n=e.getParentOrThrow(),i=Ri(n),s=e!==r||i?Ki(e):e;if(i)return co(e)&&co(s)||t(133),e.insertAfter(s),[e,s,s];{var _o55=_o56(n),_t196=_o55[0],_r72=_o55[1],_i29=_o55[2],_l10=e.getNextSiblings();return _i29.append.apply(_i29,[s].concat(_l10)),[_t196,_r72,s];}},_o54=_o56(r),i=_o54[0],s=_o54[1];return[i,s];},exports.$updateRangeSelectionFromCaretRange=Us,exports.ArtificialNode__DO_NOT_USE=_xo,exports.BEFORE_INPUT_COMMAND=Gt,exports.BLUR_COMMAND=Be,exports.CAN_REDO_COMMAND=Fe,exports.CAN_UNDO_COMMAND=Re,exports.CLEAR_EDITOR_COMMAND=Ie,exports.CLEAR_HISTORY_COMMAND=Le,exports.CLICK_COMMAND=Vt,exports.COLLABORATION_TAG=bn,exports.COMMAND_PRIORITY_CRITICAL=4,exports.COMMAND_PRIORITY_EDITOR=vo,exports.COMMAND_PRIORITY_HIGH=3,exports.COMMAND_PRIORITY_LOW=1,exports.COMMAND_PRIORITY_NORMAL=2,exports.COMPOSITION_END_COMMAND=Qt,exports.COMPOSITION_START_COMMAND=Xt,exports.CONTROLLED_TEXT_INSERTION_COMMAND=ne,exports.COPY_COMMAND=we,exports.CUT_COMMAND=De,exports.DELETE_CHARACTER_COMMAND=Zt,exports.DELETE_LINE_COMMAND=se,exports.DELETE_WORD_COMMAND=ie,exports.DRAGEND_COMMAND=Ae,exports.DRAGOVER_COMMAND=Me,exports.DRAGSTART_COMMAND=be,exports.DROP_COMMAND=Ee,exports.DecoratorNode=_uo,exports.ElementNode=_lo4,exports.FOCUS_COMMAND=Ke,exports.FORMAT_ELEMENT_COMMAND=Oe,exports.FORMAT_TEXT_COMMAND=le,exports.HISTORIC_TAG="historic",exports.HISTORY_MERGE_TAG=On,exports.HISTORY_PUSH_TAG="history-push",exports.INDENT_CONTENT_COMMAND=ve,exports.INPUT_COMMAND=qt,exports.INSERT_LINE_BREAK_COMMAND=te,exports.INSERT_PARAGRAPH_COMMAND=ee,exports.INSERT_TAB_COMMAND=Te,exports.INTERNAL_$isBlock=Xi,exports.IS_ALL_FORMATTING=2047,exports.IS_BOLD=1,exports.IS_CODE=16,exports.IS_HIGHLIGHT=y,exports.IS_ITALIC=2,exports.IS_STRIKETHROUGH=4,exports.IS_SUBSCRIPT=32,exports.IS_SUPERSCRIPT=64,exports.IS_UNDERLINE=8,exports.KEY_ARROW_DOWN_COMMAND=pe,exports.KEY_ARROW_LEFT_COMMAND=he,exports.KEY_ARROW_RIGHT_COMMAND=fe,exports.KEY_ARROW_UP_COMMAND=_e,exports.KEY_BACKSPACE_COMMAND=xe,exports.KEY_DELETE_COMMAND=Se,exports.KEY_DOWN_COMMAND=ue,exports.KEY_ENTER_COMMAND=ye,exports.KEY_ESCAPE_COMMAND=Ce,exports.KEY_MODIFIER_COMMAND=ze,exports.KEY_SPACE_COMMAND=me,exports.KEY_TAB_COMMAND=Ne,exports.LineBreakNode=_Dn,exports.MOVE_TO_END=de,exports.MOVE_TO_START=ge,exports.NODE_STATE_KEY="$",exports.OUTDENT_CONTENT_COMMAND=ke,exports.PASTE_COMMAND=re,exports.PASTE_TAG="paste",exports.ParagraphNode=_Co,exports.REDO_COMMAND=ae,exports.REMOVE_TEXT_COMMAND=oe,exports.RootNode=_ho,exports.SELECTION_CHANGE_COMMAND=jt,exports.SELECTION_INSERT_CLIPBOARD_NODES_COMMAND=Ht,exports.SELECT_ALL_COMMAND=Pe,exports.SKIP_COLLAB_TAG="skip-collab",exports.SKIP_DOM_SELECTION_TAG=An,exports.SKIP_SCROLL_INTO_VIEW_TAG=Mn,exports.SKIP_SELECTION_FOCUS_TAG=wn,exports.TEXT_TYPE_TO_FORMAT=w,exports.TabNode=_er,exports.TextNode=_Un2,exports.UNDO_COMMAND=ce,exports.buildImportMap=function(t){return t;},exports.configExtension=function(){for(var _len13=arguments.length,t=new Array(_len13),_key13=0;_key13<_len13;_key13++){t[_key13]=arguments[_key13];}return t;},exports.createCommand=Yt,exports.createEditor=function(t){var e=t||{},n=Vr(),r=e.theme||{},o=void 0===t?n:e.parentEditor||null,i=e.disableEvents||!1,s=po(),l=e.namespace||(null!==o?o._config.namespace:ai()),c=e.editorState,a=[_ho,_Un2,_Dn,_er,_Co,_xo].concat(e.nodes||[]),u=e.onError,f=e.html,d=void 0===e.editable||e.editable;var h;if(void 0===t&&null!==n)h=n._nodes;else{h=new Map();for(var _t197=0;_t197<a.length;_t197++){var _e119=a[_t197],_n90=null,_r73=null;if("function"!=typeof _e119){var _t198=_e119;_e119=_t198.replace,_n90=_t198["with"],_r73=_t198.withKlass||null;}ss(_e119);var _o57=_e119.getType(),_i30=Eo(_e119);h.set(_o57,{exportDOM:f&&f["export"]?f["export"].get(_e119):void 0,klass:_e119,replace:_n90,replaceWithKlass:_r73,sharedNodeState:X(a[_t197]),transforms:_i30});}}var g=new _Oo(s,o,h,{disableEvents:i,namespace:l,theme:r},u||console.error,function(t,e){var n=new Map(),r=new Set(),o=function o(t){Object.keys(t).forEach(function(e){var r=n.get(e);void 0===r&&(r=[],n.set(e,r)),r.push(t[e]);});};return t.forEach(function(t){var e=t.klass.importDOM;if(null==e||r.has(e))return;r.add(e);var n=e.call(t.klass);null!==n&&o(n);}),e&&o(e),n;}(h,f?f["import"]:void 0),d,t);return void 0!==c&&(g._pendingEditorState=c,g._dirtyType=2),function(t){t.registerCommand(Gt,un,vo),t.registerCommand(qt,fn,vo),t.registerCommand(Xt,dn,vo),t.registerCommand(Qt,hn,vo),t.registerCommand(ue,_n,vo);}(g),g;},exports.createSharedNodeState=X,exports.createState=function(t,e){return new G(t,e);},exports.declarePeerDependency=function(t,e){return[t,e];},exports.defineExtension=function(t){return t;},exports.flipDirection=ds,exports.getDOMOwnerDocument=Ai,exports.getDOMSelection=Ji,exports.getDOMSelectionFromTarget=Yi,exports.getDOMTextNode=Jo,exports.getEditorPropertyFromDOMNode=Bo,exports.getNearestEditorFromDOMNode=Ko,exports.getRegisteredNode=Do,exports.getRegisteredNodeOrThrow=wo,exports.getStaticNodeConfig=ss,exports.getTextDirection=function(t){return M.test(t)?"rtl":A.test(t)?"ltr":null;},exports.getTransformSetFromKlass=Eo,exports.isBlockDomNode=qi,exports.isCurrentlyReadOnlyMode=$r,exports.isDOMDocumentNode=Uo,exports.isDOMNode=Hi,exports.isDOMTextNode=$o,exports.isDOMUnmanaged=os,exports.isDocumentFragment=Vi,exports.isExactShortcutMatch=pi,exports.isHTMLAnchorElement=function(t){return ji(t)&&"A"===t.tagName;},exports.isHTMLElement=ji,exports.isInlineDomNode=Gi,exports.isLexicalEditor=Ro,exports.isModifierMatch=_i,exports.isSelectionCapturedInDecoratorInput=Lo,exports.isSelectionWithinEditor=Fo,exports.makeStepwiseIterator=Is,exports.removeFromParent=Ho,exports.resetRandomKey=function(){Ao=1;},exports.safeCast=function(t){return t;},exports.setDOMUnmanaged=function(t){t.__lexicalUnmanaged=!0;},exports.setNodeIndentFromDOM=rs,exports.shallowMergeConfig=function(t,e){if(!e||t===e)return t;for(var _n91 in e)if(t[_n91]!==e[_n91])return babelHelpers["extends"]({},t,e);return t;};}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<d4f4df497abc7b85a16c829825c1c083>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalComposerContext.prod",["react"],(function $module_LexicalComposerContext_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _require_closure_react;var e=_require_closure_react||(_require_closure_react=require("react"));var n=e.createContext(null);exports.LexicalComposerContext=n,exports.createLexicalComposerContext=function(e,n){var t=null;return null!=e&&(t=e[1]),{getTheme:function getTheme(){return null!=n?n:null!=t?t.getTheme():null;}};},exports.useLexicalComposerContext=function(){var t=e.useContext(n);return null==t&&function(e){var t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",e);for(var _len=arguments.length,n=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){n[_key-1]=arguments[_key];}for(var _e of n)r.append("v",_e);throw t.search=r.toString(),Error("Minified Lexical error #"+e+"; visit "+t.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}(8),t;};}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<4ba13524308c1dd46ac5b44adf0aeab2>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalContentEditable.prod",["LexicalComposerContext","LexicalText","LexicalUtils","react"],(function $module_LexicalContentEditable_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _excluded=["editor","ariaActiveDescendant","ariaAutoComplete","ariaControls","ariaDescribedBy","ariaErrorMessage","ariaExpanded","ariaInvalid","ariaLabel","ariaLabelledBy","ariaMultiline","ariaOwns","ariaRequired","autoCapitalize","className","id","role","spellCheck","style","tabIndex","data-testid"],_excluded2=["placeholder"];var _require_closure_react;var t=_require_closure_react||(_require_closure_react=require("react")),a=_require_closure_react;var n="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?t.useLayoutEffect:t.useEffect;function o(_ref,q){var e=_ref.editor,i=_ref.ariaActiveDescendant,r=_ref.ariaAutoComplete,o=_ref.ariaControls,l=_ref.ariaDescribedBy,s=_ref.ariaErrorMessage,d=_ref.ariaExpanded,u=_ref.ariaInvalid,c=_ref.ariaLabel,f=_ref.ariaLabelledBy,b=_ref.ariaMultiline,m=_ref.ariaOwns,x=_ref.ariaRequired,E=_ref.autoCapitalize,p=_ref.className,C=_ref.id,_ref$role=_ref.role,v=_ref$role===void 0?"textbox":_ref$role,_ref$spellCheck=_ref.spellCheck,w=_ref$spellCheck===void 0?!0:_ref$spellCheck,y=_ref.style,L=_ref.tabIndex,g=_ref["data-testid"],h=babelHelpers.objectWithoutPropertiesLoose(_ref,_excluded);var _t$useState=t.useState(e.isEditable()),R=_t$useState[0],j=_t$useState[1],S=t.useCallback(function(t){t&&t.ownerDocument&&t.ownerDocument.defaultView?e.setRootElement(t):e.setRootElement(null);},[e]),D=t.useMemo(function(){return function(){for(var _len=arguments.length,e=new Array(_len),_key=0;_key<_len;_key++){e[_key]=arguments[_key];}return function(t){for(var _a of e)"function"==typeof _a?_a(t):null!=_a&&(_a.current=t);};}(q,S);},[S,q]);return n(function(){return j(e.isEditable()),e.registerEditableListener(function(e){j(e);});},[e]),a.jsx("div",babelHelpers["extends"]({"aria-activedescendant":R?i:void 0,"aria-autocomplete":R?r:"none","aria-controls":R?o:void 0,"aria-describedby":l},null!=s?{"aria-errormessage":s}:{},{"aria-expanded":R&&"combobox"===v?!!d:void 0},null!=u?{"aria-invalid":u}:{},{"aria-label":c,"aria-labelledby":f,"aria-multiline":b,"aria-owns":R?m:void 0,"aria-readonly":!R||void 0,"aria-required":x,autoCapitalize:E,className:p,contentEditable:R,"data-testid":g,id:C,ref:D,role:v,spellCheck:w,style:y,tabIndex:L},h));}var l=t.forwardRef(o);function s(e){return e.getEditorState().read(require("LexicalText").$canShowPlaceholderCurry(e.isComposing()));}var d=t.forwardRef(u);function u(t,i){var r=t.placeholder,n=babelHelpers.objectWithoutPropertiesLoose(t,_excluded2),_e$useLexicalComposer=require("LexicalComposerContext").useLexicalComposerContext(),o=_e$useLexicalComposer[0];return a.jsxs(a.Fragment,{children:[a.jsx(l,babelHelpers["extends"]({editor:o},n,{ref:i})),null!=r&&a.jsx(c,{editor:o,content:r})]});}function c(_ref2){var e=_ref2.content,i=_ref2.editor;var o=function(e){var _t$useState3=t.useState(function(){return s(e);}),a=_t$useState3[0],i=_t$useState3[1];return n(function(){function t(){var t=s(e);i(t);}return t(),require("LexicalUtils").mergeRegister(e.registerUpdateListener(function(){t();}),e.registerEditableListener(function(){t();}));},[e]),a;}(i),_t$useState2=t.useState(i.isEditable()),l=_t$useState2[0],d=_t$useState2[1];if(t.useLayoutEffect(function(){return d(i.isEditable()),i.registerEditableListener(function(e){d(e);});},[i]),!o)return null;var u=null;return"function"==typeof e?u=e(l):null!==e&&(u=e),null===u?null:a.jsx("div",{"aria-hidden":!0,children:u});}exports.ContentEditable=d,exports.ContentEditableElement=l;}),null);
__d("LexicalDragon",["cr:2903"],(function(t,n,r,o,a,i){a.exports=n("cr:2903")}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<d590ff2ad017346a92057f379cd1818d>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalErrorBoundary.prod",["react"],(function $module_LexicalErrorBoundary_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _require_closure_react;var r=_require_closure_react||(_require_closure_react=require("react")),e=_require_closure_react;var t=r.createContext(null),o={didCatch:!1,error:null};var _s4=function(_r$Component){function s(r){var _this;_this=_r$Component.call(this,r)||this,_this.resetErrorBoundary=_this.resetErrorBoundary.bind(babelHelpers.assertThisInitialized(_this)),_this.state=o;return _this;}babelHelpers.inheritsLoose(s,_r$Component);s.getDerivedStateFromError=function getDerivedStateFromError(r){return{didCatch:!0,error:r};};var _proto=s.prototype;_proto.resetErrorBoundary=function resetErrorBoundary(){var r=this.state.error;if(null!==r){for(var e,t,_s=arguments.length,n=new Array(_s),i=0;i<_s;i++)n[i]=arguments[i];null===(e=(t=this.props).onReset)||void 0===e||e.call(t,{args:n,reason:"imperative-api"}),this.setState(o);}};_proto.componentDidCatch=function componentDidCatch(r,e){var t,o;null===(t=(o=this.props).onError)||void 0===t||t.call(o,r,e);};_proto.componentDidUpdate=function componentDidUpdate(r,e){var t=this.state.didCatch,_s2=this.props.resetKeys;var n,i;t&&null!==e.error&&function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r.length!==e.length||r.some(function(r,t){return!Object.is(r,e[t]);});}(r.resetKeys,_s2)&&(null===(n=(i=this.props).onReset)||void 0===n||n.call(i,{next:_s2,prev:r.resetKeys,reason:"keys"}),this.setState(o));};_proto.render=function render(){var _this$props=this.props,e=_this$props.children,o=_this$props.fallbackRender,_s3=_this$props.FallbackComponent,n=_this$props.fallback,_this$state=this.state,i=_this$state.didCatch,a=_this$state.error;var l=e;if(i){var _e={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof o)l=o(_e);else if(_s3)l=r.createElement(_s3,_e);else{if(void 0===n)throw a;l=n;}}return r.createElement(t.Provider,{value:{didCatch:i,error:a,resetErrorBoundary:this.resetErrorBoundary}},l);};return s;}(r.Component);exports.LexicalErrorBoundary=function(_ref){var r=_ref.children,t=_ref.onError;return e.jsx(_s4,{fallback:e.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:t,children:r});};}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<e7f655cbe89eb99649f683ba7274227b>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalHashtag.prod",["Lexical","LexicalText","LexicalUtils"],(function $module_LexicalHashtag_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _r=function(_n$TextNode){function r(){return _n$TextNode.apply(this,arguments)||this;}babelHelpers.inheritsLoose(r,_n$TextNode);r.getType=function getType(){return"hashtag";};r.clone=function clone(e){return new r(e.__text,e.__key);};var _proto=r.prototype;_proto.createDOM=function createDOM(e){var n=_n$TextNode.prototype.createDOM.call(this,e);return require("LexicalUtils").addClassNamesToElement(n,e.theme.hashtag),n;};r.importJSON=function importJSON(e){return a().updateFromJSON(e);};_proto.canInsertTextBefore=function canInsertTextBefore(){return!1;};_proto.isTextEntity=function isTextEntity(){return!0;};return r;}(require("Lexical").TextNode);function a(e){if(e===void 0){e="";}return require("Lexical").$applyNodeReplacement(new _r(e));}var s=new RegExp(function(){var _ref=function(){var e=String.fromCharCode,t="A-Za-zªµºÀ-ÖØ-öø-Ɂɐ-ˁˆ-ˑˠ-ˤˮͺΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϵϷ-ҁҊ-ӎӐ-ӹԀ-ԏԱ-Ֆՙա-ևא-תװ-ײء-غـ-يٮ-ٯٱ-ۓەۥ-ۦۮ-ۯۺ-ۼۿܐܒ-ܯݍ-ݭހ-ޥޱऄ-हऽॐक़-ॡॽঅ-ঌএ-ঐও-নপ-রলশ-হঽৎড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલ-ળવ-હઽૐૠ-ૡଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଵ-ହଽଡ଼-ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡඅ-ඖක-නඳ-රලව-ෆก-ะา-ำเ-ๆກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ະາ-ຳຽເ-ໄໆໜ-ໝༀཀ-ཇཉ-ཪྈ-ྋက-အဣ-ဧဩ-ဪၐ-ၕႠ-Ⴥა-ჺჼᄀ-ᅙᅟ-ᆢᆨ-ᇹሀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙶᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦩᧁ-ᧇᨀ-ᨖᴀ-ᶿḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₔℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℱℳ-ℹℼ-ℿⅅ-ⅉⰀ-Ⱞⰰ-ⱞⲀ-ⳤⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〆〱-〵〻-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄬㄱ-ㆎㆠ-ㆷㇰ-ㇿ㐀-䶵一-龻ꀀ-ꒌꠀ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢ가-힣豈-鶴侮-頻並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜÀ-ÖØ-öø-ÿĀ-ɏɓ-ɔɖ-ɗəɛɣɨɯɲʉʋʻ̀-ͯḀ-ỿЀ-ӿԀ-ԧⷠ-ⷿꙀ-֑ꚟ-ֿׁ-ׂׄ-ׇׅא-תװ-״﬒-ﬨשׁ-זּטּ-לּמּנּ-סּףּ-פּצּ-ﭏؐ-ؚؠ-ٟٮ-ۓە-ۜ۞-۪ۨ-ۯۺ-ۼۿݐ-ݿࢠࢢ-ࢬࣤ-ࣾﭐ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼ‌-‌ก-ฺเ-๎ᄀ-ᇿ㄰-ㆅꥠ-꥿가-힯ힰ-퟿ﾡ-ￜァ-ヺー-ヾｦ-ﾟ０-９Ａ-Ｚａ-ｚぁ-ゖ゙-ゞ㐀-䶿一-鿿"+e(173824)+"-"+e(177983)+e(177984)+"-"+e(178207)+e(194560)+"-"+e(195103)+"〃々〻";return{alpha:t,alphanumeric:t+"̀-ͯ҃-֑҆-ֹֻ-ֽֿׁ-ׂׄ-ׇׅؐ-ًؕ-ٰٞۖ-ۜ۟-ۤۧ-۪ۨ-ܑۭܰ-݊ަ-ްँ-ः़ा-्॑-॔ॢ-ॣঁ-ঃ়া-ৄে-ৈো-্ৗৢ-ৣਁ-ਃ਼ਾ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗං-ඃ්ා-ුූෘ-ෟෲ-ෳัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾-༿ཱ-྄྆-྇ྐ-ྗྙ-ྼ࿆ာ-ဲံ-္ၖ-ၙ፟ᜒ-᜔ᜲ-᜴ᝒ-ᝓᝲ-ᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈ-ᧉᨗ-ᨛ᷀-᷃⃐-⃥⃜⃡-⃫〪-゙〯-゚ꠂ꠆ꠋꠣ-ꠧﬞ︀-️︠-︣0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௦-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩၀-၉០-៩᠐-᠙᥆-᥏᧐-᧙０-９_",hashChars:"#\\uFF03"};}(),e=_ref.alpha,t=_ref.alphanumeric,n=_ref.hashChars,r="["+t+"]";return"("+("^|$|[^&/"+t+"]")+")("+("["+n+"]")+")("+r+"*"+("["+e+"]")+r+"*)";}(),"i");var i={getHashtagMatch:function getHashtagMatch(e){var t=s.exec(e);if(null===t)return null;var n=t[3].length+1,r=t.index+t[1].length;return{end:r+n,start:r};}};function c(n,s){if(s===void 0){s=i;}return require("LexicalUtils").mergeRegister.apply(require("LexicalUtils"),require("LexicalText").registerLexicalTextEntity(n,s.getHashtagMatch,_r,function(e){return a(e.getTextContent());}));}var o=require("Lexical").defineExtension({config:i,name:"@lexical/hashtag/Hashtag",nodes:function nodes(){return[_r];},register:c});exports.$createHashtagNode=a,exports.$isHashtagNode=function(e){return e instanceof _r;},exports.HashtagExtension=o,exports.HashtagNode=_r,exports.registerLexicalHashtag=c;}),null);
__d("LexicalHistory",["cr:2904"],(function(t,n,r,o,a,i){a.exports=n("cr:2904")}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<a4e75d98d5c200f319ab621ceecc265d>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalHistoryPlugin.prod",["LexicalComposerContext","LexicalHistory","react"],(function $module_LexicalHistoryPlugin_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _require_closure_react;var r=_require_closure_react||(_require_closure_react=require("react"));exports.createEmptyHistoryState=require("LexicalHistory").createEmptyHistoryState,exports.HistoryPlugin=function(_ref){var o=_ref.delay,s=_ref.externalHistoryState;var _e$useLexicalComposer=require("LexicalComposerContext").useLexicalComposerContext(),i=_e$useLexicalComposer[0];return function(e,o,s){if(s===void 0){s=1e3;}var i=r.useMemo(function(){return o||require("LexicalHistory").createEmptyHistoryState();},[o]);r.useEffect(function(){return require("LexicalHistory").registerHistory(e,i,s);},[s,e,i]);}(i,s,o),null;};}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<80803d44c4e0703f78c6246668ce4223>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalLink.prod",["Lexical","LexicalExtension","LexicalUtils"],(function $module_LexicalLink_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _excluded=["url"];var _require_Lexical;var r=new Set(["http:","https:","mailto:","sms:","tel:"]);var _i1=function(_t$ElementNode){function i(e,t,n){var _this;if(e===void 0){e="";}if(t===void 0){t={};}_this=_t$ElementNode.call(this,n)||this;var _t=t,_t$target=_t.target,r=_t$target===void 0?null:_t$target,_t$rel=_t.rel,_i=_t$rel===void 0?null:_t$rel,_t$title=_t.title,s=_t$title===void 0?null:_t$title;_this.__url=e,_this.__target=r,_this.__rel=_i,_this.__title=s;return _this;}babelHelpers.inheritsLoose(i,_t$ElementNode);i.getType=function getType(){return"link";};i.clone=function clone(e){return new i(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key);};var _proto=i.prototype;_proto.createDOM=function createDOM(t){var n=document.createElement("a");return this.updateLinkDOM(null,n,t),require("LexicalUtils").addClassNamesToElement(n,t.theme.link),n;};_proto.updateLinkDOM=function updateLinkDOM(t,n,r){if(require("LexicalUtils").isHTMLAnchorElement(n)){t&&t.__url===this.__url||(n.href=this.sanitizeUrl(this.__url));for(var _e of["target","rel","title"]){var _r="__"+_e,_i2=this[_r];t&&t[_r]===_i2||(_i2?n[_e]=_i2:n.removeAttribute(_e));}}};_proto.updateDOM=function updateDOM(e,t,n){return this.updateLinkDOM(e,t,n),!1;};i.importDOM=function importDOM(){return{a:function a(e){return{conversion:s,priority:1};}};};i.importJSON=function importJSON(e){return l().updateFromJSON(e);};_proto.updateFromJSON=function updateFromJSON(e){return _t$ElementNode.prototype.updateFromJSON.call(this,e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null);};_proto.sanitizeUrl=function sanitizeUrl(e){e=p(e);try{var _t2=new URL(p(e));if(!r.has(_t2.protocol))return"about:blank";}catch(t){return e;}return e;};_proto.exportJSON=function exportJSON(){return babelHelpers["extends"]({},_t$ElementNode.prototype.exportJSON.call(this),{rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()});};_proto.getURL=function getURL(){return this.getLatest().__url;};_proto.setURL=function setURL(e){var t=this.getWritable();return t.__url=e,t;};_proto.getTarget=function getTarget(){return this.getLatest().__target;};_proto.setTarget=function setTarget(e){var t=this.getWritable();return t.__target=e,t;};_proto.getRel=function getRel(){return this.getLatest().__rel;};_proto.setRel=function setRel(e){var t=this.getWritable();return t.__rel=e,t;};_proto.getTitle=function getTitle(){return this.getLatest().__title;};_proto.setTitle=function setTitle(e){var t=this.getWritable();return t.__title=e,t;};_proto.insertNewAfter=function insertNewAfter(e,t){if(t===void 0){t=!0;}var n=l(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(n,t),n;};_proto.canInsertTextBefore=function canInsertTextBefore(){return!1;};_proto.canInsertTextAfter=function canInsertTextAfter(){return!1;};_proto.canBeEmpty=function canBeEmpty(){return!1;};_proto.isInline=function isInline(){return!0;};_proto.extractWithChild=function extractWithChild(e,n,r){if(!require("Lexical").$isRangeSelection(n))return!1;var _i3=n.anchor.getNode(),s=n.focus.getNode();return this.isParentOf(_i3)&&this.isParentOf(s)&&n.getTextContent().length>0;};_proto.isEmailURI=function isEmailURI(){return this.__url.startsWith("mailto:");};_proto.isWebSiteURI=function isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://");};return i;}((_require_Lexical=require("Lexical")).ElementNode);function s(t){var n=null;if(require("LexicalUtils").isHTMLAnchorElement(t)){var _e2=t.textContent;(null!==_e2&&""!==_e2||t.children.length>0)&&(n=l(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}));}return{node:n};}function l(e,n){if(e===void 0){e="";}return require("Lexical").$applyNodeReplacement(new _i1(e,n));}function o(e){return e instanceof _i1;}var _a4=function(_i4){function a(e,t,n){var _this2;if(e===void 0){e="";}if(t===void 0){t={};}_this2=_i4.call(this,e,t,n)||this,_this2.__isUnlinked=void 0!==t.isUnlinked&&null!==t.isUnlinked&&t.isUnlinked;return _this2;}babelHelpers.inheritsLoose(a,_i4);a.getType=function getType(){return"autolink";};a.clone=function clone(e){return new a(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title},e.__key);};var _proto2=a.prototype;_proto2.getIsUnlinked=function getIsUnlinked(){return this.__isUnlinked;};_proto2.setIsUnlinked=function setIsUnlinked(e){var t=this.getWritable();return t.__isUnlinked=e,t;};_proto2.createDOM=function createDOM(e){return this.__isUnlinked?document.createElement("span"):_i4.prototype.createDOM.call(this,e);};_proto2.updateDOM=function updateDOM(e,t,n){return _i4.prototype.updateDOM.call(this,e,t,n)||e.__isUnlinked!==this.__isUnlinked;};a.importJSON=function importJSON(e){return u().updateFromJSON(e);};_proto2.updateFromJSON=function updateFromJSON(e){return _i4.prototype.updateFromJSON.call(this,e).setIsUnlinked(e.isUnlinked||!1);};a.importDOM=function importDOM(){return null;};_proto2.exportJSON=function exportJSON(){return babelHelpers["extends"]({},_i4.prototype.exportJSON.call(this),{isUnlinked:this.__isUnlinked});};_proto2.insertNewAfter=function insertNewAfter(e,n){if(n===void 0){n=!0;}var r=this.getParentOrThrow().insertNewAfter(e,n);if(require("Lexical").$isElementNode(r)){var _e3=u(this.__url,{isUnlinked:this.__isUnlinked,rel:this.__rel,target:this.__target,title:this.__title});return r.append(_e3),_e3;}return null;};return a;}(_i1);function u(e,n){if(e===void 0){e="";}return require("Lexical").$applyNodeReplacement(new _a4(e,n));}function c(e){return e instanceof _a4;}var g=_require_Lexical.createCommand("TOGGLE_LINK_COMMAND");function f(e,n){if("element"===e.type){var _r2=e.getNode();require("Lexical").$isElementNode(_r2)||function(e){var n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",e);for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key];}for(var _e4 of t)r.append("v",_e4);throw n.search=r.toString(),Error("Minified Lexical error #"+e+"; visit "+n.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}(252);return _r2.getChildren()[e.offset+n]||null;}return null;}function d(n,r){if(r===void 0){r={};}var i;if(n&&"object"==typeof n){var _e5=n.url,_t3=babelHelpers.objectWithoutPropertiesLoose(n,_excluded);i=_e5,r=babelHelpers["extends"]({},_t3,r);}else i=n;var _r3=r,s=_r3.target,a=_r3.title,u=void 0===r.rel?"noreferrer":r.rel,g=require("Lexical").$getSelection();if(null===g||!require("Lexical").$isRangeSelection(g)&&!require("Lexical").$isNodeSelection(g))return;if(require("Lexical").$isNodeSelection(g)){var _t4=g.getNodes();if(0===_t4.length)return;return void _t4.forEach(function(t){if(null===i){var _n=require("LexicalUtils").$findMatchingParent(t,function(e){return!c(e)&&o(e);});_n&&(_n.insertBefore(t),0===_n.getChildren().length&&_n.remove());}else{var _n2=require("LexicalUtils").$findMatchingParent(t,function(e){return!c(e)&&o(e);});if(_n2)_n2.setURL(i),void 0!==s&&_n2.setTarget(s),void 0!==u&&_n2.setRel(u);else{var _e6=l(i,{rel:u,target:s});t.insertBefore(_e6),_e6.append(t);}}});}var d=g.extract();if(null===i){var _n3=new Set();return void d.forEach(function(r){var i=require("LexicalUtils").$findMatchingParent(r,function(e){return!c(e)&&o(e);});if(null!==i){var _e7=i.getKey();if(_n3.has(_e7))return;!function(e,n){var r=new Set(n.filter(function(t){return e.isParentOf(t);}).map(function(e){return e.getKey();})),i=e.getChildren(),s=function s(i){return r.has(i.getKey())||require("Lexical").$isElementNode(i)&&n.some(function(t){return e.isParentOf(t)&&i.isParentOf(t);});},o=i.filter(s);if(o.length===i.length)return i.forEach(function(t){return e.insertBefore(t);}),void e.remove();var a=i.findIndex(s),u=i.findLastIndex(s),c=0===a,g=u===i.length-1;if(c)o.forEach(function(t){return e.insertBefore(t);});else if(g)for(var _t5=o.length-1;_t5>=0;_t5--)e.insertAfter(o[_t5]);else{for(var _t6=o.length-1;_t6>=0;_t6--)e.insertAfter(o[_t6]);var _t7=i.slice(u+1);if(_t7.length>0){var _n4=l(e.getURL(),{rel:e.getRel(),target:e.getTarget(),title:e.getTitle()});o[o.length-1].insertAfter(_n4),_t7.forEach(function(e){return _n4.append(e);});}}}(i,d),_n3.add(_e7);}});}var h=new Set(),p=function p(e){h.has(e.getKey())||(h.add(e.getKey()),e.setURL(i),void 0!==s&&e.setTarget(s),void 0!==u&&e.setRel(u),void 0!==a&&e.setTitle(a));};if(1===d.length){var _t8=d[0],_n5=require("LexicalUtils").$findMatchingParent(_t8,o);if(null!==_n5)return p(_n5);}!function(e){var n=require("Lexical").$getSelection();if(!require("Lexical").$isRangeSelection(n))return e();var r=require("Lexical").$normalizeSelection__EXPERIMENTAL(n),i=r.isBackward(),s=f(r.anchor,i?-1:0),l=f(r.focus,i?0:-1),o=e();if(s||l){var _e8=require("Lexical").$getSelection();if(require("Lexical").$isRangeSelection(_e8)){var _n6=_e8.clone();if(s){var _e9=s.getParent();_e9&&_n6.anchor.set(_e9.getKey(),s.getIndexWithinParent()+(i?1:0),"element");}if(l){var _e0=l.getParent();_e0&&_n6.focus.set(_e0.getKey(),l.getIndexWithinParent()+(i?0:1),"element");}require("Lexical").$setSelection(require("Lexical").$normalizeSelection__EXPERIMENTAL(_n6));}}}(function(){var n=null;for(var _r4 of d){if(!_r4.isAttached())continue;var _g=require("LexicalUtils").$findMatchingParent(_r4,o);if(_g){p(_g);continue;}if(require("Lexical").$isElementNode(_r4)){if(!_r4.isInline())continue;if(o(_r4)){if(!(c(_r4)||null!==n&&n.getParentOrThrow().isParentOf(_r4))){p(_r4),n=_r4;continue;}for(var _e1 of _r4.getChildren())_r4.insertBefore(_e1);_r4.remove();continue;}}var _f=_r4.getPreviousSibling();o(_f)&&_f.is(n)?_f.append(_r4):(n=l(i,{rel:u,target:s,title:a}),_r4.insertAfter(n),n.append(_r4));}});}var h=/^\+?[0-9\s()-]{5,}$/;function p(e){return e.match(/^[a-z][a-z0-9+.-]*:/i)||e.match(/^[/#.]/)?e:e.includes("@")?"mailto:"+e:h.test(e)?"tel:"+e:"https://"+e;}var _={attributes:void 0,validateUrl:void 0};function m(r,i){return require("LexicalUtils").mergeRegister(require("LexicalExtension").effect(function(){return r.registerCommand(g,function(e){var t=i.validateUrl.peek(),n=i.attributes.peek();if(null===e)return d(null),!0;if("string"==typeof e)return!(void 0!==t&&!t(e))&&(d(e,n),!0);{var _t9=e.url,_r5=e.target,_i5=e.rel,_s=e.title;return d(_t9,babelHelpers["extends"]({},n,{rel:_i5,target:_r5,title:_s})),!0;}},require("Lexical").COMMAND_PRIORITY_LOW);}),require("LexicalExtension").effect(function(){var n=i.validateUrl.value;if(!n)return;var s=i.attributes.value;return r.registerCommand(require("Lexical").PASTE_COMMAND,function(i){var l=require("Lexical").$getSelection();if(!require("Lexical").$isRangeSelection(l)||l.isCollapsed()||!require("LexicalUtils").objectKlassEquals(i,ClipboardEvent))return!1;if(null===i.clipboardData)return!1;var o=i.clipboardData.getData("text");return!!n(o)&&!l.getNodes().some(function(e){return require("Lexical").$isElementNode(e);})&&(r.dispatchCommand(g,babelHelpers["extends"]({},s,{url:o})),i.preventDefault(),!0);},require("Lexical").COMMAND_PRIORITY_LOW);}));}var x=_require_Lexical.defineExtension({build:function build(e,t,r){return require("LexicalExtension").namedSignals(t);},config:_,mergeConfig:function mergeConfig(e,n){var r=require("Lexical").shallowMergeConfig(e,n);return e.attributes&&(r.attributes=require("Lexical").shallowMergeConfig(e.attributes,r.attributes)),r;},name:"@lexical/link/Link",nodes:function nodes(){return[_i1];},register:function register(e,t,n){return m(e,n.getOutput());}});function k(n,r,i){if(i===void 0){i={};}var s=function s(i){var s=i.target;if(!require("Lexical").isDOMNode(s))return;var l=require("Lexical").getNearestEditorFromDOMNode(s);if(null===l)return;var a=null,u=null;if(l.update(function(){var n=require("Lexical").$getNearestNodeFromDOMNode(s);if(null!==n){var _i6=require("LexicalUtils").$findMatchingParent(n,require("Lexical").$isElementNode);if(!r.disabled.peek())if(o(_i6))a=_i6.sanitizeUrl(_i6.getURL()),u=_i6.getTarget();else{var _t0=function(e,t){var n=e;for(;null!=n;){if(t(n))return n;n=n.parentNode;}return null;}(s,require("LexicalUtils").isHTMLAnchorElement);null!==_t0&&(a=_t0.href,u=_t0.target);}}}),null===a||""===a)return;var c=n.getEditorState().read(require("Lexical").$getSelection);if(require("Lexical").$isRangeSelection(c)&&!c.isCollapsed())return void i.preventDefault();var g="auxclick"===i.type&&1===i.button;window.open(a,r.newTab.peek()||g||i.metaKey||i.ctrlKey||"_blank"===u?"_blank":"_self"),i.preventDefault();},l=function l(e){1===e.button&&s(e);};return n.registerRootListener(function(e,t){null!==t&&(t.removeEventListener("click",s),t.removeEventListener("mouseup",l)),null!==e&&(e.addEventListener("click",s,i),e.addEventListener("mouseup",l,i));});}var N=_require_Lexical.defineExtension({build:function build(e,t,r){return require("LexicalExtension").namedSignals(t);},config:_require_Lexical.safeCast({disabled:!1,newTab:!1}),dependencies:[x],name:"@lexical/link/ClickableLink",register:function register(e,t,n){return k(e,n.getOutput());}});function L(e,t){for(var _n7=0;_n7<t.length;_n7++){var _r6=t[_n7](e);if(_r6)return _r6;}return null;}var T=/[.,;\s]/;function S(e){return T.test(e);}function b(e){return S(e[e.length-1]);}function $(e){return S(e[0]);}function U(e){var n=e.getPreviousSibling();return require("Lexical").$isElementNode(n)&&(n=n.getLastDescendant()),null===n||require("Lexical").$isLineBreakNode(n)||require("Lexical").$isTextNode(n)&&b(n.getTextContent());}function R(e){var n=e.getNextSibling();return require("Lexical").$isElementNode(n)&&(n=n.getFirstDescendant()),null===n||require("Lexical").$isLineBreakNode(n)||require("Lexical").$isTextNode(n)&&$(n.getTextContent());}function v(e,t,n,r){if(!(e>0?S(n[e-1]):U(r[0])))return!1;return t<n.length?S(n[t]):R(r[r.length-1]);}function O(e,t,n){var r=[],i=[],s=[];var l=0,o=0;var a=[].concat(e);for(;a.length>0;){var _e10=a[0],_u=_e10.getTextContent().length,_c=o;o+_u<=t?(r.push(_e10),l+=_u):_c>=n?s.push(_e10):i.push(_e10),o+=_u,a.shift();}return[l,r,i,s];}function E(e,n,r,i){var s=u(i.url,i.attributes);if(1===e.length){var _o$splitText,_o$splitText2;var _l,_o=e[0];0===n?(_o$splitText=_o.splitText(r),_l=_o$splitText[0],_o=_o$splitText[1],_o$splitText):(_o$splitText2=_o.splitText(n,r),_l=_o$splitText2[1],_o=_o$splitText2[2],_o$splitText2);var _a=require("Lexical").$createTextNode(i.text);return _a.setFormat(_l.getFormat()),_a.setDetail(_l.getDetail()),_a.setStyle(_l.getStyle()),s.append(_a),_l.replace(s),_o;}if(e.length>1){var _i7$splitText;var _i7=e[0];var _l2,_o2=_i7.getTextContent().length;0===n?_l2=_i7:(_i7$splitText=_i7.splitText(n),_l2=_i7$splitText[1],_i7$splitText);var _a2=[];var _u2;for(var _t1=1;_t1<e.length;_t1++){var _n8=e[_t1],_i8=_n8.getTextContent().length,_s2=_o2;if(_s2<r)if(_o2+_i8<=r)_a2.push(_n8);else{var _n8$splitText=_n8.splitText(r-_s2),_e11=_n8$splitText[0],_t10=_n8$splitText[1];_a2.push(_e11),_u2=_t10;}_o2+=_i8;}var _c2=require("Lexical").$getSelection(),_g2=_c2?_c2.getNodes().find(require("Lexical").$isTextNode):void 0,_f2=require("Lexical").$createTextNode(_l2.getTextContent());return _f2.setFormat(_l2.getFormat()),_f2.setDetail(_l2.getDetail()),_f2.setStyle(_l2.getStyle()),s.append.apply(s,[_f2].concat(_a2)),_g2&&_g2===_l2&&(require("Lexical").$isRangeSelection(_c2)?_f2.select(_c2.anchor.offset,_c2.focus.offset):require("Lexical").$isNodeSelection(_c2)&&_f2.select(0,_f2.getTextContent().length)),_l2.replace(s),_u2;}}function C(e,n,r){var i=e.getChildren(),s=i.length;for(var _n9=0;_n9<s;_n9++){var _s3=i[_n9];if(!require("Lexical").$isTextNode(_s3)||!_s3.isSimpleText())return M(e),void r(null,e.getURL());}var l=e.getTextContent(),o=L(l,n);if(null===o||o.text!==l)return M(e),void r(null,e.getURL());if(!U(e)||!R(e))return M(e),void r(null,e.getURL());var a=e.getURL();if(a!==o.url&&(e.setURL(o.url),r(o.url,a)),o.attributes){var _t11=e.getRel();_t11!==o.attributes.rel&&(e.setRel(o.attributes.rel||null),r(o.attributes.rel||null,_t11));var _n0=e.getTarget();_n0!==o.attributes.target&&(e.setTarget(o.attributes.target||null),r(o.attributes.target||null,_n0));}}function M(e){var t=e.getChildren();for(var _n1=t.length-1;_n1>=0;_n1--)e.insertAfter(t[_n1]);return e.remove(),t.map(function(e){return e.getLatest();});}var P={changeHandlers:[],matchers:[]};function A(n,r){if(r===void 0){r=P;}var _r7=r,i=_r7.matchers,s=_r7.changeHandlers,l=function l(e,t){for(var _n10 of s)_n10(e,t);};return require("LexicalUtils").mergeRegister(n.registerNodeTransform(require("Lexical").TextNode,function(e){var n=e.getParentOrThrow(),r=e.getPreviousSibling();if(c(n)&&!n.getIsUnlinked())C(n,i,l);else if(!o(n)){if(e.isSimpleText()&&($(e.getTextContent())||!c(r))){var _n11=function(e){var n=[e];var r=e.getNextSibling();for(;null!==r&&require("Lexical").$isTextNode(r)&&r.isSimpleText()&&(n.push(r),!/[\s]/.test(r.getTextContent()));)r=r.getNextSibling();return n;}(e);!function(e,t,n){for(var _t12 of e){var _e12=_t12.getParent();if(c(_e12)&&!_e12.getIsUnlinked())return;}var r=[].concat(e);var i=r.map(function(e){return e.getTextContent();}).join("");var s,l=i,o=0;for(;(s=L(l,t))&&null!==s;){var _e13=s.index,_t13=_e13+s.length;if(v(o+_e13,o+_t13,i,r)){var _O=O(r,o+_e13,o+_t13),_i9=_O[0],_a3=_O[2],_u3=_O[3];var _g3=!1;for(var _e14 of _a3){var _t14=_e14.getParent();if(c(_t14)&&!_t14.getIsUnlinked()){_g3=!0;break;}}if(_g3){o+=_t13,l=l.substring(_t13);continue;}var _f3=E(_a3,o+_e13-_i9,o+_t13-_i9,s);r=_f3?[_f3].concat(_u3):_u3,n(s.url,null),o=0;}else o+=_t13;l=l.substring(_t13);}}(_n11,i,l);}!function(e,t,n){var r=e.getParent(),i=e.getPreviousSibling(),s=e.getNextSibling(),l=e.getTextContent();if(!c(r)||r.getIsUnlinked()){if(c(i)&&!i.getIsUnlinked()&&i.is(e.getPreviousSibling())&&e.getParent()===i.getParent()){if(!$(l))return M(i),void n(null,i.getURL());if(o=l,i.isEmailURI()?/^\.[a-zA-Z]{2,}/.test(o):/^\.[a-zA-Z0-9]{1,}/.test(o)){var _r8=i.getTextContent()+l,_s4=L(_r8,t);null!==_s4&&_s4.text===_r8&&(i.append(e),C(i,t,n),n(null,i.getURL()));}}var o;!c(s)||s.getIsUnlinked()||b(l)||s.is(e.getNextSibling())&&e.getParent()===s.getParent()&&(M(s),n(null,s.getURL()));}}(e,i,l);}}),n.registerCommand(g,function(e){var n=require("Lexical").$getSelection();if(null!==e||!require("Lexical").$isRangeSelection(n))return!1;return n.extract().forEach(function(e){var t=e.getParent();c(t)&&(t.setIsUnlinked(!t.getIsUnlinked()),t.markDirty());}),!1;},require("Lexical").COMMAND_PRIORITY_LOW));}var D=_require_Lexical.defineExtension({config:P,dependencies:[x],mergeConfig:function mergeConfig(e,n){var r=require("Lexical").shallowMergeConfig(e,n);for(var _t15 of["matchers","changeHandlers"]){var _i0=n[_t15];Array.isArray(_i0)&&(r[_t15]=[].concat(e[_t15],_i0));}return r;},name:"@lexical/link/AutoLink",register:A}),I=d;exports.$createAutoLinkNode=u,exports.$createLinkNode=l,exports.$isAutoLinkNode=c,exports.$isLinkNode=o,exports.$toggleLink=d,exports.AutoLinkExtension=D,exports.AutoLinkNode=_a4,exports.ClickableLinkExtension=N,exports.LinkExtension=x,exports.LinkNode=_i1,exports.TOGGLE_LINK_COMMAND=g,exports.createLinkMatcherWithRegExp=function(e,t){if(t===void 0){t=function t(e){return e;};}return function(n){var r=e.exec(n);return null===r?null:{index:r.index,length:r[0].length,text:r[0],url:t(r[0])};};},exports.formatUrl=p,exports.registerAutoLink=A,exports.registerClickableLink=k,exports.registerLink=m,exports.toggleLink=I;}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<111cde4a64dea62e780fcbb1e7938bc1>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalOverflow.prod",["Lexical"],(function $module_LexicalOverflow_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _t4=function(_e$ElementNode){function t(){return _e$ElementNode.apply(this,arguments)||this;}babelHelpers.inheritsLoose(t,_e$ElementNode);var _proto=t.prototype;_proto.$config=function $config(){return this.config("overflow",{$transform:function $transform(e){e.isEmpty()&&e.remove();},"extends":require("Lexical").ElementNode});};_proto.createDOM=function createDOM(e){var _t=document.createElement("span"),r=e.theme.characterLimit;return"string"==typeof r&&(_t.className=r),_t;};_proto.updateDOM=function updateDOM(e,_t2){return!1;};_proto.insertNewAfter=function insertNewAfter(e,_t3){if(_t3===void 0){_t3=!0;}return this.getParentOrThrow().insertNewAfter(e,_t3);};_proto.excludeFromCopy=function excludeFromCopy(){return!0;};return t;}(require("Lexical").ElementNode);var r=require("Lexical").defineExtension({name:"LexicalOverflow",nodes:function nodes(){return[_t4];}});exports.$createOverflowNode=function(){return require("Lexical").$applyNodeReplacement(new _t4());},exports.$isOverflowNode=function(e){return e instanceof _t4;},exports.OverflowExtension=r,exports.OverflowNode=_t4;}),null);
__d("LexicalPlainText",["cr:2909"],(function(t,n,r,o,a,i){a.exports=n("cr:2909")}),null);
__d("LexicalReactProviderExtension",["cr:13740"],(function(t,n,r,o,a,i){a.exports=n("cr:13740")}),null);
__d("useLexicalEditable",["cr:4793"],(function(t,n,r,o,a,i){a.exports=n("cr:4793")}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<b71013edf6ac0a7d06f41d04de6a60eb>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalPlainTextPlugin.prod",["LexicalComposerContext","LexicalDragon","LexicalExtension","LexicalPlainText","LexicalReactProviderExtension","LexicalText","LexicalUtils","ReactDOM","react","useLexicalEditable"],(function $module_LexicalPlainTextPlugin_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";var _require_closure_react;var o=_require_closure_react||(_require_closure_react=require("react")),c=_require_closure_react;function d(e){var t=new URL("https://lexical.dev/docs/error"),n=new URLSearchParams();n.append("code",e);for(var _len=arguments.length,r=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){r[_key-1]=arguments[_key];}for(var _e of r)n.append("v",_e);throw t.search=n.toString(),Error("Minified Lexical error #"+e+"; visit "+t.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}var x="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?o.useLayoutEffect:o.useEffect;function f(_ref){var e=_ref.editor,r=_ref.ErrorBoundary;return function(e,r){var _o$useState=o.useState(function(){return e.getDecorators();}),t=_o$useState[0],n=_o$useState[1];return x(function(){return e.registerDecoratorListener(function(e){require("ReactDOM").flushSync(function(){n(e);});});},[e]),o.useEffect(function(){n(e.getDecorators());},[e]),o.useMemo(function(){var n=[],a=Object.keys(t);for(var _s=0;_s<a.length;_s++){var _u=a[_s],_l=c.jsx(r,{onError:function onError(r){return e._onError(r);},children:c.jsx(o.Suspense,{fallback:null,children:t[_u]})}),_d=e.getElementByKey(_u);null!==_d&&n.push(require("ReactDOM").createPortal(_l,_d,_u));}return n;},[r,t,e]);}(e,r);}function E(_ref2){var e=_ref2.editor,r=_ref2.ErrorBoundary;return function(e){var r=require("LexicalExtension").LexicalBuilder.maybeFromEditor(e);if(r&&r.hasExtensionByName(require("LexicalReactProviderExtension").ReactProviderExtension.name)){for(var _e2 of["LexicalPlainText","LexicalRichText"])r.hasExtensionByName(_e2)&&d(320,_e2);return!0;}return!1;}(e)?null:c.jsx(f,{editor:e,ErrorBoundary:r});}function g(e){return e.getEditorState().read(require("LexicalText").$canShowPlaceholderCurry(e.isComposing()));}function m(_ref3){var t=_ref3.content;var _e$useLexicalComposer=require("LexicalComposerContext").useLexicalComposerContext(),n=_e$useLexicalComposer[0],i=function(e){var _o$useState2=o.useState(function(){return g(e);}),r=_o$useState2[0],t=_o$useState2[1];return x(function(){function r(){var r=g(e);t(r);}return r(),require("LexicalUtils").mergeRegister(e.registerUpdateListener(function(){r();}),e.registerEditableListener(function(){r();}));},[e]),r;}(n),c=require("useLexicalEditable").useLexicalEditable();return i?"function"==typeof t?t(c):t:null;}exports.PlainTextPlugin=function(_ref4){var r=_ref4.contentEditable,_ref4$placeholder=_ref4.placeholder,t=_ref4$placeholder===void 0?null:_ref4$placeholder,n=_ref4.ErrorBoundary;var _e$useLexicalComposer2=require("LexicalComposerContext").useLexicalComposerContext(),o=_e$useLexicalComposer2[0];return function(e){x(function(){return require("LexicalUtils").mergeRegister(require("LexicalPlainText").registerPlainText(e),require("LexicalDragon").registerDragonSupport(e));},[e]);}(o),c.jsxs(c.Fragment,{children:[r,c.jsx(m,{content:t}),c.jsx(E,{editor:o,ErrorBoundary:n})]});};}),null);
__d("LexicalSelection",["cr:2180"],(function(t,n,r,o,a,i){a.exports=n("cr:2180")}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<7dcdb223bf348832203cf99dbbd5db05>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalText.prod",["Lexical"],(function $module_LexicalText_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";function e(){return require("Lexical").$getRoot().getTextContent();}function n(t,n){if(n===void 0){n=!0;}if(t)return!1;var r=e();return n&&(r=r.trim()),""===r;}function r(e){if(!n(e,!1))return!1;var r=require("Lexical").$getRoot().getChildren(),o=r.length;if(o>1)return!1;for(var _e=0;_e<o;_e++){var _n=r[_e];if(require("Lexical").$isDecoratorNode(_n))return!1;if(require("Lexical").$isElementNode(_n)){if(!require("Lexical").$isParagraphNode(_n))return!1;if(0!==_n.__indent)return!1;var _r=_n.getChildren(),_o=_r.length;for(var _n2=0;_n2<_o;_n2++){var _n3=_r[_e];if(!require("Lexical").$isTextNode(_n3))return!1;}}}return!0;}function o(t){var n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",t);for(var _len=arguments.length,e=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){e[_key-1]=arguments[_key];}for(var _t of e)r.append("v",_t);throw n.search=r.toString(),Error("Minified Lexical error #"+t+"; visit "+n.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}exports.$canShowPlaceholder=r,exports.$canShowPlaceholderCurry=function(t){return function(){return r(t);};},exports.$findTextIntersectionFromCharacters=function(e,n){var r=e.getFirstChild(),o=0;t:for(;null!==r;){if(require("Lexical").$isElementNode(r)){var _t2=r.getFirstChild();if(null!==_t2){r=_t2;continue;}}else if(require("Lexical").$isTextNode(r)){var _t3=r.getTextContentSize();if(o+_t3>n)return{node:r,offset:n-o};o+=_t3;}var _e2=r.getNextSibling();if(null!==_e2){r=_e2;continue;}var i=r.getParent();for(;null!==i;){var _t4=i.getNextSibling();if(null!==_t4){r=_t4;continue t;}i=i.getParent();}break;}return null;},exports.$isRootTextContentEmpty=n,exports.$isRootTextContentEmptyCurry=function(t,e){return function(){return n(t,e);};},exports.$rootTextContent=e,exports.registerLexicalTextEntity=function(e,n,r,i){var s=function s(t){return t instanceof r;},l=function l(e){var n=require("Lexical").$createTextNode(e.getTextContent());n.setFormat(e.getFormat()),e.replace(n);};return[e.registerNodeTransform(require("Lexical").TextNode,function(e){if(!e.isSimpleText())return;var r,u=e.getPreviousSibling(),c=e.getTextContent(),f=e;if(require("Lexical").$isTextNode(u)){var _t5=u.getTextContent(),_r2=n(_t5+c);if(s(u)){if(null===_r2||0!==function(t){return t.getLatest().__mode;}(u))return void l(u);{var _n4=_r2.end-_t5.length;if(_n4>0){var _r3=_t5+c.slice(0,_n4);if(u.select(),u.setTextContent(_r3),_n4===c.length)e.remove();else{var _t6=c.slice(_n4);e.setTextContent(_t6);}return;}}}else if(null===_r2||_r2.start<_t5.length)return;}var d=0;for(;;){var _f$splitText,_f$splitText2;r=n(c);var _e3=void 0,a=null===r?"":c.slice(r.end);if(c=a,""===a){var _e4=f.getNextSibling();if(require("Lexical").$isTextNode(_e4)){a=f.getTextContent()+_e4.getTextContent();var _t7=n(a);if(null===_t7)return void(s(_e4)?l(_e4):_e4.markDirty());if(0!==_t7.start)return;}}if(null===r)return;if(0===r.start&&require("Lexical").$isTextNode(u)&&u.isTextEntity()){d+=r.end;continue;}0===r.start?(_f$splitText=f.splitText(r.end),_e3=_f$splitText[0],f=_f$splitText[1],_f$splitText):(_f$splitText2=f.splitText(r.start+d,r.end+d),_e3=_f$splitText2[1],f=_f$splitText2[2],_f$splitText2),void 0===_e3&&o(165,"nodeToReplace");var x=i(_e3);if(x.setFormat(_e3.getFormat()),_e3.replace(x),null==f)return;d=0,u=x;}}),e.registerNodeTransform(r,function(e){var r=e.getTextContent(),o=n(r);if(null===o||0!==o.start)return void l(e);if(r.length>o.end)return void e.splitText(o.end);var i=e.getPreviousSibling();require("Lexical").$isTextNode(i)&&i.isTextEntity()&&(l(i),l(e));var u=e.getNextSibling();require("Lexical").$isTextNode(u)&&u.isTextEntity()&&(l(u),s(e)&&l(e));})];};}),null);
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 *
 * @fullSyntaxTransform
 * @es6-async_DO_NOT_USE
 * @generated SignedSource<<8d2c1867d26d8c559040a7b79c031005>>
 * 
 * @nolint
 * @oncall lexical_web_text_editor
 * @preserve-invariant-messages
 * @preserve-whitespace
 * @preventMunge
 */__d("LexicalUtils.prod",["Lexical","LexicalSelection"],(function $module_LexicalUtils_prod(global,require,requireDynamic,requireLazy,module,exports){

"use strict";function n(e){var n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams();r.append("code",e);for(var _len=arguments.length,t=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){t[_key-1]=arguments[_key];}for(var _e of t)r.append("v",_e);throw n.search=r.toString(),Error("Minified Lexical error #"+e+"; visit "+n.toString()+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.");}var r="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,o=r&&"documentMode"in document?document.documentMode:null,i=r&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),s=r&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),l=!(!r||!("InputEvent"in window)||o)&&"getTargetRanges"in new window.InputEvent("input"),a=r&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),c=r&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,u=r&&/Android/.test(navigator.userAgent),d=r&&/^(?=.*Chrome).*/i.test(navigator.userAgent),g=r&&u&&d,f=r&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&i&&!d;function p(){var t=[];for(var _len2=arguments.length,e=new Array(_len2),_key2=0;_key2<_len2;_key2++){e[_key2]=arguments[_key2];}for(var _n of e)if(_n&&"string"==typeof _n)for(var _ref2 of _n.matchAll(/\S+/g)){var _e2=_ref2[0];t.push(_e2);}return t;}function m(){for(var _len3=arguments.length,e=new Array(_len3),_key3=0;_key3<_len3;_key3++){e[_key3]=arguments[_key3];}return function(){for(var _t=e.length-1;_t>=0;_t--)e[_t]();e.length=0;};}function h(e){return e+"px";}var $={attributes:!0,characterData:!0,childList:!0,subtree:!0};function x(r,o,i){var s=null,l=null,a=null,c=[];var u=document.createElement("div");function d(){null===s&&n(182),null===l&&n(183);var _l$getBoundingClientR=l.getBoundingClientRect(),e=_l$getBoundingClientR.left,a=_l$getBoundingClientR.top,d=require("LexicalSelection").createRectsFromDOMRange(r,o);var g,f;u.isConnected||(f=u,(g=l).insertBefore(f,g.firstChild));var p=!1;for(var _t2=0;_t2<d.length;_t2++){var _n2=d[_t2],_r=c[_t2]||document.createElement("div"),_o=_r.style;"absolute"!==_o.position&&(_o.position="absolute",p=!0);var _i=h(_n2.left-e);_o.left!==_i&&(_o.left=_i,p=!0);var _s=h(_n2.top-a);_o.top!==_s&&(_r.style.top=_s,p=!0);var _l=h(_n2.width);_o.width!==_l&&(_r.style.width=_l,p=!0);var _g=h(_n2.height);_o.height!==_g&&(_r.style.height=_g,p=!0),_r.parentNode!==u&&(u.append(_r),p=!0),c[_t2]=_r;}for(;c.length>d.length;)c.pop();p&&i(c);}function g(){l=null,s=null,null!==a&&a.disconnect(),a=null,u.remove();for(var _e3 of c)_e3.remove();c=[];}u.style.position="relative";var f=r.registerRootListener(function t(){var n=r.getRootElement();if(null===n)return g();var o=n.parentElement;if(!require("Lexical").isHTMLElement(o))return g();g(),s=n,l=o,a=new MutationObserver(function(e){var n=r.getRootElement(),o=n&&n.parentElement;if(n!==s||o!==l)return t();for(var _t3 of e)if(!u.contains(_t3.target))return d();}),a.observe(o,$),d();});return function(){f(),g();};}function S(t,n,r){if("text"!==t.type&&require("Lexical").$isElementNode(n)){var _e4=n.getDOMSlot(r);return[_e4.element,_e4.getFirstChildOffset()+t.offset];}return[require("Lexical").getDOMTextNode(r)||r,t.offset];}function C(t,n){var r=null,o=null,i=null,s=null,l=null,a=null,c=function c(){};function u(u){u.read(function(){var u=require("Lexical").$getSelection();if(!require("Lexical").$isRangeSelection(u))return r=null,i=null,s=null,a=null,c(),void(c=function c(){});var _ref3=function(e){var t=e.getStartEndPoints();return e.isBackward()?[t[1],t[0]]:t;}(u),d=_ref3[0],g=_ref3[1],f=d.getNode(),p=f.getKey(),m=d.offset,$=g.getNode(),C=$.getKey(),E=g.offset,v=t.getElementByKey(p),N=t.getElementByKey(C),A=null===r||v!==o||m!==i||p!==r.getKey(),w=null===s||N!==l||E!==a||C!==s.getKey();if((A||w)&&null!==v&&null!==N){var _e5=function(e,t,n,r,o,i,s){var l=(e._window?e._window.document:document).createRange();return l.setStart.apply(l,S(t,n,r)),l.setEnd.apply(l,S(o,i,s)),l;}(t,d,f,v,g,$,N);c(),c=x(t,_e5,function(e){if(void 0===n)for(var _t4 of e){var _e6=_t4.style;"Highlight"!==_e6.background&&(_e6.background="Highlight"),"HighlightText"!==_e6.color&&(_e6.color="HighlightText"),_e6.marginTop!==h(-1.5)&&(_e6.marginTop=h(-1.5)),_e6.paddingTop!==h(4)&&(_e6.paddingTop=h(4)),_e6.paddingBottom!==h(0)&&(_e6.paddingBottom=h(0));}else n(e);});}r=f,o=v,i=m,s=$,l=N,a=E;});}return u(t.getEditorState()),m(t.registerUpdateListener(function(_ref4){var e=_ref4.editorState;return u(e);}),function(){c();});}var E=l,v=r,N=u,A=g,w=i,b=f,y=d,P=s,R=c,I=a;function O(e,t){for(var _n3 of t)if(e.type.startsWith(_n3))return!0;return!1;}function L(e,t){return T("next",e,t);}function M(t,n){var r=require("Lexical").$getAdjacentSiblingOrParentSiblingCaret(require("Lexical").$getSiblingCaret(t,n));return r&&r[0];}function T(t,n,r){var o=require("Lexical").$getRoot(),i=n||o,s=require("Lexical").$isElementNode(i)?require("Lexical").$getChildCaret(i,t):require("Lexical").$getSiblingCaret(i,t),l=_(i),a=r?require("Lexical").$getAdjacentChildCaret(require("Lexical").$getChildCaretOrSelf(require("Lexical").$getSiblingCaret(r,t)))||M(r,t):M(i,t);var c=l;return require("Lexical").makeStepwiseIterator({hasNext:function hasNext(e){return null!==e;},initial:s,map:function map(e){return{depth:c,node:e.origin};},step:function step(t){if(t.isSameNodeCaret(a))return null;require("Lexical").$isChildCaret(t)&&c++;var n=require("Lexical").$getAdjacentSiblingOrParentSiblingCaret(t);return!n||n[0].isSameNodeCaret(a)?null:(c+=n[1],n[0]);}});}function _(e){var t=-1;for(var _n4=e;null!==_n4;_n4=_n4.getParent())t++;return t;}function D(e,t){return T("previous",e,t);}function F(t,r,o){var i=require("Lexical").$getCaretInDirection(r,"next");for(var _t5=i;_t5;_t5=require("Lexical").$splitAtPointCaretNext(_t5,o))i=_t5;return require("Lexical").$isTextPointCaret(i)&&n(283),i.insert(t.isInline()?require("Lexical").$createParagraphNode().append(t):t),require("Lexical").$getCaretInDirection(require("Lexical").$getSiblingCaret(t.getLatest(),"next"),r.direction);}var B=!(P||!v)&&void 0;function j(t,n,r){var o=!1;var _loop=function _loop(_i2){n(_i2)?null!==r&&r(_i2):(o=!0,require("Lexical").$isElementNode(_i2)&&j(_i2,n,r||function(e){return _i2.insertAfter(e);}),_i2.remove());};for(var _i2 of k(t)){_loop(_i2);}return o;}function k(t){return H(require("Lexical").$getChildCaret(t,"previous"));}function H(t){return require("Lexical").makeStepwiseIterator({hasNext:require("Lexical").$isSiblingCaret,initial:t.getAdjacentCaret(),map:function map(e){return e.origin.getLatest();},step:function step(e){return e.getAdjacentCaret();}});}exports.$findMatchingParent=require("Lexical").$findMatchingParent,exports.$getAdjacentSiblingOrParentSiblingCaret=require("Lexical").$getAdjacentSiblingOrParentSiblingCaret,exports.$splitNode=require("Lexical").$splitNode,exports.isBlockDomNode=require("Lexical").isBlockDomNode,exports.isHTMLAnchorElement=require("Lexical").isHTMLAnchorElement,exports.isHTMLElement=require("Lexical").isHTMLElement,exports.isInlineDomNode=require("Lexical").isInlineDomNode,exports.$descendantsMatching=function(t,n){var r=[],o=Array.from(t).reverse();for(var _t6=o.pop();void 0!==_t6;_t6=o.pop())if(n(_t6))r.push(_t6);else if(require("Lexical").$isElementNode(_t6))for(var _e7 of k(_t6))o.push(_e7);return r;},exports.$dfs=function(e,t){return Array.from(L(e,t));},exports.$dfsIterator=L,exports.$filter=function(e,t){var n=[];for(var _r2=0;_r2<e.length;_r2++){var _o2=t(e[_r2]);null!==_o2&&n.push(_o2);}return n;},exports.$firstToLastIterator=function(t){return H(require("Lexical").$getChildCaret(t,"next"));},exports.$getAdjacentCaret=function(e){return e?e.getAdjacentCaret():null;},exports.$getDepth=_,exports.$getNearestBlockElementAncestorOrThrow=function(t){var r=require("Lexical").$findMatchingParent(t,function(t){return require("Lexical").$isElementNode(t)&&!t.isInline();});return require("Lexical").$isElementNode(r)||n(4,t.__key),r;},exports.$getNearestNodeOfType=function(e,t){var n=e;for(;null!=n;){if(n instanceof t)return n;n=n.getParent();}return null;},exports.$getNextRightPreorderNode=function(t){var n=require("Lexical").$getChildCaretOrSelf(require("Lexical").$getSiblingCaret(t,"previous")),r=require("Lexical").$getAdjacentSiblingOrParentSiblingCaret(n,"root");return r&&r[0].origin;},exports.$getNextSiblingOrParentSibling=function(t){var n=require("Lexical").$getAdjacentSiblingOrParentSiblingCaret(require("Lexical").$getSiblingCaret(t,"next"));return n&&[n[0].origin,n[1]];},exports.$insertFirst=function(t,n){require("Lexical").$getChildCaret(t,"next").insert(n);},exports.$insertNodeToNearestRoot=function(t){var n=require("Lexical").$getSelection()||require("Lexical").$getPreviousSelection();var r;if(require("Lexical").$isRangeSelection(n))r=require("Lexical").$caretFromPoint(n.focus,"next");else{if(null!=n){var _t7=n.getNodes(),_o3=_t7[_t7.length-1];_o3&&(r=require("Lexical").$getSiblingCaret(_o3,"next"));}r=r||require("Lexical").$getChildCaret(require("Lexical").$getRoot(),"previous").getFlipped().insert(require("Lexical").$createParagraphNode());}var o=F(t,r),i=require("Lexical").$getAdjacentChildCaret(o),s=require("Lexical").$isChildCaret(i)?require("Lexical").$normalizeCaret(i):o;return require("Lexical").$setSelectionFromCaretRange(require("Lexical").$getCollapsedCaretRange(s)),t.getLatest();},exports.$insertNodeToNearestRootAtCaret=F,exports.$isEditorIsNestedEditor=function(e){return null!==e._parentEditor;},exports.$lastToFirstIterator=k,exports.$restoreEditorState=function(t,n){var r=new Map(),o=t._pendingEditorState;for(var _ref6 of n._nodeMap){var _t8=_ref6[0];var _o4=_ref6[1];r.set(_t8,require("Lexical").$cloneWithProperties(_o4));}o&&(o._nodeMap=r),t._dirtyType=2;var i=n._selection;require("Lexical").$setSelection(null===i?null:i.clone());},exports.$reverseDfs=function(e,t){return Array.from(D(e,t));},exports.$reverseDfsIterator=D,exports.$unwrapAndFilterDescendants=function(e,t){return j(e,t,null);},exports.$unwrapNode=function(t){require("Lexical").$rewindSiblingCaret(require("Lexical").$getSiblingCaret(t,"next")).splice(1,t.getChildren());},exports.$wrapNodeInElement=function(e,t){var n=t();return e.replace(n),n.append(e),n;},exports.CAN_USE_BEFORE_INPUT=E,exports.CAN_USE_DOM=v,exports.IS_ANDROID=N,exports.IS_ANDROID_CHROME=A,exports.IS_APPLE=w,exports.IS_APPLE_WEBKIT=b,exports.IS_CHROME=y,exports.IS_FIREFOX=P,exports.IS_IOS=R,exports.IS_SAFARI=I,exports.addClassNamesToElement=function(e){var _e$classList;for(var _len4=arguments.length,t=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++){t[_key4-1]=arguments[_key4];}var n=p.apply(void 0,t);n.length>0&&(_e$classList=e.classList).add.apply(_e$classList,n);},exports.calculateZoomLevel=function(e,t){if(t===void 0){t=!1;}var n=1;if(function(){if(void 0===B){var _e8=document.createElement("div");_e8.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(_e8);var _t9=_e8.getBoundingClientRect();_e8.style.setProperty("zoom","2"),B=_e8.getBoundingClientRect().width===_t9.width,document.body.removeChild(_e8);}return B;}()||t)for(;e;)n*=Number(window.getComputedStyle(e).getPropertyValue("zoom")),e=e.parentElement;return n;},exports.isMimeType=O,exports.makeStateWrapper=function(t){var n=function n(_n5){return require("Lexical").$getState(_n5,t);},r=function r(n,_r3){return require("Lexical").$setState(n,t,_r3);};return{$get:n,$set:r,accessors:[n,r],makeGetterMethod:function makeGetterMethod(){return function(){return n(this);};},makeSetterMethod:function makeSetterMethod(){return function(e){return r(this,e);};},stateConfig:t};},exports.markSelection=C,exports.mediaFileReader=function(e,t){var n=e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();return new Promise(function(e,r){var o=[],_i3=function i(){var _n$next=n.next(),s=_n$next.done,l=_n$next.value;if(s)return e(o);var a=new FileReader();a.addEventListener("error",r),a.addEventListener("load",function(){var e=a.result;"string"==typeof e&&o.push({file:l,result:e}),_i3();}),O(l,t)?a.readAsDataURL(l):_i3();};_i3();});},exports.mergeRegister=m,exports.objectKlassEquals=function(e,t){return null!==e&&Object.getPrototypeOf(e).constructor.name===t.name;},exports.positionNodeOnRange=x,exports.registerNestedElementResolver=function(e,t,n,r){var o=function o(e){return e instanceof t;};return e.registerNodeTransform(t,function(e){var t=function(e){var t=e.getChildren();for(var _e9=0;_e9<t.length;_e9++){var _n6=t[_e9];if(o(_n6))return null;}var n=e,r=e;for(;null!==n;)if(r=n,n=n.getParent(),o(n))return{child:r,parent:n};return null;}(e);if(null!==t){var _o5=t.child,_i4=t.parent;if(_o5.is(e)){r(_i4,e);var _t0=_o5.getNextSiblings(),_s2=_t0.length;if(_i4.insertAfter(_o5),0!==_s2){var _e0=n(_i4);_o5.insertAfter(_e0);for(var _n7=0;_n7<_s2;_n7++)_e0.append(_t0[_n7]);}_i4.canBeEmpty()||0!==_i4.getChildrenSize()||_i4.remove();}}});},exports.removeClassNamesFromElement=function(e){var _e$classList2;for(var _len5=arguments.length,t=new Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){t[_key5-1]=arguments[_key5];}var n=p.apply(void 0,t);n.length>0&&(_e$classList2=e.classList).remove.apply(_e$classList2,n);},exports.selectionAlwaysOnDisplay=function(e,t){var n=null;var r=function r(){var r=getSelection(),o=r&&r.anchorNode,i=e.getRootElement();null!==o&&null!==i&&i.contains(o)?null!==n&&(n(),n=null):null===n&&(n=C(e,t));};return document.addEventListener("selectionchange",r),function(){null!==n&&n(),document.removeEventListener("selectionchange",r);};};}),null);
__d("cometComposerLexicalCreateEditor",["CometComposerNodes","FBLogger","Lexical","cometLexicalBaseTheme","mlcErrorHandler__INTERNAL"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=o("Lexical").createEditor({namespace:"CometPostComposer",nodes:o("CometComposerNodes").COMET_NODES,onError:function(n){return r("mlcErrorHandler__INTERNAL")(n,e,function(e){r("FBLogger")("CometComposer").catching(n).mustfix("Lexical Error Composer \u2013 "+e)})},theme:babelHelpers.extends({},r("cometLexicalBaseTheme"),{hashtag:"xv78j7m x1sy0etr",link:"x1fey0fg xmper1u x1edh9d7",paragraph:"xdj266r x14z9mp xat24cr x1lziwak x16tdsg8",placeholder:"xi81zsa x6ikm8r x10wlt62 x47corl x10l6tqk xlyipyv x13vifvy x87ps6o xuxw1ft"})});return e}l.default=e}),98);/*FB_PKG_DELIM*/
__d("EBGetContactEpochHead",["EBMinosSecureMailboxKeysForContact","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.rawContactId;if(t==null)return Promise.reject(o("WAResultOrError").makeError("invalid-arguments"));var n=await o("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(t);return n==null?o("WAResultOrError").makeResult():o("WAResultOrError").makeResult({epochHead:n.epoch_head,epochHeadCreationTime:n.epoch_head_creation_time})}l.getContactEpochHead=e}),98);
__d("EBGetMessageKeys",["EBMinosDb","FBLogger","WAResultOrError","WebMps","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(t,n){var e=await o("EBMinosDb").getEBMinosDb(),r=await e.runInTransaction(["secure_minos_message_epoch_heads"],"readonly",function(e){return e.stores.secure_minos_message_epoch_heads.readIndex("[thread_id+message_id]",[t,n])},"LoadNewMinosMessageEpochHead");return r.length===0?null:{epochHead:r[0].epoch_head}};async function u(t){var n=t.messageId,a=t.threadId;try{if(n==null||a==null)return o("WAResultOrError").makeError("invalid-arguments");var i=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"get-message-keys"},messageId:n,threadId:a}),l=await s(a,n);if(l==null)return o("WAResultOrError").makeError("no-epoch-head-found");if(i.success===!1)return o("WAResultOrError").makeError(i.error);var u=i.value;if(u==null)return o("WAResultOrError").makeError("no-message");var c=new Map;await Promise.all(Array.from(u.supplementalProtobufs).map(async function(e){var t=e[0],n=e[1],r=await s(a,n.messageId);if(r==null)return o("WAResultOrError").makeError("no-epoch-head-found");c.set(t,babelHelpers.extends({},n,{senderEpochHead:r.epochHead}))}));var d=babelHelpers.extends({},u.toplevelProtobuf,{senderEpochHead:l.epochHead});return o("WAResultOrError").makeResult(babelHelpers.extends({},u,{supplementalProtobufs:c,toplevelProtobuf:d}))}catch(t){throw r("FBLogger")("wmi_minos").catching(r("getErrorSafe")(t)).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Runtime error in EBGetMessageKeys"]))),t}}l.getMessageKeys=u}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWGetUserDeviceChangeAdminType","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e={add:"add",remove:"remove",update:"update"};function s(e,t,n,a,i){return o("MAWDbMsgTxns").getIsThreadEmpty(e,n.jid).then(function(l){if(l)return o("MAWDexieTable").dexieResolve();var s=t===o("MAWUserJidWrapper").getMyUserJid(),u=o("MAWGetUserDeviceChangeAdminType").getUserDeviceAdminType(a,s),c=s?[]:[o("WAJids").userIdFromJid(t)],d=o("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:c,adminType:u,version:1},n.jid,o("MAWExternalId").generateExternalId(),i);return o("MAWWriteMsgTxns").writeMsg(e,d,n).then(r("emptyFunction"))})}function u(e,t,n,a){var i=o("MAWAdminMsgHelpers").UNKNOWN_USER,l=t===o("MAWUserJidWrapper").getMyUserJid(),s={ack:o("MAWAckLevel").ACK.received,altIndex:void 0,author:l?o("WAJids").AUTHOR_ME:t,externalId:o("MAWExternalId").generateExternalId(),msgContent:{adminType:o("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:i},threadJid:n.jid,ts:a!=null?a:o("WATimeUtils").unixTime(),type:o("MAWMsgType").MSG_TYPE.ICDC_ALERT};return o("MAWWriteMsgTxns").writeMsg(e,s,n).then(r("emptyFunction"))}l.DeviceChange=e,l.writeUserDeviceAdminMsg=s,l.writeICDCAlert=u}),98);
__d("MpsFutureProofKey",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({WCEPlaintextPayloadFutureProofPlaceholder:0,WCEPlaintextPayloadFutureProofNoPlaceholder:1,WCEPlaintextPayloadFutureProofIgnore:2});i.WCEPlaintextPayloadFutureProof=e}),66);
__d("WABuildMpsPayload",["MpsFutureProofKey","MpsTypes","WAArmadilloBackupMessage.pb","WAArmadilloMiTransportAdminMessage.pb","WAArmadilloTransportEvent.pb","WAGlobals","WAJids","WALogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;function c(e,t){var n=o("WAJids").extractUserId(t.senderJid),r;t.hideDecryptionFailure!=null&&(r=t.hideDecryptionFailure?o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder:o("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofPlaceholder);var a=o("encodeProtobuf").encodeProtobuf(o("WAArmadilloBackupMessage.pb").BackupMessageSpec,babelHelpers.extends({},e,{metadata:{frankingMetadata:{frankingTag:t.frankingTag,reportingTag:t.reportingTag},messageId:t.externalId,payloadVersion:2,senderId:n,futureProofBehavior:r,timestampMs:t.timestampMs}})).readBuffer();return a}function d(e,t){var n=o("WAJids").extractUserId(t.senderJid),r=o("MpsTypes").toThreadId(t.threadId),a=t.millisServerTs!=null?t.millisServerTs:t.serverTs*1e3+o("WAGlobals").getDependencies().extractMsFromStanzaId(t.externalId),i=c(e,{senderJid:t.senderJid,externalId:t.externalId,frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:t.threadId,timestampMs:o("MpsTypes").toTimestamp(a)});return{messageId:o("MpsTypes").toMessageId(t.externalId),payload:o("MpsTypes").toBytes(i),senderId:n,threadId:r,timestampMs:o("MpsTypes").toTimestamp(a)}}function m(t,n,r){try{var a={};switch(r.type){case"message":a={encryptedTransportMessage:r.applicationPayload};break;case"ciphertext":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;case"unavailable":a={encryptedTransportEvent:{payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{placeholder:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Placeholder$Type.DECRYPTION_FAILURE}}).readBuffer(),version:3}};break;default:r.type}var i=n.type==="Available"?n.originalMsgTimestampMs:null;return d(a,babelHelpers.extends({senderJid:o("WAJids").extractUserJid(n.from),externalId:t.stanzaId},i!=null?{millisServerTs:o("WATimeUtils").castToMillisTime(i)}:{serverTs:t.serverTs},{frankingTag:t.frankingTag,reportingTag:t.reportingTag,hideDecryptionFailure:t.hideDecryptionFailure,threadId:n.chat}))}catch(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["buildMpsMessagePayload: ",""])),t),null}}function p(e,t,n){if(n.payload==null)return o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: No appdata payload"]))),null;try{return d({encryptedTransportMessage:n.payload},{senderJid:o("WAJids").extractUserJid(e.from),externalId:e.stanzaId,serverTs:t,threadId:o("WAJids").extractUserJid(e.from)})}catch(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["buildMpsAppdataPayload: ",""])),e),null}}function _(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupMembershipAddModeChanged:{mode:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function f(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupAdminChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function g(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupParticipantChanged:{targetUserId:n.map(o("WAJids").extractUserId),action:r}}).readBuffer(),version:3};return d({miTransportAdminMessage:l},{serverTs:a!=null?a:o("WATimeUtils").unixTime(),externalId:i,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function h(e,t,n,r,a){var i={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,{groupNameChanged:{groupName:n}}).readBuffer(),version:3};return d({miTransportAdminMessage:i},{serverTs:r!=null?r:o("WATimeUtils").unixTime(),externalId:a,hideDecryptionFailure:!1,senderJid:t,threadId:e})}function y(e,t,n){var r={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{icdcAlert:{type:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$IcdcAlert$Type.DETECTED}}}).readBuffer(),version:3};return d({encryptedTransportEvent:r},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}function C(e,t,n,r,a,i){var l={payload:o("encodeProtobuf").encodeProtobuf(o("WAArmadilloTransportEvent.pb").TransportEventSpec,{event:{deviceChange:{type:r,devicePlatform:a,deviceModel:i}}}).readBuffer(),version:3};return d({encryptedTransportEvent:l},{serverTs:t!=null?t:o("WATimeUtils").unixTime(),externalId:n,hideDecryptionFailure:!1,senderJid:e,threadId:e})}l.buildBackupProtobufBytes=c,l.buildMpsMessage=d,l.buildMpsMessageFromIncomingMessage=m,l.buildMpsAppdataPayload=p,l.buildMpsGroupMemberAddType=_,l.buildMpsGroupAdminChangedMsg=f,l.buildMpsGroupParticipantsChanged=g,l.buildMpsGroupNameChangedMsg=h,l.buildMpsIcdcAdminMessage=y,l.buildMpsDeviceChangeAdminMessage=C}),98);
__d("EBMinosWriteKeyChangeAdminMessage",["EBMinosTypes","FBLogger","MAWAdminWriteUserDeviceMsgTxn","MAWBridge","MAWDbAppMeta","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWTransactionMode","MpsTypes","WAArmadilloTransportEvent.pb","WABuildMpsPayload","WADbContact","WAGlobals","WAJids","WAStanzaUtils","WebMps","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e){return e.appMeta.get({key:o("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert}).then(function(e){var t;return(t=e==null?void 0:e.value.allowSecurityAlert)!=null?t:!1})}function u(e,t){var n=o("WAGlobals").getMyUserJid()===t;return!n&&e}async function c(e){var t=e.deviceChangeType,n=t===void 0?o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED:t,a=e.epochHeadCreationTime,i=e.userJid;try{var l=o("MAWExternalId").generateExternalId(),s=o("WABuildMpsPayload").buildMpsDeviceChangeAdminMessage(i,a,o("WAStanzaUtils").toStanzaId(l),n),u={directive:null,insertionSource:o("MpsTypes").InsertionSource.Receive,message:s};await o("WebMps").mps().saveNewMessages([u],{source:"eb-minos-device-change"}),r("FBLogger")("wmi_minos").info("Sent device change transport event for user %s with type %s",i,String(n))}catch(e){var c=r("getErrorSafe")(e);throw r("FBLogger")("wmi_minos").catching(c).mustfix("Failed to send device change transport event for user %s",i),c}}async function d(t){var n=t.contactId,a=t.epochHeadCreationTime,i=o("EBMinosTypes").userFbidToUserJid(n);if(i==null)return r("FBLogger")("wmi_minos").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Invalid userJid generated in writeKeyChangeAdminMessage"]))),Promise.resolve();var l=await o("MAWIndexedDb").makeMsgrTransactor({participants:o("MAWTransactionMode").READONLY,threads:o("MAWTransactionMode").READONLY},"writeKeyChangeAdminMessage",function(e){return function(){return o("MAWDbThreadTxns").getAllThreadsForUsers(e,[i])}})(),d=l.get(i),m=await o("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersRelationships",{users:[i]});if(d==null||(d==null?void 0:d.length)===0)return Promise.resolve();var p=d.filter(function(e){var t=o("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(){return"group"},user:function(){return"one_to_one"}});return t==="one_to_one"}),_=await Promise.all([c({deviceChangeType:o("WAArmadilloTransportEvent.pb").TransportEvent$Event$DeviceChange$Type.REPLACED,epochHeadCreationTime:a,userJid:i}),o("MAWIndexedDb").makeMsgrTransactor({appMeta:o("MAWTransactionMode").READONLY,ftsBackloggedMessages:o("MAWTransactionMode").READWRITE,groupInfo:o("MAWTransactionMode").READONLY,messages:o("MAWTransactionMode").READWRITE,threads:o("MAWTransactionMode").READWRITE},"writeKeyChangeAdminMessage",function(e){return function(){return o("MAWDexieTable").dexieAll(p.map(function(t){return s(e).then(function(n){u(n,i)&&m.get(i)===o("WADbContact").TWO_WAY_CONTACT?o("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(e,i,t,"update",a):o("MAWDexieTable").dexieResolve()})}))}})()]),f=_[1];return f}l.saveDeviceChangeTransportEvent=c,l.writeMinosKeyChangeAdminMessage=d}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return e.deviceChangeAlerts.add(t)}i.addDeviceChangeAlertsTxn=e}),66);
__d("MAWDbDeviceChangeAlerts",[],(function(t,n,r,o,a,i){"use strict";var e="add",l="keyChange",s="remove";function u(e){return e}i.ADD=e,i.KEY_CHANGE=l,i.REMOVE=s,i.unsafeCoerceToDeviceChangeAlertsID=u}),66);
__d("WAXmlParsingFailure",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t){this.parser=e,this.reason=t}var t=e.prototype;return t.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason},e})();i.XmlParsingFailure=e}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){throw new TypeError('"'+e+'" is read-only')}var s=(function(){function e(e,t){var n=this;this.$1=e,this.$2=t,this.$3=Array.isArray(t.content)?t.content.map(function(t){return new n.constructor(e,t)}):null}var t=e.prototype;return t.name=function(){return this.$1},t.node=function(){return this.$2},t.hasAttr=function(t){return r("WAHasProperty")(this.$2.attrs,t)},t.assertTag=function(t){this.$2.tag!==t&&this.throw("to be <"+t+">")},t.tag=function(){return this.$2.tag},t.maybeChild=function(t){var e=this.$3;if(!e)return null;for(var n=0;n<e.length;n++)if(e[n].tag()===t)return e[n];return null},t.hasChild=function(t){return!!this.maybeChild(t)},t.child=function(t){var e=this.maybeChild(t);return e||this.throw("to have child <"+t+">")},t.assertAttr=function(t,n){var e=this.attrString(t);e!==n&&this.throw('to have "'+t+'"="'+n+'", but instead has "'+e+'"')},t.attrString=function(t){return r("WAHasProperty")(this.$2.attrs,t)?this.decodeAsString(this.$2.attrs[t]):this.throw('to have attribute "'+t+'"')},t.forEachAttributeKey=function(t){var e=this.$2.attrs;Object.keys(e).forEach(function(e){return t(e)})},t.maybeAttrString=function(t){return this.hasAttr(t)?this.decodeAsString(this.$2.attrs[t]):null},t.maybeAttrInt=function(t,n,r){return this.hasAttr(t)?this.attrInt(t,n,r):null},t.attrEnumValues=function(t,n,r){var e=new Set(n),o=this.attrString(t);if(!e.has(o)){if(r!=null)return r;var a=Array.from(e).join("|");return this.throw('to have "'+t+'"={'+a+'} but has value "'+o+'"')}return o},t.attrEnum=function(t,n){var e=this.attrString(t);if(!r("WAHasProperty")(n,e)){var o=Object.keys(n).join("|");return this.throw('to have "'+t+'"={'+o+'} but has value "'+e+'"')}return n[e]},t.attrEnumOrNullIfUnknown=function(t,n){var e=this.attrString(t);return r("WAHasProperty")(n,e)?n[e]:null},t.maybeAttrEnum=function(t,n){return this.hasAttr(t)?this.attrEnum(t,n):null},t.attrInt=function(t,n,r){var e=this.attrString(t);return this.$4(e,t,n,r)},t.$4=function(t,n,r,o){var e=parseInt(t,10);return Number.isNaN(e)?this.throw('to have "'+n+'"={integer} but has value "'+t+'"'):r!==void 0&&e<r?this.throw('to have "'+n+'"={at least '+r+"} but has value "+e):o!==void 0&&e>=o?this.throw('to have "'+n+'"={below '+o+"} but has value "+e):e},t.forEachChild=function(t){var e=this.$3;if(e)e.forEach(function(e){return t(e)});else if(this.$2.content!=null)return this.throw("to have children")},t.forEachChildWithTag=function(t,n){this.forEachChild(function(e){e.tag()===t&&n(e)})},t.mapChildren=function(t){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.map(function(e){return t(e)}):[]},t.mapChildrenWithTag=function(t,n){var e=this.$3;return!e&&this.$2.content!=null?this.throw("to have children"):e?e.filter(function(e){return e.tag()===t}).map(function(e){return n(e)}):[]},t.mapFirstChild=function(t){var e=this.$3;return!e||e.length===0?this.throw("to have children"):t(e[0])},t.hasContent=function(){return!this.$3&&!!this.$2.content},t.hasChildren=function(){return this.$3!=null},t.getChildren=function(){return this.$3},t.mapAttrKeys=function(t){var e=this.getAttrKeys();return e&&e.length?e.map(t):[]},t.getAttrKeys=function(){return Object.keys(this.$2.attrs)},t.hasAttrs=function(){var e=this.$2.attrs?Object.keys(this.$2.attrs):[];return e.length>0},t.getNode=function(){return this.$2},t.unsafeSetChildren=function(t){this.$3=t},t.unsafeSetNodeContent=function(t){this.$2.content=t},t.contentUint=function(t){var e=this.contentBytes(t);return u(e,t)},t.contentBytes=function(t){if(t===void 0&&(t=-1),this.$3)return this.throw("to have binary content, but has children instead");if(this.$2.content!=null){var e=this.$2.content;return t!==-1&&e.length!==t?this.throw("to be "+t+" bytes, but got "+e.length+" instead"):e}else return this.throw("to have content")},t.contentString=function(){return this.$3?this.throw("to have string content, but has children instead"):this.$2.content!=null?this.$2.content:this.throw("to have content")},t.contentInt=function(t,n){var e=this.contentString();return this.$4(e,"content",t,n)},t.contentEnum=function(t){var e=this.contentString();if(!r("WAHasProperty")(t,e)){var n=Object.keys(t).join("|");return this.throw("to have content {"+n+'} but has value "'+e+'"')}return t[e]},t.decodeAsString=function(t){if(typeof t!="string")throw r("err")("decodeAsString: attribute is "+typeof t+" not a string: "+t);return t},t.throw=function(t){throw new(o("WAXmlParsingFailure")).XmlParsingFailure(this.$1,"expected <"+this.$2.tag+"> "+t)},t.toString=function(){return this.$2.toString()},e})();function u(e,t){for(var n=0,r=0;r<t;r++)n=n*256+e[r];return n}l.ParsableXmlNode=s,l.convertBytesToUint=u}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e={name:"AES-CBC"},s={name:"HMAC",hash:"SHA-256"};function u(e,t){if(e.length!==t)throw r("err")("Signal expected "+t+" bytes, given "+e.length);return e}function c(e,t){return u(new Uint8Array(e),t)}function d(e){var t=e.buffer,n=e.byteOffset,r=e.length;return n===0&&r===t.byteLength?t:t.slice(n,n+r)}function m(e,t){return e.readByteArrayView(t)}function p(e){return new Uint8Array(e)}function _(e,t,n){if(e.length-t<n)throw r("err")("Can not split off "+n+" bytes from index "+t+" of "+e.length+" bytes");return e.slice(t,t+n)}function f(e){var t=e==="extendedRange"?2147483646:16380;return o("WACryptoUtils").randomNumberLessThan(t)+1}function g(e){return b(e)}function h(e){return o("WAParsableXmlNode").convertBytesToUint(e,4)}function y(){var e=2147483647;return o("WACryptoUtils").randomNumberLessThan(e)+1}function C(e){return b(e)}function b(e,t,n){if(t===void 0&&(t=0),n===void 0&&(n=4294967296),typeof e=="number"&&t<=e&&e<n&&Math.floor(e)===e)return e;throw r("err")("Expected integer in range ["+t+", "+n+"), given "+String(e))}function v(e,t){return o("encodeProtobuf").encodeProtobuf(e,t).readByteArrayView()}function S(e,t,n){return n(o("decodeProtobuf").decodeProtobuf(e,t))}function R(e,t,n,r){return o("WACryptoHkdf").extractWithSaltAndExpand(e,t,n,r).then(function(e){return new Uint8Array(e)})}function L(t,n){var r,a;return n==="hmac-sha256"?(r=s,a=["sign"]):(r=e,a=["encrypt","decrypt"]),o("WACryptoDependencies").getCrypto().subtle.importKey("raw",t,r,!1,a)}function E(e){return e}function k(e){return e}function I(e,t){return o("WACryptoUtils").arrayBuffersEqual(e,t)}l.AES_CBC=e,l.HMAC_SHA256=s,l.ensureSize=u,l.toBytes=c,l.toBuffer=d,l.readBytes=m,l.makeBytes=p,l.sliceBytes=_,l.makeRegistrationId=f,l.castRegistrationId=g,l.castRegistrationIdFromBytes=h,l.makeSenderKeyId=y,l.castSenderKeyId=C,l.ensureIntInRange=b,l.encodeSignalProto=v,l.decodeSignalProto=S,l.hkdf=R,l.makeCryptoKey=L,l.castToByteEncoded=E,l.castToSessionHash=k,l.areSessionHashesEqual=I}),98);
__d("EBMinosWriteSecureStorageAlert",["EBMinosTypes","FBLogger","MAWDbAddDeviceChangeAlertsTxn","MAWDbDeviceChangeAlerts","MAWIndexedDb","MAWTransactionMode","MAWUnsafeCoerce","Promise","WAJids","WASignalOther"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){var a=t.contactId,i=t.epochHead,l=t.epochHeadCreationTime,u=o("WAJids").validateDeviceJid(o("EBMinosTypes").userFbidToUserJid(o("EBMinosTypes").unsafeCastToUserFbId(a)));return u==null?(r("FBLogger")("wmi_minos").MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Invalid deviceJid generated in writeMinosSecureStorageAlert"]))),(s||(s=n("Promise"))).resolve()):o("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:o("MAWTransactionMode").READWRITE},"writeMinosSecureStorageAlert",function(e){return function(){return o("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(e,{action:o("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:u,epochHead:i,identity:o("MAWUnsafeCoerce").unsafeCoerce(o("WASignalOther").toBytes(i,32)),isArchived:!1,model:"secure_storage",platform:"Meta",ts:l})}})()}l.writeMinosSecureStorageAlert=u}),98);
__d("EncryptedBackupsResignCdnUrl",["MAWBridge","MAWConfig","MAWLoggerUtils","WAJids","WAPromiseDelays","WAResolvable","WAResultOrError","cr:10071","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map;function u(e){return s.get(e)}function c(t){var n=t.deliveryObjectId,r=t.logger,a=t.mediaDownloadFlow,i=t.mediaKey,l=t.mediaType,s=t.msgId,u=t.protocolMsgId,c=t.sortOrderMs;return a.addPoint("resign_cdn_url_start"),d({deliveryObjectId:n,mediaDownloadFlow:{addAnnotations:function(t){a==null||a.addAnnotations(babelHelpers.extends({},t))},addPoint:function(t,n){a==null||a.addPoint(t,babelHelpers.extends({},n))}},mediaKey:i,mediaType:l,msgId:s,protocolMsgId:u,sortOrderMs:c}).then(function(e){return e.success?(a==null||a.addPoint("resign_cdn_url_end"),e):(a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:e.error}}),e)}).catch(function(t){return r.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["resignCdnUrl runtime-error: ",""])),t),a.addPoint("resign_cdn_url_fail",{string:{resignCdnUrlFailReason:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),o("WAResultOrError").makeError("resign-cdn-url-runtime-error")})}async function d(e){var t=e.deliveryObjectId,r=e.mediaDownloadFlow,a=e.mediaKey,i=e.mediaType,l=e.msgId,u=e.protocolMsgId,c=e.sortOrderMs;if(n("cr:10071")!==null){var d=await n("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:u.chat,deliveryObjectId:t,externalId:u.externalId,mediaDownloadFlow:r,mediaKey:a,mediaType:i,sortOrderMs:c});return d.success?o("WAResultOrError").makeResult(d.value):d}else{var m=o("MAWLoggerUtils").getInstanceKey(),p=new(o("WAResolvable")).Resolvable;return s.set(m,p),o("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"ResignAttachmentCDNUrl",value:{deliveryObjectId:t,mediaType:i,messageId:u.externalId,msgId:l,productType:o("MAWConfig").getConfig().productTypeForEBAttachments,skipLegacyMediaDownloadFlow:!0,sortOrder:c,threadId:o("WAJids").threadIdForChatJid(u.chat),threadJid:u.chat,traceId:m}}]}),o("WAPromiseDelays").withTimeout(p.promise,900*1e3,function(){return o("WAResultOrError").makeError("resign-cdn-url-timeout")}).finally(function(){s.delete(m)})}}l.getRestoredCdnUrlResolvable=u,l.resignCdnUrl=c}),98);
__d("WADbTransactor",["MAWDexie","MAWIndexedDb","MAWTransactionMode","WAExceededStorageQuota","err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=Object.keys(e),a=r.some(function(t){return e[t]===o("MAWTransactionMode").READWRITE})?o("MAWTransactionMode").READWRITE:o("MAWTransactionMode").READONLY;return function(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];return o("MAWIndexedDb").getSignalDB(t).then(function(e){return s(a,r,function(){return n(e.stores).apply(void 0,i)})}).then(function(e){return e}).catch(function(e){throw d(e,t)})}}function s(e,t,n){if(r("MAWDexie").currentTransaction!=null)throw r("err")("protocolDB transactor %s cannot be called within another transaction");return o("MAWIndexedDb").getSignalDB().then(function(r){return r.transact(e,t,n)})}function u(e){return e instanceof Error?e:typeof e=="string"?r("err")(e):null}async function c(e,t,n,r){var a=e+"_"+r,i=await o("MAWIndexedDb").getDB(a);return i.transact(t,[e],function(){return n(i.stores[e])}).then(function(e){return e}).catch(function(e){throw d(e,a)})}function d(e,t){var n;o("WAExceededStorageQuota").checkQuotaExceededError(e);var a=u(e);return a?(a.message="["+((n=a==null?void 0:a.toString())!=null?n:"unknown error")+"] Error performing %s transaction "+t,a):r("err")("[unknown error] Error performing %s transaction "+t)}l.makeSignalTransactor=e,l.persistedQueueTransactor=c}),98);
__d("WAClearSignalStores",["MAWDexieTable","MAWTransactionMode","WADbTransactor"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({tasks:o("MAWTransactionMode").READWRITE},"clearSignalStores",function(e){return function(){return o("MAWDexieTable").dexieAll([e.tasks.clear()]).then(function(){})}});l.clearSignalStores=e}),98);
__d("WAClearSignalStoresV2",["WASignalDB"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return o("WASignalDB").getDb().runInTransaction(["identity","contacts","meta","prekey","prekeyGeneration","senderKeySessions","session","signedPrekey","personalSenderKeyStatuses"],"readwrite",async function(e){await Promise.all([e.stores.identity.clear(),e.stores.contacts.clear(),e.stores.meta.clear(),e.stores.prekey.clear(),e.stores.prekeyGeneration.clear(),e.stores.senderKeySessions.clear(),e.stores.session.clear(),e.stores.signedPrekey.clear(),e.stores.personalSenderKeyStatuses.clear()])},o("WASignalDB").signalOp("clearSignalStores"))};l.clearSignalStores=e}),98);
__d("MAWClearSignalAndTempStores",["MAWDeleteOldLogsFromDisk","MAWJobActionsV2","MAWJobsIndexedDb","MAWLoggingSwitches","MAWTransactionMode","Promise","WAClearSignalStores","WAClearSignalStoresV2","emptyFunction"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MAWJobsIndexedDb").makeJobsTransactor("jobs",o("MAWTransactionMode").READWRITE,"clearJob")(o("MAWJobActionsV2").clearJobs),u=function(){return(e||(e=n("Promise"))).all([o("MAWLoggingSwitches").removeLoggingFromBridge&&o("MAWDeleteOldLogsFromDisk").clearLogs(),o("WAClearSignalStores").clearSignalStores(),s(),o("WAClearSignalStoresV2").clearSignalStores()]).then(r("emptyFunction"))};l.clearSignalAndTempStores=u}),98);
__d("MAWCreateMaybeAddPointForMediaRender",["MAWQplProxy","qpl"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return function(t,n){e!=null&&o("MAWQplProxy").sendQplPointThroughBridge(r("qpl")._(25302828,"2195"),t,{annotations:n,instanceKey:e},!0)}}l.createMaybeAddPointForMediaRender=e}),98);
__d("WAFindMostRecentMediaEntry",["WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null;for(var n of e){var r,a,i=n[0],l=n[1],s=o("WAMediaUtils").decodeMediaEntryData(l);(((r=t)==null?void 0:r[1].mediaKeyTimestamp)==null||s.mediaKeyTimestamp!=null&&s.mediaKeyTimestamp>((a=t)==null?void 0:a[1].mediaKeyTimestamp))&&(t=[i,s])}return t!=null?o("WAResultOrError").makeResult(t):o("WAResultOrError").makeError("no-media-entry")}l.findMostRecentMediaEntry=e}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","MWFBLogger","WAFindMostRecentMediaEntry","WAHashUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("MWFBLogger").MWMediaLogger().tags(["getMostRecentDecodedMediaEntry"]),u=o("MAWIndexedDb").makeMsgrTransactor({media:o("MAWTransactionMode").READONLY},"getMediaEntries",function(t){return function(n){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(t,n).then(function(t){return t?o("WAResultOrError").makeResult(t.mediaEntries):(s.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."])),o("WAHashUtils").sanitisePlaintextHash(n)),o("WAResultOrError").makeError("no-media-by-plaintext-hash"))})}});async function c(e){var t=await u(e);if(t.success===!1)return t;var n=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(t.value);return n.success===!1?n:o("WAResultOrError").makeResult(n.value[1])}l.getMediaEntries=u,l.getMostRecentDecodedMediaEntry=c}),98);
__d("MAWGetProtocolMsgIdAndSortOrderMsApi",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MAWIndexedDb").makeMsgrTransactor({messages:o("MAWTransactionMode").READONLY},"getProtocolMsgIdAndSortOrderMs",function(e){return function(t){return e.messages.get({msgId:t}).then(function(e){if(e==null)return null;var t=e.sortOrderMs;if(t==null||o("WAJids").isAuthorSystem(e.author))return null;var n={author:e.author,chat:e.threadJid,externalId:e.externalId};return{protocolMsgId:n,sortOrderMs:t}})}});l.getProtocolMsgIdAndSortOrderMs=e}),98);
__d("WATypedArraysConcat",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){n===void 0&&(n=0);var r=t.reduce(function(e,t){return e+t.length},n),o=new e(r),a=0;return t.forEach(function(e){o.set(e,a),a+=e.length}),o}i.concatTypedArrays=e}),66);
__d("WACryptoAesCbc",["WABinary","WACryptoDependencies","WAPromiseDelays","WATypedArraysCast","WATypedArraysConcat","err"],(function(t,n,r,o,a,i,l){"use strict";var e=16,s=1024,u=16,c=1024*1024,d=e*c,m=(function(){function t(e,t,n,r){this.$4=null,this.$6=!1,this.$1=e,this.$2=t,this.$3=n;var a={name:"AES-CBC",iv:r};this.$5=o("WACryptoDependencies").getCrypto().subtle.importKey("raw",n,"AES-CBC",!1,[t]).then(function(e){return{algo:a,key:e}})}var n=t.prototype;return n.append=function(n){var t=this;this.$7("append");var r,a=this.$4;if(a)if(a.writeByteArray(n),a.size()>s){var i=a.size()%e;r=a.readByteArrayView(a.size()-i),a.size()||(this.$4=null)}else r=null;else if(n.length>s){var l=n.length%e;l?(this.$4=new(o("WABinary")).Binary(n),r=this.$4.readByteArrayView(n.length-l)):r=n}else this.$4=new(o("WABinary")).Binary(n),r=null;var u=r;return u&&(this.$5=this.$5.then(function(n){var r=n.algo,a=n.key;if(t.$2==="encrypt")return o("WACryptoDependencies").getCrypto().subtle.encrypt(r,a,u).then(function(n){return t.$1.writeByteArray(new Uint8Array(n,0,n.byteLength-e)),new Uint8Array(n,n.byteLength-2*e,e)});var i=u.slice(-e);return o("WACryptoDependencies").getCrypto().subtle.decrypt(r,a,u).then(function(e){return t.$1.writeBuffer(e),i})}).then(function(e){var n={name:"AES-CBC",iv:e};return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",t.$3,"AES-CBC",!1,[t.$2]).then(function(e){return{algo:n,key:e}})})),this.$5.then(function(){})},n.finalize=function(t){var e=this;this.$7("finalize");var n;if(this.$4){var r=this.$4;t&&r.writeByteArray(t),n=r.readByteArrayView(),this.$4=null}else t&&(n=t);if(n){var a=n;return this.$5.then(function(t){var n=t.algo,r=t.key;return e.$2==="encrypt"?o("WACryptoDependencies").getCrypto().subtle.encrypt(n,r,a):o("WACryptoDependencies").getCrypto().subtle.decrypt(n,r,a)}).then(function(t){e.$1.writeBuffer(t)})}else return this.$5.then(function(){})},n.$7=function(t){if(this.$6)throw r("err")("AesCbcStream."+t+" called after finalize")},t})();function p(e){return{name:"AES-CBC",iv:o("WATypedArraysCast").castTypedArrays(Uint8Array,e)}}function _(e){return o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function f(e){if(e)return o("WATypedArraysCast").castTypedArrays(Uint8Array,e);var t=new Uint8Array(u);return o("WACryptoDependencies").getCrypto().getRandomValues(t),t}function g(t){var n=t.byteLength,r=e-n%e;return Number.isNaN(r)?n:n+r}function h(e,t,n){var r=p(t);return Promise.resolve(o("WACryptoDependencies").getCrypto().subtle.importKey("raw",o("WATypedArraysCast").castTypedArrays(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.decrypt(r,e,n)})}function y(e,t){return Promise.resolve().then(function(){var n=t.slice(0,u),r=t.slice(u);return h(e,n,r)})}function C(e,t,n){return Promise.resolve().then(function(){var r=f(n),a=p(r);return Promise.resolve(_(e)).then(function(e){return o("WACryptoDependencies").getCrypto().subtle.encrypt(a,e,t)}).then(function(e){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[r,new Uint8Array(e)]).buffer})})}async function b(t){var n=t.encKey,a=t.plaintext,i=t.optionalIv,l=t.chunkSize,s=l===void 0?d:l,u=t.delayInBetween,c=u===void 0?!1:u;if(s%e!==0)throw r("err")("chunkSize must be a multiple of "+e+", "+s+" received");var m=await _(n),p=new Uint8Array(a),h=Math.ceil(p.byteLength/s),y=f(i),C=new Uint8Array(g(p)+y.byteLength);C.set(y);for(var b=0,S=y,R;b<h;b++){var L=b===h-1,E=b*s;R=p.subarray(E,E+s);var k=await v(L,R,S,m),I=k.encryptedChunk,T=k.nextIv;C.set(I,y.byteLength+b*s),S=T,c===!0&&await o("WAPromiseDelays").releaseToMainThread()}return C.buffer}async function v(t,n,r,a){var i=await o("WACryptoDependencies").getCrypto().subtle.encrypt(p(r),a,n).then(function(n){return t?new Uint8Array(n):new Uint8Array(n).subarray(0,-e)}),l=i.slice(-e);return{encryptedChunk:i,nextIv:l}}l.AES_CBC_BLOCK_SIZE=e,l.AesCbcStream=m,l.importRawKey=_,l.getIv=f,l.aesCbcDecrypt=h,l.aesCbcDecryptSplit=y,l.aesCbcEncrypt=C,l.aesCbcEncryptWithChunking=b,l.aesCbcEncryptChunk=v}),98);
__d("WAConcurrentIterate",[],(function(t,n,r,o,a,i){"use strict";function e(e,t,n){for(var r=[],o=[],a=0,i=async function(){for(;a<e;){var n=a;a++,o[n]=await t(n)}},l=Math.min(e,n),s=0;s<l;s++)r.push(i());return Promise.all(r).then(function(){return o})}i.concurrentIterate=e}),66);
__d("WAMediaCryptoSidecar",["WAConcurrentIterate","WACryptoHmac","WAMediaUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e==="video"}var s=16,u=10,c=64*1024;function d(e,t,n){n===void 0&&(n=1);var r=t.buffer.byteLength,a=Math.ceil((r-s)/c),i=new Uint8Array(u*a);return o("WAConcurrentIterate").concurrentIterate(a,function(n){var r=n*c,a=r+s+c,l=t.subarray(r,a);return o("WACryptoHmac").sign(e,l).then(function(e){var t=new Uint8Array(e,0,u);i.set(t,n*u)})},n).then(function(){return o("WAMediaUtils").castToStreamingSidecar(i.buffer)})}l.shouldHaveStreamingSidecar=e,l.calculateStreamingSidecar=d}),98);
__d("WAMediaHkdfInfo",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case"document":return"WhatsApp Document Keys";case"image":case"sticker":case"xma-image":return"WhatsApp Image Keys";case"video":case"gif":return"WhatsApp Video Keys";case"audio":case"ptt":return"WhatsApp Audio Keys";case"md-app-state":return"WhatsApp App State Keys";case"md-msg-hist":return"WhatsApp History Keys";default:throw r("err")("getMediaHkdfInfo: unexpected media type "+e)}}function s(){return"Messenger Preview Keys"}l.getMediaHkdfInfo=e,l.getPreviewMediaHkdfInfo=s}),98);
__d("WAMediaCrypto",["WABinary","WACryptoAesCbc","WACryptoDependencies","WACryptoHkdf","WACryptoHmac","WACryptoSha256","WACryptoUtils","WACustomError","WAHashUtils","WAMediaCryptoSidecar","WAMediaHkdfInfo","WATagsLogger","WATypedArraysConcat","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["WAMediaCrypto"]),c=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="HmacValidationError",n}return babelHelpers.inheritsLoose(t,e),t})(o("WACustomError").CustomError),d=new Uint8Array([2,2]);function m(e,t){return o("WACryptoHkdf").extractAndExpand(new Uint8Array(e),t,112).then(function(e){return{iv:new Uint8Array(e,0,16),cipherKey:new Uint8Array(e,16,32),hmacKey:new Uint8Array(e,48,32),refKey:new Uint8Array(e,80,32)}})}function p(e,t){var n=o("WAMediaHkdfInfo").getMediaHkdfInfo(t);return m(e,n)}function _(e){var t=o("WAMediaHkdfInfo").getPreviewMediaHkdfInfo();return m(e,t)}async function f(e){var t=new Map,n=await _(e);t.set("preview",n);var r=["document","image","video","audio","md-app-state","md-msg-hist"];return await Promise.all(r.map(function(n){return p(e,n).then(function(e){t.set(n,e)})})),t}function g(e){switch(e){case"image":case"video":return e;default:return null}}var h=16,y=16,C=10,b=64*1024;async function v(e,t,n,r,a){var i=new(o("WABinary")).Binary;i.ensureCapacity(y+r.byteLength+h+C),i.writeByteArray(t);for(var l=new(o("WACryptoAesCbc")).AesCbcStream(i,"encrypt",e,t),s=0,u=s+b;u<r.byteLength;){var c=r.slice(s,u);await l.append(new Uint8Array(c)),s=u,u+=b}var d=await r.slice(s);await l.finalize(new Uint8Array(d));var m=i.peek(function(e){return e.readByteArrayView()}),p=await o("WACryptoHmac").encodeKeySha256(n),_=await o("WACryptoHmac").sign(p,m);i.writeByteArray(new Uint8Array(_,0,C));var f=i.readByteArrayView(),g=f.subarray(y),v=await Promise.all([o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",g),o("WAMediaCryptoSidecar").shouldHaveStreamingSidecar(a)?o("WAMediaCryptoSidecar").calculateStreamingSidecar(p,f):void 0]),S=v[0],R=v[1];return{ciphertext:g,ciphertextHash:S,sidecar:R,ivCiphertext:m,ivCiphertextHmac:f}}async function S(e,t,n){var r=await o("WACryptoHmac").encodeKeySha256(e),a=o("WABinary").Binary.build(t,n).readByteArrayView();return o("WACryptoHmac").sign(r,a)}async function R(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new c("Bad hmac size "+a.length);var i=o("WABinary").Binary.build(t,n).readByteArrayView(),l=await o("WACryptoHmac").hmacSha256(r,i).then(function(e){return new Uint8Array(e)}),s=l.slice(0,a.length);if(!I(s,a))throw new c("hmacAndDecrypt hmac mismatch");var u=await o("WACryptoAesCbc").aesCbcDecrypt(e,t,n),d=await o("WACryptoDependencies").getCrypto().subtle.digest("SHA-256",u);return{plaintextHash:o("WAHashUtils").toPlaintextHash(d),plaintext:u}}function L(e,t,n,r,a){if(!(10<=a.length&&a.length<=32))throw new c("Bad hmac size "+a.length);var i=o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[t,n]);return o("WACryptoHmac").hmacSha256(r,i,a.length).then(function(e){return new Uint8Array(e)}).then(function(e){if(!o("WACryptoUtils").uint8ArraysEqual(e,a))throw new c("hmacAndDecrypt hmac mismatch")}).then(function(){var e=n.byteLength%h===C;return e===!0?n.subarray(0,-10):n}).then(function(n){return E(e,t,n)})}function E(e,t,n){var r=n.subarray(-h);return o("WACryptoAesCbc").aesCbcEncrypt(e,d,r).then(function(e){return e.slice(y)}).then(function(e){return o("WABinary").Binary.build(n,e).readByteArrayView()}).then(function(n){return o("WACryptoAesCbc").aesCbcDecrypt(e,t,n)}).then(function(e){return new Uint8Array(e,0,e.byteLength-d.byteLength)}).then(function(e){return{plaintext:e,nextIv:r}})}async function k(t,n,a,i,l,c){l>c.scanLengths.length&&u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["decryptPartialChunks targetScan greater length of scanLength array"])));var d=Math.min(l,c.scanLengths.length);if(d<1)throw u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt partial due to invalid target scan"]))),r("err")("Unable to decrypt partial due to invalid target scan");for(var m=new(o("WABinary")).Binary,p=[],_=0;_<d;_++)p.push(new Uint8Array(c.sidecar,_*10,10));for(var f=0,g=n,h=0,y=0;y<d;y++){var C=c.alignedScanLengths[y],b=f+C,v=a.subarray(f,b),S=await L(t,g,v,i,p[y]),R=S.nextIv,E=S.plaintext;m.write(E),f+=C,g=R,h+=c.scanLengths[y]}var k=m.readBuffer(h),I=await o("WACryptoSha256").sha256(k);return{plaintextHash:o("WAHashUtils").toPlaintextHash(I),plaintext:k}}function I(e,t){if(e.length!==t.length)return!1;for(var n=1,r=e.length,o=0;o<r;o++)n&=e[o]===t[o]?1:0;return n!==0}l.HmacValidationError=c,l.DEFAULT_PADDING=d,l.computeMediaKeys=p,l.computeMediaKeysForPreview=_,l.deprecated_getAllCommonComputedMediaKeys=f,l.convertServerMediaTypeToPreviewMediaType=g,l.CBC_BLOCK_SIZE=h,l.IV_LENGTH=y,l.HMAC_LENGTH=C,l.encryptAndHmac=v,l.hmacCiphertext=S,l.hmacAndDecrypt=R,l.hmacAndDecryptPartial=L,l.decryptPartialChunks=k}),98);
__d("WAAlignChunkLengthsToMultipleOfAesBlockSize",[],(function(t,n,r,o,a,i){"use strict";function e(e){return parseInt((e+15)/16,10)*16}function l(t,n){for(var r=[],o=0,a=0,i=0,l=0;l<t.length;++l)if(o+=t[l],l===t.length-1&&n!=null&&n>0){o>a?r.push(n-a):(r.pop(),r.push(n-i));break}else if(o>a){var s=e(o-a);i=a,r.push(s),a+=s}return r}i.alignChunkSizeToMultipleAesBlockSize=e,i.alignChunkLengthsToMultipleOfAesBlockSize=l}),66);
__d("WAProgressiveJpegAlignScanLengths",["WAAlignChunkLengthsToMultipleOfAesBlockSize"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=e.totalEncryptedBytes;return o("WAAlignChunkLengthsToMultipleOfAesBlockSize").alignChunkLengthsToMultipleOfAesBlockSize(t.map(function(e){return e}),n).map(function(e){return e})}function s(e){return e}l.progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize=e,l.toProgressiveJpegAlignedScanLength=s}),98);
__d("WAProgressiveJpegGetPJpegDetails",["WAMediaCrypto","WAProgressiveJpegAlignScanLengths","WAProgressiveJpegGetScanLengths","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WATagsLogger").TAGS(["WAProgressiveJpegDetails"]);function m(e){var t=e.ciphertextLength,n=e.progressiveJpegDetails;return babelHelpers.extends({},n,{alignedScanLengths:o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:n.scanLengths,totalEncryptedBytes:t})})}async function p(e,t,n){var r=t.byteLength-o("WAMediaCrypto").IV_LENGTH,a=o("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(e),i=o("WAProgressiveJpegAlignScanLengths").progressiveJpegAlignChunkLengthsToMultipleOfAesBlockSize({scanLengths:a,totalEncryptedBytes:r}),l=await _(i,t,n);return{scanLengths:a,sidecar:l}}async function _(e,t,n){for(var r=new Uint8Array(e.length*10),a=0,i=0,l=t.slice(0,16),s=t.slice(16),u=0;u<e.length;u++){var c=e[u];i=a+c;var d=s.subarray(a,i),m=(await o("WAMediaCrypto").hmacCiphertext(n,l,d)).slice(0,10);r.set(new Uint8Array(m),u*10),l=d.slice(d.length-16,d.length),a=i}return r.buffer}function f(t){return t.sidecar.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0?(d.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar has an invalid length"]))),o("WAResultOrError").makeError("pjpeg-check-sidecar-invalid-length")):t.scanLengths.length>0&&t.sidecar.byteLength===0?(d.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar is missing"]))),o("WAResultOrError").makeError("pjpeg-check-no-sidecar")):t.scanLengths.length===0?o("WAResultOrError").makeResult(!1):t.scanLengths.length*o("WAMediaCrypto").HMAC_LENGTH!==t.sidecar.byteLength?(d.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg sidecar size mismatch"]))),o("WAResultOrError").makeError("pjpeg-check-scan-length-mismatch")):t.scanLengths.length<3?(d.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Progressive Jpeg has too few scans"]))),o("WAResultOrError").makeError("pjpeg-too-few-scans")):o("WAResultOrError").makeResult(!0)}function g(e,t){var n=0;if(t===0)return 0;for(var r=0;r<t;r++){var o=e[r];o!=null&&(n+=o)}return n}function h(e){var t=e.progressiveJpegDetails;if(t==null)return o("WAResultOrError").makeResult(null);var n=f(t);return n.success===!1?n:n.value===!0?o("WAResultOrError").makeResult({scanLengths:t.scanLengths,sidecar:t.sidecar}):o("WAResultOrError").makeResult(null)}l.getExtendedProgressiveJpegDetails=m,l.getProgressiveJpegDetails=p,l.isValidProgressiveJpegDetails=f,l.getTotalByteSizeForScan=g,l.maybeGetProgressiveJpegDetailsUsingMediaEntry=h}),98);
__d("WADownloadDownloadablePreview",["WADownloadMedia","WAMediaCrypto","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WADownloadMedia").mediaDownloadLogger.TAGS(["DownloadDownloadablePreview"]);async function f(t,n,r,a,i,l,f){var g=l.handleMediaPreviewBeforeDownload,h=l.handleMediaPreviewDownloadFailed,y=a.downloadableThumbnail,C=y==null?void 0:y.directPath,b=C!=null,v=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(a);if(_.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_available: ",""])),b),y==null||C==null)return _.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No downloadableThumbnail. Skipping..."]))),o("WAResultOrError").makeError("preview-not-supported");_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["DownloadableThumbnail exists. Attempting to download."])));var S=y.fileEncSha256,R=y.fileSha256,L=y.mediaKey,E=y.objectId,k=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:t,downloadEntry:i,msgType:null,triggerUIView:f,isPreview:!0});if(k.addAnnotations({bool:{duplicateDirectPath:C===a.directPath,isProgressiveJpeg:v.success===!0,hasObjectId:E!=null},string:{mediaType:"preview",fullSizeMediaType:a.serverMediaType}}),k.addPoint("wa_protocol_media_download_start"),C==null||S==null||R==null||L==null)return _.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - mediaEntryData "," is incomplete for media preview"])),a),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-incomplete-media-entry"}}),o("WAResultOrError").makeError("media-entry-invalid");var I=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(r);if(I==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),r),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"preview-unsupported-type"}}),o("WAResultOrError").makeError("request-error");await g(n);var T=await o("WADownloadMedia").downloadMediaImpl({downloadFlow:k,mediaTypeDetails:{messageType:I,type:"preview"},directPath:C,fileEncSha256:S,fileSha256:R,mediaKey:L});return T.success===!1?(_.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["failed to download media. Reason: ",""])),T.error),h(n,T.error),k.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:T.error}}),T):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["finished downloading"]))),k.addPoint("wa_protocol_media_download_end"),k.endSuccess(),o("WAResultOrError").makeResult(T.value))}l.maybeDownloadDownloadablePreview=f}),98);
__d("WADecryptMedia",["WAMediaCrypto","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptMedia"]);async function f(t,n,r,a){_.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Encountered enc-hash-mismatch - looking for a potential working hmac salt"])));var i=r.type==="preview"?"preview":r.mediaType,l=await o("WAMediaCrypto").deprecated_getAllCommonComputedMediaKeys(a),d;for(var m of l){var p=m[0],f=m[1];try{if(p===i)continue;_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Trying "," as an alternative hmac salt."])),p);var g=o("WAResultOrError").makeResult(await o("WAMediaCrypto").hmacAndDecrypt(f.cipherKey,f.iv,t,f.hmacKey,n));return d={hmacAndDecryptResult:g,alternativeHmacSaltUsed:p},_.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found a working hmac salt using ","."])),p),d}catch(e){_.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose([""," is not a working hmac salt."])),p);continue}}return{hmacAndDecryptResult:o("WAResultOrError").makeError("enc-hash-mismatch")}}async function g(e){var t=e.ciphertextHmac,n=e.mediaKey,r=e.mediaTypeDetails,a=e.plaintextHash;_.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Using default plaintext verifier"])));var i=t.byteLength-o("WAMediaCrypto").HMAC_LENGTH,l=new Uint8Array(t,i),s=new Uint8Array(t,0,i),u;r.type==="preview"?u=o("WAMediaCrypto").computeMediaKeysForPreview(n):u=o("WAMediaCrypto").computeMediaKeys(n,r.mediaType);var c,g=null;if(c=await u.then(function(e){var t=e.cipherKey,n=e.hmacKey,r=e.iv;return o("WAMediaCrypto").hmacAndDecrypt(t,r,s,n,l)}).then(o("WAResultOrError").makeResult).catch(function(e){return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")}),c.success===!1&&c.error==="enc-hash-mismatch"){var h=await f(s,l,r,n);c=h.hmacAndDecryptResult,g=h.alternativeHmacSaltUsed}if(!c.success)return c;var y=c.value,C=y.plaintext,b=y.plaintextHash;return a!==b?o("WAResultOrError").makeError("hash-mismatch"):(_.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Success"]))),o("WAResultOrError").makeResult({plaintext:C,alternativeHmacSaltUsed:g}))}l.decryptMedia=g}),98);
__d("WAArrayUtils",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e}function l(e,t){var n=e.pop();t<e.length&&(e[t]=n)}function*s(e,t){for(var n=0;n<e.length;n+=t)yield e.slice(n,n+t)}function u(t,n){return c(t,n,e)}function c(e,t,n){var r=new Map;for(var o of e){var a,i=t(o),l=(a=r.get(i))!=null?a:[];l.push(n(o)),r.set(i,l)}return r}i.removeIndexWithoutPreservingOrder=l,i.peekEvery=s,i.groupBy=u,i.groupByAndMap=c}),66);
__d("WABaseGlobals",["err"],(function(t,n,r,o,a,i,l){"use strict";var e=null;function s(t){e=t}function u(){if(e==null)throw r("err")("Trying to access WAGlobals before being set");return e}function c(e){var t=u();t.myJids=e}function d(){var e,t=(e=u().myJids)==null?void 0:e.deviceJid;if(t==null)throw r("err")("Trying to access myDeviceJid, but it's not set");return t}function m(){var e,t=(e=u().myJids)==null?void 0:e.userJid;if(t==null)throw r("err")("Trying to access myUserJid, but it's not set");return t}function p(){return u().jidUtils}function _(){return u().qpl}function f(){return e==null?!1:u().newClockSkewCalculation()}l.setGlobals=s,l.setMyJids=c,l.getMyDeviceJid=d,l.getMyUserJid=m,l.getJidUtilsApi=p,l.getQplConfig=_,l.newClockSkewCalculation=f}),98);
__d("WAErrors",["WACustomError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="BufferTooLargeError",n}return babelHelpers.inheritsLoose(t,e),t})((e=o("WACustomError")).CustomError),u=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="Disconnected",n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),c=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="Offline",n}return babelHelpers.inheritsLoose(t,e),t})(u),d=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="MaxRetries",n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError),m=(function(e){function t(t){var n;return n=e.call(this,t!=null?t:"")||this,n.name="Aborted",n}return babelHelpers.inheritsLoose(t,e),t})(e.CustomError);l.BufferTooLargeError=s,l.Disconnected=u,l.Offline=c,l.MaxRetries=d,l.Aborted=m}),98);
__d("WANotifyConnectionChangeFactory",[],(function(t,n,r,o,a,i){"use strict";var e=15e3;function l(t,n,r){r===void 0&&(r=e);var o={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},a=function(){var e=o.connectionStatus,t=o.optimismLevel;t==="optimist"?o.timeoutID=setTimeout(function(){o.optimismLevel="realist",n(e)},r):n(e)};return function(e){o.connectionStatus=e,e==="disconnected"||e==="in_handshake"?a():(o.timeoutID!=null&&(clearTimeout(o.timeoutID),o.timeoutID=null),n(e)),t(e)}}i.notifyConnectionChangeFactory=l}),66);
__d("WAPromiseRetryLoop",["Promise","WALogger","WAPromiseBackoffs","WAPromiseDelays","WAResolvable","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g=(function(){function t(e){var t=this;this.$2=new(o("WAResolvable")).Resolvable,this.$3=null,this.$4=null,this.$5=0,this.$6=new(o("WAResolvable")).Resolvable,this.endWithValue=function(e){t.$5++,t.$2.resolve(e)},this.$1=e}var a=t.prototype;return a.resetTimeoutAfter=function(t){this.$4=Date.now()+t},a.cancelReset=function(){this.$4=null},a.reset=function(){this.$2.resolveWasCalled()||(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""])),this.$1.name),this.$5++,this.$6.resolve(),this.$7())},a.start=function(){this.$2.resolveWasCalled()||(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: starting ",""])),this.$1.name),this.$5!==0&&o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop was called several times. You may have race conditions"]))),this.$5++,this.$6.resolve(),this.$7())},a.pauseOnNextIteration=function(){o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: pause requested on next iteration"]))),this.$6.resolve(),this.$6=new(o("WAResolvable")).Resolvable},a.unpause=function(){this.$6.resolveWasCalled()||o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: loop unpaused"]))),this.$6.resolve()},a.$7=function(){var e=this,t=this.$1,r=this.$5,a=o("WAPromiseBackoffs").createTimer(this.$1.timer);a();var i=function(){return e.$1.isPauseEnabled!==!0?(f||(f=n("Promise"))).resolve():(e.$6.resolveWasCalled()||o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: loop paused - waiting for unpause"]))),e.$6.promise)},l=function(){if(!e.$2.resolveWasCalled()&&r===e.$5){var n=Date.now();return e.$3=(0,t.code)(e.endWithValue).then(function(){if(!e.$2.resolveWasCalled()){var r=t.resetDelay;(r!==void 0&&Date.now()>=n+r||e.$4!=null&&e.$4<=Date.now())&&(o("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: resetting ",""])),t.name),a=o("WAPromiseBackoffs").createTimer(e.$1.timer)),e.$4=null;var s=a();return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["PromiseRetryLoop: retrying "," in ","ms"])),t.name,s),o("WAPromiseDelays").delayMs(s).then(i).then(l)}}),e.$3}};this.$3=(f||(f=n("Promise"))).resolve().then(l)},a.promise=function(){var e=this;return this.$2.resolveWasCalled()?this.$2.promise:this.$3?(f||(f=n("Promise"))).race([this.$2.promise,this.$3.then(function(){return e.$2.promise})]):(f||(f=n("Promise"))).reject(r("err")("PromiseRetryLoop "+this.$1.name+" had promise() called before start()"))},t})();l.PromiseRetryLoop=g}),98);
__d("WASmaxInPingsEnums",["WAJids"],(function(t,n,r,o,a,i,l){var e={validators:[o("WAJids").validateDomainJid,o("WAJids").validateUserJid],typeName:"DomainJid|UserJid"};l.DOMAINJID_USERJID=e}),98);
__d("WAWapJid",["$InternalEnum","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e={JID:0,JID_U:1,JID_AD:1,JID_FB:3,JID_INTEROP:4},s=n("$InternalEnum")({WHATSAPP:0,LID:1,HOSTED:128,HOSTED_LID:129}),u=(function(){function t(e){this.$1=e}t.createAD=function(r,o,a){return new t({type:e.JID_AD,user:r,device:a==null?0:a,agent:o==null?0:o,domainType:s.WHATSAPP})},t.createJidU=function(r,o,a){return new t({type:e.JID_U,user:r,device:a==null?0:a,domainType:o==null?s.WHATSAPP:o})},t.createFbJid=function(r,o){var n=o==null?0:o;return new t({type:e.JID_FB,user:r,device:n})},t.createInteropJid=function(r,o,a){var n=o==null?0:o;return new t({type:e.JID_INTEROP,user:r,device:n,integrator:a})},t.create=function(r,o){return new t({type:e.JID,user:r,server:o})};var n=t.prototype;return n.toString=function(){if(this.$1.type===e.JID_AD||this.$1.type===e.JID_U){var t=this.$1,n=t.device,r=t.domainType,a=t.user,i="";return r===s.WHATSAPP?i=o("WAJids").WA_USER_JID_SUFFIX:r===s.HOSTED?i=o("WAJids").HOSTED_SUFFIX:r===s.HOSTED_LID?i=o("WAJids").HOSTED_LID_SUFFIX:i=o("WAJids").LID_SUFFIX,n===0?a+"@"+i:a+":"+n+"@"+i}else if(this.$1.type===e.JID_FB){var l=this.$1,u=l.device,c=l.user,d=o("WAJids").MSGR_USER_JID_SUFFIX;return c+":"+u+"@"+d}else if(this.$1.type===e.JID_INTEROP){var m=this.$1,p=m.device,_=m.integrator,f=m.user,g=o("WAJids").INTEROP_USER_JID_SUFFIX;return _+"-"+f+":"+p+"@"+g}else{this.$1.type;var h=this.$1,y=h.server,C=h.user;return C!=null?C+"@"+y:y}},n.getInnerJid=function(){return this.$1},t})();l.WAP_JID_SUBTYPE=e,l.DomainType=s,l.WapJid=u}),98);
__d("WASmaxParseUtils",["WABase64","WABinary","WACryptoUtils","WADeepEquals","WAHasProperty","WAResultOrError","WAStanzaUtils","WAWapJid","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WAResultOrError").makeResult();function s(t,n){return t.tag!==n?O(t,"to be <"+n+">"):e}function u(e,t){return B(e,t)?W(e,e.attrs[t]):O(e,'to have attribute "'+t+'"')}function c(e,t,n,r){var a=u(e,t);if(!a.success)return a;var i=n(a.value);return i!=null?o("WAResultOrError").makeResult(i):O(e,'to have "'+t+'"={'+r+'}, but instead has "'+a.value+'"')}function d(e,t,n){var r=P(e);if(!r.success)return r;var a=t(r.value);return a!=null?o("WAResultOrError").makeResult(a):O(e,"to have "+n+' content, but instead has "'+r.value+'"')}function m(t,n,r){var o=u(t,n);if(o.success){if(o.value!==r)return O(t,'to have "'+n+'"="'+r+'", but instead has "'+o.value+'"')}else return o;return e}function p(e,t){return c(e,t,o("WAStanzaUtils").toStanzaId,"stanzaID")}function _(e,t){return c(e,t,o("WAStanzaUtils").validateCallId,"callID")}function f(e,t){return c(e,t,q,"integer")}function g(e,t,n,r){var a=f(e,t);if(!a.success)return a;var i=a.value;return n!==void 0&&i<n?O(e,'to have "'+t+'"={at least '+n+"} but has value "+i):r!==void 0&&i>r?O(e,'to have "'+t+'"={at most '+r+"} but has value "+i):o("WAResultOrError").makeResult(i)}function h(e){var t=e.content;return t instanceof Uint8Array?O(e,"to have children"):o("WAResultOrError").makeResult(t)}function y(t,n){var r=h(t);if(!r.success)return r;var a=r.value;if(a==null)return e;for(var i=null,l=0;l<a.length;l++){var s=a[l];if(s.tag===n){if(i!=null)return O(t,"to have 1 child <"+n+">, but found more than 1");i=s}}return o("WAResultOrError").makeResult(i)}function C(t,n,r){var o=y(t,n);return o.success?o.value==null?e:r(o.value):o}function b(e,t,n){var r=C(e,t,n);if(!r.success)return r;var a=r.value;return a==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(a)}function v(e,t){var n=y(e,t);return n.success?n.value==null?O(e,"to have 1 child <"+t+">, but found 0"):o("WAResultOrError").makeResult(n.value):n}function S(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=[],s=0;s<i.value.length;s++){var u=a(i.value[s]);if(!u.success)return u;l.push(u.value)}return o("WAResultOrError").makeResult(l)}function R(e,t,n,r,a){var i=U(e,t,n,r);if(!i.success)return i;for(var l=i.value.length,s=0;s<l;s++){var u=a(i.value[s]);if(!u.success)return u}return o("WAResultOrError").makeResult(l)}function L(e,t,n){var r=S(e,t,0,1/0,n);if(!r.success)return r;for(var a=0;a<r.value.length;a++)if(!o("WADeepEquals").deepEqual(r.value[0],r.value[a]))return O(e,"to have homogeneous children, but found two children that are not equal");return r}function E(e,t,n){var r=L(e,t,n);return r.success?o("WAResultOrError").makeResult(r.value.length):r}function k(t,n,r,o,a){return B(n,r)?t(n,r,o,a):e}function I(t,n,r,a){if(a==null)return e;var i=k(t,n,r);return i.success?i.value===a?o("WAResultOrError").makeResult(a):i.value==null?e:O(n,'to have "'+r+'"={'+a+'}, but instead has "'+i.value+'"'):i}function T(e,t,n,r){var a=e(t,n);return a.success?a.value===r?o("WAResultOrError").makeResult(r):O(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"'):a}function D(e,t,n){var r=e(t);return r.success?r.value===n?o("WAResultOrError").makeResult(n):O(t,'to have content "'+n+'", but instead has "'+r.value+'"'):r}function x(e,t,n){var r=u(e,t);if(!r.success)return r;var a=n[r.value];if(a!=null)return o("WAResultOrError").makeResult(a);var i=Object.values(n).join("|");return O(e,'to have "'+t+'"={'+i+'}, but instead has "'+r.value+'"')}function $(e,t){var n=P(e);if(!n.success)return n;var r=t[n.value];if(r!=null)return o("WAResultOrError").makeResult(r);var a=Object.values(t).join("|");return O(e,'to have content "'+a+'", but instead has "'+n.value+'"')}function P(e){var t=N(e);if(t.success)try{var n=new(o("WABinary")).Binary(t.value),a=n.readString(n.size());return o("WAResultOrError").makeResult(a)}catch(t){return O(e,"to have string content, but run into decoding error: "+r("getErrorSafe")(t).message)}else return t}function N(e){var t=e.content;return t==null?O(e,"to have content"):Array.isArray(t)?O(e,"to have content, but has children instead"):o("WAResultOrError").makeResult(t)}function M(e,t){var n=N(e);return n.success?o("WACryptoUtils").uint8ArraysEqual(n.value,t)?o("WAResultOrError").makeResult(t):O(e,'to have content ":binary:'+o("WABase64").encodeB64(t)+'", but instead has ":binary:'+o("WABase64").encodeB64(n.value)+'"'):n}function w(e,t,n){var r=e.content;if(r==null)return t===void 0||t<1?o("WAResultOrError").makeResult(new Uint8Array([])):O(e,"to have content");if(Array.isArray(r))return O(e,"to have content, but has children instead");var a=r.length;return t!==void 0&&a<t?O(e,"to have binary content at least "+t+" bytes but has "+a+" bytes"):n!==void 0&&a>n?O(e,"to have binary content at most "+n+" bytes but has "+a+" bytes"):o("WAResultOrError").makeResult(r)}function A(e){return d(e,q,"integer")}function F(e){return e}function O(e,t){return o("WAResultOrError").makeError("expected <"+e.tag+">: "+t)}function B(e,t){return r("WAHasProperty")(e.attrs,t)}function W(e,t){return t instanceof o("WAWapJid").WapJid?o("WAResultOrError").makeResult(t.toString()):typeof t=="string"?o("WAResultOrError").makeResult(t):O(e,"decodeAsString: attribute is "+typeof t+" not a string: "+String(t))}function q(e){var t=parseInt(e,10);return Number.isNaN(t)?null:t}function U(e,t,n,r){var a=h(e);if(!a.success)return a;var i=a.value;if(i==null)return n!==0?O(e,"to have at least "+n+" <"+t+"> children, but found 0"):o("WAResultOrError").makeResult([]);for(var l=[],s=0;s<i.length;s++){var u=i[s];u.tag===t&&l.push(u)}var c=l.length;return c<n?O(e,"to have at least "+n+" <"+t+"> children, but found "+c):c>r?O(e,"to have at most "+r+" <"+t+"> children, but found "+c):o("WAResultOrError").makeResult(l)}var V={};function H(e,t,n){var r=t.map(function(e,t){return e+": "+n[t].error});return O(e,["to match any of following mixins: "+t.join(", ")+", but all mixins failed."].concat(r).join(" "))}l.voidSuccess=e,l.assertTag=s,l.attrString=u,l.attrValidate=c,l.contentValidate=d,l.assertAttr=m,l.attrStanzaId=p,l.attrCallId=_,l.attrInt=f,l.attrIntRange=g,l.maybeChildren=h,l.optionalChild=y,l.optionalChildWithTag=C,l.childWithTag=b,l.flattenedChildWithTag=v,l.mapChildrenWithTag=S,l.countChildrenWithTag=R,l.mapHomogeneousChildrenWithTag=L,l.countHomogeneousChildrenWithTag=E,l.optional=k,l.optionalLiteral=I,l.literal=T,l.literalContent=D,l.attrStringEnum=x,l.contentStringEnum=$,l.contentString=P,l.contentBytes=N,l.contentLiteralBytes=M,l.contentBytesRange=w,l.contentInt=A,l.identity=F,l.errorMessage=O,l.emptyObject=V,l.errorMixinDisjunction=H}),98);
__d("WASmaxParseJid",["WAJids","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateUserJid,"UserJid")}function s(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateLidUserJid,"LidUserJid")}function u(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDeviceJid,"DeviceJid")}function c(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateGroupJid,"GroupJid")}function d(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateCallJid,"CallJid")}function m(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateDomainJid,"DomainJid")}function p(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateBroadcastJid,"BroadcastJid")}function _(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateStatusJid,"StatusJid")}function f(e,t){return o("WASmaxParseUtils").attrValidate(e,t,o("WAJids").validateNewsletterJid,"NewsletterJid")}function g(e,t,n){var r=o("WASmaxParseUtils").attrString(e,t);if(!r.success)return r;for(var a=n.typeName,i=n.validators,l=0;l<i.length;l++){var s=i[l](r.value);if(s!=null)return o("WAResultOrError").makeResult(s)}return o("WASmaxParseUtils").errorMessage(e,'to have "'+t+'"={'+a+'}, but instead has "'+r.value+'"')}function h(e,t,n,r){var a=e(t,n);return!a.success||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}function y(e,t,n,r){var a=o("WASmaxParseUtils").optional(e,t,n);return!a.success||a.value==null||a.value===r?a:o("WASmaxParseUtils").errorMessage(t,'to have "'+n+'"={'+r+'}, but instead has "'+a.value+'"')}l.attrUserJid=e,l.attrLidUserJid=s,l.attrDeviceJid=u,l.attrGroupJid=c,l.attrCallJid=d,l.attrDomainJid=m,l.attrBroadcastJid=p,l.attrStatusJid=_,l.attrNewsletterJid=f,l.attrJidEnum=g,l.literalJid=h,l.optionalLiteralJid=y}),98);
__d("WASmaxParseReference",["WAHasProperty","WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,r,o){var a=m(t,n);if(!a.success)return _(a);var i=e(a.value,n[n.length-1],r,o);return i.success?i:_(i)}function s(t,n,r,a,i){return p(n,r)?e(t,n,r,a,i):o("WASmaxParseUtils").voidSuccess}function u(t,n){return e(o("WASmaxParseUtils").attrString,t,n)}function c(e,t){return p(e,t)?u(e,t):o("WASmaxParseUtils").voidSuccess}function d(e,t){var n=m(e,t);if(!n.success)return _(n);var r=o("WASmaxParseUtils").contentString(n.value);return r.success?r:_(r)}function m(e,t){for(var n=t.length,r=e,a=0;a<n-1;a++){var i=t[a],l=o("WASmaxParseUtils").flattenedChildWithTag(r,i);if(!l.success)return l;r=l.value}return o("WAResultOrError").makeResult(r)}function p(e,t){var n=m(e,t);return n.success&&r("WAHasProperty")(n.value.attrs,t[t.length-1])}function _(e){return o("WAResultOrError").makeError("in the reference, "+e.error)}l.attrFromReference=e,l.optionalAttrFromReference=s,l.attrStringFromReference=u,l.optionalAttrStringFromReference=c,l.contentStringFromReference=d}),98);
__d("WASmaxInPingsClientResponseServerResponse",["WAResultOrError","WASmaxInPingsEnums","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseJid").attrJidEnum(e,"from",o("WASmaxInPingsEnums").DOMAINJID_USERJID);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").attrInt(e,"t");return s.success?o("WAResultOrError").makeResult({from:r.value,type:a.value,t:s.value}):s}l.parseClientResponseServerResponse=e}),98);
__d("WAWapDict",[],(function(t,n,r,o,a,i){"use strict";var e=3,l=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","notification","disappearing_mode","status","jid","broadcast","user","devices","device_hash","to","offline","message","result","class","xmlns","duration","notify","iq","t","ack","g.us","enc","urn:xmpp:whatsapp:push","presence","config_value","picture","verified_name","config_code","key-index-list","contact","mediatype","routing_info","edge_routing","get","read","urn:xmpp:ping","fallback_hostname","0","chatstate","business_hours_config","unavailable","download_buckets","skmsg","verified_level","composing","handshake","device-list","media","text","fallback_ip4","media_conn","device","creation","location","config","item","fallback_ip6","count","w:profile:picture","image","business","2","hostname","call-creator","display_name","relaylatency","platform","abprops","success","msg","offline_preview","prop","key-index","v","day_of_week","pkmsg","version","1","ping","w:p","download","video","set","specific_hours","props","primary","unknown","hash","commerce_experience","last","subscribe","max_buckets","call","profile","member_since_text","close_time","call-id","sticker","mode","participants","value","query","profile_options","open_time","code","list","host","ts","contacts","upload","lid","preview","update","usync","w:stats","delivery","auth_ttl","context","fail","cart_enabled","appdata","category","atn","direct_connection","decrypt-fail","relay_id","mmg-fallback.whatsapp.net","target","available","name","last_id","mmg.whatsapp.net","categories","401","is_new","index","tctoken","ip4","token_id","latency","recipient","edit","ip6","add","thumbnail-document","26","paused","true","identity","stream:error","key","sidelist","background","audio","3","thumbnail-image","biz-cover-photo","cat","gcm","thumbnail-video","error","auth","deny","serial","in","registration","thumbnail-link","remove","00","gif","thumbnail-gif","tag","capability","multicast","item-not-found","description","business_hours","config_expo_key","md-app-state","expiration","fallback","ttl","300","md-msg-hist","device_orientation","out","w:m","open_24h","side_list","token","inactive","01","document","te2","played","encrypt","msgr","hide","direct_path","12","state","not-authorized","url","terminate","signature","status-revoke-delay","02","te","linked_accounts","trusted_contact","timezone","ptt","kyc-id","privacy_token","readreceipts","appointment_only","address","expected_ts","privacy","7","android","interactive","device-identity","enabled","attribute_padding","1080","03","screen_height"],s=["read-self","active","fbns","protocol","reaction","screen_width","heartbeat","deviceid","2:47DEQpj8","uploadfieldstat","voip_settings","retry","priority","longitude","conflict","false","ig_professional","replaced","preaccept","cover_photo","uncompressed","encopt","ppic","04","passive","status-revoke-drop","keygen","540","offer","rate","opus","latitude","w:gp2","ver","4","business_profile","medium","sender","prev_v_id","email","website","invited","sign_credential","05","transport","skey","reason","peer_abtest_bucket","America/Sao_Paulo","appid","refresh","100","06","404","101","104","107","102","109","103","member_add_mode","105","transaction-id","110","106","outgoing","108","111","tokens","followers","ig_handle","self_pid","tue","dec","thu","joinable","peer_pid","mon","features","wed","peer_device_presence","pn","delete","07","fri","audio_duration","admin","connected","delta","rcat","disable","collection","08","480","sat","phash","all","invite","accept","critical_unblock_low","group_update","signed_credential","blinded_credential","eph_setting","net","09","background_location","refresh_id","Asia/Kolkata","privacy_mode_ts","account_sync","voip_payload_type","service_areas","acs_public_key","v_id","0a","fallback_class","relay","actual_actors","metadata","w:biz","5","connected-limit","notice","0b","host_storage","fb_page","subject","privatestats","invis","groupadd","010","note.m4r","uuid","0c","8000","sun","372","1020","stage","1200","720","canonical","fb","011","video_duration","0d","1140","superadmin","012","Opening.m4r","keystore_attestation","dleq_proof","013","timestamp","ab_key","w:sync:app:state","0e","vertical","600","p_v_id","6","likes","014","500","1260","creator","0f","rte","destination","group","group_info","syncd_anti_tampering_fatal_exception_enabled","015","dl_bw","Asia/Jakarta","vp8/h.264","online","1320","fb:multiway","10","timeout","016","nse_retry","urn:xmpp:whatsapp:dirty","017","a_v_id","web_shops_chat_header_button_enabled","nse_call","inactive-upgrade","none","web","groups","2250","mms_hot_content_timespan_in_seconds","contact_blacklist","nse_read","suspended_group_deletion_notification","binary_version","018","https://www.whatsapp.com/otp/copy/","reg_push","shops_hide_catalog_attachment_entrypoint","server_sync",".","ephemeral_messages_allowed_values","019","mms_vcache_aggregation_enabled","iphone","America/Argentina/Buenos_Aires","01a","mms_vcard_autodownload_size_kb","nse_ver","shops_header_dropdown_menu_item","dhash","catalog_status","communities_mvp_new_iqs_serverprop","blocklist","default","11","ephemeral_messages_enabled","01b","original_dimensions","8","mms4_media_retry_notification_encryption_enabled","mms4_server_error_receipt_encryption_enabled","original_image_url","sync","multiway","420","companion_enc_static","shops_profile_drawer_entrypoint","01c","vcard_as_document_size_kb","status_video_max_duration","request_image_url","01d","regular_high","s_t","abt","share_ext_min_preliminary_image_quality","01e","32","syncd_key_rotation_enabled","data_namespace","md_downgrade_read_receipts2","patch","polltype","ephemeral_messages_setting","userrate","15","partial_pjpeg_bw_threshold","played-self","catalog_exists","01f","mute_v2"],u=["reject","dirty","announcement","020","13","9","status_video_max_bitrate","fb:thrift_iq","offline_batch","022","full","ctwa_first_business_reply_logging","h.264","smax_id","group_description_length","https://www.whatsapp.com/otp/code","status_image_max_edge","smb_upsell_business_profile_enabled","021","web_upgrade_to_md_modal","14","023","s_o","smaller_video_thumbs_status_enabled","media_max_autodownload","960","blocking_status","peer_msg","joinable_group_call_client_version","group_call_video_maximization_enabled","return_snapshot","high","America/Mexico_City","entry_point_block_logging_enabled","pop","024","1050","16","1380","one_tap_calling_in_group_chat_size","regular_low","inline_joinable_education_enabled","hq_image_max_edge","locked","America/Bogota","smb_biztools_deeplink_enabled","status_image_quality","1088","025","payments_upi_intent_transaction_limit","voip","w:g2","027","md_pin_chat_enabled","026","multi_scan_pjpeg_download_enabled","shops_product_grid","transaction_id","ctwa_context_enabled","20","fna","hq_image_quality","alt_jpeg_doc_detection_quality","group_call_max_participants","pkey","America/Belem","image_max_kbytes","web_cart_v1_1_order_message_changes_enabled","ctwa_context_enterprise_enabled","urn:xmpp:whatsapp:account","840","Asia/Kuala_Lumpur","max_participants","video_remux_after_repair_enabled","stella_addressbook_restriction_type","660","900","780","context_menu_ios13_enabled","mute-state","ref","payments_request_messages","029","frskmsg","vcard_max_size_kb","sample_buffer_gif_player_enabled","match_last_seen","510","4983","video_max_bitrate","028","w:comms:chat","17","frequently_forwarded_max","groups_privacy_blacklist","Asia/Karachi","02a","web_download_document_thumb_mms_enabled","02b","hist_sync","biz_block_reasons_version","1024","18","web_is_direct_connection_for_plm_transparent","view_once_write","file_max_size","paid_convo_id","online_privacy_setting","video_max_edge","view_once_read","enhanced_storage_management","multi_scan_pjpeg_encoding_enabled","ctwa_context_forward_enabled","video_transcode_downgrade_enable","template_doc_mime_types","hq_image_bw_threshold","30","body","u_aud_limit_sil_restarts_ctrl","other","participating","w:biz:directory","1110","vp8","4018","meta","doc_detection_image_max_edge","image_quality","1170","02c","smb_upsell_chat_banner_enabled","key_expiry_time_second","pid","stella_interop_enabled","19","linked_device_max_count","md_device_sync_enabled","02d","02e","360","enhanced_block_enabled","ephemeral_icon_in_forwarding","paid_convo_status","gif_provider","project_name","server-error","canonical_url_validation_enabled","wallpapers_v2","syncd_clear_chat_delete_chat_enabled","medianotify","02f","shops_required_tos_version","vote","reset_skey_on_id_change","030","image_max_edge","multicast_limit_global","ul_bw","21","25","5000","poll","570","22","031","1280","WhatsApp","032","bloks_shops_enabled","50","upload_host_switching_enabled","web_ctwa_context_compose_enabled","ptt_forwarded_features_enabled","unblocked","partial_pjpeg_enabled","fbid:devices","height","ephemeral_group_query_ts","group_join_permissions","order","033","alt_jpeg_status_quality","migrate","popular-bank","win_uwp_deprecation_killswitch_enabled","web_download_status_thumb_mms_enabled","blocking","url_text","035","web_forwarding_limit_to_groups","1600","val","1000","syncd_msg_date_enabled","bank-ref-id","max_subject","payments_web_enabled","web_upload_document_thumb_mms_enabled","size","request","ephemeral","24","receipt_agg","ptt_remember_play_position","sampling_weight","enc_rekey","mute_always","037","034","23","036","action","click_to_chat_qr_enabled","width","disabled","038","md_blocklist_v2","played_self_enabled","web_buttons_message_enabled","flow_id","clear","450","fbid:thread","bloks_session_state","America/Lima","attachment_picker_refresh","download_host_switching_enabled","1792","u_aud_limit_sil_restarts_test2","custom_urls","device_fanout","optimistic_upload","2000","key_cipher_suite","web_smb_upsell_in_biz_profile_enabled","e","039","siri_post_status_shortcut","pair-device","lg","lc","stream_attribution_url","model","mspjpeg_phash_gen","catalog_send_all","new_multi_vcards_ui","share_biz_vcard_enabled","-","clean","200","md_blocklist_v2_server","03b","03a","web_md_migration_experience","ptt_conversation_waveform","u_aud_limit_sil_restarts_test1"],c=["64","ptt_playback_speed_enabled","web_product_list_message_enabled","paid_convo_ts","27","manufacturer","psp-routing","grp_uii_cleanup","ptt_draft_enabled","03c","business_initiated","web_catalog_products_onoff","web_upload_link_thumb_mms_enabled","03e","mediaretry","35","hfm_string_changes","28","America/Fortaleza","max_keys","md_mhfs_days","streaming_upload_chunk_size","5541","040","03d","2675","03f","...","512","mute","48","041","alt_jpeg_quality","60","042","md_smb_quick_reply","5183","c","1343","40","1230","043","044","mms_cat_v1_forward_hot_override_enabled","user_notice","ptt_waveform_send","047","Asia/Calcutta","250","md_privacy_v2","31","29","128","md_messaging_enabled","046","crypto","690","045","enc_iv","75","failure","ptt_oot_playback","AIzaSyDR5yfaG7OG8sMTUj8kfQEb8T9pN8BM6Lk","w","048","2201","web_large_files_ui","Asia/Makassar","812","status_collapse_muted","1334","257","2HP4dm","049","patches","1290","43cY6T","America/Caracas","web_sticker_maker","campaign","ptt_pausable_enabled","33","42","attestation","biz","04b","query_linked","s","125","04a","810","availability","1411","responsiveness_v2_m1","catalog_not_created","34","America/Santiago","1465","enc_p","04d","status_info","04f","key_version","..","04c","04e","md_group_notification","1598","1215","web_cart_enabled","37","630","1920","2394","-1","vcard","38","elapsed","36","828","peer","pricing_category","1245","invalid","stella_ios_enabled","2687","45","1528","39","u_is_redial_audio_1104_ctrl","1025","1455","58","2524","2603","054","bsp_system_message_enabled","web_pip_redesign","051","verify_apps","1974","1272","1322","1755","052","70","050","1063","1135","1361","80","1096","1828","1851","1251","1921","key_config_id","1254","1566","1252","2525","critical_block","1669","max_available","w:auth:backup:token","product","2530","870","1022","participant_uuid","web_cart_on_off","1255","1432","1867","41","1415","1440","240","1204","1608","1690","1846","1483","1687","1749","69","url_number","053","1325","1040","365","59","Asia/Riyadh","1177","test_recommended","057","1612","43","1061","1518","1635","055","1034","1375","750","1430","event_code","1682","503","55","865","78","1309","1365","44","America/Guayaquil","535","LIMITED","1377","1613","1420","1599","1822","05a","1681","password","1111","1214","1376","1478","47","1082","4282","Europe/Istanbul","1307","46","058","1124","256","rate-overlimit","retail","u_a_socket_err_fix_succ_test","1292","1370","1388","520","861","psa","regular","1181","1766","05b","1183","1213","1304","1537"],d=["1724","profile_picture","1071","1314","1605","407","990","1710","746","pricing_model","056","059","061","1119","6027","65","877","1607","05d","917","seen","1516","49","470","973","1037","1350","1394","1480","1796","keys","794","1536","1594","2378","1333","1524","1825","116","309","52","808","827","909","495","1660","361","957","google","1357","1565","1967","996","1775","586","736","1052","1670","bank","177","1416","2194","2222","1454","1839","1275","53","997","1629","6028","smba","1378","1410","05c","1849","727","create","1559","536","1106","1310","1944","670","1297","1316","1762","en","1148","1295","1551","1853","1890","1208","1784","7200","05f","178","1283","1332","381","643","1056","1238","2024","2387","179","981","1547","1705","05e","290","903","1069","1285","2436","062","251","560","582","719","56","1700","2321","325","448","613","777","791","51","488","902","Asia/Almaty","is_hidden","1398","1527","1893","1999","2367","2642","237","busy","065","067","233","590","993","1511","54","723","860","363","487","522","605","995","1321","1691","1865","2447","2462","NON_TRANSACTIONAL","433","871","432","1004","1207","2032","2050","2379","2446","279","636","703","904","248","370","691","700","1068","1655","2334","060","063","364","533","534","567","1191","1210","1473","1827","069","701","2531","514","prev_dhash","064","496","790","1046","1139","1505","1521","1108","207","544","637","final","1173","1293","1694","1939","1951","1993","2353","2515","504","601","857","modify","spam_request","p_121_aa_1101_test4","866","1427","1502","1638","1744","2153","068","382","725","1704","1864","1990","2003","Asia/Dubai","508","531","1387","1474","1632","2307","2386","819","2014","066","387","1468","1706","2186","2261","471","728","1147","1372","1961"],m=[s,u,c,d];i.DICT_VERSION=e,i.SINGLE_BYTE_TOKEN=l,i.DICTIONARY_0_TOKEN=s,i.DICTIONARY_1_TOKEN=u,i.DICTIONARY_2_TOKEN=c,i.DICTIONARY_3_TOKEN=d,i.DICTIONARIES=m}),66);
__d("WAXmlFormatter",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),n=t.length,r=!1,o=0,a="",i=0,s=["\n"];for(i=0;i<100;i++)s.push(s[i]+"    ");var u=function(t,n){var e=/^<[\w:\-.,]+/.exec(t[n-1]),r=/^<\/[\w:\-.,]+/.exec(t[n]);return e!=null&&r!=null&&e[0]===r[0]};for(i=0;i<n;i++)t[i].search(/<!/)>-1?(a+=s[o]+t[i],r=!0,(t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1||t[i].search(/!DOCTYPE/)>-1)&&(r=!1)):t[i].search(/-->/)>-1||t[i].search(/\]>/)>-1?(a+=t[i],r=!1):u(t,i)?(a+=t[i],r||o--):t[i].search(/<\w/)>-1&&t[i].search(/<\//)===-1&&t[i].search(/\/>/)===-1?(t[i]=l(t[i]),a=r?a+=t[i]:a+=s[o++]+t[i]):t[i].search(/<\w/)>-1&&t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\//)>-1?a=r?a+=t[i]:a+=s[o===0?o:--o]+t[i]:t[i].search(/\/>/)>-1?a=r?a+=t[i]:a+=s[o]+t[i]:t[i].search(/<\?/)>-1||t[i].search(/xmlns:/)>-1||t[i].search(/xmlns=/)>-1?a+=s[o]+t[i]:a+=t[i];return a[0]==="\n"?a.slice(1):a}function l(e){var t=e.match(/(<query.*>|<result>)(\{.*\})/);if(t===null)return e;try{var n=t[1],r=JSON.stringify(JSON.parse(t[2]),null,2);return n+"\n"+r}catch(t){return e+"[Error formatting JSON]"}}i.default=e}),66);
__d("WAXmlNode",["WAHex"],(function(t,n,r,o,a,i,l){"use strict";var e={},s=(function(){function t(t,n,r){n===void 0&&(n=e),r===void 0&&(r=null),this.tag=t,this.attrs=n,this.content=r}var n=t.prototype;return n.toString=function(){var e="<"+this.tag;e+=u(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t instanceof Uint8Array?e+=">"+c(t)+"</"+this.tag+">":t!=null?e+=">"+String(t)+"</"+this.tag+">":e+=" />",e},t})();function u(e){for(var t=Object.keys(e),n="",r=0;r<t.length;r++){var o=t[r];n+=" "+o+'="'+e[o].toString()+'"'}return n}function c(e){var t="";return e.length===0?t="<!-- empty binary -->":e.length<50?t=o("WAHex").bytesToDebugString(e):t="<!-- "+e.length+" bytes -->",t}l.XmlNode=s,l.attrsToString=u,l.uint8ArrayToDebugString=c}),98);
__d("WAWap",["WAAssertUnreachable","WABinary","WACryptoDependencies","WAJids","WALogger","WALongInt","WATextEncoding","WAWapDict","WAWapJid","WAXmlFormatter","WAXmlNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=(s=o("WAJids")).MSGR_USER_DOMAIN.replace("@",""),d=s.WA_USER_DOMAIN.replace("@",""),m=s.LID_DOMAIN.replace("@",""),p=s.INTEROP_DOMAIN.replace("@",""),_=s.HOSTED_DOMAIN.replace("@",""),f=2,g=128,h=0,y=236,C=237,b=238,v=239,S=[y,C,b,v],R=245,L=246,E=247,k=248,I=249,T=250,D=251,x=252,$=253,P=254,N=255,M=["0","1","2","3","4","5","6","7","8","9","-",".","\uFFFD","\uFFFD","\uFFFD","\uFFFD"],w=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],A="",F=1,O={sentinel:"DROP_ATTR"},B=(u=o("WAWapJid")).WapJid.create(null,"g.us"),W=u.WapJid.create(null,s.WA_SERVER_JID_SUFFIX),q=u.WapJid.create("status","broadcast"),U=u.WapJid.create(null,"newsletter"),V=u.WapJid.create(null,"hosted"),H=u.WapJid.create(null,"hosted.lid"),G=u.WapJid.create(null,"call"),z={},j=!1;function K(){j=!0}var Q=o("WATextEncoding").newTextEncoder(),X=(function(){function e(e,t,n){t===void 0&&(t=z),n===void 0&&(n=null),this.tag=e,this.attrs=t,this.content=n}var t=e.prototype;return t.toString=function(){var e="<"+this.tag;e+=o("WAXmlNode").attrsToString(this.attrs);var t=this.content;return Array.isArray(t)?e+=">"+t.map(String).join("")+"</"+this.tag+">":t?e+=">"+o("WAXmlNode").uint8ArrayToDebugString(t)+"</"+this.tag+">":e+=" />",j&&(e=r("WAXmlFormatter")(e)),e},e})();function Y(e,t,n){var a=null;if(t&&t.children!=null)throw r("err")('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(n))a=n.filter(Boolean);else if(typeof n=="string")a=o("WABinary").Binary.build(n).readByteArrayView();else if(n instanceof ArrayBuffer)a=new Uint8Array(n);else if(n instanceof Uint8Array)a=n;else{for(var i=[],l=2;l<arguments.length;l++){var s=arguments[l];s&&i.push(s)}a=i}Array.isArray(a)&&a.length===0&&(a=null);var u={};if(t){var c=t;Object.keys(c).forEach(function(t){if(!["__self","__source"].includes(t)){var n=c[t];if(n==null)throw r("err")("Attr "+t+" in <"+e+"> is null");n!==O&&(u[t]=n)}})}return new X(e,u,a)}var J=Y;function Z(e){return e instanceof o("WAWapJid").WapJid?e.toString():e}function ee(e){var t=e.content;return Array.isArray(t)?t=t.map(ee):typeof t=="string"&&(t=o("WABinary").Binary.build(t).readByteArrayView()),new X(e.tag,e.attrs||z,t)}function te(e){var t=e instanceof X?e:ee(e),n=new(o("WABinary")).Binary;ne(t,n);var r=0,a=n.readByteArrayView(),i=new Uint8Array(1+a.length);return i[0]=r,i.set(a,1),i}function ne(e,t){if(e==null)t.writeUint8(h);else if(e instanceof X)oe(e,t);else if(e instanceof o("WAWapJid").WapJid)re(e,t);else if(typeof e=="string")se(e,t);else if(e instanceof Uint8Array)ce(e,t);else{var n=typeof e;throw r("err")("Invalid payload type "+n)}}function re(e,t){var n=e.getInnerJid();if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_U){var r=n.device,a=n.domainType,i=n.user;t.writeUint8(E),t.writeUint8(a),t.writeUint8(r),ne(i,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_FB){var l=n.device,s=n.user;t.writeUint8(L),ne(s,t),t.writeUint16(l),ne(c,t)}else if(n.type===o("WAWapJid").WAP_JID_SUBTYPE.JID_INTEROP){var u=n.device,d=n.integrator,m=n.user;t.writeUint8(R),ne(m,t),t.writeUint16(u),t.writeUint16(d)}else{var p=n.server,_=n.user;t.writeUint8(T),_!=null?ne(_,t):t.writeUint8(h),ne(p,t)}}function oe(e,t){if(e.tag===void 0){t.writeUint8(k),t.writeUint8(h);return}var n=1;e.attrs&&(n+=Object.keys(e.attrs).length*2),e.content&&n++,n<256?(t.writeUint8(k),t.writeUint8(n)):n<65536&&(t.writeUint8(I),t.writeUint16(n)),ne(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach(function(n){se(n,t),ne(e.attrs[n],t)});var r=e.content;if(Array.isArray(r)){r.length<256?(t.writeUint8(k),t.writeUint8(r.length)):r.length<65536&&(t.writeUint8(I),t.writeUint16(r.length));for(var o=0;o<r.length;o++)oe(r[o],t)}else r&&ne(r,t)}var ae,ie;function le(e){for(var t=new Map,n=0;n<e.length;n++)t.set(e[n],n);return t}function se(e,t){if(e===""){t.writeUint8(x),t.writeUint8(0);return}ae==null&&(ae=le(o("WAWapDict").SINGLE_BYTE_TOKEN));var n=ae.get(e);if(n!=null){t.writeUint8(n+1);return}if(ie==null){ie=[];for(var r=0;r<o("WAWapDict").DICTIONARIES.length;++r)ie.push(le(o("WAWapDict").DICTIONARIES[r]))}for(var a=0;a<ie.length;++a){var i=ie[a].get(e);if(i!=null){t.writeUint8(S[a]),t.writeUint8(i);return}}var l=o("WABinary").numUtf8Bytes(e);if(l<128){var s=/[^0-9.-]+?/,u=/[^0-9A-F]+?/;if(s.exec(e)){if(!u.exec(e)){ue(e,D,t);return}}else{ue(e,N,t);return}}de(l,t),t.writeString(e)}function ue(e,t,n){var o=e.length%2===1;n.writeUint8(t);var a=Math.ceil(e.length/2);o&&(a|=g),n.writeUint8(a);for(var i=0,l=0;l<e.length;l++){var s=e.charCodeAt(l),u=null;if(48<=s&&s<=57?u=s-48:t===N?s===45?u=10:s===46&&(u=11):t===D&&65<=s&&s<=70&&(u=s-55),u==null)throw r("err")("Cannot nibble encode "+s);l%2===0?(i=u<<4,l===e.length-1&&(i|=15,n.writeUint8(i))):(i|=u,n.writeUint8(i))}}function ce(e,t){de(e.length,t),t.writeByteArray(e)}function de(e,t){if(e<256)t.writeUint8(x),t.writeUint8(e);else if(e<1048576)t.writeUint8($),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(e&255);else if(e<4294967296)t.writeUint8(P),t.writeUint32(e);else throw r("err")("Binary with length "+e+" is too big for WAP protocol")}function me(t,n){var r=new(o("WABinary")).Binary(t),a=r.readUint8(),i=a&f;return i?(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Decoding compressed stanza"]))),n(r.readByteArrayView()).then(function(e){return ge(new(o("WABinary")).Binary(e))})):Promise.resolve(ge(r))}function pe(e){var t=new(o("WABinary")).Binary(e),n=t.readUint8(),a=n&f;if(a)throw r("err")("Cannot pass compressed stanza to decodeStanzaDebug");return ge(t)}function _e(e,t){var n=e.readUint8();if(n===h)return null;if(n===k)return fe(e,e.readUint8());if(n===I)return fe(e,e.readUint16());if(n===x){var a=e.readUint8();return Re(e,a,t)}if(n===$){var i=e.readUint8(),l=e.readUint8(),s=e.readUint8(),u=((i&15)<<16)+(l<<8)+s;return Re(e,u,t)}if(n===P){var c=e.readUint32();return Re(e,c,t)}if(n===T)return Ce(e);if(n===L)return be(e);if(n===R)return ve(e);if(n===E)return Se(e);if(n===N){var d=e.readUint8(),m=d>>>7,p=d&127;return Le(e,M,m,p)}if(n===D){var _=e.readUint8(),f=_>>>7,g=_&127;return Le(e,w,f,g)}if(n<=0||n>=240)throw r("err")("Unable to decode WAP buffer");if(n>=y&&n<=v){var C=n-y,b=o("WAWapDict").DICTIONARIES[C];if(b===void 0)throw r("err")("Missing WAP dictionary "+C);var S=e.readUint8(),A=b[S];if(A===void 0)throw r("err")("Invalid value index "+S+" in dict "+C);return A}var F=o("WAWapDict").SINGLE_BYTE_TOKEN[n-1];if(F===void 0)throw r("err")("Undefined token with index "+n);return F}function fe(e,t){for(var n=[],r=0;r<t;r++)n.push(ge(e));return n}function ge(e){var t=e.readUint8(),n;if(t===k)n=e.readUint8();else if(t===I)n=e.readUint16();else throw r("err")("Failed to decode node since type byte "+String(t)+" is invalid");var a=void 0,i=null;if(n===0)throw r("err")("Failed to decode node, list cannot be empty");var l=he(e);for(n-=1;n>1;){a||(a={});var s=he(e),u=_e(e,!0);a[s]=u,n-=2}return n===1&&(i=_e(e,!1),i instanceof o("WAWapJid").WapJid&&(i=String(i)),typeof i=="string"&&(i=Q.encode(i))),new X(l,a,i)}function he(e){var t=_e(e,!0);if(typeof t!="string")throw r("err")("WAWap:decodeString got invalid value, string expected");return t}function ye(e){var t=_e(e,!0);if(t!=null&&typeof t!="string")throw r("err")("WAWap:decodeNullableString got invalid value, string expected");return t}function Ce(e){var t=ye(e),n=he(e);return o("WAWapJid").WapJid.create(t,n)}function be(e){var t=he(e),n=e.readUint16();return he(e),o("WAWapJid").WapJid.createFbJid(t,n)}function ve(e){var t=he(e),n=e.readUint16(),r=e.readUint16();return he(e),o("WAWapJid").WapJid.createInteropJid(t,n,r)}function Se(e){var t=null,n=e.readUint8();if(n===0)t=o("WAWapJid").DomainType.WHATSAPP;else if(n===1)t=o("WAWapJid").DomainType.LID;else if((1&n)===0&&(128&n)!==0)t=o("WAWapJid").DomainType.HOSTED;else if(n===129)t=o("WAWapJid").DomainType.HOSTED_LID;else throw r("err")("decodeJidU - Invalid domain type encoding "+n);var a=e.readUint8(),i=he(e);return o("WAWapJid").WapJid.createJidU(i,t,a)}function Re(e,t,n){return n===void 0&&(n=!1),n?e.readString(t):e.readByteArrayView(t)}function Le(e,t,n,r){for(var o=new Array(r*2-n),a=0;a<o.length-1;a+=2){var i=e.readUint8();o[a]=t[i>>>4],o[a+1]=t[i&15]}if(n){var l=e.readUint8();o[o.length-1]=t[l>>>4]}return o.join("")}function Ee(){if(!A){var e=new Uint16Array(2);o("WACryptoDependencies").getCrypto().getRandomValues(e),A=String(e[0])+"."+String(e[1])+"-"}return""+A+F++}function ke(e){switch(e.type){case"group":return e.groupJid;case"status":return o("WAJids").STATUS_JID;case"device":return e.deviceJid;case"newsletter":return e.newsletterJid;case"hosted":return e.hostedDeviceJid;case"hostedLid":return e.hostedLidDeviceJid;default:return e.type,e.broadcastJid}}function Ie(e){switch(e.type){case"group":return e.author;case"status":return e.author;case"broadcast":return e.author;default:return e.type,null}}function Te(e){return e.type==="status"||e.type==="group"||e.type==="broadcast"?xe(e.author):O}function De(e){return xe(ke(e))}function xe(e){var t=o("WAJids").validateDomainJid(e);if(t!=null)return $e(t);var n=e.split("@"),a=n[0],i=n[1],l=null,s=null;if((i===d||i===c||i===p||i===m||i===_||i===o("WAJids").HOSTED_LID_SUFFIX)&&a.indexOf(":")!==-1){var u=a.split(":");a=u[0],l=u[1],s=parseInt(l,10)}if(i===p){var f=a.split("-"),g=f[0],h=f[1];return o("WAWapJid").WapJid.createInteropJid(h,s,parseInt(g,10))}else if(i===c)return o("WAWapJid").WapJid.createFbJid(a,s);var y=null;if(i===m)y=o("WAWapJid").DomainType.LID;else if(i===_){if(s!==99)throw r("err")("wid unexpected deviceId");y=o("WAWapJid").DomainType.HOSTED}else if(i===o("WAJids").HOSTED_LID_SUFFIX){if(s!==99)throw r("err")("lid invalid deviceId");y=o("WAWapJid").DomainType.HOSTED_LID}else y=o("WAWapJid").DomainType.WHATSAPP;return s!=null&&s!==0?o("WAWapJid").WapJid.createJidU(a,y,s):o("WAWapJid").WapJid.create(a,i)}function $e(e){return e==="s.whatsapp.net"?W:e==="g.us"?B:e==="newsletter"?U:e==="call"?G:r("WAAssertUnreachable")(e)}function Pe(e){return xe(e)}function Ne(e){return xe(e)}function Me(e){return xe(e)}function we(e){return xe(e)}function Ae(e){return xe(e)}function Fe(e){return xe(e)}function Oe(e){return e.jidType==="phoneDevice"||e.jidType==="msgrDevice"||e.jidType==="lidDevice"?xe(e.deviceJid):e.jidType==="phoneUser"||e.jidType==="msgrUser"||e.jidType==="lidUser"?xe(e.userJid):e.jidType==="group"?xe(e.groupJid):e.jidType==="status"?xe(e.statusJid):e.jidType==="call"?xe(e.callJid):e.jidType==="interopDevice"?xe(e.deviceJid):e.jidType==="interopUser"?xe(e.userJid):e.jidType==="newsletter"?xe(e.newsletterJid):e.jidType==="hosted"?xe(e.hostedDeviceJid):e.jidType==="hostedLid"?xe(e.hostedLidDeviceJid):e.jidType==="bot"?xe(e.botJid):(e.jidType,xe(e.broadcastJid))}function Be(e){return e}function We(e){return e.toString()}function qe(e){return e}function Ue(e){return e}function Ve(e){return e==null?O:e}function He(e){return e.toString()}function Ge(e){return o("WALongInt").longIntToDecimalString(e)}function ze(e,t){t===void 0&&(t=4);for(var n=e,r=new Uint8Array(t),o=t-1;o>=0;o--)r[o]=n&255,n>>>=8;return r}l.DROP_ATTR=O,l.G_US=B,l.S_WHATSAPP_NET=W,l.STATUS_BROADCAST=q,l.NEWSLETTER=U,l.HOSTED=V,l.HOSTED_LID=H,l.CALL=G,l.enableXMLFormat=K,l.WapNode=X,l.makeWapNode=Y,l.wap=J,l.decodeAsString=Z,l.makeStanza=ee,l.encodeStanza=te,l.decodeStanza=me,l.decodeStanzaDebug=pe,l.generateId=Ee,l.extractToJid=ke,l.extractParticipantJid=Ie,l.PARTICIPANT_JID=Te,l.TO_JID=De,l.JID=xe,l.DOMAIN_JID=$e,l.USER_JID=Pe,l.DEVICE_JID=Ne,l.GROUP_JID=Me,l.BROADCAST_JID=we,l.CALL_JID=Ae,l.NEWSLETTER_JID=Fe,l.TO_WAP_JID=Oe,l.STANZA_ID=Be,l.SMAX_ID=We,l.CUSTOM_STRING=qe,l.CALL_ID=Ue,l.MAYBE_CUSTOM_STRING=Ve,l.INT=He,l.LONG_INT=Ge,l.BIG_ENDIAN_CONTENT=ze}),98);
__d("WASmaxJsx",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";l.smax=o("WAWap").wap}),98);
__d("WASmaxMixins",["WAArrayBufferUtils","WAWapJid"],(function(t,n,r,o,a,i,l){"use strict";var e="smax$any";function s(e,t){return c(e,t),d(e,t),t.content instanceof Uint8Array?p(e,t.content):t.content!=null&&_(e,t.content),e}function u(e,t,n,r){return n!=null?e(t,n,r):t}function c(t,n){var r=t.tag,o=n.tag;if(o!==e&&r!==o)throw new Error("tag mismatch: "+r+" != "+o)}function d(e,t){var n=e.attrs,r=t.attrs;Object.keys(r).forEach(function(e){var t=r[e],o=n[e];if(t!=null&&o!=null){if(m(t,o))return;throw new Error("conflict for key: "+e)}n[e]=t})}function m(e,t){return typeof e=="string"&&typeof t=="string"?e===t:e instanceof o("WAWapJid").WapJid&&t instanceof o("WAWapJid").WapJid?e.toString()===t.toString():!1}function p(e,t){var n=e.content;if(n instanceof Uint8Array){if(!o("WAArrayBufferUtils").uint8ArraysEqualUNSAFE(n,t))throw new Error("elementValue mismatch: bytes dose not equal");return}if(n!=null)throw new Error("elementValue mismatch: destination has children");e.content=t}function _(e,t){var n=e.content;if(n instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(n==null||n.length===0){e.content=t;return}if(!f(n,t))throw new Error("children mismatch: child counts are not compatible");var r=[],o=Array.from(n);t.forEach(function(e){var t=o.findIndex(function(t){return t.tag===e.tag});if(t===-1)r.push(e);else{var n=o.splice(t,1),a=s(n[0],e);r.push(a)}}),o.forEach(function(e){return r.push(e)}),e.content=r}function f(e,t){for(var n=g(t),r=g(e),o=Object.keys(n),a=0;a<o.length;a++){var i=o[a],l=n[i],s=r[i];if(l!=null&&s!=null&&l!==s)return!1}return!0}function g(e){return e.reduce(function(e,t){var n=t.tag,r=e[n];return e[n]=r==null?1:r+1,e},{})}l.mergeStanzas=s,l.optionalMerge=u}),98);
__d("WASmaxOutPingsClientWellFormedToMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeClientWellFormedToMixin=s}),98);
__d("WASmaxOutPingsClientRequest",["WASmaxJsx","WASmaxOutPingsClientWellFormedToMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutPingsClientWellFormedToMixin").mergeClientWellFormedToMixin(o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get",xmlns:"w:p"}));return e}l.makeClientRequest=e}),98);
__d("WAComms",["WAArrayUtils","WABaseGlobals","WAErrors","WALogger","WANotifyConnectionChangeFactory","WAPromiseRetryLoop","WAResolvable","WAShiftTimer","WASmaxInPingsClientResponseServerResponse","WASmaxOutPingsClientRequest","WASmaxParseUtils","WATimeUtils","WAWap","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D,x,$,P,N,M,w=null,A=null,F=1,O=0,B=(function(){function t(t,n,r){var a=this,i,l,c;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this.pendingSmaxStanzas=new Map,this.$2=new(o("WAResolvable")).Resolvable,this.socketAbortController=null,this.activePing=null,this.$3=new Set,this.socketId=O,this.socket=null,this.softCloseSocket=null,this.handleStanza=function(t,n,r){var i=o("WASmaxParseUtils").attrString(t,"id");if(i.success&&t.tag!=="receipt"){var l=i.value,u=a.pendingSmaxStanzas.get(l);if(u)return a.pendingSmaxStanzas.delete(l),u.resolve(t),a.maybeScheduleHealthCheck(),"NO_ACK"}var c=ue(t);if(c!=null){var d=a.pendingIqs.get(c);d?(a.pendingIqs.delete(c),d.resolve(t),a.maybeScheduleHealthCheck()):(o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq with id ",""])),c),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["handleIq no handler for iq"]))))}else if(t.tag==="ack")a.handleAck(t);else return t.tag==="failure"&&a.config.shouldBlockReceivingUntilSuccess?a.$1(t,n,r):a.$2.promise.then(function(){return a.$1(t,n,r)});return"NO_ACK"},this.healthCheckTimer=new(o("WAShiftTimer")).ShiftTimer(function(){a.socketId&&a.sendPing()}),this.deadSocketTimer=new(o("WAShiftTimer")).ShiftTimer(function(e){e===a.socketId&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," expired"])),e),a.softCloseSocket&&a.softCloseSocket())}),this.$1=t,this.onConnectionChange=o("WANotifyConnectionChangeFactory").notifyConnectionChangeFactory((i=n.handlers.onConnectionChange)!=null?i:function(){},(l=n.handlers.onOptimisticConnectionChange)!=null?l:function(){}),this.gzipInflate=r,this.config=n,this.socketLoop=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"MainSocketLoop",code:Y,timer:(c=n.socketReconnectBackoffAlgo)!=null?c:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4,isPauseEnabled:n.isPauseEnabled===!0})}var n=t.prototype;return n.filterPending=function(t){var e=[];function n(n){t(n)&&e.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),this.pendingSmaxStanzas.forEach(n),e},n.sendPendingStanza=function(t){t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.callStanza(t.stanza)},n.maybeSendPendingStanza=function(t){if(t.attempt>=this.config.maxRetries){var e,n;(e=(n=this.config.handlers).onDropStanza)==null||e.call(n,t),t.cleanup==null||t.cleanup(),t.cleanup=void 0,this.removeHandler(t,"max-retries")}else if(this.socket){t.attempt+=1,this.sendPendingStanza(t);return}else o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will resend stanza when socket opens"])))},n.callStanzaAsync=async function(t,n){var e=await this.callStanza(t,n);return e},n.callStanza=function(t,n){var e=this.castStanza(t,n);return this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel(),e},n.castStanzaAsync=async function(t){var e=await this.castStanza(t);return e},n.castStanza=function(t,n){var e=this;try{var r,a,i=(r=(a=this.config.handlers).onBeforeCastStanzaForE2E)==null?void 0:r.call(a,t,n);if(i!=null)return o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Dropping stanza since onBeforeCastStanza matched. We return mock response directly."]))),Array.isArray(i)?Promise.all(i.map(function(t){return Promise.resolve(e.handleStanza(t,e.socketId,O))})):(this.handleStanza(i,this.socketId,O),Promise.resolve())}catch(e){}var l=this.socketOrThrow("castStanza");try{return l.sendFrame(o("WAWap").encodeStanza(t)).then(function(){e.config.handlers.onCastStanza==null||e.config.handlers.onCastStanza(t,n)}).catch(function(e){if(o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["castStanza async error ",""])),e),e instanceof o("WAErrors").BufferTooLargeError)return Promise.reject(e)})}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["castStanza error ",""])),e)}return Promise.resolve()},n.socketOrThrow=function(t){var e=this.socket;if(e)return e;throw r("err")("Comms."+t+" called while no socket")},n.startHandlingRequests=function(){return o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Comms.startHandlingRequests"]))),this.$2.resolve(),this.$2.promise.then(function(){})},n.parseAndHandleStanza=function(t,n){var e=this;t===this.socketId&&(this.deadSocketTimer.cancel(),A&&(A.resolve(),A=null));var r=o("WAWap").decodeStanza(n,this.gzipInflate).catch(function(e){throw o("WALogger").ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Failure parsing stanza!"]))),e}).then(function(r){e.config.handlers.onHandleStanza==null||e.config.handlers.onHandleStanza(r,t,n.byteLength);var o=e.activePing;return o&&o.socketId===t&&o.stanzaId===ue(r)?(e.activePing=null,o.handler.resolve(r),e.maybeScheduleHealthCheck(),"NO_ACK"):e.handleStanza(r,t,n.byteLength)}).then(function(n){if(t===e.socketId){if(n==="CLOSE_SOCKET"){o("WALogger").LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["[comms] job response is CLOSE_SOCKET"])));var r=e.socket;r&&r.close()}else n==="NO_ACK"||e.castStanza(n);return"NO_ACK"}});this.$3.add(r),r.finally(function(){return void e.$3.delete(r)})},n.handleAck=function(t){for(var e=this.ackHandlers,n=-1,r=null;!r&&++n<e.length;)r=e[n].parseAndTest(t);if(r){var a,i,l=e[n];o("WAArrayUtils").removeIndexWithoutPreservingOrder(e,n),(a=(i=this.config.handlers).onHandleAck)==null||a.call(i,t),l.resolve(r),this.maybeScheduleHealthCheck()}else o("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["handleAck: unrecognized ",""])),t)},n.removeHandler=function(t,n){if(n===void 0&&(n="disconnect"),t.type==="iq"||t.type==="smax"){var e=t.stanza.attrs.id;if(!e||typeof e!="string"||t.type==="iq"&&!this.pendingIqs.delete(e)||t.type==="smax"&&!this.pendingSmaxStanzas.delete(e))return}else{t.type;var r=this.ackHandlers.indexOf(t);if(r===-1)return;o("WAArrayUtils").removeIndexWithoutPreservingOrder(this.ackHandlers,r)}n==="disconnect"?t.resolve(Promise.reject(new(o("WAErrors")).Disconnected)):n==="abort"?t.resolve(Promise.reject(new(o("WAErrors")).Aborted)):t.resolve(Promise.reject(new(o("WAErrors")).MaxRetries))},n.maybeScheduleHealthCheck=function(){if(!this.healthCheckTimer.isScheduled()&&!(this.activePing||this.ackHandlers.length||this.pendingIqs.size||this.pendingSmaxStanzas.size)){var e=this.config.healthCheckInterval,t=Math.ceil(e*1e3*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}},n.sendPing=async function(){var e=se("sendPing");if(!e.socketId)return o("WALogger").LOG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing when socket dead"]))),!1;if(e.activePing&&e.activePing.socketId===e.socketId)return o("WALogger").LOG(C||(C=babelHelpers.taggedTemplateLiteralLoose(["[comms] sendPing ping still pending"]))),!1;e.activePing&&e.activePing.handler.resolve();var t=o("WASmaxOutPingsClientRequest").makeClientRequest(),n=t.attrs.id;if(typeof n!="string")return o("WALogger").ERROR(b||(b=babelHelpers.taggedTemplateLiteralLoose(["[comms] No stanzaId in ping request stanza"]))),!1;var r=new(o("WAResolvable")).Resolvable;e.activePing={socketId:e.socketId,stanzaId:n,handler:r};var a=Date.now();e.callStanza(t);var i=await r.promise,l=Date.now();if(i){var s=o("WASmaxInPingsClientResponseServerResponse").parseClientResponseServerResponse(i,t);if(s.success){var u=l-a,c=Math.round(u/2),d=o("WATimeUtils").castToUnixTime(s.value.t),m=o("WABaseGlobals").newClockSkewCalculation()?Math.round((a+c)/1e3-d):Math.round(Date.now()/1e3-d);return e.config.handlers.onClockSkewUpdate==null||e.config.handlers.onClockSkewUpdate(m),!0}}return!1},t})();function W(){return w}function q(e,t,n,r){r===void 0&&(r=!0),!w&&(w=new B(e,t,n),r&&setTimeout(z,0))}function U(){var e=se("stopComms");e.socketLoop.endWithValue(),e.socket&&J(),w=null}function V(){var e=se("closeSocketAndPreventRetry");e.socketLoop.endWithValue(),e.socket&&(o("WALogger").LOG(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPreventRetry called"]))),J())}function H(){var e=se("closeSocketAndPause");e.socketLoop.pauseOnNextIteration(),e.socket&&(o("WALogger").LOG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndPause called"]))),J())}function G(){var e=se("closeSocketAndResume");e.socketLoop.unpause(),e.socket&&(o("WALogger").LOG(R||(R=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocketAndResume called"]))),J())}function z(){se("openSocketLoop").socketLoop.start()}function j(){o("WALogger").LOG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["[comms] maybeResetSocketLoop"]))),X()||se("maybeResetSocketLoop").socketLoop.reset()}function K(){se("forceResetSocketLoop").socketLoop.reset()}function Q(){var e,t=se("socketAbortController");(e=t.socketAbortController)==null||e.abort(),t.softCloseSocket==null||t.softCloseSocket()}function X(){var e;return!!((e=w)!=null&&e.socket)}function Y(){var e,t=se("socketLoopIteration"),n=t.nextSocketId++;o("WALogger").LOG(E||(E=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opening"])),n);var r=function(){t.onConnectionChange("in_handshake")};return t.config.handlers.onSocketLoopIteration==null||t.config.handlers.onSocketLoopIteration(t.socketAbortController),typeof AbortController=="function"&&(t.socketAbortController=new AbortController),t.config.openChatSocket(r,(e=t.socketAbortController)==null?void 0:e.signal).then(function(e){if(e.success){var r=e.value;t.config.handlers.onSocketOpen==null||t.config.handlers.onSocketOpen();var a=new(o("WAResolvable")).Resolvable;return o("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," opened"])),n),t.socketId=n,t.socket=r,t.softCloseSocket=function(){t.softCloseSocket=null,t.socket&&t.config.shouldCloseStaleSocket&&(J(),t.socket=null),a.resolve()},t.socketLoop.resetTimeoutAfter(1e4),t.deadSocketTimer.cancel(),t.maybeScheduleHealthCheck(),r.setOnFrame(function(e){return t.parseAndHandleStanza(n,e)}),r.setOnClose(function(){o("WALogger").LOG(I||(I=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),n),t.activePing&&n===t.activePing.socketId&&(t.activePing.handler.resolve(),t.activePing=null),t.filterPending(function(e){return e.attachedToSocketId===n}).forEach(function(e){return void t.removeHandler(e)}),n===t.socketId&&(t.socketId=O,t.socket=null,t.onConnectionChange("disconnected"),t.config.handlers.onDisconnect==null||t.config.handlers.onDisconnect(),a.resolve())}),t.onConnectionChange("connected"),t.config.handlers.onConnect==null||t.config.handlers.onConnect(),t.filterPending(function(e){return!e.attachedToSocketId}).sort(function(e,t){return e.orderedId-t.orderedId}).forEach(function(e){switch(e.type){case"smax":case"iq":t.maybeSendPendingStanza(e);break;case"ack":t.callStanza(e.stanza);break;default:e.type;break}}),a.promise}else{var i=e.error;switch(i){case"max-hunters":o("WALogger").WARN(T||(T=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake using treasureHunt strategy"])));break;case"disconnected":o("WALogger").WARN(D||(D=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket disconnected while in noise handshake"])));break;default:return}}}).catch(function(e){e instanceof o("WAErrors").Disconnected?o("WALogger").LOG(x||(x=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration socket closed while in noise handshake"]))):o("WALogger").ERROR($||($=babelHelpers.taggedTemplateLiteralLoose(["[comms] socketLoopIteration failed ",""])),e)})}function J(){var e=se("closeSocket");e.socket&&(o("WALogger").LOG(P||(P=babelHelpers.taggedTemplateLiteralLoose(["[comms] Socket "," closed"])),e.socketId),o("WALogger").LOG(N||(N=babelHelpers.taggedTemplateLiteralLoose(["[comms] closeSocket called"]))),e.socket.close())}function Z(){se("onStreamErrorReceived").socketLoop.cancelReset()}function ee(){return se("waitForConnection").sendPing(),A||(A=new(o("WAResolvable")).Resolvable),A.promise}function te(e,t){var n=se("castStanza");n.socket?n.castStanza(e,t):o("WALogger").LOG(M||(M=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket"])))}function ne(e){var t=se("castStanza");return t.socketId===e}function re(e,t,n,a,i){return n===void 0&&(n=0),i===void 0&&(i="iq"),new Promise(function(l){var s=se("sendIq"),u=e.attrs.id;if(!u||typeof u!="string")throw r("err")("[comms] sendIq given iq without id: "+String(e));var c=s.socketId;if(t&&!c){l(Promise.reject(new(o("WAErrors")).Offline));return}var d=function(t){t===void 0&&(t="disconnect");var e=i==="iq"?s.pendingIqs.get(u):s.pendingSmaxStanzas.get(u);if(!e){l(Promise.reject(r("err")("[comms] _sendIq unexisting stanza to be cancelled: "+u)));return}s.removeHandler(e,t)},m=null;if(n>0){var p=setTimeout(d,n*1e3);m=function(){clearTimeout(p)}}if(a!=null)if(a.aborted){l(Promise.reject(new(o("WAErrors")).Disconnected));return}else{var _=function(){d("abort")};a.addEventListener("abort",_),m=function(){a.removeEventListener("abort",_)}}var f={resolve:l,stanza:e,attachedToSocketId:t?c:O,orderedId:F++,attempt:0,cleanup:m};if(i==="iq"){var g=babelHelpers.extends({type:i},f);s.pendingIqs.set(u,g),s.config.handlers.onSendIq==null||s.config.handlers.onSendIq(e),s.maybeSendPendingStanza(g)}else{var h=babelHelpers.extends({type:i},f);s.pendingSmaxStanzas.set(u,h),s.maybeSendPendingStanza(h)}})}function oe(e,t){var n,r,o,a=(n=t==null?void 0:t.withoutRetry)!=null?n:!1,i=(r=t==null?void 0:t.timeoutSeconds)!=null?r:0,l=(o=t==null?void 0:t.signal)!=null?o:null;return re(e,a,i,l,"smax")}function ae(){var e=se("sendPing");return e.sendPing()}function ie(){return se("startHandlingRequests").startHandlingRequests()}function le(){w&&w.deadSocketTimer.cancel()}function se(e){if(w)return w;throw r("err")("[comms] "+e+" called before startComms")}function ue(e){if(e.tag==="iq"){var t=e.attrs.type;if(t==="result"||t==="error")return o("WAWap").decodeAsString(e.attrs.id)||null}return null}function ce(){return F++}function de(){w=null,A=new(o("WAResolvable")).Resolvable,F=1}l.DEFAULT_SOCKET_ID=O,l.getComms=W,l.startComms=q,l.stopComms=U,l.closeSocketAndPreventRetry=V,l.closeSocketAndPause=H,l.closeSocketAndResume=G,l.openSocketLoop=z,l.maybeResetSocketLoop=j,l.forceResetSocketLoop=K,l.forceAbortSocketConnection=Q,l.isSocketConnected=X,l.socketLoopIteration=Y,l.closeSocket=J,l.onStreamErrorReceived=Z,l.waitForConnection=ee,l.castSmaxStanza=te,l.isActiveSocket=ne,l._sendIq=re,l.sendSmaxStanza=oe,l.sendPing=ae,l.startHandlingRequests=ie,l.cancelDeadSocketTimer=le,l.singletonOrThrowIfUninitialized=se,l.getAndIncrementNextOrderedId=ce,l.resetStateForTests=de}),98);
__d("WADecimalStringMod",["WALogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t,n){if(!/^\d+$/.test(t))throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string'])),t),r("err")("decimalStringMod is given an invalid decimal string");var a=t.length;if(a<16||a===16&&t<="9007199254740991")return Number(t)%n;if(a>20||a===20&&t>"18446744073709551615")throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits'])),t),r("err")("decimalStringMod is given value over 64 bits");for(var i=0,l=0;l<t.length;l++){var u=Number(t[l]);i=(i*10+u)%n}return i}l.decimalStringMod=u}),98);
__d("WACreateGetVcaEnabledBucket",["WAArrayBufferUtils","WADecimalStringMod","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(e,t){return function(){return t==null?null:o("WAArrayBufferUtils").arrayBufferMod(e,t)+100}}function u(t,n){return function(){if(n==null)return null;var r=t.split("/"),a=r[r.length-1],i=a.split("_")[1];return/^\d+$/.test(i)?i==null?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["mediaRouteSelection: can't get fbId from mediaDirectPath"]))),null):o("WADecimalStringMod").decimalStringMod(i,n)+100:null}}l.createGetVcaEnabledBucket=s,l.msgrCreateGetVcaEnabledBucket=u}),98);
__d("WAExtractNcHotTimestamp",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return null;var t=s(e);if(t.has("_nc_hot")){var n=parseInt(t.get("_nc_hot"),10);return Number.isInteger(n)?o("WATimeUtils").castToUnixTime(n):null}else return null}function s(e){var t=e.split("?");return new URLSearchParams(t.length===2?t[1]:"")}l.extractNcHotTimestamp=e}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(t,n,r,o,a,i,l){var e,s={},u={},c={},d={},m={},p={},_={},f={},g={},h={},y={},C={},b={},v={},S={};s.internalSpec={sessionVersion:[1,(e=o("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,e.TYPES.BYTES],remoteIdentityPublic:[3,e.TYPES.BYTES],rootKey:[4,e.TYPES.BYTES],previousCounter:[5,e.TYPES.UINT32],senderChain:[6,e.TYPES.MESSAGE,d],receiverChains:[7,e.FLAGS.REPEATED|e.TYPES.MESSAGE,d],pendingKeyExchange:[8,e.TYPES.MESSAGE,c],pendingPreKey:[9,e.TYPES.MESSAGE,u],remoteRegistrationId:[10,e.TYPES.UINT32],localRegistrationId:[11,e.TYPES.UINT32],needsRefresh:[12,e.TYPES.BOOL],aliceBaseKey:[13,e.TYPES.BYTES]},u.internalSpec={preKeyId:[1,e.TYPES.UINT32],signedPreKeyId:[3,e.TYPES.INT32],baseKey:[2,e.TYPES.BYTES]},c.internalSpec={sequence:[1,e.TYPES.UINT32],localBaseKey:[2,e.TYPES.BYTES],localBaseKeyPrivate:[3,e.TYPES.BYTES],localRatchetKey:[4,e.TYPES.BYTES],localRatchetKeyPrivate:[5,e.TYPES.BYTES],localIdentityKey:[7,e.TYPES.BYTES],localIdentityKeyPrivate:[8,e.TYPES.BYTES]},d.internalSpec={senderRatchetKey:[1,e.TYPES.BYTES],senderRatchetKeyPrivate:[2,e.TYPES.BYTES],chainKey:[3,e.TYPES.MESSAGE,p],messageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,m]},m.internalSpec={index:[1,e.TYPES.UINT32],cipherKey:[2,e.TYPES.BYTES],macKey:[3,e.TYPES.BYTES],iv:[4,e.TYPES.BYTES]},p.internalSpec={index:[1,e.TYPES.UINT32],key:[2,e.TYPES.BYTES]},_.internalSpec={currentSession:[1,e.TYPES.MESSAGE,s],previousSessions:[2,e.FLAGS.REPEATED|e.TYPES.MESSAGE,s]},f.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES]},g.internalSpec={id:[1,e.TYPES.UINT32],publicKey:[2,e.TYPES.BYTES],privateKey:[3,e.TYPES.BYTES],signature:[4,e.TYPES.BYTES],timestamp:[5,e.TYPES.FIXED64]},h.internalSpec={publicKey:[1,e.TYPES.BYTES],privateKey:[2,e.TYPES.BYTES]},y.internalSpec={senderKeyId:[1,e.TYPES.UINT32],senderChainKey:[2,e.TYPES.MESSAGE,v],senderSigningKey:[3,e.TYPES.MESSAGE,C],senderMessageKeys:[4,e.FLAGS.REPEATED|e.TYPES.MESSAGE,b]},C.internalSpec={public:[1,e.TYPES.BYTES],private:[2,e.TYPES.BYTES]},b.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},v.internalSpec={iteration:[1,e.TYPES.UINT32],seed:[2,e.TYPES.BYTES]},S.internalSpec={senderKeyStates:[1,e.FLAGS.REPEATED|e.TYPES.MESSAGE,y]},l.SessionStructureSpec=s,l.SessionStructure$PendingPreKeySpec=u,l.SessionStructure$PendingKeyExchangeSpec=c,l.SessionStructure$ChainSpec=d,l.SessionStructure$Chain$MessageKeySpec=m,l.SessionStructure$Chain$ChainKeySpec=p,l.RecordStructureSpec=_,l.PreKeyRecordStructureSpec=f,l.SignedPreKeyRecordStructureSpec=g,l.IdentityKeyPairStructureSpec=h,l.SenderKeyStateStructureSpec=y,l.SenderKeyStateStructure$SenderSigningKeySpec=C,l.SenderKeyStateStructure$SenderMessageKeySpec=b,l.SenderKeyStateStructure$SenderChainKeySpec=v,l.SenderKeyRecordStructureSpec=S}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(t,n,r,o,a,i,l){"use strict";var e=5,s=16777215;function u(e,t){return{publicKey:e,privateKey:t}}function c(e){var t=o("WACryptoPrimitives").keypairFromSecretKey(e),n=t.publicKey,r=t.secretKey;return u(o("WASignalOther").ensureSize(n,32),o("WASignalOther").ensureSize(r,32))}function d(e,t){return{publicKey:o("WASignalOther").toBytes(e,32),privateKey:o("WASignalOther").toBytes(t,32)}}function m(){var e=o("WACryptoPrimitives").keyPair(),t=e.publicKey,n=e.secretKey;return n[0]&=248,n[31]=64|n[31]&63,u(o("WASignalOther").ensureSize(t,32),o("WASignalOther").ensureSize(n,32))}function p(e,t){return u(o("WASignalOther").sliceBytes(t,1,32),e)}function _(e,t){return{serializedPubKey:t,privateKey:e}}function f(){var e=m();return _(e.privateKey,g(e))}function g(t){var n=o("WASignalOther").makeBytes(33);return n[0]=e,n.set(t.publicKey,1),n}function h(t){var n=o("WASignalOther").makeBytes(33);return n[0]=e,n.set(o("WASignalOther").ensureSize(t,32),1),n}function y(e){return _(e.privateKey,g(e))}function C(e,t){for(var n=e>=s?0:e-1,r=[],a=0;a<t;a++){var i=n+1>=s?1:n+1,l=m(),u=o("WASignalOther").encodeSignalProto(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:i,publicKey:g(l),privateKey:l.privateKey});r.push({plainObject:{id:i,keyPair:l},record:u}),n=i}return r}function b(e){try{var t=o("decodeProtobuf").decodeProtobuf(o("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,e),n=t.id,r=t.privateKey,a=t.publicKey;return n==null||a==null||r==null?null:{id:v(n),keyPair:p(o("WASignalOther").toBytes(r,32),R(new Uint8Array(a)))}}catch(e){return null}}function v(e){return o("WASignalOther").ensureIntInRange(e,1,s)}function S(e){return o("WASignalOther").ensureIntInRange(e,0,s)}function R(t){if(t.length===0||t[0]!==e)throw r("err")("Unrecognized public key type");return o("WASignalOther").ensureSize(t,33)}function L(){var e=o("WASignalOther").makeBytes(32);return o("WACryptoDependencies").getCrypto().getRandomValues(e),e}function E(e,t){return o("WACryptoPrimitives").scalarMult(e,t.subarray(1)).buffer}l.KEY_TYPE=e,l.PRE_KEY_NON_INCLUSIVE_UPPER_BORDER=s,l.makeKeyPairFrom=c,l.makeKeyPairFromArrayBuffers=d,l.makeKeyPair=m,l.makeKeyPairFromSerialized=p,l.makeSerializedKeyPairFrom=_,l.makeSerializedKeyPair=f,l.serializePubKey=g,l.serializeIdentity=h,l.toSerializedKeyPair=y,l.makePreKeys=C,l.deserializePreKey=b,l.castToPreKeyId=v,l.castToSignedPreKeyId=S,l.castToSerializedPubKey=R,l.makeRawSenderKey=L,l.ecdh=E}),98);
__d("WAParsableWapNode",["WABinary","WAJids","WALogger","WALongInt","WAParsableXmlNode","WASignalKeys","WATimeUtils","WAWap","WAWapJid","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=(function(e){function t(t,n){var r;return r=e.call(this,"XmppParsingFailure: "+t+": "+n)||this,r.name="XmppParsingFailure",r.parser=t,r.reason=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.toString=function(){return"XmppParsingFailure: "+this.parser+": "+this.reason},t})(babelHelpers.wrapNativeSuper(Error)),c=(function(t){function n(e,n){return t.call(this,e,n)||this}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.assertFromServer=function(){var e=this.attrString("from");e!==o("WAJids").WA_SERVER_JID_SUFFIX&&this.throw('to have "from"="s.whatsapp.net", but instead has "'+e+'"')},a.attrUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.botJid!=null?n.botJid:n.userJid==null?this.throw('to have "'+t+'"={UserJid}, but instead has "'+e+'"'):n.userJid},a.attrPhoneUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:this.throw('to have "'+t+'"={PhoneUserJid}, but instead has "'+e+'"')},a.attrLidUserJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidUser"?n.userJid:this.throw('to have "'+t+'"={LidUserJid}, but instead has "'+e+'"')},a.maybeAttrUserJid=function(t){return this.hasAttr(t)?this.attrUserJid(t):null},a.maybeAttrPhoneUserJid=function(t){return this.hasAttr(t)?this.attrPhoneUserJid(t):null},a.maybeAttrLidUserJid=function(t){return this.hasAttr(t)?this.attrLidUserJid(t):null},a.attrGroupJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.groupJid==null?this.throw('to have "'+t+'"={GroupJid}, but instead has "'+e+'"'):n.groupJid},a.maybeAttrGroupJid=function(t){return this.hasAttr(t)?this.attrGroupJid(t):null},a.attrChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.userJid!=null?n.userJid:n.groupJid!=null?n.groupJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrPhoneChatJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneUser"?n.userJid:n.jidType==="group"?n.groupJid:this.throw('to have "'+t+'"={ChatJid}, but instead has "'+e+'"')},a.attrDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.deviceJid!=null?n.deviceJid:n.userJid!=null?o("WAJids").defaultDeviceJidForUser(n.userJid):n.hostedDeviceJid!=null?n.hostedDeviceJid:n.hostedLidDeviceJid!=null?n.hostedLidDeviceJid:n.botJid!=null?n.botJid:this.throw('to have "'+t+'"={DeviceJid}, but instead has "'+e+'"')},a.attrPhoneDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="phoneDevice"?n.deviceJid:n.jidType==="phoneUser"?o("WAJids").defaultPhoneDeviceJidForUser(n.userJid):this.throw('to have "'+t+'"={PhoneDeviceJid}, but instead has "'+e+'"')},a.attrLidDeviceJid=function(t){var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="lidDevice"?n.deviceJid:n.jidType==="lidUser"?o("WAJids").defaultLidDeviceJidForLidUserJid(n.userJid):this.throw('to have "'+t+'"={LidDeviceJid}, but instead has "'+e+'"')},a.attrDeviceId=function(t){var e=this.attrInt(t);return o("WAJids").interpretAsDeviceId(e)},a.attrFromJidChat=function(){var t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{var n=t.userJid,a=o("WAJids").defaultDeviceJidForUser(n);return{type:"device",chat:n,deviceJid:a,author:a}}case"interopUser":{var i=t.userJid,l=o("WAJids").defaultDeviceJidForUser(i);return{type:"device",chat:i,deviceJid:l,author:l}}case"phoneUser":{var s=t.userJid,u=o("WAJids").defaultDeviceJidForUser(s);return{type:"device",chat:s,deviceJid:u,author:u}}case"lidUser":{var c=t.userJid,d=o("WAJids").defaultLidDeviceJidForLidUserJid(c);return{type:"device",chat:c,deviceJid:d,author:d}}case"phoneDevice":{var m=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(m),deviceJid:m,author:m}}case"msgrDevice":{var p=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(p),deviceJid:p,author:p}}case"interopDevice":{var _=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(_),deviceJid:_,author:_}}case"lidDevice":{var f=t.deviceJid;return{type:"device",chat:o("WAJids").extractUserJid(f),deviceJid:f,author:f}}case"group":{var g=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return g==null?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:g}}case"broadcast":{var h=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return h==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:o("WAJids").extractUserJid(h),author:h}}case"hosted":{var y=t.hostedDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(y),deviceJid:y,author:y}}case"hostedLid":{var C=t.hostedLidDeviceJid;return{type:"device",chat:o("WAJids").extractUserJid(C),deviceJid:C,author:C}}case"call":throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),t.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with jid of type "+t.jidType)}},a.attrFromJidPhoneChat=function(){var e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{var t=e.userJid,n=o("WAJids").defaultPhoneDeviceJidForUser(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{var a=e.deviceJid;return{type:"device",chat:o("WAJids").extractPhoneUserJid(a),deviceJid:a,author:a}}case"group":{var i=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return i==null?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:i}}case"broadcast":{var l=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return l==null?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:o("WAJids").extractPhoneUserJid(l),author:l}}case"call":throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["ParsableWapNode: attrFromJid() is called with ",""])),e.callJid),r("err")("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw("attrFromJidChat should not be used with jid of type "+e.jidType)}},a.attrFromPhoneJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}else return this.attrFromJidPhoneChat()},a.attrFromJid=function(){var e=this.attrJidWithType();if(e.jidType==="status"){var t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return t==null?this.throw("to have participant for status msg"):{type:"status",author:t}}return e.jidType==="newsletter"?{type:"newsletter",newsletterJid:e.newsletterJid}:e.jidType==="hosted"?{type:"hosted",hostedDeviceJid:e.hostedDeviceJid}:e.jidType==="hostedLid"?{type:"hostedLid",hostedLidDeviceJid:e.hostedLidDeviceJid}:this.attrFromJidChat()},a.attrJidWithType=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?this.throw('to have "'+t+'"={Jid}, but instead has "'+e+'"'):n},a.attrWapJid=function(t){t===void 0&&(t="from");var e=this.attrString(t),n=o("WAJids").interpretAndValidateJid(e);return n.jidType==="unknown"?o("WAWapJid").WapJid.create(null,e):o("WAWap").JID(o("WAJids").extractFromJid(n))},a.attrLongInt=function(t){var e=this.attrString(t);return o("WALongInt").decimalStringToLongInt(e)},a.attrTime=function(t){return o("WATimeUtils").castToUnixTime(this.attrInt(t))},a.maybeAttrTime=function(t){return this.hasAttr(t)?this.attrTime(t):null},a.attrFutureTime=function(t){var e=this.attrInt(t);return o("WATimeUtils").futureUnixTime(e)},a.contentString=function(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){var e=new(o("WABinary")).Binary(this.contentBytes());return e.readString(e.size())}else return this.throw("to have content")},a.decodeAsString=function(t){return o("WAWap").decodeAsString(t)},a.contentSerializedPubKey=function(){return this.hasContent()?o("WASignalKeys").serializeIdentity(this.contentBytes()):this.throw("to have content")},a.createParseError=function(t){return new u(this.name(),"expected <"+this.tag()+"> "+t)},a.throw=function(t){throw this.createParseError(t)},n})(o("WAParsableXmlNode").ParsableXmlNode);l.XmppParsingFailure=u,l.ParsableWapNode=c}),98);
__d("WADeprecatedWapParser",["WAParsableWapNode","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t){this.$1=e,this.$2=t}var t=e.prototype;return t.parse=function(t){var e=new(o("WAParsableWapNode")).ParsableWapNode(this.$1,t);try{return{success:this.$2(e)}}catch(e){if(e instanceof o("WAParsableWapNode").XmppParsingFailure)return{error:e};throw e}},t.parseOrThrow=function(t){var e=this.parse(t);if(e.error)throw r("err")(String(e.error));return e.success},e})();l.default=e}),98);
__d("WAAckParser",["WADeprecatedWapParser","WAJids"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("ack",function(e){return e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null,recipient:e.hasAttr("recipient")?e.attrUserJid("recipient"):null}});function s(e,t){return e.id===t.id&&(t.class===void 0||e.class===t.class)&&(t.type===void 0||e.type===t.type)&&(t.from===void 0||u(e.from,t.from))&&(t.participant===void 0||e.participant===t.participant)&&(t.recipient===void 0||e.recipient===t.recipient)&&(t.ts===void 0||e.ts===t.ts)}function u(e,t){if(o("WAJids").extractFromJid(e)===t)return!0;if(e.userJid!=null)return o("WAJids").defaultDeviceJidForUser(e.userJid)===t;if(e.deviceJid!=null){var n=e.deviceJid;return o("WAJids").extractDeviceId(n)===0&&o("WAJids").extractUserJid(n)===t}return!1}l.AckParser=e,l.ackMatchesTemplate=s,l.fromJidsAreEqual=u}),98);
__d("WAParseIqResponse",["WAWap"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){var r=e.content;if(r&&Array.isArray(r)&&r[0]){var a=r[0];if(a.tag==="error"){var i=a.attrs||{},l;n&&(typeof n=="function"?l=n(e):l=n.parseOrThrow(a));var u=l;return{success:!1,errorCode:parseInt(i.code,10),errorText:o("WAWap").decodeAsString(i.text)||"",errorType:o("WAWap").decodeAsString(i.type)||"",errorBackoff:parseInt(i.backoff,10),toString:s,customError:u}}}return typeof t=="function"?{success:!0,result:t(e)}:{success:!0,result:t.parseOrThrow(e)}}function s(){return"IqError "+this.errorCode+": "+this.errorText}l.parseIqResponse=e}),98);
__d("WADeprecatedSendIq",["Promise","WAAckParser","WAArrayUtils","WAComms","WALogger","WAParseIqResponse"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(e,t){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function c(e,t,n){return o("WAComms")._sendIq(e,!1).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t,n)})}function d(e,t,n){return o("WAComms")._sendIq(e,!1,n).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function m(e,t){return o("WAComms")._sendIq(e,!0).then(function(e){return o("WAParseIqResponse").parseIqResponse(e,t)})}function p(e,t){return _(e,t).then(function(){})}function _(t,r){return new(s||(s=n("Promise")))(function(a){var i=o("WAComms").singletonOrThrowIfUninitialized("deprecatedSendStanzaAndReturnAck"),l=function(t){var e=o("WAAckParser").AckParser.parse(t);return!e.error&&o("WAAckParser").ackMatchesTemplate(e.success,r)?t:null},u={type:"ack",parseAndTest:l,resolve:a,stanza:t,attachedToSocketId:o("WAComms").DEFAULT_SOCKET_ID,orderedId:o("WAComms").getAndIncrementNextOrderedId()};if(i.ackHandlers.push(u),!i.socket){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Comms has no open socket, will send stanza when socket opens"])));return}i.callStanza(t).catch(function(e){var t=i.ackHandlers.indexOf(u);t!==-1&&(o("WAArrayUtils").removeIndexWithoutPreservingOrder(i.ackHandlers,t),u.resolve((s||(s=n("Promise"))).reject(e)))})})}function f(e,t){o("WAComms").castSmaxStanza(e,t)}l.deprecatedSendIq=u,l.deprecatedSendIqErrorParser=c,l.deprecatedSendIqIfConnectedWithin=d,l.deprecatedSendIqWithoutRetry=m,l.deprecatedSendStanzaAndWaitForAck=p,l.deprecatedSendStanzaAndReturnAck=_,l.deprecatedCastStanza=f}),98);
__d("WAMediaConnParser",["WADeprecatedWapParser","WAServerMediaType"],(function(t,n,r,o,a,i,l){"use strict";var e=new(r("WADeprecatedWapParser"))("mediaConnParser",function(e){var t,n,r=e.child("media_conn"),o=c(r);return{hosts:o,authToken:r.attrString("auth"),authTokenExpiryTs:r.attrFutureTime("auth_ttl"),routesExpiryTs:r.attrFutureTime("ttl"),maxBuckets:r.attrInt("max_buckets"),maxManualRetry:(t=r.maybeAttrInt("max_manual_retry",0,4))!=null?t:3,maxAutoDownloadRetry:(n=r.maybeAttrInt("max_auto_download_retry",0,4))!=null?n:3}});function s(e){var t,n;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:(t=e.maybeAttrString("fallback_ip4"))!=null?t:void 0,ip6:(n=e.maybeAttrString("fallback_ip6"))!=null?n:void 0}}function u(e){var t,n,r,o;return{domain:e.attrString("hostname"),fallback:s(e),uploadable:d(e,"upload"),downloadable:d(e,"download"),isFallback:e.maybeAttrString("type")==="fallback",downloadBuckets:(t=(n=e.maybeChild("download_buckets"))==null?void 0:n.mapChildren(function(e){return parseInt(e.tag(),10)}))!=null?t:[],class:e.maybeAttrString("class"),ip4:(r=e.maybeAttrString("ip4"))!=null?r:void 0,ip6:(o=e.maybeAttrString("ip6"))!=null?o:void 0}}function c(e){return e.mapChildrenWithTag("host",u)}function d(e,t){return e.hasChild(t)?e.child(t).mapChildren(function(e){var t=e.tag();return o("WAServerMediaType").castToServerMediaType(t)}).filter(Boolean):o("WAServerMediaType").SERVER_MEDIA}l.mediaConnParser=e}),98);
__d("WAGatherMediaInfo",["WADeprecatedSendIq","WAErrors","WALogger","WAMediaConnParser","WAPromiseManagement","WAPromiseRetryLoop","WAResultOrError","WAWap"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m=507,p=o("WAPromiseManagement").cacheWhilePending(function(){return"gatherMediaInfo"},_);function _(){var e=new(o("WAPromiseRetryLoop")).PromiseRetryLoop({name:"gatherMediaInfo",timer:{jitter:.25,max:987e3,algo:{type:"fibonacci",first:6e3,second:12e3},relativeDelay:!0},code:g});return e.start(),e.promise()}var f=60;function g(t){var n,r=(n=o("WAWap")).wap("iq",{id:n.generateId(),to:n.S_WHATSAPP_NET,type:"set",xmlns:"w:m"},n.wap("media_conn",null));return o("WADeprecatedSendIq").deprecatedSendIqIfConnectedWithin(r,o("WAMediaConnParser").mediaConnParser,f).then(function(n){if(n.success)o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," hosts"])),n.result.hosts.length),t(o("WAResultOrError").makeResult(n.result));else if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo failure ",""])),n),n.errorCode===m){var r=n.errorBackoff;o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got "," seconds backoff"])),r),t(o("WAResultOrError").makeError({type:"backoff",backoffMs:r*1e3}))}else n.errorCode<500&&(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo got client error: ",""])),n.errorCode),t(o("WAResultOrError").makeError({type:"client-error",code:n.errorCode,text:n.errorText})))}).catch(function(e){e instanceof o("WAErrors").Disconnected?t(o("WAResultOrError").makeError("disconnected")):o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["gatherMediaInfo error ",""])),e)})}l.gatherMediaInfo=p}),98);
__d("WAMediaRouteSelection",["WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=null,n=null,r=null,a=e.hosts,i=e.mediaType,l=e.operation;if(e.operation==="download"){var s,u=e.catHotTimespan,c=e.getVcaEnabledBucket,d=e.ncHot,m=new Map;a.forEach(function(e){e.downloadBuckets.forEach(function(t){m.set(t,e)})});var p=m.get(0);u>0&&d!=null&&o("WATimeUtils").happenedWithin(o("WATimeUtils").castToUnixTime(d),u)?t=1:c&&(t=c());var _=null;t!=null&&(_=m.get(t)),(s=_)!=null&&s.downloadable.includes(i)?n=_:p!=null&&p.downloadable.includes(i)&&(n=p)}for(var f=0;f<a.length;f++){var g=a[f];if((l==="upload"&&g.uploadable.includes(i)||l==="download"&&g.downloadable.includes(i))&&(n==null?n=g:g.isFallback&&r==null&&(r=g)),n!=null&&r!=null)break}return{selectedHost:n,fallbackHost:r,bucket:t}}l.mediaRouteSelection=e}),98);
__d("WAGetMediaRoute",["$InternalEnum","WACreateGetVcaEnabledBucket","WAExtractNcHotTimestamp","WAGatherMediaInfo","WAMediaRouteSelection","WAPromiseManagement","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WAWorkerGlobalScope"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f=o("WATagsLogger").TAGS(["GetMediaRoute"]),g=86400,h=n("$InternalEnum")({Fresh:"fresh",Cached:"cached",Stale:"stale"}),y=null,C=!1,b=null;async function v(t,n){n==null||n.addPoint("get_cached_or_fresh_media_access_start");var r=await E();if(n==null||n.addPoint("get_cached_or_fresh_media_access_end"),!r.success)return f.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to get mediaAccess: ",""])),r.error),n==null||n.addPoint("get_media_access_failed",{string:{mediaAccessStatus:r.error}}),r;n==null||n.addAnnotations({string:{mediaAccessStatus:r.value.state}});var a=r.value.mediaAccess,i=a.authToken,l=a.hosts,u=a.maxBuckets,c=t.operation==="upload"?o("WAMediaRouteSelection").mediaRouteSelection({operation:"upload",mediaType:t.serverMediaType,hosts:l}):o("WAMediaRouteSelection").mediaRouteSelection({operation:"download",mediaType:t.serverMediaType,hosts:l,catHotTimespan:g,ncHot:o("WAExtractNcHotTimestamp").extractNcHotTimestamp(t.directPath),getVcaEnabledBucket:o("WACreateGetVcaEnabledBucket").msgrCreateGetVcaEnabledBucket(t.directPath,u)}),d=c.bucket,m=c.fallbackHost,p=c.selectedHost;return p==null?(f.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error: no media host"]))),o("WAResultOrError").makeError("no-host")):o("WAResultOrError").makeResult({authToken:i,selectedHost:p,fallbackHost:m,bucket:d})}function S(){var e=b;e!=null&&(o("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(e),b=null)}function R(e){S();var t=Math.max(e.authTokenExpiryTs-o("WATimeUtils").unixTime(),0);if(!(t<=300)){var n=o("WATimeUtils").pastUnixTime(300,e.authTokenExpiryTs),r=o("WATimeUtils").pastUnixTime(Math.floor(t*.2),e.authTokenExpiryTs),a=n<r?n:r,i=o("WATimeUtils").cappedMillisecondsUntil(a),l=Math.floor(Math.random()*o("WATimeUtils").MINUTE_MILLISECONDS),s=o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){f.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["AuthTTL approaching expiry, refreshing MediaAccess routes"]))),L().catch(function(e){f.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Error occurred during authTTL automatic refresh: ",""])),e)})},i+l);b=s}}var L=o("WAPromiseManagement").cacheWhilePending(function(){return"all"},async function(){if(C)return f.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, but we are still locked by backoff"]))),o("WAResultOrError").makeError("backoff");await o("WAWaitForComms").waitForComms(),f.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["mediaAccess has gone, gather a new one"]))),S();var e=await o("WAGatherMediaInfo").gatherMediaInfo();if(e.success)return y=e.value,R(e.value),o("WAResultOrError").makeResult({mediaAccess:e.value,state:h.Fresh});var t=e.error,n=t==="disconnected"?"disconnected":t.type;return f.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Can not get mediaAccess: ",""])),n),t==="disconnected"||t.type==="client-error"?o("WAResultOrError").makeError("disconnected"):(t.type,C=!0,o("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){C=!1,L().catch(function(e){f.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Error occurred on gather after backoff expiry: ",""])),e)})},t.backoffMs),o("WAResultOrError").makeError("backoff"))}),E=function(){var e=y;if(e==null)return L();if(o("WATimeUtils").isInFuture(e.routesExpiryTs))return Promise.resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:h.Cached}));var t=L();return o("WATimeUtils").isInFuture(e.authTokenExpiryTs)?Promise.resolve(o("WAResultOrError").makeResult({mediaAccess:e,state:h.Stale})):t};function k(){y=null,C=!1,S()}l.getMediaRoute=v,l.getCachedOrFreshMediaAccess=E,l.clearCachedMediaAccessForTest=k}),98);
__d("WAMediaOperationsRetrier",["WALogger","WAPromiseBackoffs"],(function(t,n,r,o,a,i,l){"use strict";var e,s=4,u={algo:{type:"constant",delay:1e3},jitter:0},c=(function(){function t(e,t,n){this.$1=e,this.routesInfo=t,this.$2=o("WAPromiseBackoffs").createPromiseTimer(u),this.$3=0,this.$4=!1,this.$5=n}var n=t.prototype;return n.run=async function(n,r){for(;this.$3<s;){await this.$2();var t=void 0;if(this.$3>0){var a;t=this.$3>=s-2&&!this.$4,o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["MediaOperationsRetrier:"," wait for internet, attempt = ",""])),this.$1,this.$3),await((a=this.$5)==null?void 0:a.call(this))}else t=!1;var i=this.routesInfo;if(!i)return null;var l=i.host;t&&i.fallbackHost&&(l=i.fallbackHost);var u=await n(l,i.authToken,this.$3,r);if(u.success)return u.value;++this.$3,this.$4=u.error.progressMade}return null},t})();l.MAX_ATTEMPTS=s,l.BACKOFF_OPTIONS=u,l.MediaOperationsRetrier=c}),98);
__d("WACreateMediaDownloadRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.directPath,n=e.eventFlow,r=e.fileEncSha256,a=e.mediaTypeDetails,i=a.type==="regular"?a.mediaType:"preview";n==null||n.addPoint("get_media_route_start");var l=await o("WAGetMediaRoute").getMediaRoute({operation:"download",serverMediaType:i,fileEncSha256:r,directPath:t},n);if(!l.success)return n==null||n.addPoint("get_media_route_fail"),l;n==null||n.addPoint("get_media_route_end");var s=l.value,u=s.authToken,c=s.fallbackHost,d=s.selectedHost,m=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("download",{host:{domain:d.domain,class:d.class},fallbackHost:c&&{domain:c.domain,class:c.class},authToken:u,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult({retrier:m,mediaRouteDetails:l.value})}l.createMediaDownloadRetrier=e}),98);
__d("WAHttpDownloadMedia",["WAErrorMessage","WALogger","WAMediaQplHelper","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="URL signature expired";async function m(t,n){var r=n!=null?n:{},a=r.abortSignal,i=r.mediaMetrics;i==null||i.addPoint("http_fetch_start");var l=await self.fetch(t,{method:"GET",mode:"cors",cache:"no-store",signal:a}).then(function(e){return i==null||i.addPoint("http_fetch_end"),o("WAResultOrError").makeResult(e)}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return i==null||i.addPoint("http_fetch_fail",{string:{httpFetchError:n}}),o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to initiate fetch: ",", message: ",""])),t,n),t.name==="AbortError"?o("WAResultOrError").makeError("http-fetch-aborted"):o("WAResultOrError").makeError("http-fetch-exception")});if(l.success===!1)return l;var m=l.value,p=m.headers.get("content-length"),_=m.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),_),i==null||i.addAnnotations({string:{ciphertextMediaSizeBucket:p!=null?o("WAMediaQplHelper").convertIntegerSizeToStringBucket(Number(p)):null},int:{httpStatus:_}}),_){case 200:case 206:return o("WAResultOrError").makeResult(m);case 401:return o("WAResultOrError").makeError("access-expired");case 403:return m.text().then(function(e){return e===d?o("WAResultOrError").makeError("signature-expired"):o("WAResultOrError").makeError("access-expired")}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body: ",""])),e),o("WAResultOrError").makeError("access-expired")});case 404:case 410:return o("WAResultOrError").makeError("media-not-found");case 408:return o("WAResultOrError").makeError("server-timeout");case 416:return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: can not resume from offset"]))),o("WAResultOrError").makeError("request-error");case 429:case 507:return o("WAResultOrError").makeError("download-throttled");default:return _>=400&&_<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpDownloadMedia=m}),98);
__d("WAHttpUtils",["err"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw r("err")('buildUrl given invalid host "'+e+'"');if(!t.startsWith("/"))throw r("err")('buildUrl given invalid path "'+t+'"');var o=n,a=""+e+t;if(!o)return a;var i=Object.keys(o).map(function(e){var t=o[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n=t instanceof Uint8Array?Array.from(t).map(function(e){return"%"+e.toString(16)}).join(""):encodeURIComponent(t.toString());return encodeURIComponent(e)+"="+n});if(i.length>0){var l=i.join("&");return a.includes("?")?a+"&"+l:a+"?"+l}else return a}l.buildUrl=e}),98);
__d("WAMediaUrl",["WABase64","WAGlobals","WAHttpUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=1;function s(t,n,r,a,i,l,s){var u=o("WAGlobals").getDependencies().mediaUploadRoot(),c=o("WABase64").encodeB64UrlSafe(r),d=o("WABase64").encodeB64UrlSafe(n),m={auth:i,token:d};return l&&(m.resume=e),s!=null&&s>0&&(m.bytestart=s),o("WAHttpUtils").buildUrl("https://"+a,u+"/"+t+"/"+c,m)}function u(e,t,n,r,a,i,l){var s=o("WABase64").encodeB64UrlSafe(t),u={hash:s,mode:r};return a!=null&&(u._nc_cat=a),i!=null&&i>=0&&(u.bytestart=i),l!=null&&l>0&&(u.byteend=l),o("WAHttpUtils").buildUrl("https://"+n,e,u)}l.RESUME_PARAM=e,l.buildUploadUrl=s,l.buildDownloadUrl=u}),98);
__d("WADownloadCiphertext",["WAAssertUnreachable","WABase64","WACreateMediaDownloadRetrier","WACryptoSha256","WACryptoUtils","WAHashUtils","WAHttpDownloadMedia","WALogger","WAMediaUrl","WAPromiseManagement","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;async function p(t){var n=t.abortSignal,a=t.directPath,i=t.eventFlow,l=t.fileEncSha256,p=t.fromBytes,_=t.mediaTypeDetails,g=t.plaintextHash,h=t.toBytes;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Start download ciphertext for hash: ",""])),o("WAHashUtils").sanitisePlaintextHash(g)),i.addPoint("create_retrier_start");var y=await o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({mediaTypeDetails:_,directPath:a,eventFlow:i,fileEncSha256:l});if(!y.success)return i.addPoint("create_retrier_fail"),y;i.addPoint("create_retrier_end");var C=y.value,b=C.mediaRouteDetails,v=C.retrier,S=await v.run(function(e,t,r){var d=e.domain,m="http_download_media_"+r,_=o("WAMediaUrl").buildDownloadUrl(a,l,d,"manual",b.bucket,p,h);return i.addPoint(m+"_start"),o("WAHttpDownloadMedia").httpDownloadMedia(_,{mediaMetrics:i,abortSignal:n,cachePolicy:r>0?"no-store":"force-cache"}).then(function(e){if(e.success)return e.value.arrayBuffer().then(function(e){return i.addPoint(m+"_end"),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult(e))}).catch(function(e){return i.addPoint("response_array_buffer_error"),i.addPoint(m+"_fail"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["HttpDownloadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeResult(o("WAResultOrError").makeError("body-network-error"))});i.addPoint(m+"_fail");var t=e.error;switch(o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Download Media Error: ",""])),t),i.addPoint(t),t){case"signature-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("signature-expired"));case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("http-fetch-aborted"));case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){return i.addPoint(m+"_fail"),o("WALogger").WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["downloadCiphertext http download exception: ",""])),e),o("WAResultOrError").makeError({progressMade:!1})})});if(S==null)return o("WALogger").WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(S.success===!1){var R=S.error;switch(o("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext failed: ",""])),R),R){case"signature-expired":case"http-fetch-aborted":case"media-not-found":case"download-throttled":case"body-network-error":case"request-error":return o("WAResultOrError").makeError(R);case"access-expired":return o("WAResultOrError").makeError("disconnected");default:throw r("WAAssertUnreachable")(R)}}else{var L=S.value;return!f(p,h)&&!o("WACryptoUtils").arrayBuffersEqual(await o("WACryptoSha256").sha256(L),l)?o("WAResultOrError").makeError("ciphertext-hash-mismatch"):(i.addPoint("download_finish",{int:{byteLength:L.byteLength},bool:{isPartialDownload:f(p,h)}}),o("WAResultOrError").makeResult(L))}}var _=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.fileEncSha256,n=e.fromBytes,r=e.toBytes;return o("WABase64").encodeB64UrlSafe(t)+"-"+(n!=null?n:"X")+"-"+(r!=null?r:"X")},p);function f(e,t){return e!=null&&e>0?!0:t!=null}l.cachedDownloadCiphertext=_}),98);
__d("WADownloadAndDecryptMedia",["WADecryptMedia","WADownloadCiphertext","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.abortSignal,n=e.directPath,r=e.eventFlow,a=e.fileEncSha256,i=e.mediaKey,l=e.mediaTypeDetails,s=e.plaintextHash,u=await o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:l,fileEncSha256:a,directPath:n,eventFlow:r,plaintextHash:s});if(u.success!==!0)return u;var c=await o("WADecryptMedia").decryptMedia({mediaKey:i,mediaTypeDetails:l,plaintextHash:s,ciphertextHmac:u.value});return c.success!==!0?c:(c.value.alternativeHmacSaltUsed!=null&&r.addAnnotations({string:{alternativeHmacSaltUsed:c.value.alternativeHmacSaltUsed}}),o("WAResultOrError").makeResult(c.value.plaintext))}l.downloadAndDecryptMedia=e}),98);
__d("WACreateMediaDecrypterStream",["WABinary","WAMediaCrypto","WAResultOrError","WATagsLogger","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["WADecryptStream"]);function f(t,n,r,a,i){if(a.byteLength===0)return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs must have at least one element"]))),o("WAResultOrError").makeError("missing-expected-hmacs");if(a.byteLength!==i.length*o("WAMediaCrypto").HMAC_LENGTH)return _.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["expectedHmacs and ciphertextLengths must have the same length"]))),o("WAResultOrError").makeError("hmac-chiphertext-array-mismatch");var l=g(a),m=n,p=new(o("WABinary")).Binary,f=0,y=async function(n,a){for(p.writeByteArray(n);f<l.length&&p.size()>=i[f];f++){var e=p.readByteArrayView(i[f]);_.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," of size ",""])),f,e.length);var s=f===i.length-1;try{var d=await o("WAMediaCrypto").hmacAndDecryptPartial(t,m,e,r,l[f]),g=d.nextIv,y=d.plaintext;s?a.enqueue(h(y)):a.enqueue(y),m=g}catch(e){_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt chunk. isLastChunk: "," error: ",""])),s,e),e instanceof o("WAMediaCrypto").HmacValidationError?a.error("enc-hash-mismatch"):a.error("decryption-error")}}},C=new TransformStream({transform:function(t,n){var e=t;return y(e,n)},flush:function(t){p.size()>0&&_.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Unexpected ciphertext in buffer following flush"])))}});return o("WAResultOrError").makeResult(C)}function g(e){var t=[];if(e.byteLength%o("WAMediaCrypto").HMAC_LENGTH!==0)throw r("err")("Sidecar length is not a multiple of hmac length");for(var n=0;n<e.byteLength;n+=o("WAMediaCrypto").HMAC_LENGTH){var a=new Uint8Array(e,n,o("WAMediaCrypto").HMAC_LENGTH);t.push(a)}return t}function h(e){if(e.length<o("WAMediaCrypto").CBC_BLOCK_SIZE)return _.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Plaintext size is less than CBC_BLOCK_SIZE"]))),e;var t=e[e.length-1];return t===0||t>o("WAMediaCrypto").CBC_BLOCK_SIZE?(_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Invalid PKCS padding length"]))),e):e.subarray(0,-t)}l.createDefaultDecryptStream=f}),98);
__d("WAMediaProgressiveJpegTransformStream",["WABinary"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.scanLengths,n=[],r=0;for(var a of t)r+=a,n.push(r);var i=new(o("WABinary")).Binary,l=0,s=0,u=new TransformStream({transform:function(r,o){var e=r;for(s+=e.byteLength,i.writeByteArray(e);l<t.length&&n[l]<s;l++){var a=i.readByteArrayView(t[l]);o.enqueue(a)}},flush:function(t){t.enqueue(i.readByteArrayView())}});return u}l.makeProgressiveJpegHandlerTransformStream=e}),98);
__d("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry",["WACreateMediaDecrypterStream","WAHttpDownloadMedia","WAMediaCrypto","WAMediaProgressiveJpegTransformStream","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);function c(e){return e}async function d(t){var n=t.abortSignal,r=t.cachePolicy,a=t.downloadUrl,i=t.eventFlow,l=t.mediaKey,c=t.progressiveJpegDetails,d=t.serverMediaType,m=await o("WAHttpDownloadMedia").httpDownloadMedia(a,{mediaMetrics:i,abortSignal:n,cachePolicy:r});if(m.success!==!0)return m;var p=m.value.body;if(p==null)return o("WAResultOrError").makeError("body-network-error");var _=m.value.headers.get("Content-Length");if(_==null)return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is missing"]))),o("WAResultOrError").makeError("missing-content-length-header");var f=Number(_);if(Number.isNaN(f))return u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Content-Length header is not a number"]))),o("WAResultOrError").makeError("invalid-content-length-header");var g=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:c,ciphertextLength:f}),h=await o("WAMediaCrypto").computeMediaKeys(l,d),y=o("WACreateMediaDecrypterStream").createDefaultDecryptStream(h.cipherKey,h.iv,h.hmacKey,g.sidecar,g.alignedScanLengths);if(y.success!==!0)return y;var C=y.value,b=o("WAMediaProgressiveJpegTransformStream").makeProgressiveJpegHandlerTransformStream(g),v=p.pipeThrough(C).pipeThrough(b);return o("WAResultOrError").makeResult(v)}l.unsafeCastToDownloadAndDecryptPJpegStream=c,l.downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry=d}),98);
__d("WADownloadProgressiveJpegPlaintextStreamer",["WAAssertUnreachable","WACreateMediaDownloadRetrier","WADownloadProgressiveJpegPlaintextStreamerWithoutRetry","WAMediaUrl","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=o("WATagsLogger").TAGS(["WADownloadProgressiveJpegPlaintextStreamer"]);async function u(t){var n=t.abortSignal,a=t.directPath,i=t.eventFlow,l=t.fileEncSha256,u=t.mediaKey,c=t.progressiveJpegDetails,d=t.serverMediaType,m=await o("WACreateMediaDownloadRetrier").createMediaDownloadRetrier({directPath:a,eventFlow:i,fileEncSha256:l,mediaTypeDetails:{type:"regular",mediaType:d}});if(!m.success)return m;var p=m.value,_=p.mediaRouteDetails,f=p.retrier,g=_.bucket,h=await f.run(async function(e,t,s){var m=e.domain,p=o("WAMediaUrl").buildDownloadUrl(a,l,m,"manual",g),_=await o("WADownloadProgressiveJpegPlaintextStreamerWithoutRetry").downloadProgressiveJpegPlaintextUsingStreamsWithoutRetry({abortSignal:n,downloadUrl:p,eventFlow:i,mediaKey:u,progressiveJpegDetails:c,serverMediaType:d,cachePolicy:s>0?"no-store":"force-cache"});if(_.success===!0)return o("WAResultOrError").makeResult(_);var f=_.error;switch(f){case"http-fetch-exception":case"server-timeout":case"unspecified-http-error":case"invalid-content-length-header":case"missing-content-length-header":return o("WAResultOrError").makeError({progressMade:!0});case"access-expired":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("disconnected"));case"body-network-error":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError("request-error"));case"media-not-found":case"request-error":case"download-throttled":case"signature-expired":case"http-fetch-aborted":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(f));default:throw r("WAAssertUnreachable")(f)}});return h==null?(s.WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Download with stream given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded")):h}l.downloadProgressiveJpegPlaintextUsingStreams=u}),98);
__d("WAPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=typeof((e=navigator.storage)==null?void 0:e.getDirectory)=="function",m=typeof self.caches=="object",p=0;function _(e){var t,r=e.hash,a=e.logger,i=e.mediaDownloadFlow,l=e.mediaEntry,_=l.directPath,f=l.downloadableThumbnail,g=l.mediaKeyTimestamp,h=l.serverMediaType,y=l.size,C=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(g);a.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["start download ",". mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(r),C,y,h);var b=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(l).value)!=null?t:null;return i.addPoint("wa_protocol_media_download_start",{string:{mediaType:h,mediaKeyTimestampAgeBucket:C,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)},bool:{isOPFSSupported:d,isWebCacheSupported:m,duplicateDirectPath:(f==null?void 0:f.directPath)===_,hasDownloadableThumbnail:(f==null?void 0:f.directPath)!=null,isProgressiveJpeg:b!=null}}),{logDownloadResult:function(t){return p++,i.addAnnotations({int:{concurrentDownloadCount:p}}),t.then(function(e){if(e.success){var t=e.value.plaintext.byteLength;i.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else i.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){i.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return a.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(c||(c=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){p--})}}}l.prepareMediaDownload=_}),98);
__d("WAProgressiveJpegAddJPEGTrailingTag",["WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e=new Uint8Array([255,217]);function s(t){return o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[new Uint8Array(t),e]).buffer}l.JPEG_TRAILING_TAG=e,l.addJPEGTrailingTag=s}),98);
__d("WAStreamAsyncIterator",[],(function(t,n,r,o,a,i){"use strict";function e(e){return l.apply(this,arguments)}function l(){return l=babelHelpers.wrapAsyncGenerator(function*(e){var t=e.getReader();try{for(;;){var n=yield babelHelpers.awaitAsyncGenerator(t.read()),r=n.done,o=n.value;if(r)return;yield o}}finally{t.releaseLock()}}),l.apply(this,arguments)}i.streamAsyncIterator=e}),66);
__d("WADownloadMedia",["WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadAndDecryptMedia","WADownloadDownloadablePreview","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAHashUtils","WAMediaCrypto","WAMediaUtils","WAPrepareMediaDownload","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAPromiseManagement","WAResultOrError","WAStreamAsyncIterator","WATagsLogger","WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e=["hash"],s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=o("WATagsLogger").TAGS(["MediaDownload"]);function R(e){var t=e.downloadMediaMetric,n=e.handleMediaPreviewBeforeDownload,r=e.handleMediaPreviewDownload,a=e.handleMediaPreviewDownloadFailed,i=e.hash,l=e.mediaEntry,s=e.protocolMsgId,u=o("WAPrepareMediaDownload").prepareMediaDownload({mediaDownloadFlow:t,mediaEntry:l,hash:i,logger:S}),c=u.logDownloadResult;return c(E({downloadMediaMetric:t,hash:i,mediaEntry:l,protocolMsgId:s,handleMediaPreviewDownload:r,handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:a}))}var L=async function(t){var e=t.downloadMediaMetric,n=t.handleMediaPreviewBeforeDownload,r=t.handleMediaPreviewDownload,a=t.handleMediaPreviewDownloadFailed,i=t.hash,l=t.mediaEntry,p=t.protocolMsgId,_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(l);if(!_.success)return S.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mediaEntry is incomplete. ",""])),_.error),_;var f=_.value,g=f.directPath,h=f.fileEncSha256,y=f.fileSha256,C=f.mediaKey,b=f.serverMediaType,v=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(l);v.success===!1&&(S.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to get ProgressiveJpeg details: ",""])),v.error),e.addPoint(v.error));var R=v.success===!0?v.value:null,L=function(t){if(t==null)return Promise.resolve();var e=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(b);return e==null?(S.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["media: mediaPreview - unsupported preview media type ",""])),b),Promise.resolve()):r(i,t,e,p).then(function(){})};if(R!=null&&o("WAMediaUtils").isTransformStreamSupported()&&b==="image"){var E=await x({directPath:g,downloadFlow:e,fileEncSha256:h,handleMediaPreviewBlob:L,hash:i,mediaKey:C,progressiveJpegDetails:R,serverMediaType:b,fileSha256:y,handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:a});if(E.success)return o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(b),plaintext:E.value,serverMediaType:b});var I=E.error;switch(S.WARN(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Media Streaming failed to download progressive jpeg. Reason: ",". PlaintextHash: ",""])),I,o("WAHashUtils").sanitisePlaintextHash(i)),I){case"signature-expired":case"request-error":return S.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Skipping fallback for ",". PlaintextHash: ",""])),I,o("WAHashUtils").sanitisePlaintextHash(i)),o("WAResultOrError").makeError(I)}}e==null||e.addPoint("fallback_to_non_streaming_download");var T=D({hash:i,mediaEntry:l,progressiveJpegDetails:R,protocolMsgId:p,serverMediaType:b,handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:a,downloadEntry:e.downloadEntry,triggerUIView:e.triggerUIView});return T.then(function(e){return e.success===!1?L(null):L(e.value)}),k({downloadMediaMetric:e,mediaEntry:_.value})},E=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},L),k=async function(t){var e=t.abortSignal,n=t.downloadMediaMetric,r=t.mediaEntry,a=r.directPath,i=r.fileEncSha256,l=r.fileSha256,s=r.mediaKey,u=r.serverMediaType,c=await T({abortSignal:e,downloadFlow:n,mediaTypeDetails:{mediaType:u,type:"regular"},directPath:a,fileEncSha256:i,fileSha256:l,mediaKey:s});return c.success?o("WAResultOrError").makeResult({mimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(u),plaintext:c.value,serverMediaType:u}):c},I=o("WAPromiseManagement").cacheWhilePending(function(e){var t=e.hash;return t},function(t){var n=t.hash,r=babelHelpers.objectWithoutPropertiesLoose(t,e),a=o("WAPrepareMediaDownload").prepareMediaDownload({hash:n,mediaDownloadFlow:r.downloadMediaMetric,mediaEntry:r.mediaEntry,logger:S}),i=a.logDownloadResult;return i(k(r))});async function T(e){var t=e.abortSignal,n=e.directPath,r=e.downloadFlow,a=e.fileEncSha256,i=e.fileSha256,l=e.mediaKey,s=e.mediaTypeDetails,u=o("WAHashUtils").toPlaintextHash(i),c=await o("WADownloadAndDecryptMedia").downloadAndDecryptMedia({abortSignal:t,directPath:n,eventFlow:r,fileEncSha256:a,mediaKey:l,mediaTypeDetails:s,plaintextHash:u});if(c.success===!1){var d=c.error;switch(d){case"signature-expired":case"media-not-found":return o("WAResultOrError").makeError(d);case"enc-hash-mismatch":return S.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["downloadMedia: enc-hash-mismatch"]))),o("WAResultOrError").makeError(d);default:return o("WAResultOrError").makeError(d)}}else{var m=c.value;return o("WAResultOrError").makeResult(m)}}function D(e){var t=e.downloadEntry,n=e.handleMediaPreviewBeforeDownload,r=e.handleMediaPreviewDownloadFailed,a=e.hash,i=e.mediaEntry,l=e.progressiveJpegDetails,s=e.protocolMsgId,u=e.serverMediaType,c=e.triggerUIView;return l==null?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(s,a,u,i,t,{handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:r},c):o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreview({protocolMsgId:s,hash:a,serverMediaType:u,mediaEntry:i,progressiveJpegDetails:l,handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:r,downloadEntry:t,triggerUIView:c}).then(function(e){return e.success!==!0?o("WADownloadDownloadablePreview").maybeDownloadDownloadablePreview(s,a,u,i,t,{handleMediaPreviewBeforeDownload:n,handleMediaPreviewDownloadFailed:r},c):e})}async function x(e){var t=e.directPath,n=e.downloadFlow,r=e.fileEncSha256,a=e.fileSha256,i=e.handleMediaPreviewBeforeDownload,l=e.handleMediaPreviewBlob,s=e.handleMediaPreviewDownloadFailed,u=e.hash,c=e.mediaKey,d=e.progressiveJpegDetails,m=e.serverMediaType,p=S.TAGS(["MediaStreaming"]);p.LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(u)),n.addPoint("media_streaming_start");var R=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(d.scanLengths)-1;p.LOG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Targeting scanIndex "," for preview. PlaintextHash: ",""])),R,o("WAHashUtils").sanitisePlaintextHash(u)),n.addAnnotations({int:{scans:d.scanLengths.length}}),i(u);var L=await o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({directPath:t,eventFlow:n,fileEncSha256:r,mediaKey:c,progressiveJpegDetails:d,serverMediaType:m});if(L.success===!1)return n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:L.error}}),s(u,L.error),L;n.addPoint("download_pjpeg_preview_start");var E=[],k=0;try{var I=!1,T=!1,D;try{for(var x=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(L.value)),$;I=!($=await x.next()).done;I=!1){var P=$.value;{if(P==null)continue;if(p.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Processing scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(u)),E.push(P),k===R){n.addPoint("media_streaming_preview_processed"),p.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Handling preview from scan "," for plaintextHash ",""])),k,o("WAHashUtils").sanitisePlaintextHash(u));var N=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));l(N),n.addPoint("download_pjpeg_preview_end")}k++}}}catch(e){T=!0,D=e}finally{try{I&&x.return!=null&&await x.return()}finally{if(T)throw D}}k<R&&(p.ERROR(y||(y=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex for plaintextHash ",""])),o("WAHashUtils").sanitisePlaintextHash(u)),n.addPoint("download_pjpeg_preview_fail"));var M=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(E))),w=await o("WACryptoSha256").sha256(M);return o("WACryptoUtils").arrayBuffersEqual(a,w)?(p.LOG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download successful. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(u)),n.addPoint("media_streaming_end"),o("WAResultOrError").makeResult(M)):(p.WARN(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch. PlaintextHash: ",""])),o("WAHashUtils").sanitisePlaintextHash(u)),n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:"hash-mismatch"}}),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return p.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),k<R&&(n.addPoint("download_pjpeg_preview_fail"),s(u,o("WAErrorMessage").maybeGetMessageFromError(e))),n==null||n.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("stream-error")}}l.mediaDownloadLogger=S,l.downloadMedia=R,l.downloadFullMediaOnly=k,l.cachedDownloadFullMediaOnly=I,l.downloadMediaImpl=T}),98);
__d("WADownloadProgressiveJpegPlaintext",["WADownloadCiphertext","WAMediaCrypto","WAProgressiveJpegAddJPEGTrailingTag","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=o("WATagsLogger").TAGS(["DownloadProgressiveJpeg"]);async function d(e){var t=e.abortSignal,n=e.directPath,r=e.eventFlow,a=e.fileEncSha256,i=e.mediaKey,l=e.mediaTypeDetails,s=e.plaintextHash,u=e.progressiveJpegDetails,c=e.size,d=e.targetScan,_=o("WAProgressiveJpegGetPJpegDetails").getExtendedProgressiveJpegDetails({progressiveJpegDetails:u,ciphertextLength:p(c)}),f=o("WAProgressiveJpegGetPJpegDetails").getTotalByteSizeForScan(_.alignedScanLengths,d),g=await o("WADownloadCiphertext").cachedDownloadCiphertext({abortSignal:t,mediaTypeDetails:l,fileEncSha256:a,directPath:n,fromBytes:0,toBytes:f-1,eventFlow:r,plaintextHash:s});return g.success!==!0?g:m(i,l,d,_,g.value)}async function m(t,n,r,a,i){c.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using progressiveJpeg decryptAndVerify"])));var l=new Uint8Array(i),d;n.type==="preview"?d=o("WAMediaCrypto").computeMediaKeysForPreview(t):d=o("WAMediaCrypto").computeMediaKeys(t,n.mediaType);var m=await d.then(function(e){var t=e.cipherKey,n=e.hmacKey,i=e.iv;return o("WAMediaCrypto").decryptPartialChunks(t,i,l,n,r,a)}).then(o("WAResultOrError").makeResult).catch(function(e){return c.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Download Plaintext Error ",""])),e),e instanceof o("WAMediaCrypto").HmacValidationError?o("WAResultOrError").makeError("enc-hash-mismatch"):o("WAResultOrError").makeError("decryption-error")});if(!m.success)return m;c.LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["ProgressiveJpeg download and decrypt successful. Partial: ",""])),r<a.scanLengths.length);var p=o("WAProgressiveJpegAddJPEGTrailingTag").addJPEGTrailingTag(m.value.plaintext);return o("WAResultOrError").makeResult(p)}function p(e){if(e==null)return null;var t=o("WAMediaCrypto").CBC_BLOCK_SIZE-e%o("WAMediaCrypto").CBC_BLOCK_SIZE;return e+t+o("WAMediaCrypto").HMAC_LENGTH}l.downloadProgressiveJpegPlaintext=d}),98);
__d("WALoggerTag",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]),l=e;i.default=l}),66);
__d("WAProgressiveJpegGetTargetScanLengthForBytes",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=0,r=0,o=0;o<e.length&&(r=o+1,n+=e[o],!(n>=t));o++);return r}i.getTargetScanBasedOnByteSize=e}),66);
__d("WADownloadProgressiveJpegPreview",["WADownloadMedia","WADownloadProgressiveJpegPlaintext","WAGlobals","WALoggerTag","WAProgressiveJpegGetTargetScanLengthForBytes","WAResultOrError","WAStartMediaDownloadQplFlow"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WADownloadMedia").mediaDownloadLogger.TAGS([r("WALoggerTag").MediaPreview]),c=3;async function d(t){var n=t.downloadEntry,r=t.handleMediaPreviewBeforeDownload,a=t.handleMediaPreviewDownloadFailed,i=t.hash,l=t.mediaEntry,c=t.progressiveJpegDetails,d=t.protocolMsgId,p=t.serverMediaType,_=t.triggerUIView,f=l.directPath,g=l.fileEncSha256,h=l.mediaKey,y=l.size;if(f==null||g==null||h==null)return o("WAResultOrError").makeError("pjpeg-failed");var C=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({protocolMsgId:d,downloadEntry:n,isPreview:!0,msgType:null,triggerUIView:_});C.addAnnotations({bool:{isProgressiveJpeg:!0},string:{mediaType:"preview",fullSizeMediaType:l.serverMediaType},int:{mediaEntrySize:l.size}}),u.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Starting progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_start");var b=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?c.scanLengths.length-1:c.scanLengths.length,v=Math.min(m(c.scanLengths,y),b);await r(i);var S=await o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({directPath:f,eventFlow:C,fileEncSha256:g,mediaKey:h,mediaTypeDetails:{mediaType:p,type:"regular"},progressiveJpegDetails:c,plaintextHash:i,targetScan:v,size:y});if(!S.success)return a(i,S.error),C.endFail("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:S.error}}),o("WAResultOrError").makeError("pjpeg-failed");var R=S.value;return u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Finished progressiveJpeg preview download"]))),C.addPoint("wa_protocol_media_download_end"),C.endSuccess(),o("WAResultOrError").makeResult(R)}function m(e,t){var n=o("WAGlobals").getConfig().jpegThumbnailTargetByteSizeKB()*1024,r=o("WAProgressiveJpegGetTargetScanLengthForBytes").getTargetScanBasedOnByteSize(e,n);return(t==null||t===0)&&(r=Math.min(r,e.length-1)),r=Math.max(r,c),r}function p(e){var t=e.abortSignal,n=e.hash,r=e.mediaDownloadFlow,a=e.mediaEntry,i=e.progressiveJpegDetails,l=e.serverMediaType,s=a.directPath,u=a.fileEncSha256,c=a.mediaKey,d=a.size,p=o("WAGlobals").getConfig().pjpegPreviewAvoidLastScan()===!0?i.scanLengths.length-1:i.scanLengths.length,_=Math.min(m(i.scanLengths,d),p);return o("WADownloadProgressiveJpegPlaintext").downloadProgressiveJpegPlaintext({abortSignal:t,directPath:s,fileEncSha256:u,mediaKey:c,mediaTypeDetails:{mediaType:l,type:"regular"},progressiveJpegDetails:i,plaintextHash:n,targetScan:_,size:d,eventFlow:r})}l.maybeDownloadProgressiveJpegPreview=d,l.getPreviewTargetScan=m,l.maybeDownloadProgressiveJpegPreviewV2=p}),98);
__d("WAGetKaleidoscopeWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("33861")),s=function(){return o("WAWasmModuleCache").loadWasmModule(e)};l.getKaleidoscopeWasm=s}),98);
__d("WAMediaUtilsWasmUrl",["bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("237"));l.WAMediaUtilsWasmUrl=e}),98);
__d("WAPreloadWamediaUtilsWasm",["WAMediaUtilsWasmUrl","WAWasmModuleCache"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.preloadWamediaUtilsWasm=e}),98);
__d("WAPreloadWebpCheckWasm",["WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("bx").getURL(r("bx")("6946")),s=function(){o("WAWasmModuleCache").loadWasmModule(e)};l.preloadWebpCheckWasm=s}),98);
__d("WAPrewarmMediaValidate",["WAGetKaleidoscopeWasm","WALogger","WAPreloadWamediaUtilsWasm","WAPreloadWebpCheckWasm","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(t){if(r("gkx")("3272")){o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm().catch(function(t){var n=r("getErrorSafe")(t);o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["prewarm Kaleidoscop wasm failed with error: ",""])),n.message)});return}if(t==null){o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["prewarmMediaValidate: serverMediaType is null"])));return}(t==="sticker"||t==="image")&&o("WAPreloadWebpCheckWasm").preloadWebpCheckWasm(),(t==="video"||t==="audio")&&o("WAPreloadWamediaUtilsWasm").preloadWamediaUtilsWasm()}l.prewarmMediaValidate=u}),98);
__d("WAMediaManagerPrepareMediaDownload",["Promise","WAErrorMessage","WAGetAgeBucketForMediaKeyTimestamp","WAHashUtils","WAMediaQplHelper","WAPrewarmMediaValidate","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=0;function d(t){var r,a=t.hash,i=t.logger,l=t.mediaDownloadFlow,d=t.mediaEntry,m=d.directPath,p=d.downloadableThumbnail,_=d.mediaKeyTimestamp,f=d.serverMediaType,g=d.size;o("WAPrewarmMediaValidate").prewarmMediaValidate(f);var h=o("WAGetAgeBucketForMediaKeyTimestamp").getAgeBucketForMediaKeyTimestamp(_);i.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start download ",". entry: "," mediaKeyTimestampAgeBucket: ",", size: ",", serverMediaType: ",""])),o("WAHashUtils").sanitisePlaintextHash(a),l.downloadEntry,h,g,f);var y=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(d).value)!=null?r:null;return l.addPoint("wa_protocol_media_download_start",{bool:{duplicateDirectPath:(p==null?void 0:p.directPath)===m,hasDownloadableThumbnail:(p==null?void 0:p.directPath)!=null,isProgressiveJpeg:y!=null},string:{mediaKeyTimestampAgeBucket:h,mediaType:f}}),{logDownloadResult:function(t){return c++,l.addAnnotations({int:{concurrentDownloadCount:c}}),t.then(function(e){if(e.success){var t=e.value.validatedResult.validatedPlaintext.byteLength;l.addPoint("wa_protocol_media_download_end",{string:{media_size:o("WAMediaQplHelper").convertIntegerSizeToStringBucket(t)}})}else l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:e.error}});return e}).catch(function(e){l.addPoint("wa_protocol_media_download_fail",{string:{wa_protocol_media_download_fail_reason:"runtime-error"}});var t=o("WAErrorMessage").maybeGetMessageFromError(e);return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media due to runtime-error: ",""])),t),(u||(u=n("Promise"))).resolve(o("WAResultOrError").makeError("runtime-error"))}).finally(function(){c--})}}}l.mediaManagerPrepareMediaDownload=d}),98);
__d("WAIsMp4",[],(function(t,n,r,o,a,i){"use strict";function e(e){return e.length<8?!1:e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112}i.isMp4=e}),66);
__d("WAIsWebP",[],(function(t,n,r,o,a,i){"use strict";function e(e){return!(e.length<12||e[0]!==82||e[1]!==73||e[2]!==70||e[3]!==70||e[8]!==87||e[9]!==69||e[10]!==66||e[11]!==80)}i.isWebP=e}),66);
__d("WAKaleidoscopeLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(){return r("FBLogger")("wmi").tags(["Kaleidoscope"])};l.ksLogger=e}),98);
__d("WAKaleidoscopeCheck",["WAGetKaleidoscopeWasm","WAKaleidoscopeLogger","WAResultOrError","WASI","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_="input",f="output",g="/"+_,h="/"+f;function y(e){var t,n=e.input,r=e.mediaType,o=e.rawMimeType,a=e.stderr,i=e.stdout;return{args:["kaleidoscope","check","--json-report="+f,"--mimetype-hint="+o,_],fs:(t={},t[g]={path:g,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(n)},t[h]={path:h,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},t),stdout:i,stderr:a,moduleName:"WAKaleidoscopeCheck_CLI"}}function C(t){var n=t.getWasmModule;return async function(a){var t,i,l,_,f=a.input,g=a.mediaType,C=a.rawMimeType,b=o("WASI").createWasi(y({input:f,rawMimeType:C,mediaType:g,stderr:function(n){o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),n)},stdout:function(t){o("WAKaleidoscopeLogger").ksLogger().DEBUG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)}})),v=b.getImportObject,S=b.start,R=await n(),L=await WebAssembly.instantiate(R,v()),E=S(L),k=E.exitCode,I=E.fs;if(k!==0)return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(u||(u=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with exit code ",""])),k),o("WAResultOrError").makeError("wasm-runtime-error");var T=(t=I[h])==null?void 0:t.content;if(typeof T!="string")return o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed invalid result type"]))),o("WAResultOrError").makeError("wasm-result-not-json");var D={};try{D=JSON.parse(T)}catch(e){return o("WAKaleidoscopeLogger").ksLogger().catching(r("getErrorSafe")(e)).MUSTFIX(d||(d=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed to parse JSON"]))),o("WAResultOrError").makeError("wasm-invalid-json")}return typeof((i=D)==null?void 0:i.score)!="number"?(o("WAKaleidoscopeLogger").ksLogger().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck score is null"]))),o("WAResultOrError").makeError("wasm-invalid-json")):(o("WAKaleidoscopeLogger").ksLogger().DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck called with rawMimeType: ",", mediaType: ",""])),C,g),o("WAResultOrError").makeResult({mimetype:((l=D)==null?void 0:l.mimetype)||"application/octet-stream",extension:((_=D)==null?void 0:_.extension)||null,score:D.score}))}}var b=C({getWasmModule:o("WAGetKaleidoscopeWasm").getKaleidoscopeWasm});l.kaleidoscopeCheck=b}),98);
__d("WAMp4Check",["WAMediaUtilsWasmUrl","WAResultOrError","WASI","WAWasmModuleCache"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="output",u="/"+e,c="/"+s;function d(t){var n,r=t.input,o=t.stderr,a=t.stdout;return{args:["wamediautil","mp4check","--error-tolerance=2","--json-report="+s,e],fs:(n={},n[u]={path:u,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n[c]={path:c,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"string",content:""},n),stdout:a,stderr:o,moduleName:"WAMp4Check_CLI"}}function m(e){var t=e.getWasmModule,n=e.logError,r=e.logMessage;return async function(a){var e,i,l,s,u,m,p,_,f,g,h,y,C,b=a.input,v=o("WASI").createWasi(d({input:b,stderr:n,stdout:r})),S=v.getImportObject,R=v.start,L=await t(),E=await WebAssembly.instantiate(L,S()),k=R(E),I=k.exitCode,T=k.fs;if(I!==0)return n("mp4Check failed with exit code "+I),o("WAResultOrError").makeError("invalid-media");var D=(e=T[c])==null?void 0:e.content;if(typeof D!="string")return n("mp4check failed invalid result type"),o("WAResultOrError").makeError("runtime-error");var x=(i=JSON.parse(D))!=null?i:{};return o("WAResultOrError").makeResult({videoStreamReport:(x==null?void 0:x.video_stream_report)==null?null:{streamType:(l=x.video_stream_report)==null?void 0:l.stream_type,calculatedFps:(s=x.video_stream_report)==null?void 0:s.calculated_fps,nominalFps:(u=x.video_stream_report)==null?void 0:u.nominal_fps,videoWidth:(m=x.video_stream_report)==null?void 0:m.video_width,videoHeight:(p=x.video_stream_report)==null?void 0:p.video_height,duration:(_=x.video_stream_report)==null?void 0:_.duration,avgBitsPerSecond:(f=x.video_stream_report)==null?void 0:f.avg_bits_per_second},audioStreamReport:(x==null?void 0:x.audio_stream_report)==null?null:{streamType:(g=x.audio_stream_report)==null?void 0:g.stream_type,samplingRate:(h=x.audio_stream_report)==null?void 0:h.sampling_rate,numberOfChannels:(y=x.audio_stream_report)==null?void 0:y.number_of_channels,avgBitsPerSecond:(C=x.audio_stream_report)==null?void 0:C.avg_bits_per_second}})}}var p=function(){return o("WAWasmModuleCache").loadWasmModule(o("WAMediaUtilsWasmUrl").WAMediaUtilsWasmUrl)};l.createMp4Check=m,l.getMp4CheckWasm=p}),98);
__d("WAParseWav",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=new DataView(e);return e.byteLength<44||t.getUint32(0)!==1380533830||t.getUint32(8)!==1463899717?null:e}function l(e){var t=new DataView(e),n=t.getUint16(22,!0),r=t.getUint32(24,!0);return{numChannels:n,sampleRate:r}}i.validateWav=e,i.parseWav=l}),66);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","bx"],(function(t,n,r,o,a,i,l){"use strict";var e="input",s="/"+e;function u(t){var n,r=t.input,o=t.stderr,a=t.stdout;return{args:["webpcheck",e],fs:(n={},n[s]={path:s,timestamps:{access:new Date,change:new Date,modification:new Date},mode:"binary",content:new Uint8Array(r)},n),stdout:a,stderr:o,moduleName:"WAWebPCheck_CLI"}}function c(e){var t=e.getWasmModule,n=e.logError,r=e.logMessage;return async function(a){var e=a.input,i=o("WASI").createWasi(u({input:e,stderr:n,stdout:r})),l=i.getImportObject,s=i.start,c=await t(),d=await WebAssembly.instantiate(c,l()),m=s(d),p=m.exitCode;return p!==0?(n("WebPCheck failed with exit code "+p),o("WAResultOrError").makeError("invalid-media")):o("WAResultOrError").makeResult()}}var d=r("bx").getURL(r("bx")("6946")),m=function(){return o("WAWasmModuleCache").loadWasmModule(d)};l.createWebPCheck=c,l.getWebpCheckWasm=m}),98);
__d("WAValidateMedia",["FBLogger","WAIsMp4","WAIsOgg","WAIsWebP","WAKaleidoscopeCheck","WAMp4Check","WAParseWav","WAResultOrError","WAWebPCheck","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=function(){return r("FBLogger")("wmi").tags(["WAValidateMedia"])};function m(t,n){return n.addPoint("media_validation_start"),(r("gkx")("3272")?p(t):_(t)).then(function(e){return e.success?n.addPoint("media_validation_end",{bool:{is_validation_setup_failed:e.value.validationSetupFailed,is_validation_skipped:e.value.skipValidation},string:{validated_mime_type:e.value.mimeType}}):n.addPoint("media_validation_fail",{string:{validationError:e.error}}),e}).catch(function(a){var i=r("getErrorSafe")(a);return d().catching(i).MUSTFIX(e||(e=babelHelpers.taggedTemplateLiteralLoose(["validateMedia threw an exception: ",""])),i.message),n.addPoint("media_validation_fail",{string:{validationError:i.message}}),o("WAResultOrError").makeResult({skipValidation:!0,mimeType:null,validatedPlaintext:t,validationSetupFailed:!0})})}async function p(e){var t=await o("WAKaleidoscopeCheck").kaleidoscopeCheck({input:e,rawMimeType:"application/octet-stream",mediaType:"unknown"});if(!t.success)return d().MUSTFIX(s||(s=babelHelpers.taggedTemplateLiteralLoose(["kaleidoscopeCheck failed with error: ",""])),t.error),o("WAResultOrError").makeError("runtime-error");var n=t.value,r=n.mimetype,a=n.score;return a>=80?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:r,validatedPlaintext:e,validationSetupFailed:!1,isKaleidoscopeCheck:!0})}function _(e){var t=new Uint8Array(e);if(o("WAIsWebP").isWebP(t))return h(e);if(o("WAIsMp4").isMp4(t))return y(e);if(o("WAIsOgg").isOgg(t))return Promise.resolve(o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/ogg",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:null}));var n=o("WAParseWav").validateWav(e);return n!=null?Promise.resolve(C(n)):Promise.resolve(o("WAResultOrError").makeResult({mimeType:null,skipValidation:!0,validatedPlaintext:e,validationSetupFailed:!1}))}var f=function(t){t!==""&&d().WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)},g=function(t){t!==""&&d().DEBUG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",""])),t)};async function h(e){var t=o("WAWebPCheck").createWebPCheck({getWasmModule:o("WAWebPCheck").getWebpCheckWasm,logError:f,logMessage:g}),n=await t({input:e});return n.success?o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:e,validationSetupFailed:!1}):n}async function y(e){var t=o("WAMp4Check").createMp4Check({getWasmModule:o("WAMp4Check").getMp4CheckWasm,logError:f,logMessage:g}),n=await t({input:e});if(!n.success)return o("WAResultOrError").makeError(n.error);var r=n.value,a=r.audioStreamReport,i=r.videoStreamReport;return i==null?a==null?o("WAResultOrError").makeError("invalid-media"):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/mp4",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:a}):o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:e,validationSetupFailed:!1,videoStreamReport:i,audioStreamReport:a})}function C(e){var t=o("WAParseWav").parseWav(e),n=t.numChannels,r=t.sampleRate;return o("WAResultOrError").makeResult({skipValidation:!1,mimeType:"audio/wav",validatedPlaintext:e,validationSetupFailed:!1,audioStreamReport:{streamType:"LPCM",samplingRate:r,numberOfChannels:n}})}l.validateMedia=m}),98);
__d("WADownloadFullSizeOnlyTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","WADownloadMedia","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAResultOrError","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow;i.addPoint("get_media_entries_start");var l=await n.getMediaEntries(r);if(!l.success)return i.addPoint("get_media_entries_fail"),{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var s=l.value;i.addPoint("get_media_entries_end");var u=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(s);if(!u.success)return{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var c=u.value,m=c[0],p=c[1],_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(p);if(!_.success)return{fullsizePromise:Promise.resolve(_)};var f=_.value,g=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:f}),h=g.logDownloadResult,y=d({abortSignal:t,dbCallbacks:n,logger:a,mediaDownloadFlow:i,mediaEntries:s,msgIdOfRecentMediaEntry:m,recentMediaEntry:f}).then(async function(e){if(!e.success)return e;var t=await o("WAValidateMedia").validateMedia(e.value.plaintext,i);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[m,f],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return{fullsizePromise:h(y)}}async function d(t){var n=t.abortSignal,a=t.dbCallbacks,i=t.logger,l=t.mediaDownloadFlow,c=t.mediaEntries,d=t.msgIdOfRecentMediaEntry,m=t.recentMediaEntry,p=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");p&&l.addPoint("forcing_eb_download");var _=p?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:l,mediaEntry:m});if(_.success||!o("WAIsMediaExpiredError").isMediaExpiredError(_.error)||!r("MAWEBSwitch").isEnabled())return _;var f=await a.getProtocolMsgIdAndSortOrderMs(d);if(f==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var g=f.protocolMsgId,h=f.sortOrderMs,y=m,C=d,b=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(y.serverMediaType);if(b==null||y.objectId==null)return i.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),_.error),_;var v=await o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:y.objectId,logger:i,mediaDownloadFlow:l,mediaKey:y.mediaKey,mediaType:b,msgId:C,protocolMsgId:g,sortOrderMs:h});if(!v.success)return i.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed: ",""])),v.error),v;var S=await o("WADownloadMedia").downloadFullMediaOnly({abortSignal:n,downloadMediaMetric:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},y,{directPath:v.value})});return S.success?o("WAResultOrError").makeResult(S.value):(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),S.error),S)}l.startDownloadFullSizeTask=c,l.downloadOrRestoreFullSize=d}),98);
__d("WADownloadMediaPreviewV2",["WADownloadMedia","WADownloadProgressiveJpegPreview","WAMediaCrypto","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.abortSignal,r=t.hash,a=t.logger,i=t.mediaDownloadFlow,l=t.mediaEntry,s=t.progressiveJpegDetails,u=l.serverMediaType,c=o("WAMediaUtils").getMimeTypeFromServerMediaType(u),d=s==null?o("WAResultOrError").makeError("jpeg-stream-not-supported"):await o("WADownloadProgressiveJpegPreview").maybeDownloadProgressiveJpegPreviewV2({abortSignal:n,hash:r,serverMediaType:u,mediaEntry:l,progressiveJpegDetails:s,mediaDownloadFlow:i});if(d.success===!0)return o("WAResultOrError").makeResult({plaintext:d.value,mimeType:c,serverMediaType:u});i.addPoint("fallback_to_downloadable_thumbnail");var m=l.downloadableThumbnail;if((m==null?void 0:m.directPath)==null)return o("WAResultOrError").makeError("media-not-found");var p=o("WAMediaUtils").validateDownloadableThumbnailForDownload(m);if(p.success===!1)return a.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["preview mediaEntry is incomplete: ",""])),p.error),o("WAResultOrError").makeError(p.error[0]);var _=p.value,f=_.directPath,g=_.fileEncSha256,h=_.fileSha256,y=_.mediaKey,C=o("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(u);if(C==null)return o("WAResultOrError").makeError("request-error");var b=await o("WADownloadMedia").downloadMediaImpl({abortSignal:n,downloadFlow:i,mediaTypeDetails:{messageType:C,type:"preview"},directPath:f,fileEncSha256:g,fileSha256:h,mediaKey:y});return b.success===!1?b:o("WAResultOrError").makeResult({plaintext:b.value,mimeType:c,serverMediaType:u})}l.downloadMediaPreview=s}),98);
__d("WAIsPreviewSupported",["$InternalEnum","WAProgressiveJpegGetPJpegDetails"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum").Mirrored(["NO","YES"]),s=n("$InternalEnum").Mirrored(["NO","YES","DuplicatedWithFullSize"]);function u(t){var n=t.serverMediaType;switch(n){case"image":{var r,a,i=(r=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(t).value)!=null?r:null,l=i!=null?e.YES:e.NO;if(((a=t.downloadableThumbnail)==null?void 0:a.directPath)==null)return[l,s.NO];t.downloadableThumbnail.directPath;var u=t.downloadableThumbnail.directPath===t.directPath?s.DuplicatedWithFullSize:s.YES;return[l,u]}case"video":{var c;if(((c=t.downloadableThumbnail)==null?void 0:c.directPath)==null)return[e.NO,s.NO];t.downloadableThumbnail.directPath;var d=t.downloadableThumbnail.directPath===t.directPath?s.NO:s.YES;return[e.NO,d]}case"sticker":case"ptt":case"audio":case"document":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"template":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"novi-video":case"novi-image":case"payment-bg-image":case"xma-image":case"biz-cover-photo":case"preview":case"newsletter-audio":case"newsletter-document":case"newsletter-image":case"newsletter-gif":case"newsletter-music-artwork":case"newsletter-ptt":case"newsletter-sticker":case"newsletter-sticker-pack":case"newsletter-thumbnail-link":case"newsletter-video":case"newsletter-ptv":case"sticker-pack":case"thumbnail-sticker-pack":case"music-artwork":case"group-history":case"ads-image":case"ads-video":case"ptv":return[e.NO,s.NO];default:return[e.NO,s.NO]}}l.PjpegPreviewSupport=e,l.DownloadablePreviewSupport=s,l.checkPreviewSupport=u}),98);
__d("WADownloadPreviewOnlyTask",["EncryptedBackupsResignCdnUrl","MAWEBSwitch","WADownloadMediaPreviewV2","WAFindMostRecentMediaEntry","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow;i.addPoint("get_media_entries_start");var l=await n.getMediaEntries(r);if(!l.success)return i.addPoint("get_media_entries_fail"),{previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};i.addPoint("get_media_entries_end");var s=l.value,u=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(s);if(!u.success)return{previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var d=u.value,m=d[0],p=d[1],_=o("WAMediaUtils").validateDecodedMediaEntryForDownload(p);if(!_.success)return{previewPromise:Promise.resolve(_)};var f=_.value,g=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:f}),h=g.logDownloadResult,y=c({abortSignal:t,dbCallbacks:n,fullSizePlaintextHash:r,logger:a,mediaDownloadFlow:i,mediaEntries:l.value,msgIdOfRecentMediaEntry:m,recentMediaEntry:f}).then(async function(e){if(!e.success)return e;var t=await o("WAValidateMedia").validateMedia(e.value.plaintext,i);return t.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:[m,f],serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.mimeType,validatedResult:t.value}):t});return{previewPromise:h(y)}}async function c(t){var n,a=t.abortSignal,i=t.dbCallbacks,l=t.fullSizePlaintextHash,u=t.logger,c=t.mediaDownloadFlow,d=t.mediaEntries,m=t.msgIdOfRecentMediaEntry,p=t.recentMediaEntry,_=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");_&&c.addPoint("forcing_eb_download");var f=o("WAIsPreviewSupported").checkPreviewSupport(p),g=f[0],h=f[1];if(g===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&h===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return o("WAResultOrError").makeError("preview-not-supported");var y=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(p),C=y.success===!0?y.value:null,b={abortSignal:a,hash:l,logger:u,mediaDownloadFlow:c,progressiveJpegDetails:C};c.addPoint("download_preview_start",{string:{preview_downloadable_support:h,preview_pjpeg_support:g}});var v=_?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},b,{mediaEntry:p}));if(v.success)return c.addPoint("download_preview_end"),o("WAResultOrError").makeResult({mimeType:v.value.mimeType,plaintext:v.value.plaintext,serverMediaType:v.value.serverMediaType});if(c.addPoint("download_preview_fail"),!o("WAIsMediaExpiredError").isMediaExpiredError(v.error)||!r("MAWEBSwitch").isEnabled()||r("gkx")("1327")!==!0)return v;var S=await i.getProtocolMsgIdAndSortOrderMs(m);if(S==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var R=S.protocolMsgId,L=S.sortOrderMs,E=p,k=m,I=h===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO||((n=E.downloadableThumbnail)==null?void 0:n.objectId)==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:E.downloadableThumbnail.objectId,logger:u,mediaDownloadFlow:c,mediaKey:E.mediaKey,mediaType:"preview",msgId:k,protocolMsgId:R,sortOrderMs:L}),T=g===o("WAIsPreviewSupported").PjpegPreviewSupport.NO||E.objectId==null?null:o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:E.objectId,logger:u,mediaDownloadFlow:c,mediaKey:E.mediaKey,mediaType:"image",msgId:k,protocolMsgId:R,sortOrderMs:L}),D=await Promise.all([I,T]),x=D[0],$=D[1];if((x==null?void 0:x.success)!==!0&&($==null?void 0:$.success)!==!0){var P;return u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and restore failed. downloadableThumbnail error: ",". pjpegPreview error: ",""])),x==null?void 0:x.error,$==null?void 0:$.error),(P=$!=null?$:x)!=null?P:o("WAResultOrError").makeError("preview-not-supported")}c.addPoint("second_download_preview_start");var N=await o("WADownloadMediaPreviewV2").downloadMediaPreview(babelHelpers.extends({},b,{mediaDownloadFlow:babelHelpers.extends({},c,{addPoint:function(t,n){c.addPoint("second_"+t,n)}}),mediaEntry:babelHelpers.extends({},E,{directPath:($==null?void 0:$.success)===!0?$.value:E.directPath,downloadableThumbnail:E.downloadableThumbnail==null?null:babelHelpers.extends({},E.downloadableThumbnail,{directPath:(x==null?void 0:x.success)===!0?x.value:E.downloadableThumbnail.directPath})})}));return N.success?(c.addPoint("second_download_preview_end"),o("WAResultOrError").makeResult({mimeType:N.value.mimeType,plaintext:N.value.plaintext,serverMediaType:N.value.serverMediaType})):(u.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media after restore CDN URL: ",""])),N.error),c.addPoint("second_download_preview_fail"),N)}l.startDownloadPreviewTask=u,l.downloadOrRestorePreviewOnly=c}),98);
__d("WADownloadProgressiveJpegUsingMediaStreaming",["WAByteArray","WACryptoSha256","WACryptoUtils","WADownloadProgressiveJpegPlaintextStreamer","WADownloadProgressiveJpegPreview","WAErrorMessage","WAMediaUtils","WAProgressiveJpegAddJPEGTrailingTag","WAResolvable","WAResultOrError","WAStreamAsyncIterator","WATypedArraysConcat"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;async function f(t){var n=t.abortSignal,r=t.directPath,a=t.downloadFlow,i=t.fileEncSha256,l=t.fileSha256,m=t.logger,p=t.mediaKey,_=t.progressiveJpegDetails,f=t.serverMediaType,h=m.TAGS(["MediaStreaming"]);h.LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Using Media Streaming to download ProgressiveJpeg."]))),a.addPoint("create_pjpeg_stream_start");var y=await o("WADownloadProgressiveJpegPlaintextStreamer").downloadProgressiveJpegPlaintextUsingStreams({abortSignal:n,directPath:r,eventFlow:a,fileEncSha256:i,mediaKey:p,progressiveJpegDetails:_,serverMediaType:f}).catch(function(e){return h.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["create DownloadAndDecryptPJpegStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(y.success===!1)return a.addPoint("create_pjpeg_stream_fail"),y;a.addPoint("create_pjpeg_stream_end");var C=new(o("WAResolvable")).Resolvable,b=!1,v=g({downloadFlow:a,fileSha256:l,mediaStreamingLogger:h,previewResolvable:C,progressiveJpegDetails:_,progressiveJpegDownloadStream:y.value,serverMediaType:f}).then(function(e){return b=!0,h.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream completed"]))),e}).catch(function(e){return b=!0,h.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["handleProgressiveJpegDownloadStream unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),C.reject(e),o("WAResultOrError").makeError("runtime-error")}),S=o("WAMediaUtils").getMimeTypeFromServerMediaType(f);function R(e){return e.success===!1?e:o("WAResultOrError").makeResult({mimeType:S,plaintext:e.value,serverMediaType:f})}var L=v.then(R),E=C.promise.then(R),k=await C.promise;if(k.success===!0&&b===!0&&h.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["fullsizeResolvable is settled before previewResolvable"]))),k.success===!0)return o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E});var I=await v;return k.success,I.success===!0?o("WAResultOrError").makeResult({fullsizePromise:L,previewPromise:E}):(I.success,I)}async function g(e){var t=e.downloadFlow,n=e.fileSha256,r=e.mediaStreamingLogger,a=e.previewResolvable,i=e.progressiveJpegDetails,l=e.progressiveJpegDownloadStream;t.addPoint("download_pjpeg_preview_start");var s=0,u=o("WADownloadProgressiveJpegPreview").getPreviewTargetScan(i.scanLengths)-1;try{var c=[],d=!1,f=!1,g;try{for(var h=babelHelpers.asyncIterator(o("WAStreamAsyncIterator").streamAsyncIterator(l)),y;d=!(y=await h.next()).done;d=!1){var C=y.value;{if(C==null)continue;if(c.push(C),s===u){t.addPoint("media_streaming_preview_processed");var b=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c,[o("WAProgressiveJpegAddJPEGTrailingTag").JPEG_TRAILING_TAG])));a.resolve(o("WAResultOrError").makeResult(b)),t.addPoint("download_pjpeg_preview_end")}s++}}}catch(e){f=!0,g=e}finally{try{d&&h.return!=null&&await h.return()}finally{if(f)throw g}}a.isSettled===!1&&(r.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["pjpeg stream ended before reaching previewTargetScanIndex"]))),a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail"));var v=o("WAByteArray").uint8ArrayToBuffer(o("WATypedArraysConcat").concatTypedArrays(Uint8Array,[].concat(c))),S=await o("WACryptoSha256").sha256(v);return o("WACryptoUtils").arrayBuffersEqual(n,S)?o("WAResultOrError").makeResult(v):(r.WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Media streaming for ProgressiveJpeg download failed due to plaintext hash mismatch."]))),o("WAResultOrError").makeError("hash-mismatch"))}catch(e){return r.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Exception occurred during Media Streaming: Reason: ",""])),e),a.isSettled===!1&&(a.resolve(o("WAResultOrError").makeError("runtime-error")),t.addPoint("download_pjpeg_preview_fail")),o("WAResultOrError").makeError("runtime-error")}}l.downloadProgresiveJpegUsingMediaStreaming=f}),98);
__d("WADownloadFullSizeAndPreviewTask",["EncryptedBackupsResignCdnUrl","MAWCastToMsgrServerMediaType","MAWEBSwitch","UserAgent","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WADownloadProgressiveJpegUsingMediaStreaming","WAErrorMessage","WAFindMostRecentMediaEntry","WAHashUtils","WAIsMediaExpiredError","WAIsPreviewSupported","WAMediaManagerPrepareMediaDownload","WAMediaUtils","WAProgressiveJpegGetPJpegDetails","WAResultOrError","WAStartMediaDownloadQplFlow","WAValidateMedia","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h;async function y(t){var n=t.abortSignal,r=t.dbCallbacks,a=t.fullSizePlaintextHash,i=t.logger,l=t.mediaDownloadFlow;l.addPoint("get_media_entries_start");var c=await r.getMediaEntries(a);if(!c.success)return l.addPoint("get_media_entries_fail"),{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};l.addPoint("get_media_entries_end");var d=c.value,m=o("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(d);if(!m.success)return{fullsizePromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry")),previewPromise:Promise.resolve(o("WAResultOrError").makeError("missing-media-entry"))};var p=m.value,_=p[0],f=p[1],g=o("WAMediaUtils").validateDecodedMediaEntryForDownload(f);return g.success?b({abortSignal:n,dbCallbacks:r,fullSizePlaintextHash:a,logger:i,mediaDownloadFlow:l,mediaEntries:d,msgIdOfRecentMediaEntry:_,recentMediaEntry:g.value}).then(function(e){return i.DEV(s||(s=babelHelpers.taggedTemplateLiteralLoose(["outter promise: ",""])),e.success===!0?"success":e.error),e.success?e.value:(i.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["outter promise failed: ",""])),e.error),{fullsizePromise:Promise.resolve(e),previewPromise:Promise.resolve(e)})}):(i.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaEntry for download: ",""])),g.error),{fullsizePromise:Promise.resolve(g),previewPromise:Promise.resolve(g)})}async function C(e,t,n){var r=await e;if(!r.success)return Promise.resolve(r);var a=await o("WAValidateMedia").validateMedia(r.value.plaintext,n);return a.success?o("WAResultOrError").makeResult({msgIdAndMediaEntry:t,serverMediaType:r.value.serverMediaType,unvalidatedMimeType:r.value.mimeType,validatedResult:a.value}):a}async function b(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.logger,i=e.mediaDownloadFlow,l=e.mediaEntries,s=e.msgIdOfRecentMediaEntry,u=e.recentMediaEntry,d=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:a,mediaDownloadFlow:i,mediaEntry:u}),m=d.logDownloadResult,p={abortSignal:t,dbCallbacks:n,logger:a,mediaDownloadFlow:i,mediaEntries:l,msgIdOfRecentMediaEntry:s,recentMediaEntry:u},_=await v(babelHelpers.extends({},p,{fullSizePlaintextHash:r}));if(_.success){var f=_.value,g=f.fullsizePromise,h=f.previewPromise,y=g.then(function(e){return e.success?e:(i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:e.error}}),o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p))}),b=[s,u];return o("WAResultOrError").makeResult({fullsizePromise:m(C(y,b,i)),previewPromise:C(h,b,i)})}var R=L(_.error);if(!R.shouldFallback)return o("WAResultOrError").makeError(R.error);i.addPoint("fallback_to_non_streaming_download",{string:{streaming_fallback_reason:R.error}}),a.LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["fallback to non-streaming download"])));var E=C(o("WADownloadFullSizeOnlyTask").downloadOrRestoreFullSize(p),[s,u],i),k=S(babelHelpers.extends({},p,{fullSizePlaintextHash:r,fullsizePromise:E}));return o("WAResultOrError").makeResult({fullsizePromise:m(E),previewPromise:k})}async function v(e){var t,n=e.abortSignal,a=e.dbCallbacks,i=e.logger,l=e.mediaDownloadFlow,s=e.mediaEntries,u=e.msgIdOfRecentMediaEntry,c=e.recentMediaEntry,g=r("MAWEBSwitch").isEnabled()&&r("gkx")("23960");g&&l.addPoint("forcing_eb_download");var h=c.directPath,y=c.fileEncSha256,C=c.fileSha256,b=c.mediaKey,v=c.serverMediaType,S=(t=o("WAProgressiveJpegGetPJpegDetails").maybeGetProgressiveJpegDetailsUsingMediaEntry(c).value)!=null?t:null;if(S==null||c.serverMediaType!=="image"||!o("WAMediaUtils").isTransformStreamSupported()||r("UserAgent").isBrowser("Safari < 18")||r("UserAgent").isBrowser("Mobile Safari < 18"))return c.serverMediaType==="image"&&S==null&&(i.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["skip pjpeg streaming because pjpeg metadata is null"]))),i.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["media entry: ",""])),c)),o("WAResultOrError").makeError("jpeg-stream-not-supported");l.addPoint("media_streaming_start");var L=g?o("WAResultOrError").makeError("signature-expired"):await o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:h,downloadFlow:l,fileEncSha256:y,fileSha256:C,logger:i,mediaKey:b,progressiveJpegDetails:S,serverMediaType:v}).catch(function(e){return i.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});if(L.success)return l.addPoint("media_streaming_end"),L;if(!o("WAIsMediaExpiredError").isMediaExpiredError(L.error)||!r("MAWEBSwitch").isEnabled())return R(l,L),L;var E=await a.getProtocolMsgIdAndSortOrderMs(u);if(E==null)return o("WAResultOrError").makeError("missing-sort-order-ms-for-restore");var k=E.protocolMsgId,I=E.sortOrderMs,T=c,D=u,x=T.fileEncSha256,$=T.fileSha256,P=T.mediaKey,N=T.serverMediaType,M=o("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(N);if(M==null||T.objectId==null)return i.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media and can not restore: ",""])),L.error),L;var w=await o("EncryptedBackupsResignCdnUrl").resignCdnUrl({deliveryObjectId:T.objectId,logger:i,mediaDownloadFlow:l,mediaKey:T.mediaKey,mediaType:M,msgId:D,protocolMsgId:k,sortOrderMs:I});if(!w.success)return w;l.addPoint("second_media_streaming_start");var A=await o("WADownloadProgressiveJpegUsingMediaStreaming").downloadProgresiveJpegUsingMediaStreaming({abortSignal:n,directPath:w.value,downloadFlow:babelHelpers.extends({},l,{addPoint:function(t,n){l.addPoint("second_"+t,n)}}),fileEncSha256:x,fileSha256:$,logger:i,mediaKey:P,progressiveJpegDetails:S,serverMediaType:N}).catch(function(e){return i.ERROR(f||(f=babelHelpers.taggedTemplateLiteralLoose(["downloadProgresiveJpegUsingMediaStreaming unexpected runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")});return A.success?(l.addPoint("second_media_streaming_end"),A):(R(l,A),A)}function S(e){var t=e.abortSignal,n=e.dbCallbacks,r=e.fullSizePlaintextHash,a=e.fullsizePromise,i=e.logger,l=e.mediaDownloadFlow,s=e.mediaEntries,u=e.msgIdOfRecentMediaEntry,c=e.recentMediaEntry,d=c.serverMediaType,m=o("WAIsPreviewSupported").checkPreviewSupport(c),p=m[0],_=m[1];if(p===o("WAIsPreviewSupported").PjpegPreviewSupport.NO&&_===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return i.LOG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["preview not supported"]))),Promise.resolve(o("WAResultOrError").makeError("preview-not-supported"));if(_===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return i.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["preview duplicated with fullsize"]))),a;var f=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:l.downloadEntry,isPreview:!0,msgType:null,protocolMsgId:null,triggerUIView:null}),y=o("WAMediaManagerPrepareMediaDownload").mediaManagerPrepareMediaDownload({hash:r,logger:i,mediaDownloadFlow:f,mediaEntry:c}),b=y.logDownloadResult;f.addAnnotations({bool:{isMediaManager:!0},string:{downloadKind:"fullsizeAndPreview",fullSizeMediaType:d,mediaType:"preview",sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var v=o("WADownloadPreviewOnlyTask").downloadOrRestorePreviewOnly({abortSignal:t,dbCallbacks:n,fullSizePlaintextHash:r,logger:i,mediaDownloadFlow:f,mediaEntries:s,msgIdOfRecentMediaEntry:u,recentMediaEntry:c});return b(C(v,[u,c],f)).then(function(e){return e.success?f.endSuccess():f.endFail(e.error,{string:{failReason:e.error}}),e}).catch(function(e){return f.endFail("runtime-error",{string:{failReason:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WAResultOrError").makeError("runtime-error")})}function R(e,t){e.addPoint("media_streaming_fail",{string:{wa_media_download_streaming_fail_reason:o("WAErrorMessage").maybeGetMessageFromError(t.error)}})}function L(e){switch(e){case"runtime-error":case"jpeg-stream-not-supported":return{error:e,shouldFallback:!0};case"missing-expected-hmacs":case"hmac-chiphertext-array-mismatch":return{error:e,shouldFallback:!0};case"missing-media-entry":case"missing-media-entry-for-restore":case"missing-sort-order-ms-for-restore":case"preview-not-supported":return{error:e,shouldFallback:!1};case"derive-primary-key-secret-error":case"derive-access-token-secret-error":case"direct-path-undefined":case"direct-path-corrupted":case"direct-path-empty":case"create-payload-failed":case"resign-cdn-url-request-error":case"resign-cdn-url-runtime-error":case"resign-cdn-url-timeout":case"resign-cdn-url-gql-error":return{error:e,shouldFallback:!1};case"invalid-media":return{error:e,shouldFallback:!1};case"decryption-error":case"enc-hash-mismatch":case"hash-mismatch":case"ciphertext-hash-mismatch":return{error:e,shouldFallback:!0};case"access-expired":case"disconnected":case"backoff":case"body-network-error":case"http-fetch-exception":case"http-fetch-aborted":case"no-host":case"server-timeout":case"unspecified-http-error":case"media-not-found":case"download-throttled":case"request-error":case"max-attempts-exceeded":case"signature-expired":case"media-entry-invalid":return{error:e,shouldFallback:!1};case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":return{error:e,shouldFallback:!1}}}l.startDownloadFullSizeAndPreviewTask=y}),98);
__d("WAMediaManagerLogger",["WAHashUtils","WATagsLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WATagsLogger").TAGS(["MediaManager"]);function s(t){var n=t.downloadKind,r=t.fullSizePlaintextHash,a=e.TAGS(["download","hash:"+o("WAHashUtils").sanitisePlaintextHash(r),n]);return a}function u(t){var n=t.plaintextHash,r=t.uploadKind,a=e.TAGS(["upload","hash:"+o("WAHashUtils").sanitisePlaintextHash(n),r]);return a}l.baseLogger=e,l.createDownloadLogger=s,l.createUploadLogger=u}),98);
__d("WAMediaManagerTypes",["WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return e.success?o("WAResultOrError").makeResult({serverMediaType:e.value.serverMediaType,unvalidatedMimeType:e.value.unvalidatedMimeType,validatedResult:e.value.validatedResult}):e}l.transformInternalMediaDownloadResult=e}),98);
__d("WAMediaManagerWorkerScheduler",["WorkerScheduler"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return e==null&&(e=o("WorkerScheduler").makeScheduler("MediaManager",{concurrency:16,maxTaskLimit:32,maxThrottleMs:3e4,timeoutMs:6e4})),e}l.mediaManagerWorkerScheduler=s}),98);
__d("WACreateRetrier",["WAComms","WAGetMediaRoute","WAMediaOperationsRetrier","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";async function e(e,t){var n=await o("WAGetMediaRoute").getMediaRoute({operation:"upload",serverMediaType:e},t);if(!n.success)return n;var r=n.value,a=r.authToken,i=r.fallbackHost,l=r.selectedHost,s=new(o("WAMediaOperationsRetrier")).MediaOperationsRetrier("upload",{host:{domain:l.domain,class:l.class},fallbackHost:i&&{domain:i.domain,class:i.class},authToken:a,timeElapsed:null},o("WAComms").waitForConnection);return o("WAResultOrError").makeResult(s)}l.createUploadRetrier=e}),98);
__d("WAHttpRegularUploadMedia",["WADirectPath","WALogger","WAResultOrError","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){var a;try{a=await fetch(t,{method:"POST",mode:"cors",cache:"no-store",headers:{"Content-Type":"text/plain"},body:new Blob([n])})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to initiate fetch ",""])),t),t}var i=a,l=i.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Fetch Media HTTP status ",""])),l),l){case 200:return a.json().then(function(e){if(!Object.prototype.hasOwnProperty.call(e,"direct_path"))throw r("err")("direct_path not available in wa upload http response");if(typeof e.direct_path!="string")throw r("err")('directPath: "'+e.direct_path+'" is not a string');if(e.object_id&&typeof e.object_id!="string")throw r("err")('objectId: "'+e.object_id+'" is not a string');if(e.handle&&typeof e.handle!="string")throw r("err")('handle: "'+e.handle+'" is not a string');var t={directPath:o("WADirectPath").unsafeCastToDirectPath(e.direct_path),objectId:e.object_id,handle:e.handle};return o("WAResultOrError").makeResult(t)}).catch(function(e){return o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpRegularUploadMedia: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 408:return o("WAResultOrError").makeError("server-timeout");case 413:return o("WAResultOrError").makeError("payload-too-large");case 415:return o("WAResultOrError").makeError("invalid-media");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return l>=400&&l<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpRegularUploadMedia=c}),98);
__d("WAHttpResumeCheck",["WADirectPath","WALogger","WAMediaUtils","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m;async function p(t){var n;try{n=await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"text/plain"}})}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to initiate fetch ",""])),t),t}var r=n,a=r.status;switch(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: response status ",""])),a),a){case 200:return n.json().then(function(e){var t=e.direct_path,n=e.object_id,r=e.resume;if(r==="complete")return t==null?(o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: direct_path is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):n==null?(o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: object_id is missing"]))),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-found",directPath:o("WADirectPath").unsafeCastToDirectPath(t),objectId:o("WAMediaUtils").stringToDeliveryObjectId(n)});var a=parseInt(r,10);return a===0?o("WAResultOrError").makeResult({type:"media-not-found"}):Number.isNaN(a)?(o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: resume is NaN: ",""])),r),o("WAResultOrError").makeResult({type:"media-not-found"})):o("WAResultOrError").makeResult({type:"media-partial-found",resumeFromBytes:a})}).catch(function(e){return o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["HttpResumeCheck: fail to parse request body ",""])),e),o("WAResultOrError").makeError("body-network-error")});case 404:return o("WAResultOrError").makeResult({type:"media-not-found"});case 408:return o("WAResultOrError").makeError("server-timeout");case 429:case 507:return o("WAResultOrError").makeError("upload-throttled");default:return a>=400&&a<500?o("WAResultOrError").makeError("request-error"):o("WAResultOrError").makeError("unspecified-http-error")}}l.httpResumeCheck=p}),98);
__d("WAEncryptAndUploadPlaintext",["WABase64","WAErrorMessage","WAGlobals","WAHttpRegularUploadMedia","WAHttpResumeCheck","WALogger","WAMediaCrypto","WAMediaUrl","WAProgressiveJpegGetPJpegDetails","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_;async function f(t){var n=t.fromOffset,r=n===void 0?0:n,a=t.mediaKey,i=t.mediaKeyTimestamp,l=t.mediaUploadFlow,f=t.plaintext,g=t.plaintextHash,h=t.serverMediaType,y=t.uploadRetrier,C=t.uploadToken;l.addPoint("encrypt_and_upload_plaintext_start"),l.addPoint("compute_media_keys_start");var b=h==="preview"?await o("WAMediaCrypto").computeMediaKeysForPreview(a):await o("WAMediaCrypto").computeMediaKeys(a,h),v=b.cipherKey,S=b.hmacKey,R=b.iv;l.addPoint("compute_media_keys_end"),l.addPoint("encrypt_and_hmac_start");var L=await o("WAMediaCrypto").encryptAndHmac(v,R,S,f,h),E=L.ciphertext,k=L.ciphertextHash,I=L.ivCiphertextHmac,T=L.sidecar;l.addPoint("encrypt_and_hmac_end");var D=null;if(h==="image"){l.addPoint("get_progressive_jpeg_details_start");var x=await o("WAProgressiveJpegGetPJpegDetails").getProgressiveJpegDetails(new Uint8Array(f),I,S),$=o("WAProgressiveJpegGetPJpegDetails").isValidProgressiveJpegDetails(x);$.success===!1?(o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Created invalid progressiveJpeg details during encrypt and upload: ",""])),$.error),l.addPoint($.error)):$.value===!0&&o("WAGlobals").getConfig().isProgressiveJpegSendEnabled()&&(o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: Found valid progressiveJpeg details. Adding to media entry."]))),D=x,l.addPoint("get_progressive_jpeg_details_end"))}var P={fileSha256:o("WABase64").decodeB64UrlSafe(g),fileEncSha256:k,mediaKey:a,mediaKeyTimestamp:i,serverMediaType:h,uploadToken:C,sidecar:T,progressiveJpegDetails:D,size:f.byteLength,filename:void 0,lastDownloadAttemptTimestamp:void 0,directPath:void 0},N,M=await y.run(async function(e,t,n){var a=e.domain,i=r;if(n>0){l.addPoint("network_retry",{int:{network_retry_attempt:n}});try{l.addPoint("resume_check_start");var s=o("WAMediaUrl").buildUploadUrl(h,C,k,a,t,!0),p=await o("WAHttpResumeCheck").httpResumeCheck(s);if(p.success){l.addPoint("resume_check_end");var _=p.value;if(_.type==="media-found")return l.addAnnotations({bool:{existingMediaFound:!0}}),o("WAResultOrError").makeResult(o("WAResultOrError").makeResult({directPath:_.directPath,objectId:null,handle:null}));_.type==="media-partial-found"&&(i=_.resumeFromBytes)}l.addPoint("resume_check_fail",{string:{resume_check_error:p.error}})}catch(e){l.addPoint("resume_check_fail",{string:{resume_check_error:o("WAErrorMessage").maybeGetMessageFromError(e)}}),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: error during retrier ",""])),e)}}i>0&&i<E.byteLength?(l.addAnnotations({int:{fromOffset:i},bool:{continuedFromOffset:!0}}),N=E.subarray(i)):N=E;var f=o("WAMediaUrl").buildUploadUrl(h,C,k,a,t,!1,i);return o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: start upload media to ",""])),f),l.addPoint("http_upload_start"),o("WAHttpRegularUploadMedia").httpRegularUploadMedia(f,N).then(function(e){if(e.success)return l.addPoint("http_upload_end",{int:{attempt:n}}),o("WAResultOrError").makeResult(e);var t=e.error;switch(l.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),t){case"server-timeout":case"unspecified-http-error":return o("WAResultOrError").makeError({progressMade:!0});default:return o("WAResultOrError").makeResult(o("WAResultOrError").makeError(t))}}).catch(function(e){var t=o("WAErrorMessage").maybeGetMessageFromError(e);return l.addPoint("http_upload_fail",{string:{http_upload_error:t}}),o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext error: ",""])),t),o("WAResultOrError").makeError({progressMade:!1})})});if(M==null)return o("WALogger").WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext given up"]))),o("WAResultOrError").makeError("max-attempts-exceeded");if(M.success===!1)return M;var w=M.value,A=w.directPath,F=w.handle,O=w.objectId,B=babelHelpers.extends({},P,{directPath:A,handle:F,objectId:O});o("WALogger").LOG(_||(_=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: upload success "," ",""])),{directPath:A},{objectId:O});var W="undefined";return O!=null&&(W=O.length>60?"new":"old"),l.addPoint("encrypt_and_upload_plaintext_end",{string:{object_id_type:W}}),o("WAResultOrError").makeResult(B)}l.encryptAndUploadPlaintext=f}),98);
__d("WAUploadMediaQuick",["WACreateRetrier","WAEncryptAndUploadPlaintext","WAMediaUtils","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.logger,r=t.mediaUploadFlow,a=t.plaintext,i=t.plaintextHash,l=t.serverMediaType;n.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["start uploadMediaQuick"]))),r.addPoint("create_upload_retrier_start");var s=await o("WACreateRetrier").createUploadRetrier(l,r);if(!s.success)return r.addPoint("create_upload_retrier_fail"),s;r.addPoint("create_upload_retrier_end"),r.addPoint("create_media_key_start");var u=o("WAMediaUtils").createMediaKey(),c=o("WAMediaUtils").createUploadToken(),d=o("WATimeUtils").unixTime();r.addPoint("create_media_key_end");var m=await o("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({mediaKey:u,mediaKeyTimestamp:d,serverMediaType:l,mediaUploadFlow:r,plaintext:a,plaintextHash:i,uploadRetrier:s.value,uploadToken:c});return m}l.uploadMediaQuick=s}),98);
__d("mapWorkerSchedulerTask",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){return babelHelpers.extends({},e,{promise:e.promise.then(t),run:function(){return e.run().then(t)}})}i.mapWorkerSchedulerTask=e}),66);
__d("WAMediaManager",["$InternalEnum","WADownloadFullSizeAndPreviewTask","WADownloadFullSizeOnlyTask","WADownloadPreviewOnlyTask","WAErrorMessage","WAHashUtils","WAMediaManagerCache","WAMediaManagerLogger","WAMediaManagerTypes","WAMediaManagerWorkerScheduler","WAResultOrError","WAUploadMediaQuick","WorkerScheduler","gkx","mapWorkerSchedulerTask","vulture"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S=n("$InternalEnum").Mirrored(["HIGH","MEDIUM","LOW"]);function R(){return{fullsizeCache:new Map,previewCache:new Map,uploadCache:new Map}}function L(t){var n=t.createCacheState,a=t.dbCallbacks,i=o("WAMediaManagerWorkerScheduler").mediaManagerWorkerScheduler(),l=o("WAMediaManagerCache").createAttachmentCache(a.getProtocolMsgIdAndSortOrderMs,n),v=function(n){var t=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsize",fullSizePlaintextHash:n.fullSizePlaintextHash}),c=l.getFullsize(n);if(t.DEV(e||(e=babelHelpers.taggedTemplateLiteralLoose(["",""])),c.type),c.type==="cache-hit")return c.cache;var d=new AbortController,m=i.task({fn:function(){return o("WADownloadFullSizeOnlyTask").startDownloadFullSizeTask({abortSignal:d.signal,dbCallbacks:a,fullSizePlaintextHash:n.fullSizePlaintextHash,logger:t,mediaDownloadFlow:n.mediaDownloadFlow})},name:"media-manager-download-fullsize-only",priority:E(n.priority)}),p=m.run();return c.setDownloadCache({abortController:d,fullSizePlaintextHash:n.fullSizePlaintextHash,mediaDownloadFlow:n.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.fullsizePromise})}),p.then(function(e){return e.fullsizePromise}).then(function(e){return x(n.fullSizePlaintextHash,e,c.setDownloadedAttachmentToUploadCache)}).catch(function(e){return r("vulture")("-KcmncnlVk3bH08uyEFarVxmbUY="),t.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){t.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},S=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"preview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getPreview(t);if(e.DEV(c||(c=babelHelpers.taggedTemplateLiteralLoose(["",""])),n.type),n.type==="cache-hit")return n.cache;var r=new AbortController,s=i.task({fn:function(){return o("WADownloadPreviewOnlyTask").startDownloadPreviewTask({abortSignal:r.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-preview-only",priority:E(t.priority)});n.setDownloadCache({abortController:r,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(s,function(e){return e.previewPromise})});var u=s.run();return u.then(function(e){return e.previewPromise}).then(function(e){return $(e,n.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["end"])))})},R=function(t){var e=o("WAMediaManagerLogger").createDownloadLogger({downloadKind:"fullsizeAndPreview",fullSizePlaintextHash:t.fullSizePlaintextHash}),n=l.getFullsizeAndPreview(t),r=n.fullsizeCacheResult,s=n.previewCacheResult;if(e.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["fullsize: ",", preview: ",""])),r.type,s.type),r.type==="cache-hit"&&s.type==="cache-hit")return{fullsizePromise:r.cache,previewPromise:s.cache};if(s.type==="cache-hit"){var u=v(t);return{fullsizePromise:u,previewPromise:s.cache}}if(r.type==="cache-hit"){var c=S(t);return{fullsizePromise:r.cache,previewPromise:c}}r.type,s.type;var d=new AbortController,m=i.task({fn:function(){return o("WADownloadFullSizeAndPreviewTask").startDownloadFullSizeAndPreviewTask({abortSignal:d.signal,dbCallbacks:a,fullSizePlaintextHash:t.fullSizePlaintextHash,logger:e,mediaDownloadFlow:t.mediaDownloadFlow})},name:"media-manager-download-fullsize-and-preview",priority:E(t.priority)});r.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.fullsizePromise})}),s.setDownloadCache({abortController:d,fullSizePlaintextHash:t.fullSizePlaintextHash,mediaDownloadFlow:t.mediaDownloadFlow,scheduledTask:o("mapWorkerSchedulerTask").mapWorkerSchedulerTask(m,function(e){return e.previewPromise})});var y=m.run();return{fullsizePromise:y.then(function(e){return e.fullsizePromise}).then(function(e){return x(t.fullSizePlaintextHash,e,r.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["fullsizePromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(f||(f=babelHelpers.taggedTemplateLiteralLoose(["fullsize end"])))}),previewPromise:y.then(function(e){return e.previewPromise}).then(function(e){return $(e,s.setDownloadedAttachmentToUploadCache)}).catch(function(t){return e.ERROR(g||(g=babelHelpers.taggedTemplateLiteralLoose(["previewPromise runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["preview end"])))})}},L=function(t){var e=o("WAMediaManagerLogger").createUploadLogger({plaintextHash:t.plaintextHash,uploadKind:"fullsize"}),n;if(r("gkx")("19103")&&(n=l.getUploadedAttachment(t),e.DEV(y||(y=babelHelpers.taggedTemplateLiteralLoose(["cache result: ",""])),n.type),t.mediaUploadFlow.addAnnotations({string:{dedupe_result:n.type}}),n.type==="in-thread-cache-hit"))return n.cache;var a=o("WAUploadMediaQuick").uploadMediaQuick({logger:e,mediaUploadFlow:t.mediaUploadFlow,plaintext:t.plaintext,plaintextHash:t.plaintextHash,serverMediaType:t.serverMediaType}).catch(function(t){return e.ERROR(C||(C=babelHelpers.taggedTemplateLiteralLoose(["runtime-error: ",""])),o("WAErrorMessage").maybeGetMessageFromError(t)),o("WAResultOrError").makeError("runtime-error")}).finally(function(){e.DEV(b||(b=babelHelpers.taggedTemplateLiteralLoose(["upload end"])))});return n!=null&&r("gkx")("19103")&&n.setUploadCache({chatJid:t.chatJid,plaintextHash:t.plaintextHash,scheduledTask:a}),a};return{clearCache:l.clearCache,dequeueDownload:l.cancelTask,enqueueDownloadFullSize:T("fullsize",v),enqueueDownloadFullSizeAndPreview:T("fullsizeAndPreview",R),enqueueDownloadPreview:T("preview",S),enqueueUploadFullSize:D(L)}}function E(e){return e===S.HIGH?o("WorkerScheduler").BLOCKING_PRIORITY:e===S.MEDIUM?o("WorkerScheduler").REGULAR_PRIORITY:e===S.LOW?o("WorkerScheduler").BACKGROUND_PRIORITY:(function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+e)})()}var k=typeof((v=navigator.storage)==null?void 0:v.getDirectory)=="function",I=typeof self.caches=="object";function T(e,t){return function(n){var r=n.fullSizePlaintextHash,a=n.mediaDownloadFlow;try{a.addPoint("enqueue_start",{bool:{isOPFSSupported:k,isWebCacheSupported:I},string:{downloadKind:e,sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var i=t(n);return a.addPoint("enqueue_end"),i}catch(e){throw a.addPoint("enqueue_fail"),e}}}function D(e){return function(t){var n=t.mediaUploadFlow,r=t.plaintextHash;try{n.addPoint("enqueue_start",{string:{sanitisedMediaHash:o("WAHashUtils").sanitisePlaintextHash(r)}});var a=e(t);return n.addPoint("enqueue_end"),a}catch(e){throw n.addPoint("enqueue_fail"),e}}}function x(e,t,n){if(!t.success)return t;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t);var a=t.value.msgIdAndMediaEntry,i=a[0],l=a[1];return n({mediaEntry:l,msgId:i,plaintextHash:e}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(t)}function $(e,t){if(!e.success)return e;if(r("gkx")("19103")===!1)return o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e);var n=e.value.msgIdAndMediaEntry,a=n[0],i=n[1],l=i.downloadableThumbnail;return l==null||l.directPath==null||l.fileEncSha256==null||l.fileSha256==null||l.mediaKey==null||l.mediaKeyTimestamp==null||l.objectId==null||t({mediaEntry:babelHelpers.extends({},i,{directPath:l.directPath,downloadableThumbnail:null,fileSha256:l.fileSha256,mediaKey:l.mediaKey,mediaKeyTimestamp:l.mediaKeyTimestamp,objectId:l.objectId,serverMediaType:"preview",size:e.value.validatedResult.validatedPlaintext.byteLength}),msgId:a,plaintextHash:o("WAHashUtils").toPlaintextHash(l.fileSha256)}),o("WAMediaManagerTypes").transformInternalMediaDownloadResult(e)}l.MediaTaskPriority=S,l.createCacheState=R,l.createMediaManager=L,l.toWorkerSchedulerPriority=E}),98);
__d("WAMediaManagerCache",["Promise","WAErrorMessage","WAHashUtils","WAMediaManager","WAMediaManagerLogger","WAMediaManagerTypes","WAPromiseDelays","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e=["mediaKeyTimestamp","objectId","size"],s,u,c,d,m,p,_,f=3e4,g=1e3*60*60*24*2;function h(e,t){t===void 0&&(t=o("WAMediaManager").createCacheState);var r=t(),a=r.fullsizeCache,i=r.previewCache,l=r.uploadCache,h=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,i=t.scheduledTask;a.set(n,{abortController:e,mediaDownloadFlow:r,task:i}),i.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){a.delete(n)})},b=function(t){var e=t.abortController,n=t.fullSizePlaintextHash,r=t.mediaDownloadFlow,a=t.scheduledTask;i.set(n,{abortController:e,mediaDownloadFlow:r,task:a}),a.promise.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(f):void 0}).finally(function(){i.delete(n)})},v=function(t){var e=t.chatJid,n=t.plaintextHash,r=t.scheduledTask,a=t.cacheTtlMs,i=a===void 0?g:a,s=l.get(n)||new Map;s.set(e,r),l.set(n,s),r.then(function(e){var t=e.success;return t?o("WAPromiseDelays").delayMs(i):void 0}).finally(function(){l.delete(n)})},S=function(r){var t=r.mediaEntry,a=r.msgId,i=r.plaintextHash;e(a).then(function(e){if(e==null){o("WAMediaManagerLogger").baseLogger.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["missing chatJid, skip setDownloadedAttachmentToUploadCache"])));return}var r=e.protocolMsgId.chat,a=C(t);if(a==null){o("WAMediaManagerLogger").baseLogger.ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["can not covert mediaEntry from download to upload for cache"])));return}var l=o("WATimeUtils").timeoutFor(a.mediaKeyTimestamp,g/1e3);if(l!==0){var c=o("WATimeUtils").pastUnixTime(o("WATimeUtils").DAY_SECONDS,a.mediaKeyTimestamp);o("WATimeUtils").isInFuture(c)||v({cacheTtlMs:l,chatJid:r,plaintextHash:i,scheduledTask:(_||(_=n("Promise"))).resolve(o("WAResultOrError").makeResult(a))})}}).catch(function(e){o("WAMediaManagerLogger").baseLogger.WARN(c||(c=babelHelpers.taggedTemplateLiteralLoose(["setDownloadedAttachmentToUploadCache getProtocolMsgIdAndSortOrderMs: ",""])),o("WAErrorMessage").maybeGetMessageFromError(e))})};return{cancelTask:function(t){var e=o("WAMediaManagerLogger").baseLogger.TAGS(["hash:"+o("WAHashUtils").sanitisePlaintextHash(t),"cancelTask"]);e.LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["start"])));var n=[a,i];for(var r of n){var l=r.get(t);if(l!=null){var s=l.task.cancel();l.mediaDownloadFlow.addPoint("cancel_download_triggered"),s===!1?(l.abortController.abort(),l.mediaDownloadFlow.addPoint("http_abort_cancel"),e.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["http abort cancel"])))):(l.mediaDownloadFlow.addPoint("worker_task_cancel_cancel"),e.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["worker task cancel"])))),r.delete(t)}}},clearCache:function(){i.clear(),a.clear(),l.clear()},getFullsize:function(t){var e=a.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","fullsize"),{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getFullsizeAndPreview:function(t){var e=o("WAMediaManager").toWorkerSchedulerPriority(t.priority),n=a.get(t.fullSizePlaintextHash),r=i.get(t.fullSizePlaintextHash);return n!=null&&r!=null?(y(t.mediaDownloadFlow,"hit","fullsize-and-preview"),n.task.promote(e),r.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):n!=null?(y(t.mediaDownloadFlow,"hit","fullsize"),n.task.promote(e),{fullsizeCacheResult:{cache:n.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}}):r!=null?(y(t.mediaDownloadFlow,"hit","preview"),r.task.promote(e),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{cache:r.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}}):(y(t.mediaDownloadFlow,"miss","fullsize-and-preview"),{fullsizeCacheResult:{setDownloadCache:h,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"},previewCacheResult:{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"}})},getPreview:function(t){var e=i.get(t.fullSizePlaintextHash);return e!=null?(y(t.mediaDownloadFlow,"hit","preview"),e.task.promote(o("WAMediaManager").toWorkerSchedulerPriority(t.priority)),{cache:e.task.promise.then(o("WAMediaManagerTypes").transformInternalMediaDownloadResult),type:"cache-hit"}):(y(t.mediaDownloadFlow,"miss","preview"),{setDownloadCache:b,setDownloadedAttachmentToUploadCache:S,type:"cache-miss"})},getUploadedAttachment:function(t){var e=l.get(t.plaintextHash);if(e==null)return{setUploadCache:v,type:"cache-miss-no-plaintext-hash"};var n=e.get(t.chatJid);return n==null?{setUploadCache:v,type:"cache-miss-no-thread"}:{cache:n,type:"in-thread-cache-hit"}}}}function y(e,t,n){e.addAnnotations({string:{media_manager_cache_result:t,media_manager_cache_type:n}})}function C(t){var n=t.mediaKeyTimestamp,r=t.objectId,o=t.size,a=babelHelpers.objectWithoutPropertiesLoose(t,e);return n==null||r==null||o==null?null:babelHelpers.extends({},a,{mediaKeyTimestamp:n,objectId:r,size:o})}l.DOWNLOAD_TASK_CACHE_TTL_MS=f,l.UPLOAD_TASK_CACHE_TTL_MS=g,l.createAttachmentCache=h}),98);
__d("blobToDataUri",["err"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=new FileReader,n=new Promise(function(e,n){t.onloadend=e,t.onerror=n});t.readAsDataURL(e),await n;var o=t.result;if(typeof o!="string")throw r("err")('Unexpected result type "%s" when reading Blob as DataURL.',o instanceof ArrayBuffer?"ArrayBuffer":typeof o);return o}l.default=e}),98);
__d("MAWGetThumbnailBlobDataUrlByMediaIdApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaManager","MAWMediaPreviewDownloadManager","MAWMpsGating","MAWTransactionMode","MWFBLogger","MpsMediaEntryCache","WAErrorMessage","WAHashUtils","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow","blobToDataUri"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k,I,T,D=o("MWFBLogger").MWMediaLogger().tags(["getThumbnailBlobDataUrlByMediaId"]),x=async function(n,a,i){D.DEBUG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from , from ",""])),n,a);var t=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(i),l={string:{description:a,fetch_by:"mediaId"}};t("fetch_thumbnail_blob_api_start",l),t("get_media_from_db_start",l);var g=await M(n);if(t("get_media_from_db_finish",{bool:{db_media_found:g!=null}}),g==null)throw D.WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_media_found_in_db",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",n,a);var h=A(g);if(h.success===!0){D.DEBUG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),n),t("fetch_thumbnail_blob_api_success",l);var y=await r("blobToDataUri")(h.value);if(!y)throw D.MUSTFIX(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),y}var C=h.error;switch(C){case"missing_jpeg_thumbnail":if(g.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||g.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var b=await P(g,i);if(b!=null){t("fetch_thumbnail_blob_api_success",l);var v=await r("blobToDataUri")(b);if(!v)throw D.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),v}if((g==null?void 0:g.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw t("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time (for video). mediaId is %s, from %s",n,a);var S=await N(g,i);if(S==null)throw t("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time or to generate thumnbail on the fly. mediaId is %s, from %s",n,a);t("fetch_thumbnail_blob_api_success",l);var R=await r("blobToDataUri")(S);if(!R)throw D.MUSTFIX(_||(_=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),n),t("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",n,a);return D.DEBUG(f||(f=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),n),R}throw t("fetch_thumbnail_blob_api_fail_missing_thumbnail",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). mediaId is %s, from %s",n,a);case"invalid_media":throw t("fetch_thumbnail_blob_api_fail_invalid_media",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. mediaId is %s, from %s",n,a)}},$=async function(t,n,a){var e=o("MpsMediaEntryCache").getEntry(t)!=null&&o("MAWMpsGating").isMpsMediaGalleryEnabled(),i=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(a),l={bool:{shouldUseMpsGalleryAndMpsMediaManager:e},string:{description:n,fetch_by:"hashedPlaintextHash"}};if(i("fetch_thumbnail_blob_api_start",l),D.DEBUG(g||(g=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from ",""])),o("WAHashUtils").sanitisePlaintextHash(t),n),o("MAWMpsGating").isMpsMessageRendering()||e){var s=o("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null}),u=e?o("MAWMediaManager").getMpsMediaManager():o("MAWMediaManager").getMawMediaManager(),c=u.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:t,mediaDownloadFlow:s,priority:o("WAMediaManager").MediaTaskPriority.HIGH}),d=await c.previewPromise;if(d.success){var m;s.endSuccess();var p=d.value.validatedResult.validatedPlaintext,_=new Blob([p],{type:(m=d.value.validatedResult.mimeType)!=null?m:void 0}),f=await r("blobToDataUri")(_);return f}if(d.error!=="preview-not-supported")throw s.endFail(d.error,{string:{failReason:d.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(t),n,d.error);var E=await c.fullsizePromise;if(E.success){var k;s.endSuccess();var I=E.value.validatedResult.validatedPlaintext,T=new Blob([I],{type:(k=E.value.validatedResult.mimeType)!=null?k:void 0}),x=await r("blobToDataUri")(T);return x}throw s.endFail(E.error,{string:{failReason:E.error}}),o("MWFBLogger").MPSLogger().mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",o("WAHashUtils").sanitisePlaintextHash(t),n,E.error)}var $=await w(t);if($==null)throw D.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),i("fetch_thumbnail_blob_api_fail_no_media_found_in_db",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash because media is not in the media db. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var M=A($);if(M.success===!0){D.DEBUG(y||(y=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),i("fetch_thumbnail_blob_api_success",l);var F=await r("blobToDataUri")(M.value);if(!F)throw D.MUSTFIX(C||(C=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(b||(b=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),F}var O=M.error;switch(O){case"missing_jpeg_thumbnail":if($.mediaType===o("MAWDbMedia").MEDIA_TYPE.IMAGE||$.mediaType===o("MAWDbMedia").MEDIA_TYPE.VIDEO){var B=await P($,a);if(B!=null){i("fetch_thumbnail_blob_api_success",l);var W=await r("blobToDataUri")(B);if(!W)throw D.MUSTFIX(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(S||(S=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),W}if(($==null?void 0:$.mediaType)===o("MAWDbMedia").MEDIA_TYPE.VIDEO)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time (for video). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var q=await N($,a);if(q==null)throw i("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time or to generate thumnbail on the fly. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);var U=await r("blobToDataUri")(q);if(!U)throw D.MUSTFIX(R||(R=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),i("fetch_thumbnail_blob_api_fail_no_data_uri",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);return D.DEBUG(L||(L=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""])),o("WAHashUtils").sanitisePlaintextHash(t)),U}throw i("fetch_thumbnail_blob_api_fail_missing_thumbnail",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n);case"invalid_media":throw i("fetch_thumbnail_blob_api_fail_invalid_media",l),D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. plaintextHash is %s, from %s",o("WAHashUtils").sanitisePlaintextHash(t),n)}},P=function(t,n){var e=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);e("fetch_thumbnail_blob_api_thumbnail_download_start");var r=o("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(t.plaintextHash);return r==null?(e("fetch_thumbnail_blob_api_thumbnail_download_fail_no_resolvable"),Promise.resolve(null)):o("MAWMaybeWithTimeout").maybeWithTimeout(r.promise,1e4,function(){throw D.mustfixThrow("timeout waiting for thumbnail to download")}).then(function(t){return e("fetch_thumbnail_blob_api_thumbnail_download_success"),t}).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return D.MUSTFIX(E||(E=babelHelpers.taggedTemplateLiteralLoose(["Exception when waiting for thumbnail to download: ",""])),n),e("fetch_thumbnail_blob_api_thumbnail_download_fail_exception",{string:{wait_for_thumbnail_download_exception:n}}),null})},N=o("MAWIndexedDb").makeMsgrTransactor({chunk:(T=o("MAWTransactionMode")).READONLY,media:T.READONLY},"generateThumbnailFromMediaChunk",function(e){return function(t,n){var r=o("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(n);return r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_start"),o("MAWDbChunkTxns").maybeGetChunkFromHash(e,t.hashedPlaintextHash).then(function(e){if(e==null){D.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: unable to get a thumbnail as the media chunk is missing"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_fail_chunk_missing");return}return D.WARN(I||(I=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: using media chunk as the thumbnail"]))),r("fetch_thumbnail_blob_api_thumbnail_generate_from_media_success"),new Blob([e.blobData],{type:e.mimetype})})}}),M=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromMediaId(e,t)}}),w=o("MAWIndexedDb").makeMsgrTransactor({media:T.READONLY},"getFullMedia",function(e){return function(t){return o("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,t)}}),A=function(t){var e=F(t);if(e.success===!1)return e;var n=e.value.jpegThumbnail;return n!=null?o("WAResultOrError").makeResult(new Blob([n],{type:"image/jpeg"})):o("WAResultOrError").makeError("missing_jpeg_thumbnail")},F=function(t){var e,n;switch(t.mediaType){case o("MAWDbMedia").MEDIA_TYPE.IMAGE:return o("WAResultOrError").makeResult({jpegThumbnail:(e=t.validatedImageInfo)==null?void 0:e.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.VIDEO:return o("WAResultOrError").makeResult({jpegThumbnail:(n=t.validatedVideoInfo)==null?void 0:n.jpegThumbnail});case o("MAWDbMedia").MEDIA_TYPE.PTT:case o("MAWDbMedia").MEDIA_TYPE.STICKER:case o("MAWDbMedia").MEDIA_TYPE.GIF:case o("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return o("WAResultOrError").makeError("invalid_media");default:return t.mediaType,o("WAResultOrError").makeError("invalid_media")}};l.getThumbnailBlobDataUrlByMediaId=x,l.getThumbnailBlobDataUrlByHashedPlaintextHash=$,l.getFullMediaWithPlaintextHash=w}),98);
__d("MAWMediaManager",["MAWGetMostRescentDecodedMediaEntry","MAWGetProtocolMsgIdAndSortOrderMsApi","MAWMpsGating","MpsMediaManager","WAMediaManager","memoize"],(function(t,n,r,o,a,i,l){"use strict";var e=r("memoize")(function(){return o("WAMediaManager").createCacheState()}),s=r("memoize")(function(){return o("MpsMediaManager").getMpsMediaManager(e)}),u=r("memoize")(function(){return o("WAMediaManager").createMediaManager({createCacheState:e,dbCallbacks:{getMediaEntries:o("MAWGetMostRescentDecodedMediaEntry").getMediaEntries,getProtocolMsgIdAndSortOrderMs:o("MAWGetProtocolMsgIdAndSortOrderMsApi").getProtocolMsgIdAndSortOrderMs}})}),c=function(){return o("MAWMpsGating").isMpsMessageRendering()?s():u()};l.getMpsMediaManager=s,l.getMawMediaManager=c}),98);
__d("WmiChunkApi",["CoalescingLoader","MAWDbChunkTxns","MAWDexieTable","MAWIndexedDb","MAWMediaUtils","MAWTransactionMode","emptyFunction","memoizeWithArgsLFUCache"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READONLY},"wms_getCachedChunkResult",function(e){return function(t){return o("MAWDbChunkTxns").maybeBulkGetChunksFromPlaintextHash(e,t)}}),n=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_storeChunk",function(t){return function(n){return n.map(function(t){return e(t[0])}),o("MAWDexieTable").dexieAll(n.map(function(e){return o("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(t,e[0],e[1],e[2],e[3])})).then(r("emptyFunction"))}}),a=new(o("CoalescingLoader")).CoalescingLoader(async function(n){var r=await t(n);return n.map(function(t){var n=r.get(t);return n==null&&e(t),n})}),i=new(o("CoalescingLoader")).CoalescingLoader(async function(e){return await n(e),[]}),l=r("memoizeWithArgsLFUCache")(function(e){return a.gen(e)},function(e){return e},1,function(t){e=t}),s=o("MAWIndexedDb").makeMsgrTransactor({chunk:o("MAWTransactionMode").READWRITE},"wms_deleteChunk",function(t){return function(n){n.map(e);var r=n.map(o("MAWMediaUtils").genHMACPlaintextHash);return t.chunk.where("hashedPlaintextHash").anyOf(r).delete()}});return{delete:s,get:l,store:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.gen(t)}}}l.getChunkApi=e}),98);
__d("MediaServiceLogger",["FBLogger"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){return r("FBLogger")("wmi_media_service",t)};l.MediaServiceLogger=e}),98);
__d("WmiMediaServiceSchema",["MAWWormOdsLogger","MediaServiceLogger","WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(t,n,r,o,a,i,l){"use strict";var e={autoIncrement:!0,indexes:{"[plaintextHash+updatedAtMs]":{fields:["plaintextHash","updatedAtMs"],unique:!1},"[threadId+messageId+plaintextHash]":{fields:["threadId","messageId","plaintextHash"],unique:!0}},nonEncryptedFields:["updatedAtMs","messageId"],primaryKey:"pk",secure:!0},s={messageChunk:e};function u(e){var t=e.blockingErrorThreshold,n=e.dbName,r=e.onBlockingError,a=e.qplEvent,i=e.strEncKey,l=o("WAHex").parseHex(i),u="wmi_media_service",c=new(o("WormEAR")).WormEAR(s,u,l),d=new(o("Worm")).WormDatabase(new(o("WormIDbDriver")).WormIDbDriver(n,u,s,c,o("MAWWormOdsLogger").wormOdsWorkerLogger,{blockingErrorThreshold:t,onBlockingError:r,onTransactionError:function(t){if(t instanceof o("WormEAR").DecryptionError){var e=t;o("MediaServiceLogger").MediaServiceLogger().mustfix("EAR decryption error in store: %s. Dropping corrupted entity %s",e.store,e.maybeHashedPk),d.runInTransaction([e.store],"readwrite",function(t){var n=t.stores[e.store];return e.maybeHashedPk!=null?n.delete(e.maybeHashedPk):n.clear()},"delete-corrupted-entity")}}}),a);return d}function c(e){return new(o("Worm")).WormDatabase(new(o("WormMemoryDriver")).WormMemoryDriver("wmi_media_service_test",s,o("MAWWormOdsLogger").wormOdsWorkerLogger),e)}l.SCHEMA=s,l.makeSchema=u,l.makeInMemorySchema_TEST_ONLY=c}),98);
__d("WmiMediaServiceDb",["MediaServiceLogger","WAResolvable","WmiMediaServiceSchema","err","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new(o("WAResolvable")).Resolvable;async function u(t){try{var n=o("WmiMediaServiceSchema").makeSchema(t);return e=n,await n.init(),s.resolve(n),n}catch(e){throw o("MediaServiceLogger").MediaServiceLogger().catching(r("getErrorSafe")(e)).mustfix("Error performing Media Service init"),e}}function c(){if(e==null)throw r("err")("DB is not initialized");return e}l.makeMediaServiceDb=u,l.getDb=c}),98);
__d("WmiMediaService",["MpsTypes","WmiChunkApi","WmiMediaServiceDb","err","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e,this.$2=o("WmiChunkApi").getChunkApi()}var t=e.prototype;return t.getChunk=async function(t){var e,n=await this.$2.get(t);return n==null?null:{blobData:n.blobData,isProgressivePreview:(e=n.isProgressivePreview)!=null?e:!1,mimetype:n.mimetype,plaintextHash:n.plaintextHash}},t.getMessageChunkForHash=function(t){return this.$1.runInTransaction(["messageChunk"],"readonly",async function(e){var n=await e.stores.messageChunk.readIndexRange("[plaintextHash+updatedAtMs]",{only:[t]},{limit:1,order:"desc"});return n.at(0)},"WmiGetMessagesForHash")},t.handleMessageDeletion=function(t,n){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t,n]})})},t.handleThreadDeletion=function(t){return this.$3(function(e){return e.stores.messageChunk.readIndexRange("[threadId+messageId+plaintextHash]",{only:[t]})})},t.storeChunk=function(t){var e=t.blobData,n=t.isProgressivePreview,r=t.mimetype,o=t.plaintextHash;return this.$2.store(o,e,r,n)},t.storeMessageChunks=function(t){return this.$1.runInTransaction(["messageChunk"],"readwrite",async function(e){await e.stores.messageChunk.bulkUpsert("[threadId+messageId+plaintextHash]",t.map(function(e){return{item:{messageId:e.messageId,plaintextHash:e.plaintextHash,threadId:e.threadId,updatedAtMs:o("MpsTypes").toTimestamp(Date.now())},selector:[e.threadId,e.messageId,e.plaintextHash]}}))},"WmiMediaServiceStoreChunkMessage")},t.$3=async function(t){var e=await this.$1.runInTransaction(["messageChunk"],"readwrite",async function(e){var n=await t(e);await e.stores.messageChunk.bulkDelete(n.map(function(e){return e.pk}));var r=new Set(n.map(function(e){return e.plaintextHash})),o=await e.stores.messageChunk.readIndexAnyOf("[plaintextHash+updatedAtMs]",Array.from(r).map(function(e){return[e]}));return o.forEach(function(e){return r.delete(e.plaintextHash)}),Array.from(r)},"WmiMediaServiceDeleteMessageChunkEntries");e.length>0&&await this.$2.delete(Array.from(e))},e})(),s=null;async function u(t){if(s!=null)throw r("err")("Media Service already initialised");var n=await o("WmiMediaServiceDb").makeMediaServiceDb(t);s=new e(n)}function c(){return r("nullthrows")(s,"Media Service not initialised")}function d(){s=null}l.MediaService=e,l.wmiMediaServiceSetup=u,l.mediaService=c,l.wmiMediaServiceClear__TESTONLY=d}),98);
__d("MpsMediaManager",["MAWGetThumbnailBlobDataUrlByMediaIdApi","MpsMediaEntryCache","MpsMessageToBridgeWrapper","MpsToBridgeMessageId","WAIsPreviewSupported","WAJids","WAMediaManager","WAMediaManagerCache","WAMediaUtils","WAResultOrError","WAStanzaUtils","WAValidateMedia","WebMps","WmiMediaService","getErrorSafe","memoize","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e=["kind"];function s(e){throw new TypeError('"'+e+'" is read-only')}async function u(e){var t=e.fullSizePlaintextHash,n=e.mediaDownloadFlow,r=o("MpsMediaEntryCache").getEntry(t);if(r!=null)return n.addPoint("media_entry_cache_hit"),r;var a=await o("WmiMediaService").mediaService().getMessageChunkForHash(t);if(a==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_message_chunk"}});return}var i=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-only"},debug:{purpose:"MpsMediaManager-getEntryWithFallback"},messageId:a.messageId,threadId:a.threadId}),l=i.value;if(l==null){n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"missing_reverb_message"}});return}o("MpsMediaEntryCache").hydrateCache(l.toplevelProtobuf);var s=o("MpsMediaEntryCache").getEntry(t);return s==null?(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"unable_to_cache"}}),null):(n.addPoint("media_entry_cache_miss",{string:{media_entry_recache_result:"success"}}),s)}async function c(e){var t=o("MpsToBridgeMessageId").bridgeMsgIdToMps(e),n=t.messageId,r=t.threadId,a=await o("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-first"},debug:{purpose:"mps_media_manager"},messageId:n,threadId:r});if(a.value){var i=o("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.value.toplevelProtobuf),l=i.getAuthor();if(!o("WAJids").isAuthorSystem(l))return{protocolMsgId:{author:l,chat:i.getChatJid(),externalId:o("WAStanzaUtils").toStanzaId(i.getExternalId())},sortOrderMs:i.message.timestampMs}}}var d=function(t){return o("WAMediaManager").createMediaManager({createCacheState:t,dbCallbacks:{getMediaEntries:function(t){var e=o("MpsMediaEntryCache").getEntry(t);if(e==null)return Promise.resolve(o("WAResultOrError").makeError("no-media-by-plaintext-hash"));var n=e.mediaEntry,r=e.message,a=o("MpsToBridgeMessageId").mpsToBridgeMsgId(r.threadId,r.messageId);return Promise.resolve(o("WAResultOrError").makeResult(new Map([[a,n]])))},getProtocolMsgIdAndSortOrderMs:c}})};function m(e){var t=o("WAIsPreviewSupported").checkPreviewSupport(e.decodedMediaEntry),n=t[0],r=t[1];return(function(t){if(Array.isArray(t)&&t.length===2&&t[0]===o("WAIsPreviewSupported").PjpegPreviewSupport.YES)return{kind:"progressive",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.YES)return e.thumbnailHash!=null?{kind:"withThumbnail",thumbnailHash:e.thumbnailHash}:{kind:"noPreview"};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.DuplicatedWithFullSize)return{kind:"duplicatedWithFullSize",thumbnailHash:e.plaintextHash};if(Array.isArray(t)&&t.length===2&&t[1]===o("WAIsPreviewSupported").DownloadablePreviewSupport.NO)return{kind:"noPreview"};throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+t)})([n,r])}async function p(e,t,n){if(e!=null){var r=await o("WAValidateMedia").validateMedia(e,t);if(r.value!=null)return o("WAResultOrError").makeResult({serverMediaType:n,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType(n),validatedResult:r.value})}}async function _(e,t,n){var r=await o("WmiMediaService").mediaService().getChunk(e),a=await p(r==null?void 0:r.blobData,t,n);if(!(r==null||a==null))return t.addAnnotations({bool:{from_chunk:!0}}),{chunk:r,result:a}}function f(e,t,n,a){if(n.success===!0){var i;o("WmiMediaService").mediaService().storeChunk({blobData:n.value.validatedResult.validatedPlaintext,isProgressivePreview:a,mimetype:(i=n.value.validatedResult.mimeType)!=null?i:n.value.unvalidatedMimeType,plaintextHash:e}).then(function(){return t.addAnnotations({string:{chunk_store_result:"success"}})}).catch(function(e){var n=r("getErrorSafe")(e).message;t.addAnnotations({string:{chunk_store_result:n}})})}}async function g(e,t,n){var r,a=n.fullSizePlaintextHash,i=n.mediaDownloadFlow;if(e.success||e.error!=="signature-expired")return e;var l=await o("MAWGetThumbnailBlobDataUrlByMediaIdApi").getFullMediaWithPlaintextHash(a);if(l==null)return i.addAnnotations({string:{signature_expired_fallback:"media not found"}}),e;var s=(r=l.validatedAudioInfo)!=null?r:l.validatedVideoInfo,u=s==null?void 0:s.jpegThumbnail;if(u==null)return i.addAnnotations({string:{signature_expired_fallback:"thumbnail not found"}}),e;var c=await o("WAValidateMedia").validateMedia(u,i);return c.value==null?(i.addAnnotations({string:{signature_expired_fallback:"validation failed"}}),e):(i.addAnnotations({string:{signature_expired_fallback:"success"}}),o("WAResultOrError").makeResult({serverMediaType:t.serverMediaType,unvalidatedMimeType:o("WAMediaUtils").getMimeTypeFromServerMediaType("image"),validatedResult:c.value}))}var h=function(n){var t=d(n),a=o("WAMediaManagerCache").createAttachmentCache(c,n),i={clearCache:t.clearCache,dequeueDownload:t.dequeueDownload,enqueueDownloadFullSize:async function(n){n.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsize"}});var e=a.getFullsize(n);if(e.type==="cache-hit")return e.cache;var r=await u(n);if(!r)return o("WAResultOrError").makeError("missing-media-entry");var i=await _(n.fullSizePlaintextHash,n.mediaDownloadFlow,r.serverMediaType);if(i!=null&&!i.chunk.isProgressivePreview)return i.result;n.mediaDownloadFlow.addPoint("mps_actual_download");var l=await t.enqueueDownloadFullSize(n);return f(n.fullSizePlaintextHash,n.mediaDownloadFlow,l,!1),l},enqueueDownloadFullSizeAndPreview:function(i){i.mediaDownloadFlow.addAnnotations({string:{downloadKind:"fullsizeAndPreview"}});var n=a.getFullsizeAndPreview(i),l=n.fullsizeCacheResult,s=n.previewCacheResult;if(l.type==="cache-hit"&&s.type==="cache-hit")return{fullsizePromise:l.cache,previewPromise:s.cache};var c=r("memoize")(function(){return u(i)}),d=r("memoize")(async function(){var e=r("nullthrows")(await c()),t=_(i.fullSizePlaintextHash,i.mediaDownloadFlow,e.serverMediaType);return t});i.mediaDownloadFlow.addPoint("mps_actual_download");var p=r("memoize")(function(){return t.enqueueDownloadFullSizeAndPreview(i)});return{fullsizePromise:(async function(){var e=await c();if(e==null)return o("WAResultOrError").makeError("missing-media-entry");var t=await d();if(t!=null&&!t.chunk.isProgressivePreview)return t.result;var n=await p().fullsizePromise;return f(i.fullSizePlaintextHash,i.mediaDownloadFlow,n,!1),n})(),previewPromise:(async function(){var t=await c();if(t==null)return o("WAResultOrError").makeError("missing-media-entry");var n=m(t);if(n.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var r=await(function(n){if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="duplicatedWithFullSize"||(typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="progressive")return d();if((typeof n=="object"&&n!==null||typeof n=="function")&&n.kind==="withThumbnail"){var r=n.kind,o=babelHelpers.objectWithoutPropertiesLoose(n,e);return _(o.thumbnailHash,i.mediaDownloadFlow,t.serverMediaType)}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+n)})(n);if(r!=null)return r.result;var a=await p().previewPromise,l=await g(a,t,i);return n.kind==="withThumbnail"&&f(n.thumbnailHash,i.mediaDownloadFlow,l,!1),l})()}},enqueueDownloadPreview:async function(n){n.mediaDownloadFlow.addAnnotations({string:{downloadKind:"preview"}});var e=a.getPreview(n);if(e.type==="cache-hit")return e.cache;var r=await u(n);if(r==null)return o("WAResultOrError").makeError("missing-media-entry");var i=m(r),l=i.kind==="progressive";if(i.kind==="noPreview")return o("WAResultOrError").makeError("preview-not-supported");var s=i.thumbnailHash,c=await _(s,n.mediaDownloadFlow,r.serverMediaType);if(c!=null)return c.result;n.mediaDownloadFlow.addPoint("mps_actual_download");var d=await t.enqueueDownloadPreview(n),p=await g(d,r,n);return f(s,n.mediaDownloadFlow,p,l),p},enqueueUploadFullSize:function(){return t.enqueueUploadFullSize.apply(t,arguments)}};return i};l.getMpsMediaManager=h}),98);/*FB_PKG_DELIM*/
__d("TCompactProtocol",["StringToUtf8","ThriftTypes","Utf8ToString"],(function(t,n,r,o,a,i,l){var e,s=Object.freeze({CT_STOP:0,CT_BOOLEAN_TRUE:1,CT_BOOLEAN_FALSE:2,CT_BYTE:3,CT_I16:4,CT_I32:5,CT_I64:6,CT_DOUBLE:7,CT_BINARY:8,CT_LIST:9,CT_SET:10,CT_MAP:11,CT_STRUCT:12,CT_FLOAT:13}),u=Object.freeze({NONE:-1,CT_BOOLEAN_TRUE:s.CT_BOOLEAN_TRUE,CT_BOOLEAN_FALSE:s.CT_BOOLEAN_FALSE}),c=[s.CT_STOP,0,s.CT_BOOLEAN_TRUE,s.CT_BYTE,s.CT_DOUBLE,0,s.CT_I16,0,s.CT_I32,0,s.CT_I64,s.CT_BINARY,s.CT_STRUCT,s.CT_MAP,s.CT_SET,s.CT_LIST,0,0,0,s.CT_FLOAT],d=Math.pow(2,7)-1,m=-1*Math.pow(2,7),p=Math.pow(2,15)-1,_=-1*Math.pow(2,15),f=Math.pow(2,31)-1,g=-1*Math.pow(2,31),h=Math.pow(2,32)-1,y=BigInt("9223372036854775807"),C=BigInt("-9223372036854775808"),b=BigInt("18446744073709551615"),v=BigInt(63),S=BigInt(1),R=BigInt(7),L=BigInt("0x7f"),E=BigInt("0x80"),k=Math.pow(2,4),I=(function(){function t(e){this.$4=null,this.$5=null,this.$1=e,this.$2=[],this.$3=0,this.$6=new DataView(new ArrayBuffer(1))}var n=t.prototype;return n.readStructBegin=function(){this.$2.push(this.$3),this.$3=0},n.readStructEnd=function(){return this.$3=this.$2.pop(),0},n.writeStructBegin=function(t){return this.$2.push(this.$3),this.$3=0,0},n.writeStructEnd=function(){return this.$3=this.$2.pop(),0},n.writeFieldBegin=function(n){return n.ftype===(e||(e=r("ThriftTypes"))).BOOL?(this.$4={fid:n.fid,fname:n.fname,ftype:n.ftype},0):this.$7(n,u.NONE)},n.writeListBegin=function(t){return this.$8(t)},n.writeListEnd=function(){return 0},n.writeSetBegin=function(t){return this.$8(t)},n.writeSetEnd=function(){return 0},n.writeMapBegin=function(t){var e=0;if(t.size===0)e+=this.$1.writeByte(0);else if(e+=this.writeVarint32(t.size),t.ktype!=null&&t.vtype!=null)e+=this.$1.writeByte(this.$9(t.ktype)<<4|this.$9(t.vtype));else throw new Error("received invalid map info: "+JSON.stringify(t));return e},n.writeMapEnd=function(){return 0},n.$7=function(t,n){var e=0,r=n===u.NONE?this.$9(t.ftype):n;return t.fid>this.$3&&t.fid-this.$3<=k-1?e+=this.$1.writeByte(t.fid-this.$3<<4|r):(e+=this.$1.writeByte(r),e+=this.writeI16(t.fid)),this.$3=t.fid,e},n.$8=function(t){var e=0,n=this.$9(t.etype);return t.size<=k-2?e+=this.$1.writeByte(t.size<<4|n):(e+=this.$1.writeByte(240|n),e+=this.writeVarint32(t.size)),e},n.readFieldBegin=function(){var t=this.$1.readByte(),n=t&15;if(n===(e||(e=r("ThriftTypes"))).STOP)return{ftype:(e||(e=r("ThriftTypes"))).STOP,fid:0};var o=(t&240)>>>4,a;o===0?a=this.readI16():a=this.$3+o;var i=this.$10(n);return(n===s.CT_BOOLEAN_TRUE||n===s.CT_BOOLEAN_FALSE)&&(this.$5=n===s.CT_BOOLEAN_TRUE),this.$3=a,{ftype:i,fid:a}},n.readListBegin=function(){return this.$11()},n.readListEnd=function(){return 0},n.readSetBegin=function(){return this.$11()},n.readSetEnd=function(){return 0},n.readMapBegin=function(){var e=this.readVarint32();if(e>0){var t=this.$1.readByte(),n=this.$12(t>>4,"readMapBegin:key"),r=this.$12(t&15,"readMapBegin:value");return{ktype:this.$10(n),vtype:this.$10(r),size:e}}return{size:e}},n.readMapEnd=function(){return 0},n.$12=function(t,n){if(t<0||t>13)throw new Error(n+" read invalid compact type: "+t);return t},n.$11=function(){var e=this.$1.readByte(),t=this.$12(e&15,"_readListOrSetBegin"),n=this.$10(t),r=e>>4&15;return r===15&&(r=this.readVarint32()),{etype:n,size:r}},n.readFieldEnd=function(){return 0},n.readByte=function(){return this.$6.setUint8(0,this.$1.readByte()),this.$6.getInt8(0)},n.writeByte=function(t){if(t<m||t>d)throw new Error("byte to write is out of range: "+t);return this.$6.setInt8(0,t),this.$1.writeByte(this.$6.getUint8(0))},n.readFloat=function(){return this.$1.readFloatBE()},n.writeFloat=function(t){return this.$1.writeFloatBE(t)},n.readDouble=function(){return this.$1.readDoubleBE()},n.writeDouble=function(t){return this.$1.writeDoubleBE(t)},n.writeString=function(t){return this.writeBinary(o("StringToUtf8").StringToUtf8(t))},n.skip=function(n){switch(n){case(e||(e=r("ThriftTypes"))).STOP:return;case(e||(e=r("ThriftTypes"))).BOOL:this.readBool();break;case(e||(e=r("ThriftTypes"))).BYTE:this.readByte();break;case(e||(e=r("ThriftTypes"))).DOUBLE:this.readDouble();break;case(e||(e=r("ThriftTypes"))).I16:this.readI16();break;case(e||(e=r("ThriftTypes"))).I32:this.readI32();break;case(e||(e=r("ThriftTypes"))).I64:this.readI64();break;case(e||(e=r("ThriftTypes"))).STRING:this.readString();break;case(e||(e=r("ThriftTypes"))).STRUCT:{this.readStructBegin();for(var t;t=this.readFieldBegin(),t.ftype!==(e||(e=r("ThriftTypes"))).STOP;)this.skip(t.ftype);this.readStructEnd();break}case(e||(e=r("ThriftTypes"))).MAP:{var o=this.readMapBegin();if(o.size>0&&o.ktype!=null&&o.vtype!=null)for(var a=o.ktype,i=o.vtype,l=0;l<o.size;l++)this.skip(a),this.skip(i);break}case(e||(e=r("ThriftTypes"))).SET:case(e||(e=r("ThriftTypes"))).LIST:{for(var s=this.$11(),u=0;u<s.size;u++)this.skip(s.etype);break}case(e||(e=r("ThriftTypes"))).FLOAT:this.readFloat();break;default:throw new Error("encoutered unknow thrift type: "+n+" in skip")}},n.toByteArray=function(){return this.$1.toByteArray()},n.writeFieldEnd=function(){return 0},n.writeFieldStop=function(){return this.$1.writeByte((e||(e=r("ThriftTypes"))).STOP)},n.writeI16=function(t){if(t<_||t>p)throw new Error("trying to write i16 out of range: "+t);return this.writeVarint32(this.i32ToZigzag(t))},n.readI16=function(){var e=this.zigzagToI32(this.readVarint32());if(e<_||e>p)throw new Error("read invalid i16: "+e);return e},n.writeI32=function(t){if(t<g||t>f)throw new Error("i32 out of range: "+t);return this.writeVarint32(this.i32ToZigzag(t))},n.readI32=function(){return this.zigzagToI32(this.readVarint32())},n.writeI64=function(t){return this.writeVarint64(this.i64ToZigzag(t))},n.readI64=function(){return this.zigzagToI64(this.readVarint64())},n.readBool=function(){var e;return this.$5!=null?(e=this.$5,this.$5=null):e=this.$1.readByte()===s.CT_BOOLEAN_TRUE,e},n.writeBool=function(t){var e=0;return this.$4!=null?(e+=this.$7(this.$4,t?u.CT_BOOLEAN_TRUE:u.CT_BOOLEAN_FALSE),this.$4=null):e+=this.$1.writeByte(t?s.CT_BOOLEAN_TRUE:s.CT_BOOLEAN_FALSE),e},n.readBinary=function(){var e=this.readVarint32();return e===0?new Uint8Array(0):this.$1.readBytes(e)},n.writeBinary=function(t){var e=0;return e+=this.writeVarint32(t.length),e+=this.$1.write(t),e},n.i32ToZigzag=function(t){if(t<g||t>f)throw new Error("number: "+t+" is out of range of i32");return(t<<1^(t<0?4294967295:0))>>>0},n.zigzagToI32=function(t){if(t<0||t>h)throw new Error("number: "+t+" is out of range of uint32");return t>>>1^-1*(t&1)},n.i64ToZigzag=function(t){if(t>y||t<C)throw new Error("i64 out of range: "+t.toString());return t>>v^t<<S},n.zigzagToI64=function(t){if(t<0||t>b)throw new Error("invalid uint64: "+t.toString());return(t&S)===S?~(t>>S):t>>S},n.writeVarint32=function(t){if(t<0||t>h)throw new Error("writeVarint32 received out of range uint32: "+t);for(var e=t,n=0;;)if(e>>>7)this.$1.writeByte(e&127|128),n++,e>>>=7;else{this.$1.writeByte(e),n++;break}return n},n.readVarint32=function(){for(var e=0,t=0,n;;){if(n=this.$1.readByte(),e=(e|(n&127)<<t)>>>0,t+=7,(n&128)==0){if(t===35&&(n&240)!=0)throw new Error("result exceeded 32 bit limit");break}if(t>28)throw new Error("result exceeded 32 bit limit")}return e},n.writeVarint64=function(t){if(t<0||t>b)throw new Error("invalid uint64: "+t.toString());for(var e=t,n=0;;)if(e>>R==0){this.$1.writeByte(Number(e)),n++;break}else this.$1.writeByte(Number(e&L|E)),n++,e>>=R;return n},n.readVarint64=function(){for(var e=BigInt(0),t=BigInt(0),n;;){if(n=BigInt(this.$1.readByte()),e|=(n&L)<<t,t+=R,(n&E)==0){if(t==70&&n!==S)throw new Error("result exceeded 64 bit limit");break}if(t>63)throw new Error("result exceeded 64 bit limit")}return e},n.readString=function(){return o("Utf8ToString").Utf8ToString(this.readBinary())},n.getLastFieldId=function(){return this.$3},n.getLastField=function(){return this.$2},n.getBooleanFieldInfo=function(){return this.$4},n.getBooleanValue=function(){return this.$5},n.$9=function(t){return c[t]},n.$10=function(n){switch(n){case s.CT_STOP:return(e||(e=r("ThriftTypes"))).STOP;case s.CT_BOOLEAN_FALSE:case s.CT_BOOLEAN_TRUE:return(e||(e=r("ThriftTypes"))).BOOL;case s.CT_BYTE:return(e||(e=r("ThriftTypes"))).BYTE;case s.CT_I16:return(e||(e=r("ThriftTypes"))).I16;case s.CT_I32:return(e||(e=r("ThriftTypes"))).I32;case s.CT_I64:return(e||(e=r("ThriftTypes"))).I64;case s.CT_DOUBLE:return(e||(e=r("ThriftTypes"))).DOUBLE;case s.CT_FLOAT:return(e||(e=r("ThriftTypes"))).FLOAT;case s.CT_BINARY:return(e||(e=r("ThriftTypes"))).STRING;case s.CT_LIST:return(e||(e=r("ThriftTypes"))).LIST;case s.CT_SET:return(e||(e=r("ThriftTypes"))).SET;case s.CT_MAP:return(e||(e=r("ThriftTypes"))).MAP;case s.CT_STRUCT:return(e||(e=r("ThriftTypes"))).STRUCT;default:throw new Error("don't know what type")}},t})();l.default=I}),98);
__d("CompactSerializer",["TCompactProtocol","TNoOpWriteBuffer","TReadBuffer","TWriteBuffer"],(function(t,n,r,o,a,i,l){function e(e,t,n){try{return s(e,t)}catch(e){n!=null&&n(e)}return null}function s(e,t){var n=new(r("TReadBuffer"))(e),o=new(r("TCompactProtocol"))(n);return t(o)}function u(e,t,n,r){n===void 0&&(n=!1);try{return c(e,t,n)}catch(e){r!=null&&r(e)}return null}function c(e,t,n){n===void 0&&(n=!1);var o;if(n){var a=new(r("TNoOpWriteBuffer")),i=new(r("TCompactProtocol"))(a);t(e,i),o=new(r("TWriteBuffer"))(a.currentSize())}else o=new(r("TWriteBuffer"));var l=new(r("TCompactProtocol"))(o);return t(e,l),l.toByteArray()}l.deserializeNoThrow=e,l.deserialize=s,l.serializeNoThrow=u,l.serialize=c}),98);
__d("MultiwaySharedTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({UNKNOWN:0,SFU:1,P2P:2}),s=e({UNKNOWN:0,IGVIDEOCALL:9,ROOM:15,CRUCIBLE:20,MBS_WA:21,BOT:22,HORIZON:23,ULLC:24}),u=e({OFFER:0,PRANSWER:1,ANSWER:2,PROFFER:3}),c=e({LOW:0,MEDIUM:1,HIGH:2,HD:3,NUM_QUALITIES:4}),d=e({E2EE_NOT_MANDATED:0,DEPRECATED_NO_REQUIREMENT:1,E2EE_MANDATED:2,E2EE_BYPASSED_USER_CONSENTED:3}),m=e({NOT_SET:0,CONTROL:1,TEST:2}),p=e({NOT_SET:0,CONTROL:1,TEST:2}),_=e({NotPaused:0,Paused:1}),f=e({AUDIO:0,VIDEO:1,DATA:2}),g=e({UNKNOWN:0,COMPOSITING_SERVICE:1,MEDIA_SERVER:2,CATHODE_AMBISONIC:3,CATHODE_CAPTIONS:4,CATHODE_MEETING_SUMMARIZER:5,CATHODE_REALTIME_SHARED_STATE:6,RP_GENAI_SERVICE:7,SMART_GLASSES_ASSISTANT:8}),h=e({CNAME:0,TRACK:1,DOMINANT_SPEAKER:2}),y=e({UNKNOWN:0,DEFAULT:1,SCREEN_SHARE:2}),C=e({UNSPECIFIED:0,FNA:1,FNA_PREFERRED:2}),b=e({NONE:0,EXTENSION_SELF_PARTICIPANT:1}),v=e({IntValue:"intValue",StringValue:"stringValue"});a.exports={ConferenceType:s,CustomMediaRoutingType:b,E2eeInfraMandatedExpStatus:m,E2eeMode:d,EdgerayType:C,EndpointServiceType:g,MediaPath:l,MediaPauseStatus:_,MediaType:f,P2PSFrameExpStatus:p,QuickExperimentValue$Types:v,RenderedStreamType:y,SdpType:u,SubscriptionType:h,VideoQuality:c}}),null);
__d("WebrtcSignalingCommonTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({DEFAULT_AUDIO:0,DEFAULT_VIDEO:1,SCREEN_AUDIO:2,SCREEN_VIDEO:3,CUSTOM_VIDEO:4,CUSTOM_AUDIO:5}),s=e({OLD_CLIENT_PLATFORM_STACK:0,RSYS_X:1,IG_OLD_STACK:2,MLITE_OLD_STACK:3,SCOTCH:4,ZENON:5}),u=e({NONE:0,AVATAR:1,AUGMENTED_CALLING:2,SCENE_COMPOSITION:3,STEREO_VIDEO:4,SHARED_STATE:5,CODEC_AVATAR_2D:6,CODEC_AVATAR_2D_IMU:7}),c=e({NONE:0,AMBISONIC:1,CONVERSATION_BOT:2,MONOMIX:3,MONOSTREAM:4});a.exports={ClientStack:s,CustomAudioContentType:c,CustomVideoContentType:u,TrackLabel:l}}),null);
__d("MultiwaySharedSerializers",["MultiwaySharedTypes","ThriftTypes","WebrtcSignalingCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{cluster:"",nonce:""}}function u(){return{cluster:"",conferenceName:"",nonce:"",userId:"",clientSessionId:""}}function c(){return{userId:"",deviceId:"",appId:"",appVersion:"",appBuildNumber:""}}function d(){return{mode:o("MultiwaySharedTypes").E2eeMode.cast(0),preventSfuMode:!1,infraMandatedExpStatus:o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0),p2pSFrameExpStatus:o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0)}}function m(){return{semantics:"",ssrcs:[]}}function p(){return{type:o("MultiwaySharedTypes").MediaType.cast(0),id:"",ssrcs:[],enabled:!1,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0),customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)}}function _(){return{parameters:{},conditionFbid:"0",exposureHasBeenLogged:!1,canExposureLog:!1,universeShortName:"",userFbid:"0",unitId:""}}function f(){return{experiments:{},userFbid:"0"}}function g(){return{conditionFbid:"0",userFbid:"0",universeName:"",unitId:""}}function h(){return{enabled:!1,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0),customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)}}function y(){return{tracks:{}}}function C(){return{videoQuality:o("MultiwaySharedTypes").VideoQuality.cast(0)}}function b(){return{cname:"",type:o("MultiwaySharedTypes").SubscriptionType.cast(0)}}function v(){return{restrictiveLogging:!0,verboseLogging:!1}}function S(){return{userId:"",streamId:"",streamType:0,renderWidth:0,renderHeight:0}}function R(){return{}}function L(){return{}}function E(){return{}}function k(){return{host:Uint8Array.of(),port:0}}function I(){return{}}function T(t,n){if(n.writeStructBegin("ServerInfo"),n.writeFieldBegin({fname:"cluster",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cluster!=null)n.writeString(t.cluster);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),t.conferenceName_deprecated!=null&&(n.writeFieldBegin({fname:"conferenceName_deprecated",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.conferenceName_deprecated),n.writeFieldEnd()),n.writeFieldBegin({fname:"nonce",ftype:e.STRING,fid:3}),t.nonce!=null)n.writeString(t.nonce);else{var a="";n.writeString(a)}n.writeFieldEnd(),t.conferenceId!=null&&(n.writeFieldBegin({fname:"conferenceId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:4}),n.writeI64(BigInt(t.conferenceId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("ClientSessionInfo"),n.writeFieldBegin({fname:"cluster",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cluster!=null)n.writeString(t.cluster);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conferenceName",ftype:e.STRING,fid:2}),t.conferenceName!=null)n.writeString(t.conferenceName);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"nonce",ftype:e.STRING,fid:3}),t.nonce!=null)n.writeString(t.nonce);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userId",ftype:e.STRING,fid:4}),t.userId!=null)n.writeString(t.userId);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"clientSessionId",ftype:e.STRING,fid:5}),t.clientSessionId!=null)n.writeString(t.clientSessionId);else{var s="";n.writeString(s)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function x(t,n){if(n.writeStructBegin("Endpoint"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"deviceId",ftype:e.STRING,fid:2}),t.deviceId!=null)n.writeString(t.deviceId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appId",ftype:e.STRING,fid:3}),t.appId!=null)n.writeString(t.appId);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appVersion",ftype:e.STRING,fid:4}),t.appVersion!=null)n.writeString(t.appVersion);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"appBuildNumber",ftype:e.STRING,fid:5}),t.appBuildNumber!=null)n.writeString(t.appBuildNumber);else{var s="";n.writeString(s)}n.writeFieldEnd(),t.clientStackInfo!=null&&(n.writeFieldBegin({fname:"clientStackInfo",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.clientStackInfo),n.writeFieldEnd()),t.familyDeviceId!=null&&(n.writeFieldBegin({fname:"familyDeviceId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.familyDeviceId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function $(t,n){if(n.writeStructBegin("E2eeEnforcement"),n.writeFieldBegin({fname:"mode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.mode!=null){var a;n.writeI32((a=t.mode)!=null?a:0)}else{var i=o("MultiwaySharedTypes").E2eeMode.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"preventSfuMode",ftype:e.BOOL,fid:2}),t.preventSfuMode!=null)n.writeBool(t.preventSfuMode);else{var l=!1;n.writeBool(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"infraMandatedExpStatus",ftype:e.I32,fid:3}),t.infraMandatedExpStatus!=null){var s;n.writeI32((s=t.infraMandatedExpStatus)!=null?s:0)}else{var u=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0);n.writeI32(u!=null?u:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"p2pSFrameExpStatus",ftype:e.I32,fid:4}),t.p2pSFrameExpStatus!=null){var c;n.writeI32((c=t.p2pSFrameExpStatus)!=null?c:0)}else{var d=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0);n.writeI32(d!=null?d:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function P(t,n){if(n.writeStructBegin("SsrcGroup"),n.writeFieldBegin({fname:"semantics",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.semantics!=null)n.writeString(t.semantics);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcs",ftype:e.LIST,fid:2}),t.ssrcs!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:t.ssrcs.length});for(var a of t.ssrcs)n.writeI64(BigInt(a));n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:i.length});for(var l of i)n.writeI64(BigInt(l));n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function N(t,n){if(n.writeStructBegin("Media"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwaySharedTypes").MediaType.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"id",ftype:e.STRING,fid:2}),t.id!=null)n.writeString(t.id);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcs",ftype:e.LIST,fid:3}),t.ssrcs!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:t.ssrcs.length});for(var s of t.ssrcs)n.writeI64(BigInt(s));n.writeListEnd()}else{var u=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I64,size:u.length});for(var c of u)n.writeI64(BigInt(c));n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"enabled",ftype:e.BOOL,fid:4}),t.enabled!=null)n.writeBool(t.enabled);else{var d=!1;n.writeBool(d)}if(n.writeFieldEnd(),t.pausedDownlink!=null){var m;n.writeFieldBegin({fname:"pausedDownlink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32((m=t.pausedDownlink)!=null?m:0),n.writeFieldEnd()}if(t.pausedUplink!=null){var p;n.writeFieldBegin({fname:"pausedUplink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((p=t.pausedUplink)!=null?p:0),n.writeFieldEnd()}if(t.owner!=null&&(n.writeFieldBegin({fname:"owner",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.owner),n.writeFieldEnd()),t.label!=null){var _;n.writeFieldBegin({fname:"label",ftype:(e||(e=r("ThriftTypes"))).I32,fid:8}),n.writeI32((_=t.label)!=null?_:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"customVideoContentType",ftype:e.I32,fid:9}),t.customVideoContentType!=null){var f;n.writeI32((f=t.customVideoContentType)!=null?f:0)}else{var g=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0);n.writeI32(g!=null?g:0)}if(n.writeFieldEnd(),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.name),n.writeFieldEnd()),n.writeFieldBegin({fname:"customAudioContentType",ftype:e.I32,fid:11}),t.customAudioContentType!=null){var h;n.writeI32((h=t.customAudioContentType)!=null?h:0)}else{var y=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0);n.writeI32(y!=null?y:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function M(t,n){if(n.writeStructBegin("QuickExperiment"),n.writeFieldBegin({fname:"parameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.parameters!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.parameters).length});for(var o of Object.entries(t.parameters)){var a=o[0],i=o[1];n.writeString(a),j(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),j(c,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conditionFbid",ftype:e.I64,fid:2}),t.conditionFbid!=null)n.writeI64(BigInt(t.conditionFbid));else{var d="0";n.writeI64(BigInt(d))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"exposureHasBeenLogged",ftype:e.BOOL,fid:3}),t.exposureHasBeenLogged!=null)n.writeBool(t.exposureHasBeenLogged);else{var m=!1;n.writeBool(m)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"canExposureLog",ftype:e.BOOL,fid:4}),t.canExposureLog!=null)n.writeBool(t.canExposureLog);else{var p=!1;n.writeBool(p)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"universeShortName",ftype:e.STRING,fid:5}),t.universeShortName!=null)n.writeString(t.universeShortName);else{var _="";n.writeString(_)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:6}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var f="0";n.writeI64(BigInt(f))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"unitId",ftype:e.STRING,fid:7}),t.unitId!=null)n.writeString(t.unitId);else{var g="";n.writeString(g)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function w(t,n){if(n.writeStructBegin("QuickExperimentResult"),n.writeFieldBegin({fname:"experiments",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.experiments!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.experiments).length});for(var o of Object.entries(t.experiments)){var a=o[0],i=o[1];n.writeString(a),M(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),M(c,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:2}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var d="0";n.writeI64(BigInt(d))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function A(t,n){if(n.writeStructBegin("QuickExperimentExposureLoggingEvent"),n.writeFieldBegin({fname:"conditionFbid",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.conditionFbid!=null)n.writeI64(BigInt(t.conditionFbid));else{var o="0";n.writeI64(BigInt(o))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"userFbid",ftype:e.I64,fid:2}),t.userFbid!=null)n.writeI64(BigInt(t.userFbid));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"universeName",ftype:e.STRING,fid:3}),t.universeName!=null)n.writeString(t.universeName);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"unitId",ftype:e.STRING,fid:4}),t.unitId!=null)n.writeString(t.unitId);else{var l="";n.writeString(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function F(t,n){if(n.writeStructBegin("ClientTrackInfo"),n.writeFieldBegin({fname:"enabled",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:1}),t.enabled!=null)n.writeBool(t.enabled);else{var a=!1;n.writeBool(a)}if(n.writeFieldEnd(),t.pausedUplink!=null){var i;n.writeFieldBegin({fname:"pausedUplink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((i=t.pausedUplink)!=null?i:0),n.writeFieldEnd()}if(t.pausedDownlink!=null){var l;n.writeFieldBegin({fname:"pausedDownlink",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32((l=t.pausedDownlink)!=null?l:0),n.writeFieldEnd()}if(t.owner!=null&&(n.writeFieldBegin({fname:"owner",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.owner),n.writeFieldEnd()),t.label!=null){var s;n.writeFieldBegin({fname:"label",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32((s=t.label)!=null?s:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"customVideoContentType",ftype:e.I32,fid:6}),t.customVideoContentType!=null){var u;n.writeI32((u=t.customVideoContentType)!=null?u:0)}else{var c=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0);n.writeI32(c!=null?c:0)}if(n.writeFieldEnd(),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.name),n.writeFieldEnd()),n.writeFieldBegin({fname:"customAudioContentType",ftype:e.I32,fid:8}),t.customAudioContentType!=null){var d;n.writeI32((d=t.customAudioContentType)!=null?d:0)}else{var m=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0);n.writeI32(m!=null?m:0)}n.writeFieldEnd(),t.nodeId!=null&&(n.writeFieldBegin({fname:"nodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:9}),n.writeI64(BigInt(t.nodeId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function O(t,n){if(n.writeStructBegin("ClientMediaStatus"),n.writeFieldBegin({fname:"tracks",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.tracks!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.tracks).length});for(var o of Object.entries(t.tracks)){var a=o[0],i=o[1];n.writeString(a),F(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),F(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function B(t,n){if(n.writeStructBegin("SubscriptionOptions"),n.writeFieldBegin({fname:"videoQuality",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.videoQuality!=null){var a;n.writeI32((a=t.videoQuality)!=null?a:0)}else{var i=o("MultiwaySharedTypes").VideoQuality.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.qualityIndex!=null&&(n.writeFieldBegin({fname:"qualityIndex",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32(t.qualityIndex),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function W(t,n){if(n.writeStructBegin("Subscription"),n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),t.options!=null&&(n.writeFieldBegin({fname:"options",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),B(t.options,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"type",ftype:e.I32,fid:3}),t.type!=null){var i;n.writeI32((i=t.type)!=null?i:0)}else{var l=o("MultiwaySharedTypes").SubscriptionType.cast(0);n.writeI32(l!=null?l:0)}n.writeFieldEnd(),t.trackId!=null&&(n.writeFieldBegin({fname:"trackId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.trackId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function q(t,n){if(n.writeStructBegin("LoggingOptions"),n.writeFieldBegin({fname:"restrictiveLogging",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:1}),t.restrictiveLogging!=null)n.writeBool(t.restrictiveLogging);else{var o=!0;n.writeBool(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"verboseLogging",ftype:e.BOOL,fid:2}),t.verboseLogging!=null)n.writeBool(t.verboseLogging);else{var a=!1;n.writeBool(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function U(t,n){if(n.writeStructBegin("ResolutionData"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"streamId",ftype:e.STRING,fid:2}),t.streamId!=null)n.writeString(t.streamId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"streamType",ftype:e.I32,fid:3}),t.streamType!=null)n.writeI32(t.streamType);else{var i=0;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"renderWidth",ftype:e.I32,fid:4}),t.renderWidth!=null)n.writeI32(t.renderWidth);else{var l=0;n.writeI32(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"renderHeight",ftype:e.I32,fid:5}),t.renderHeight!=null)n.writeI32(t.renderHeight);else{var s=0;n.writeI32(s)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function V(t,n){n.writeStructBegin("TurnInfo"),t.ipv4!=null&&(n.writeFieldBegin({fname:"ipv4",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeBinary(t.ipv4),n.writeFieldEnd()),t.ipv6!=null&&(n.writeFieldBegin({fname:"ipv6",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.ipv6),n.writeFieldEnd()),t.udpPort!=null&&(n.writeFieldBegin({fname:"udpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.udpPort),n.writeFieldEnd()),t.tcpPort!=null&&(n.writeFieldBegin({fname:"tcpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.tcpPort),n.writeFieldEnd()),t.sslTcpPort!=null&&(n.writeFieldBegin({fname:"sslTcpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32(t.sslTcpPort),n.writeFieldEnd()),t.portInfoIdx!=null&&(n.writeFieldBegin({fname:"portInfoIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32(t.portInfoIdx),n.writeFieldEnd()),t.tlsPort!=null&&(n.writeFieldBegin({fname:"tlsPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32(t.tlsPort),n.writeFieldEnd()),t.credentialIdx!=null&&(n.writeFieldBegin({fname:"credentialIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:8}),n.writeI32(t.credentialIdx),n.writeFieldEnd()),t.turnUsername!=null&&(n.writeFieldBegin({fname:"turnUsername",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:9}),n.writeString(t.turnUsername),n.writeFieldEnd()),t.turnPassword!=null&&(n.writeFieldBegin({fname:"turnPassword",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.turnPassword),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function H(t,n){if(n.writeStructBegin("EdgerayInfo"),t.edgerayType!=null){var o;n.writeFieldBegin({fname:"edgerayType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32((o=t.edgerayType)!=null?o:0),n.writeFieldEnd()}t.ipv4!=null&&(n.writeFieldBegin({fname:"ipv4",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.ipv4),n.writeFieldEnd()),t.ipv6!=null&&(n.writeFieldBegin({fname:"ipv6",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeBinary(t.ipv6),n.writeFieldEnd()),t.token!=null&&(n.writeFieldBegin({fname:"token",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.token),n.writeFieldEnd()),t.tokenIdx!=null&&(n.writeFieldBegin({fname:"tokenIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:5}),n.writeI32(t.tokenIdx),n.writeFieldEnd()),t.secret!=null&&(n.writeFieldBegin({fname:"secret",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeBinary(t.secret),n.writeFieldEnd()),t.secretIdx!=null&&(n.writeFieldBegin({fname:"secretIdx",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32(t.secretIdx),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function G(t,n){if(n.writeStructBegin("RelayInfo"),t.turns!=null){n.writeFieldBegin({fname:"turns",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),n.writeListBegin({etype:e.STRUCT,size:t.turns.length});for(var o of t.turns)V(o,n);n.writeListEnd(),n.writeFieldEnd()}if(t.edgerays!=null){n.writeFieldBegin({fname:"edgerays",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.edgerays.length});for(var a of t.edgerays)H(a,n);n.writeListEnd(),n.writeFieldEnd()}t.turnUsername!=null&&(n.writeFieldBegin({fname:"turnUsername",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.turnUsername),n.writeFieldEnd()),t.turnPassword!=null&&(n.writeFieldBegin({fname:"turnPassword",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.turnPassword),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function z(t,n){if(n.writeStructBegin("TSocketAddress"),n.writeFieldBegin({fname:"host",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.host!=null)n.writeBinary(t.host);else{var o=Uint8Array.of();n.writeBinary(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"port",ftype:e.I16,fid:2}),t.port!=null)n.writeI16(t.port);else{var a=0;n.writeI16(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function j(t,n){if(n.writeStructBegin("QuickExperimentValue"),t.intValue!=null){n.writeFieldBegin({fname:"intValue",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),n.writeI64(BigInt(t.intValue)),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.stringValue!=null){n.writeFieldBegin({fname:"stringValue",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.stringValue),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}n.writeFieldStop(),n.writeStructEnd()}function K(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.cluster=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName_deprecated=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.nonce=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I64?n.conferenceId=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.cluster===void 0&&(n.cluster=""),n.nonce===void 0&&(n.nonce=""),n}function Q(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.cluster=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.nonce=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.clientSessionId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.cluster===void 0&&(n.cluster=""),n.conferenceName===void 0&&(n.conferenceName=""),n.nonce===void 0&&(n.nonce=""),n.userId===void 0&&(n.userId=""),n.clientSessionId===void 0&&(n.clientSessionId=""),n}function X(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.deviceId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.appId=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.appVersion=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.appBuildNumber=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRING?n.clientStackInfo=t.readString():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).STRING?n.familyDeviceId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.deviceId===void 0&&(n.deviceId=""),n.appId===void 0&&(n.appId=""),n.appVersion===void 0&&(n.appVersion=""),n.appBuildNumber===void 0&&(n.appBuildNumber=""),n}function Y(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.mode=o("MultiwaySharedTypes").E2eeMode.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).BOOL?n.preventSfuMode=t.readBool():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.infraMandatedExpStatus=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.p2pSFrameExpStatus=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.mode===void 0&&(n.mode=o("MultiwaySharedTypes").E2eeMode.cast(0)),n.preventSfuMode===void 0&&(n.preventSfuMode=!1),n.infraMandatedExpStatus===void 0&&(n.infraMandatedExpStatus=o("MultiwaySharedTypes").E2eeInfraMandatedExpStatus.cast(0)),n.p2pSFrameExpStatus===void 0&&(n.p2pSFrameExpStatus=o("MultiwaySharedTypes").P2PSFrameExpStatus.cast(0)),n}function J(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.semantics=t.readString():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.ssrcs=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readI64().toString();n.ssrcs.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.semantics===void 0&&(n.semantics=""),n.ssrcs===void 0&&(n.ssrcs=[]),n}function Z(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwaySharedTypes").MediaType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcs=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readI64().toString();n.ssrcs.push(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BOOL?n.enabled=t.readBool():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.pausedDownlink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.pausedUplink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.owner=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.label=o("WebrtcSignalingCommonTypes").TrackLabel.cast(t.readI32()):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32()):t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I32?n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwaySharedTypes").MediaType.cast(0)),n.id===void 0&&(n.id=""),n.ssrcs===void 0&&(n.ssrcs=[]),n.enabled===void 0&&(n.enabled=!1),n.customVideoContentType===void 0&&(n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0)),n.customAudioContentType===void 0&&(n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)),n}function ee(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.parameters={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=pe(t);n.parameters[u]=c}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.conditionFbid=t.readI64().toString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.exposureHasBeenLogged=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).BOOL?n.canExposureLog=t.readBool():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.universeShortName=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).STRING?n.unitId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.parameters===void 0&&(n.parameters={}),n.conditionFbid===void 0&&(n.conditionFbid="0"),n.exposureHasBeenLogged===void 0&&(n.exposureHasBeenLogged=!1),n.canExposureLog===void 0&&(n.canExposureLog=!1),n.universeShortName===void 0&&(n.universeShortName=""),n.userFbid===void 0&&(n.userFbid="0"),n.unitId===void 0&&(n.unitId=""),n}function te(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.experiments={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=ee(t);n.experiments[u]=c}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.experiments===void 0&&(n.experiments={}),n.userFbid===void 0&&(n.userFbid="0"),n}function ne(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.conditionFbid=t.readI64().toString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.userFbid=t.readI64().toString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.universeName=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.unitId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.conditionFbid===void 0&&(n.conditionFbid="0"),n.userFbid===void 0&&(n.userFbid="0"),n.universeName===void 0&&(n.universeName=""),n.unitId===void 0&&(n.unitId=""),n}function re(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).BOOL?n.enabled=t.readBool():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.pausedUplink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.pausedDownlink=o("MultiwaySharedTypes").MediaPauseStatus.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.owner=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.label=o("WebrtcSignalingCommonTypes").TrackLabel.cast(t.readI32()):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(t.readI32()):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I64?n.nodeId=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.enabled===void 0&&(n.enabled=!1),n.customVideoContentType===void 0&&(n.customVideoContentType=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(0)),n.customAudioContentType===void 0&&(n.customAudioContentType=o("WebrtcSignalingCommonTypes").CustomAudioContentType.cast(0)),n}function oe(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.tracks={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=re(t);n.tracks[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.tracks===void 0&&(n.tracks={}),n}function ae(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.videoQuality=o("MultiwaySharedTypes").VideoQuality.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.qualityIndex=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.videoQuality===void 0&&(n.videoQuality=o("MultiwaySharedTypes").VideoQuality.cast(0)),n}function ie(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.options=ae(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwaySharedTypes").SubscriptionType.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.trackId=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.cname===void 0&&(n.cname=""),n.type===void 0&&(n.type=o("MultiwaySharedTypes").SubscriptionType.cast(0)),n}function le(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).BOOL?n.restrictiveLogging=t.readBool():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).BOOL?n.verboseLogging=t.readBool():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.restrictiveLogging===void 0&&(n.restrictiveLogging=!0),n.verboseLogging===void 0&&(n.verboseLogging=!1),n}function se(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.streamId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.streamType=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.renderWidth=t.readI32():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I32?n.renderHeight=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.streamId===void 0&&(n.streamId=""),n.streamType===void 0&&(n.streamType=0),n.renderWidth===void 0&&(n.renderWidth=0),n.renderHeight===void 0&&(n.renderHeight=0),n}function ue(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.ipv4=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.ipv6=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.udpPort=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.tcpPort=t.readI32():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I32?n.sslTcpPort=t.readI32():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).I32?n.portInfoIdx=t.readI32():t.skip(a);break;case 7:a===(e||(e=r("ThriftTypes"))).I32?n.tlsPort=t.readI32():t.skip(a);break;case 8:a===(e||(e=r("ThriftTypes"))).I32?n.credentialIdx=t.readI32():t.skip(a);break;case 9:a===(e||(e=r("ThriftTypes"))).STRING?n.turnUsername=t.readString():t.skip(a);break;case 10:a===(e||(e=r("ThriftTypes"))).STRING?n.turnPassword=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function ce(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.edgerayType=o("MultiwaySharedTypes").EdgerayType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.ipv4=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.ipv6=t.readBinary():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.token=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.tokenIdx=t.readI32():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRING?n.secret=t.readBinary():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).I32?n.secretIdx=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function de(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.turns=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=ue(t);n.turns.push(u)}}else t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.edgerays=[];for(var c=t.readListBegin(),d=0;d<c.size;d++){var m=ce(t);n.edgerays.push(m)}}else t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.turnUsername=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.turnPassword=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function me(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.host=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I16?n.port=t.readI16():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.host===void 0&&(n.host=Uint8Array.of()),n.port===void 0&&(n.port=0),n}function pe(t){var n,o={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).I64)if(n==null)o.intValue=t.readI64().toString(),n="intValue";else throw new Error("more than one field have been deserialized in union type: QuickExperimentValue; current field: intValue, previous deserialized field: "+n);else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).STRING)if(n==null)o.stringValue=t.readString(),n="stringValue";else throw new Error("more than one field have been deserialized in union type: QuickExperimentValue; current field: stringValue, previous deserialized field: "+n);else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),o}l.ServerInfo$DefaultConstructor=s,l.ClientSessionInfo$DefaultConstructor=u,l.Endpoint$DefaultConstructor=c,l.E2eeEnforcement$DefaultConstructor=d,l.SsrcGroup$DefaultConstructor=m,l.Media$DefaultConstructor=p,l.QuickExperiment$DefaultConstructor=_,l.QuickExperimentResult$DefaultConstructor=f,l.QuickExperimentExposureLoggingEvent$DefaultConstructor=g,l.ClientTrackInfo$DefaultConstructor=h,l.ClientMediaStatus$DefaultConstructor=y,l.SubscriptionOptions$DefaultConstructor=C,l.Subscription$DefaultConstructor=b,l.LoggingOptions$DefaultConstructor=v,l.ResolutionData$DefaultConstructor=S,l.TurnInfo$DefaultConstructor=R,l.EdgerayInfo$DefaultConstructor=L,l.RelayInfo$DefaultConstructor=E,l.TSocketAddress$DefaultConstructor=k,l.QuickExperimentValue$DefaultConstructor=I,l.serializeServerInfo=T,l.serializeClientSessionInfo=D,l.serializeEndpoint=x,l.serializeE2eeEnforcement=$,l.serializeSsrcGroup=P,l.serializeMedia=N,l.serializeQuickExperiment=M,l.serializeQuickExperimentResult=w,l.serializeQuickExperimentExposureLoggingEvent=A,l.serializeClientTrackInfo=F,l.serializeClientMediaStatus=O,l.serializeSubscriptionOptions=B,l.serializeSubscription=W,l.serializeLoggingOptions=q,l.serializeResolutionData=U,l.serializeTurnInfo=V,l.serializeEdgerayInfo=H,l.serializeRelayInfo=G,l.serializeTSocketAddress=z,l.serializeQuickExperimentValue=j,l.deserializeServerInfo=K,l.deserializeClientSessionInfo=Q,l.deserializeEndpoint=X,l.deserializeE2eeEnforcement=Y,l.deserializeSsrcGroup=J,l.deserializeMedia=Z,l.deserializeQuickExperiment=ee,l.deserializeQuickExperimentResult=te,l.deserializeQuickExperimentExposureLoggingEvent=ne,l.deserializeClientTrackInfo=re,l.deserializeClientMediaStatus=oe,l.deserializeSubscriptionOptions=ae,l.deserializeSubscription=ie,l.deserializeLoggingOptions=le,l.deserializeResolutionData=se,l.deserializeTurnInfo=ue,l.deserializeEdgerayInfo=ce,l.deserializeRelayInfo=de,l.deserializeTSocketAddress=me,l.deserializeQuickExperimentValue=pe}),98);
__d("WebrtcSignalingCommonSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{topic:"",data:Uint8Array.of()}}function u(t,n){if(n.writeStructBegin("GenericDataMessage"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"data",ftype:e.STRING,fid:2}),t.data!=null)n.writeBinary(t.data);else{var a=Uint8Array.of();n.writeBinary(a)}n.writeFieldEnd(),t.e2eEncryptedData!=null&&(n.writeFieldBegin({fname:"e2eEncryptedData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeBinary(t.e2eEncryptedData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function c(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.e2eEncryptedData=t.readBinary():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.data===void 0&&(n.data=Uint8Array.of()),n}l.GenericDataMessage$DefaultConstructor=s,l.serializeGenericDataMessage=u,l.deserializeGenericDataMessage=c}),98);
__d("DataMessageSerializers",["MultiwaySharedSerializers","MultiwaySharedTypes","ThriftTypes","WebrtcSignalingCommonSerializers"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{topic_DEPRECATED:""}}function u(){return{userId:""}}function c(){return{userId:"",cname:"",trackIds:[],transactionId:"0"}}function d(){return{cname:"",quality_DEPRECATED:o("MultiwaySharedTypes").VideoQuality.cast(0)}}function m(){return{userId:"",bottleneckBps:0}}function p(){return{bottleneckUplinksByLayer:{}}}function _(){return{duplicationAmount:0,delayMs:0}}function f(){return{}}function g(){return{}}function h(){return{primarySpeakerUserId:"",transactionId:"0"}}function y(){return{}}function C(){return{signalingMessagePayload:Uint8Array.of()}}function b(){return{signalingMessagePayload:Uint8Array.of()}}function v(){return{subscriptionMessagePayload:[]}}function S(){return{}}function R(){return{}}function L(){return{nodeIdToUserIdMap:{},nodeIdToServiceTypeMap:{}}}function E(){return{}}function k(){return{header:s()}}function I(t,n){if(n.writeStructBegin("DataHeader"),t.sender!=null&&(n.writeFieldBegin({fname:"sender",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sender),n.writeFieldEnd()),n.writeFieldBegin({fname:"topic_DEPRECATED",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic_DEPRECATED!=null)n.writeString(t.topic_DEPRECATED);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),t.recipients!=null){n.writeFieldBegin({fname:"recipients",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),n.writeSetBegin({etype:e.STRING,size:t.recipients.size});for(var a of t.recipients)n.writeString(a);n.writeSetEnd(),n.writeFieldEnd()}if(t.serviceSender!=null){var i;n.writeFieldBegin({fname:"serviceSender",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32((i=t.serviceSender)!=null?i:0),n.writeFieldEnd()}if(t.serviceRecipients!=null){n.writeFieldBegin({fname:"serviceRecipients",ftype:(e||(e=r("ThriftTypes"))).SET,fid:5}),n.writeSetBegin({etype:e.I32,size:t.serviceRecipients.size});for(var l of t.serviceRecipients)n.writeI32(l!=null?l:0);n.writeSetEnd(),n.writeFieldEnd()}t.shouldSendToAllUsers!=null&&(n.writeFieldBegin({fname:"shouldSendToAllUsers",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:6}),n.writeBool(t.shouldSendToAllUsers),n.writeFieldEnd()),t.senderE2eeId!=null&&(n.writeFieldBegin({fname:"senderE2eeId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeBinary(t.senderE2eeId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function T(t,n){if(n.writeStructBegin("SpeakerDetail"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("DominantSpeakerNotification"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"cname",ftype:e.STRING,fid:2}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"trackIds",ftype:e.LIST,fid:4}),t.trackIds!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.trackIds.length});for(var i of t.trackIds)n.writeString(i);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:l.length});for(var s of l)n.writeString(s);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.I64,fid:5}),t.transactionId!=null)n.writeI64(BigInt(t.transactionId));else{var u="0";n.writeI64(BigInt(u))}if(n.writeFieldEnd(),t.dominantSpeakers!=null){n.writeFieldBegin({fname:"dominantSpeakers",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:6}),n.writeListBegin({etype:e.STRUCT,size:t.dominantSpeakers.length});for(var c of t.dominantSpeakers)T(c,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function x(t,n){if(n.writeStructBegin("VideoUploadRequest"),n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.cname!=null)n.writeString(t.cname);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"quality_DEPRECATED",ftype:e.I32,fid:2}),t.quality_DEPRECATED!=null){var i;n.writeI32((i=t.quality_DEPRECATED)!=null?i:0)}else{var l=o("MultiwaySharedTypes").VideoQuality.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.qualityMask!=null&&(n.writeFieldBegin({fname:"qualityMask",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.qualityMask),n.writeFieldEnd()),t.perSsrcTargetBitrateBpsMap!=null){n.writeFieldBegin({fname:"perSsrcTargetBitrateBpsMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:4}),n.writeMapBegin({ktype:e.I64,vtype:e.I64,size:Object.keys(t.perSsrcTargetBitrateBpsMap).length});for(var s of Object.entries(t.perSsrcTargetBitrateBpsMap)){var u=s[0],c=s[1];n.writeI64(BigInt(u)),n.writeI64(BigInt(c))}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function $(t,n){if(n.writeStructBegin("ReceiverBottleneck"),n.writeFieldBegin({fname:"userId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.userId!=null)n.writeString(t.userId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"bottleneckBps",ftype:e.I32,fid:2}),t.bottleneckBps!=null)n.writeI32(t.bottleneckBps);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function P(t,n){if(n.writeStructBegin("BweDebugInfo"),n.writeFieldBegin({fname:"bottleneckUplinksByLayer",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.bottleneckUplinksByLayer!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.bottleneckUplinksByLayer).length});for(var o of Object.entries(t.bottleneckUplinksByLayer)){var a=o[0],i=o[1];n.writeI32(Number(a)),$(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI32(Number(u)),$(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function N(t,n){if(n.writeStructBegin("AudioDuplicationDebugInfo"),n.writeFieldBegin({fname:"duplicationAmount",ftype:(e||(e=r("ThriftTypes"))).I16,fid:1}),t.duplicationAmount!=null)n.writeI16(t.duplicationAmount);else{var o=0;n.writeI16(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"delayMs",ftype:e.I16,fid:2}),t.delayMs!=null)n.writeI16(t.delayMs);else{var a=0;n.writeI16(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function M(t,n){n.writeStructBegin("ReceiveTrackDebugInfo"),t.trackId!=null&&(n.writeFieldBegin({fname:"trackId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.trackId),n.writeFieldEnd()),t.numSimulcastLayersSupported!=null&&(n.writeFieldBegin({fname:"numSimulcastLayersSupported",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32(t.numSimulcastLayersSupported),n.writeFieldEnd()),t.numSimulcastLayersAllocated!=null&&(n.writeFieldBegin({fname:"numSimulcastLayersAllocated",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.numSimulcastLayersAllocated),n.writeFieldEnd()),t.spatialLayerIndex!=null&&(n.writeFieldBegin({fname:"spatialLayerIndex",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.spatialLayerIndex),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function w(t,n){if(n.writeStructBegin("DebugInfo"),t.audioDuplicationDebugInfo!=null&&(n.writeFieldBegin({fname:"audioDuplicationDebugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),N(t.audioDuplicationDebugInfo,n),n.writeFieldEnd()),t.receiveTrackDebugInfo!=null){n.writeFieldBegin({fname:"receiveTrackDebugInfo",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.receiveTrackDebugInfo.length});for(var o of t.receiveTrackDebugInfo)M(o,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function A(t,n){if(n.writeStructBegin("DominantSpeakerInfo"),n.writeFieldBegin({fname:"primarySpeakerUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.primarySpeakerUserId!=null)n.writeString(t.primarySpeakerUserId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.I64,fid:2}),t.transactionId!=null)n.writeI64(BigInt(t.transactionId));else{var a="0";n.writeI64(BigInt(a))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function F(t,n){if(n.writeStructBegin("VideoUploadInfo"),t.qualityMask!=null&&(n.writeFieldBegin({fname:"qualityMask",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.qualityMask),n.writeFieldEnd()),t.perSsrcTargetBitrateBpsMap!=null){n.writeFieldBegin({fname:"perSsrcTargetBitrateBpsMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:2}),n.writeMapBegin({ktype:e.I64,vtype:e.I64,size:Object.keys(t.perSsrcTargetBitrateBpsMap).length});for(var o of Object.entries(t.perSsrcTargetBitrateBpsMap)){var a=o[0],i=o[1];n.writeI64(BigInt(a)),n.writeI64(BigInt(i))}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function O(t,n){if(n.writeStructBegin("SignalingMessageToClient"),n.writeFieldBegin({fname:"signalingMessagePayload",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.signalingMessagePayload!=null)n.writeBinary(t.signalingMessagePayload);else{var o=Uint8Array.of();n.writeBinary(o)}n.writeFieldEnd(),t.version!=null&&(n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.version)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function B(t,n){if(n.writeStructBegin("SignalingMessageFromClient"),n.writeFieldBegin({fname:"signalingMessagePayload",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.signalingMessagePayload!=null)n.writeBinary(t.signalingMessagePayload);else{var o=Uint8Array.of();n.writeBinary(o)}n.writeFieldEnd(),t.version!=null&&(n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.version)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function W(t,n){if(n.writeStructBegin("SubscriptionMessageFromClient"),n.writeFieldBegin({fname:"subscriptionMessagePayload",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.subscriptionMessagePayload!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.subscriptionMessagePayload.length});for(var a of t.subscriptionMessagePayload)o("MultiwaySharedSerializers").serializeSubscription(a,n);n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:i.length});for(var l of i)o("MultiwaySharedSerializers").serializeSubscription(l,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function q(t,n){if(n.writeStructBegin("RenderResolutionMessageFromClient"),t.renderResolutionMap!=null){n.writeFieldBegin({fname:"renderResolutionMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),n.writeMapBegin({ktype:e.STRING,vtype:e.MAP,size:Object.keys(t.renderResolutionMap).length});for(var a of Object.entries(t.renderResolutionMap)){var i=a[0],l=a[1];n.writeString(i),n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u,c=s[0],d=s[1];n.writeI32((u=Number(c))!=null?u:0),o("MultiwaySharedSerializers").serializeResolutionData(d,n)}n.writeMapEnd()}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function U(t,n){if(n.writeStructBegin("RenderResolutionMessageToClient"),t.renderResolutionMap!=null){n.writeFieldBegin({fname:"renderResolutionMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),n.writeMapBegin({ktype:e.STRING,vtype:e.MAP,size:Object.keys(t.renderResolutionMap).length});for(var a of Object.entries(t.renderResolutionMap)){var i=a[0],l=a[1];n.writeString(i),n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u,c=s[0],d=s[1];n.writeI32((u=Number(c))!=null?u:0),o("MultiwaySharedSerializers").serializeResolutionData(d,n)}n.writeMapEnd()}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function V(t,n){if(n.writeStructBegin("NodeIdNotification"),n.writeFieldBegin({fname:"nodeIdToUserIdMap",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.nodeIdToUserIdMap!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I64,size:Object.keys(t.nodeIdToUserIdMap).length});for(var o of Object.entries(t.nodeIdToUserIdMap)){var a=o[0],i=o[1];n.writeI64(BigInt(a)),n.writeI64(BigInt(i))}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I64,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI64(BigInt(u)),n.writeI64(BigInt(c))}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"nodeIdToServiceTypeMap",ftype:e.MAP,fid:2}),t.nodeIdToServiceTypeMap!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I32,size:Object.keys(t.nodeIdToServiceTypeMap).length});for(var d of Object.entries(t.nodeIdToServiceTypeMap)){var m=d[0],p=d[1];n.writeI64(BigInt(m)),n.writeI32(p!=null?p:0)}n.writeMapEnd()}else{var _={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I64,vtype:e.I32,size:Object.keys(_).length});for(var f of Object.entries(_)){var g=f[0],h=f[1];n.writeI64(BigInt(g)),n.writeI32(h!=null?h:0)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function H(t,n){n.writeStructBegin("DataMessageBody"),t.genericMessage!=null&&(n.writeFieldBegin({fname:"genericMessage",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),o("WebrtcSignalingCommonSerializers").serializeGenericDataMessage(t.genericMessage,n),n.writeFieldEnd()),t.dominantSpeakerNotification!=null&&(n.writeFieldBegin({fname:"dominantSpeakerNotification",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),D(t.dominantSpeakerNotification,n),n.writeFieldEnd()),t.videoUploadRequest!=null&&(n.writeFieldBegin({fname:"videoUploadRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),x(t.videoUploadRequest,n),n.writeFieldEnd()),t.dominantSpeakerSignalingInfo!=null&&(n.writeFieldBegin({fname:"dominantSpeakerSignalingInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),A(t.dominantSpeakerSignalingInfo,n),n.writeFieldEnd()),t.bweDebugInfo!=null&&(n.writeFieldBegin({fname:"bweDebugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),P(t.bweDebugInfo,n),n.writeFieldEnd()),t.debugInfo!=null&&(n.writeFieldBegin({fname:"debugInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),w(t.debugInfo,n),n.writeFieldEnd()),t.videoUploadSignalingInfo!=null&&(n.writeFieldBegin({fname:"videoUploadSignalingInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),F(t.videoUploadSignalingInfo,n),n.writeFieldEnd()),t.signalingMessageToClient!=null&&(n.writeFieldBegin({fname:"signalingMessageToClient",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),O(t.signalingMessageToClient,n),n.writeFieldEnd()),t.signalingMessageFromClient!=null&&(n.writeFieldBegin({fname:"signalingMessageFromClient",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),B(t.signalingMessageFromClient,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function G(t,n){if(n.writeStructBegin("DataMessage"),n.writeFieldBegin({fname:"header",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.header!=null)I(t.header,n);else{var o=s();I(o,n)}n.writeFieldEnd(),t.data_DEPRECATED!=null&&(n.writeFieldBegin({fname:"data_DEPRECATED",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.data_DEPRECATED),n.writeFieldEnd()),t.body!=null&&(n.writeFieldBegin({fname:"body",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),H(t.body,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function z(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sender=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic_DEPRECATED=t.readString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.recipients=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.recipients.add(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.serviceSender=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32()):t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).SET){n.serviceRecipients=new Set;for(var d=t.readSetBegin(),m=0;m<d.size;m++){var p=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32());n.serviceRecipients.add(p)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).BOOL?n.shouldSendToAllUsers=t.readBool():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.senderE2eeId=t.readBinary():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic_DEPRECATED===void 0&&(n.topic_DEPRECATED=""),n}function j(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n}function K(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(a);break;case 4:if(a===(e||(e=r("ThriftTypes"))).LIST){n.trackIds=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readString();n.trackIds.push(u)}}else t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).I64?n.transactionId=t.readI64().toString():t.skip(a);break;case 6:if(a===(e||(e=r("ThriftTypes"))).LIST){n.dominantSpeakers=[];for(var c=t.readListBegin(),d=0;d<c.size;d++){var m=j(t);n.dominantSpeakers.push(m)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.cname===void 0&&(n.cname=""),n.trackIds===void 0&&(n.trackIds=[]),n.transactionId===void 0&&(n.transactionId="0"),n}function Q(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.quality_DEPRECATED=o("MultiwaySharedTypes").VideoQuality.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.qualityMask=t.readI32():t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.perSsrcTargetBitrateBpsMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readI64().toString(),d=t.readI64().toString();n.perSsrcTargetBitrateBpsMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.cname===void 0&&(n.cname=""),n.quality_DEPRECATED===void 0&&(n.quality_DEPRECATED=o("MultiwaySharedTypes").VideoQuality.cast(0)),n}function X(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.bottleneckBps=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.userId===void 0&&(n.userId=""),n.bottleneckBps===void 0&&(n.bottleneckBps=0),n}function Y(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.bottleneckUplinksByLayer={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI32(),c=X(t);n.bottleneckUplinksByLayer[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.bottleneckUplinksByLayer===void 0&&(n.bottleneckUplinksByLayer={}),n}function J(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I16?n.duplicationAmount=t.readI16():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I16?n.delayMs=t.readI16():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.duplicationAmount===void 0&&(n.duplicationAmount=0),n.delayMs===void 0&&(n.delayMs=0),n}function Z(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.trackId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.numSimulcastLayersSupported=t.readI32():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.numSimulcastLayersAllocated=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).I32?n.spatialLayerIndex=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function ee(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.audioDuplicationDebugInfo=J(t):t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.receiveTrackDebugInfo=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=Z(t);n.receiveTrackDebugInfo.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function te(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.primarySpeakerUserId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.transactionId=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.primarySpeakerUserId===void 0&&(n.primarySpeakerUserId=""),n.transactionId===void 0&&(n.transactionId="0"),n}function ne(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.qualityMask=t.readI32():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).MAP){n.perSsrcTargetBitrateBpsMap={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI64().toString(),c=t.readI64().toString();n.perSsrcTargetBitrateBpsMap[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function re(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.signalingMessagePayload=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.signalingMessagePayload===void 0&&(n.signalingMessagePayload=Uint8Array.of()),n}function oe(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.signalingMessagePayload=t.readBinary():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.signalingMessagePayload===void 0&&(n.signalingMessagePayload=Uint8Array.of()),n}function ae(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).LIST){n.subscriptionMessagePayload=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeSubscription(t);n.subscriptionMessagePayload.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.subscriptionMessagePayload===void 0&&(n.subscriptionMessagePayload=[]),n}function ie(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.renderResolutionMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){for(var c=t.readString(),d={},m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").RenderedStreamType.cast(t.readI32()),f=o("MultiwaySharedSerializers").deserializeResolutionData(t);_!=null&&(d[_]=f)}n.renderResolutionMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function le(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.renderResolutionMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){for(var c=t.readString(),d={},m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").RenderedStreamType.cast(t.readI32()),f=o("MultiwaySharedSerializers").deserializeResolutionData(t);_!=null&&(d[_]=f)}n.renderResolutionMap[c]=d}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function se(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.nodeIdToUserIdMap={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readI64().toString(),d=t.readI64().toString();n.nodeIdToUserIdMap[c]=d}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.nodeIdToServiceTypeMap={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=t.readI64().toString(),f=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32());n.nodeIdToServiceTypeMap[_]=f}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.nodeIdToUserIdMap===void 0&&(n.nodeIdToUserIdMap={}),n.nodeIdToServiceTypeMap===void 0&&(n.nodeIdToServiceTypeMap={}),n}function ue(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.genericMessage=o("WebrtcSignalingCommonSerializers").deserializeGenericDataMessage(t):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.dominantSpeakerNotification=K(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.videoUploadRequest=Q(t):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.dominantSpeakerSignalingInfo=te(t):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bweDebugInfo=Y(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.debugInfo=ee(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.videoUploadSignalingInfo=ne(t):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRUCT?n.signalingMessageToClient=re(t):t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRUCT?n.signalingMessageFromClient=oe(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function ce(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.header=z(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data_DEPRECATED=t.readBinary():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRUCT?n.body=ue(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.header===void 0&&(n.header=s()),n}l.DataHeader$DefaultConstructor=s,l.SpeakerDetail$DefaultConstructor=u,l.DominantSpeakerNotification$DefaultConstructor=c,l.VideoUploadRequest$DefaultConstructor=d,l.ReceiverBottleneck$DefaultConstructor=m,l.BweDebugInfo$DefaultConstructor=p,l.AudioDuplicationDebugInfo$DefaultConstructor=_,l.ReceiveTrackDebugInfo$DefaultConstructor=f,l.DebugInfo$DefaultConstructor=g,l.DominantSpeakerInfo$DefaultConstructor=h,l.VideoUploadInfo$DefaultConstructor=y,l.SignalingMessageToClient$DefaultConstructor=C,l.SignalingMessageFromClient$DefaultConstructor=b,l.SubscriptionMessageFromClient$DefaultConstructor=v,l.RenderResolutionMessageFromClient$DefaultConstructor=S,l.RenderResolutionMessageToClient$DefaultConstructor=R,l.NodeIdNotification$DefaultConstructor=L,l.DataMessageBody$DefaultConstructor=E,l.DataMessage$DefaultConstructor=k,l.serializeDataHeader=I,l.serializeSpeakerDetail=T,l.serializeDominantSpeakerNotification=D,l.serializeVideoUploadRequest=x,l.serializeReceiverBottleneck=$,l.serializeBweDebugInfo=P,l.serializeAudioDuplicationDebugInfo=N,l.serializeReceiveTrackDebugInfo=M,l.serializeDebugInfo=w,l.serializeDominantSpeakerInfo=A,l.serializeVideoUploadInfo=F,l.serializeSignalingMessageToClient=O,l.serializeSignalingMessageFromClient=B,l.serializeSubscriptionMessageFromClient=W,l.serializeRenderResolutionMessageFromClient=q,l.serializeRenderResolutionMessageToClient=U,l.serializeNodeIdNotification=V,l.serializeDataMessageBody=H,l.serializeDataMessage=G,l.deserializeDataHeader=z,l.deserializeSpeakerDetail=j,l.deserializeDominantSpeakerNotification=K,l.deserializeVideoUploadRequest=Q,l.deserializeReceiverBottleneck=X,l.deserializeBweDebugInfo=Y,l.deserializeAudioDuplicationDebugInfo=J,l.deserializeReceiveTrackDebugInfo=Z,l.deserializeDebugInfo=ee,l.deserializeDominantSpeakerInfo=te,l.deserializeVideoUploadInfo=ne,l.deserializeSignalingMessageToClient=re,l.deserializeSignalingMessageFromClient=oe,l.deserializeSubscriptionMessageFromClient=ae,l.deserializeRenderResolutionMessageFromClient=ie,l.deserializeRenderResolutionMessageToClient=le,l.deserializeNodeIdNotification=se,l.deserializeDataMessageBody=ue,l.deserializeDataMessage=ce}),98);
__d("DataMessageTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum")({OK:200,NOT_FOUND:404});a.exports={DataMessageStatusCode:e}}),null);
__d("HorizonWebMqttChannel",["CurrentUser","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(){var e;return o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn),new(r("MqttChannel"))({appId:(e=r("MqttWebConfig")).appID,capabilities:e.capabilities,chatVisibility:!0,clientCapabilities:e.clientCapabilities,endpoint:e.endpoint,initialSubscribedTopics:e.subscribedTopics,pageId:null,phpOverride:e.hostNameOverride,pollingEndpoint:e.pollingEndpoint,userFbid:e.fbid})}var s=null;function u(){return s==null&&(s=e()),s}function c(){s!=null&&(s.shutdown(),s=null)}l.getHorizonWebMqttChannelInstance=u,l.shutdownAndClear=c}),98);
__d("IGDOverLSMqttChannel",["CurrentUser","Env","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s;r("MqttEnvInitializer").initialize();function u(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?936619743392459:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"cookie_auth",deviceId:e,endpoint:(s||(s=r("Env"))).ig_mqtt_wss_endpoint||"wss://edge-chat.instagram.com/chat",initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:(s||(s=r("Env"))).ig_mqtt_polling_endpoint||"https://edge-chat.instagram.com/mqtt/pull",userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var c=null,d;function m(e){c==null&&(c=u(e));var t=c;return d==null||d(t),t}function p(){return new(e||(e=n("Promise")))(function(e){c?e(m()):d=function(n){e(n)}})}function _(){c!=null&&(c.shutdown(),c=null)}l.getInstance=m,l.waitAndGetInstance=p,l.shutdownAndClear=_}),98);
__d("LiveChatWidgetMqttChannel",["MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(){var e;return o("MqttEnv").setIsUserLoggedInNow(function(){return!0}),new(r("MqttChannel"))({appId:0x70127cc7da0a0,capabilities:(e=r("MqttWebConfig")).capabilities,chatVisibility:!1,clientCapabilities:e.clientCapabilities,endpoint:e.endpoint,initialSubscribedTopics:e.subscribedTopics,pageId:null,phpOverride:e.hostNameOverride,pollingEndpoint:e.pollingEndpoint,userFbid:e.fbid})}var s=null;function u(){return s==null&&(s=e()),s}function c(){s!=null&&(s.shutdown(),s=null)}l.getLiveChatWidgetMqttChannelInstance=u,l.shutdownAndClear=c}),98);
__d("MDCMqttChannel",["CurrentUser","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";r("MqttEnvInitializer").initialize();function e(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?0xc7269b363f3c:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"websocket",deviceId:r("uuidv4")(),endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var s=null;function u(t){return s==null&&(s=e(t)),s}function c(){return s}function d(){s!=null&&(s.shutdown(),s=null)}l.getMDCMqttChannelInstance=u,l.getMDCMqttChannelInstanceDoNotCreate=c,l.shutdownAndClear=d}),98);
__d("MqttThriftHeaderSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{}}function u(t,n){n.writeStructBegin("MqttThriftHeader"),t.traceInfo!=null&&(n.writeFieldBegin({fname:"traceInfo",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.traceInfo),n.writeFieldEnd()),t.coreContextRequestId!=null&&(n.writeFieldBegin({fname:"coreContextRequestId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.coreContextRequestId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function c(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.traceInfo=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.coreContextRequestId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}l.MqttThriftHeader$DefaultConstructor=s,l.serializeMqttThriftHeader=u,l.deserializeMqttThriftHeader=c}),98);
__d("MultiwayCommonTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({STRING:0,THRIFT:1,BOTH:2}),s=e({OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONFLICT:409,CONDITIONAL_REQUEST_FAILED:412,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503}),u=e({UNKNOWN:1e3,EXCEEDED_MAX_ALLOWED_PARTICIPANTS:1001,MEMBERSHIP_CHECK_FAIL:1002,CONFERENCE_THROTTLED:1003,ENDPOINT_THROTTLED:1004,MWS_MESSAGE_SENT_TO_INCORRECT_REGION:1005,UNSUPPORTED_REQUEST_TYPE:2e3,CLIENT_REQUEST_UNACCEPTABLE:2001,CLIENT_RESPONSE_UNACCEPTABLE:2002,RING_RESPONSE_BODY_NOT_SET:2004,SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:2005,INVALID_SDP:2006,INVALID_CONFERENCE_NAME:2007,SERVER_INFO_CONFERENCE_NAME_MISMATCH:2008,INVALID_USER_ID:2009,INCORRECT_VERSION_RANGE:2010,SENDER_ID_MISMATCH:2011,RECIPIENT_NOT_SPECIFIED:2012,FIELD_NOT_ALLOWED:2013,USERS_NOT_SPECIFIED:2015,REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:2016,INVALID_CALL_ID:2017,SESSION_DESCRIPTION_ID_MISMATCH:2018,EMPTY_CLIENT_MEDIA_UPDATES:2019,INVALID_SERVER_INFO_DATA:2020,INCORRECT_STATE_VERSION:2021,MISMATCHED_STATE_FOR_VERSION:2022,INVALID_STATE_VERSION:2023,NO_RESOLVER_FOUND:2024,MISSING_APPROVERLIST:2025,FULL_SDP_REQUIRED_IN_APPROVED_STATE:2026,INVALID_BROADCAST_ID:2027,INVALID_ENDPOINT_CONFIG:2028,INVALID_E2EE_STATE:2029,SFU_MODE_PREVENTED:2030,INVALID_CONFERENCE_STATE:2031,JOIN_REQUEST_DENIED:2032,EMPTY_USER_IDS:2033,MISSING_SDP_CONNECT_REQUEST:2034,CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:2035,MISSING_BODY_ENDPOINT:2101,MISSING_BODY_HEADER:2102,MISSING_BODY_BODY:2103,MISSING_BODY_PARAMS:2104,MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:2105,MISSING_BODY_DATA_MESSAGE_REQUEST:2106,MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:2107,MISSING_BODY_ADD_PARTICIPANTS_REQUEST:2108,MISSING_BODY_SUBSCRIPTION_REQUEST:2110,MISSING_BODY_JOIN_REQUEST:2111,MISSING_BODY_HANGUP_REQUEST:2112,MISSING_BODY_ICE_CANDIDATE_REQUEST:2113,MISSING_BODY_P2P_MESSAGE_REQUEST:2114,MISSING_BODY_UPDATE_REQUEST:2115,MISSING_BODY_CLIENT_EVENT_REQUEST:2116,MISSING_BODY_CONNECT_REQUEST:2117,MISSING_BODY_UNSUBSCRIBE_REQUEST:2118,MISSING_BODY_APPROVAL_REQUEST:2119,MISSING_ENDPOINT_USER_ID:2120,EMPTY_ENDPOINT_USER_ID:2121,MISSING_BODY_TRANSFER_REQUEST:2122,MISSING_BODY_GENERIC:2199,REQUESTOR_NOT_MEMBER_CONFERENCE:3002,NOT_BROADCAST_OWNER:3003,GUEST_NOT_INVITED:3004,GUEST_DISCONNECTED:3005,GUEST_INVITATION_EXPIRED:3006,PARTICIPANT_IN_PENDING_APPROVAL_STATE:3008,INVALID_MULTIWAY_PARAMS:3009,BROADCAST_ALREADY_STOPPED:4002,FAILED_TO_GENERATE_SDP_ANSWER:4003,FAILED_GENERATE_SESSION_DESCRIPTION:4004,SDP_SESSION_ID_MISMATCH:4005,MEDIA_ENDPOINT_GONE:4007,MEDIA_ENDPOINT_ALREADY_EXISTS:4008,MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:4009,LEGACY_MESSENGER_SENDER_UNSET:4010,FAILED_TO_SET_TRANSPORT_INFO:4011,NON_PRIMARY_MULTIWAY_SERVER:4012,FAILED_TO_GET_REMOTE_DESCRIPTION:4013,LOCAL_DESCRIPTION_NOT_SET:4014,INVALID_SDP_TYPE:4015,CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:4016,SDP_UNSET_ON_P2P_ANSWER:4017,MISSING_ICE_CANDIDATE_PAYLOAD:4018,P2P_PROTOCOL_UNSET:4019,CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:4020,LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:4021,CONNECT_UNSUPPORTED_IN_SFU_MODE:4022,CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:4023,RESOLVE_STATE_API_ERROR:4024,EXTERNAL_RESOLUTION_ERROR:4025,INTERNAL_RESOLUTION_ERROR:4026,RESOLUTION_DISABLED:4027,BROADCAST_ID_MISSING:4028,SDP_UNSET_ON_P2P_OFFER:4029,LEGACY_OFFER_MISSING_REQUIRED_VALUE:4031,MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:4032,CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:4033,OTHER_USER_ANSWERED_THE_CALL:4034,MEDIA_SERVER_DESERIALIZATION_ERROR:4035,REMOTE_SDP_TRACKID_MISMATCH:4036,SIGNALING_MESSAGE_TO_CLIENT_DROPPED:4037,DATA_CHANNEL_ENDPOINT_GONE:4038,DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:4039,CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:4040,P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:4041,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:4042,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:4043,REQUEST_TIMEOUT:4044,TOO_MANY_MEDIA_TRACKS_IN_SDP:4045,CONFERENCE_NOT_FOUND:5001,CONFERENCE_IS_TERMINATING:5002,CONFERENCE_IS_TERMINATED:5003,CONFERENCE_NAME_EMPTY:5004,NONCE_EMPTY:5005,NONCE_MISMATCH:5006,CONFERENCE_HAS_GONE:5007,PARTICIPANT_HAS_GONE:5008,MEDIA_SERVER_NOT_FOUND:5009,CLIENT_TERMINATED:5010,JOIN_SESSION_RESULT_MISSING:5012,LOGGING_POLICY_RESULT_MISSING:5013,INVITE_USERS_RESULT_MISSING:5014,STATE_SYNC_RESULT_MISSING:5015,ENDPOINT_INFO_RESULT_MISSING:5016,CONFERENCE_NAME_MISMATCH:5017,UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:5018,SESSION_CONFIGURATION_RESULT_MISSING:5019,REMOVE_USERS_RESULT_MISSING:5020,MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:6001,CONFERENCE_INCAPABLE_RENEGOTIATION:6002,REJECTING_CMU_WHEN_SMU_PENDING:6003,PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:6004,PARTICIPANT_ALREADY_IN_WAITING_ROOM:6005,PARTICIPANT_NOT_IN_PENDING_APPROVAL:6006,USER_NOT_APPROVER_FOR_TARGET_USER:6007,UNSUPPORTED_CAPABILITIES:6008,PRODUCT_SERVER_DEFINED_END_REASON:6009,WWW_KILLSWITCHED_REQUEST:6010,CONFLICTING_MEDIA_PATH:6011,CONFLICTING_MEDIA_STATUS:6012,CONFLICTING_SESSION_DESCRIPTION:6013,OK:9e3}),c=e({NONE:0,INFO:1,ERROR:2}),d=e({SUCCESS:0,ERROR:1,SESSION_NOT_FOUND:10,SESSION_MISMATCH:11,SESSION_TERMINATING:12,CONNECTION_ALREADY_EXIST:20,CONNECTION_OLD_EXIST:21,CONNECTION_NOT_FOUND:23,CONNECTION_MISMATCH:24,SDP_INVALID:30,SDP_NEGOTIATION_FAILED:31,EXCEEDED_MAX_PARTICIPANT_COUNT:40,UNAUTHORIZED:50}),m=e({JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,PING:18,UPDATE:20,NOTIFY:21,CONNECT:22,CLIENT_EVENT:23,UNSUBSCRIBE:25,APPROVAL:26,TRANSFER:27,WAKEUP:28}),p=e({IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5,SESSION_MIGRATED:6,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:7,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:8,WEBRTC_ERROR:9,CONNECTION_DROPPED:10}),_=e({CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7,CALL_ENDED_BY_PRODUCT:9,JOIN_APPROVAL_DENIED:10,JOIN_APPROVAL_TIMEDOUT:11,UNSUPPORTED_VERSION:12,LIVE_NOT_ACKED:13,TX_ACK_TIMEDOUT:14,ANSWERED_BY_OTHER_USER:15,PARTICIPANT_SELF_TERMINATION:16,PARTICIPANT_REJOIN:17,LONG_LASTING_AUDIO_ISSUE:18,PRIMARY_ENDPOINT_HANGUP:19,RECONNECT_FAILED:20,E2EE_HARDENING_ERROR:21,CALL_ENDED_BY_EXTENSION:22,CALL_ENDED_BY_OVER_CAPACITY:23}),f=e({SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4,SUPPORT_MWPP:5,REQUIRE_FULL_SDP_IN_SMU:6,SUPPORT_PRECONNECT:7,SUPPORT_MWPP_DEESCALATION:8,SUPPORT_PARTICIPANT_STATE_UNCALLABLE:9,SUPPORT_MULTIPLE_VIDEO_STREAMS:10,REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED:11,SUPPORT_MULTISTREAM_FEC:12,SUPPORT_DELTA_SMU:13,REQUIRE_DEFAULT_CHANNEL_SCREENSHARE:14,SUPPORT_SCREENSHARE_FLAG_IN_JOIN_RESPONSE_AND_SMU:15,SUPPORT_TEMPORAL_LAYER_JBE:16,REQUIRES_P2P_RELAY_INFO_VIA_SIGNALING:17,SUPPORT_NUMERIC_TOPICS:18,SUPPORT_PSEUDO_QUIC_CONNECTION:19,SUPPORT_SDP_SENDRECV:20}),g=e({GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6,LIVE_AUDIO_ROOM:7,LIVE_WITH_ROOM:8}),h=e({OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10}),y=e({ACTIVE:0,TERMINATED:1}),C=e({UNKNOWN:0,ACTIVE:1,TERMINATED:2}),b=e({DENIED:0,APPROVED:1}),v=e({UNKNOWN:0,SIGNALING_DATA_MESSAGE:1,STATE_SYNC_UPDATE:2,STATE_SYNC_SNAPSHOT:3}),S=e({UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11,RING_TYPE_UNSUPPORTED:12,PENDING_APPROVAL:13,APPROVED:14,FAILED_APPROVAL:15,HANGUP_IN_WAITING_ROOM:16,UNCALLABLE:17,UNCALLABLE_DELAYED:18}),R=e({PRANSWER:1001,INITIAL_ANSWER_TO_P2P_CALLER:1002,DEESCALATE_OFFER_TO_P2P_CALLEE:1003,DEESCALATE_ANSWER_TO_P2P_CALLER:1004,REQUEST_DEESCALATE_TO_P2P_CALLER:1005,REQUEST_ESCALATE:1006,REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:1007,REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:1008,PARTICIPANT_ADDED:1009,PARTICIPANT_REMOVED:1010,FIRST_REMOTE_ALERTED_FOR_INITIATOR:2001,FIRST_REMOTE_ANSWERED_FOR_INITIATOR:2002,CONTAIN_PENDING_APPROVAL_PARTICIPANTS:2003,KEEP_ALIVE_PING:3001,IS_INITIATOR:4001,PREGEN_SDP:4002}),L=e({PRIMARY:0,SECONDARY:1}),E=e({UNKNOWN:0,MEDIA_CONNECTED:1}),k=e({JoinRequest:"joinRequest",JoinResponse:"joinResponse",ServerMediaUpdateRequest:"serverMediaUpdateRequest",ServerMediaUpdateResponse:"serverMediaUpdateResponse",HangupRequest:"hangupRequest",IceCandidateRequest:"iceCandidateRequest",RingRequest:"ringRequest",RingResponse:"ringResponse",DismissRequest:"dismissRequest",ConferenceStateRequest:"conferenceStateRequest",ConferenceStateResponse:"conferenceStateResponse",AddParticipantsRequest:"addParticipantsRequest",SubscriptionRequest:"subscriptionRequest",ClientMediaUpdateRequest:"clientMediaUpdateRequest",ClientMediaUpdateResponse:"clientMediaUpdateResponse",DataMessageRequest:"dataMessageRequest",RemoveParticipantsRequest:"removeParticipantsRequest",DataMessageResponse:"dataMessageResponse",UpdateRequest:"updateRequest",UpdateResponse:"updateResponse",NotifyRequest:"notifyRequest",NotifyResponse:"notifyResponse",ConnectRequest:"connectRequest",ConnectResponse:"connectResponse",ClientEventRequest:"clientEventRequest",ClientEventResponse:"clientEventResponse",UnsubscribeRequest:"unsubscribeRequest",UnsubscribeResponse:"unsubscribeResponse",ApprovalRequest:"approvalRequest",TransferRequest:"transferRequest"});a.exports={ApprovalStatus:b,Capability:f,ClientEventType:E,DeviceStatus:h,DismissReason:_,E2eeDataMessageType:v,ExtensionSessionStatus:C,HangupReason:p,JoinMode:L,MediaConnectionStatus:y,MessageTag:R,MessageType:m,ParticipantCallState:S,RingType:g,RtcApiStatusCode:d,RtcLogSeverity:c,RtcMessageBodyVariant$Types:k,RtcResponseStatusCode:s,RtcResponseSubCode:u,SdpPayloadType:l}}),null);
__d("StateSyncSerializers",["ThriftTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{version:0}}function u(){return{stateStore:{}}}function c(t,n){if(n.writeStructBegin("State"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.version!=null)n.writeI32(t.version);else{var o=0;n.writeI32(o)}n.writeFieldEnd(),t.data!=null&&(n.writeFieldBegin({fname:"data",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.data),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function d(t,n){if(n.writeStructBegin("Snapshot"),n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.stateStore!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var o of Object.entries(t.stateStore)){var a=o[0],i=o[1];n.writeString(a),c(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],d=s[1];n.writeString(u),c(d,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function m(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version=0),n}function p(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readString(),c=m(t);n.stateStore[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.stateStore===void 0&&(n.stateStore={}),n}l.State$DefaultConstructor=s,l.Snapshot$DefaultConstructor=u,l.serializeState=c,l.serializeSnapshot=d,l.deserializeState=m,l.deserializeSnapshot=p}),98);
__d("StateSyncTopicsConfigTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({UNKNOWN:0,INTERNAL:1,EXTERNAL:2}),s=e({UNKNOWN:0,PARTICIPANT_JOIN:100,PARTICIPANT_UPDATE:101,PARTICIPANT_LEAVE:102,PARTICIPANT_NEGOTIATED:103,PARTICIPANT_SDP_CHANGED:104,EXTENSION_CREATION:201,EXTENSION_JOIN:202,EXTENSION_UPDATE:203,EXTENSION_LEAVE:204,EXTENSION_REQUEST:205,CONFERENCE_UPDATE:501,DOMINANT_SPEAKER_UPDATE:1001,MEDIA_ASPECT_RATIO_UPDATE:1002,TIMER_FIRED:1003,MEDIA_PATH_CHANGED:1004,PARTICIPANTS_ACKED_MEDIA:1005}),u=e({UNKNOWN:0,ANY_PARTICIPANT_SUBSCRIBED:1,ALWAYS_RESOLVE:2}),c=e({CACHIUS:1,IRIS:2}),d=e({Config_engine:1,E2eeState:2,Media_information:3,Breakout:4,Countdown_timer:5,Effect_match:6,Emoji_reactions:7,Entered_avatars_mode:8,Moderator_controls:9,Polls:10,Raised_hands_queue:11,Xac_calling:12,Action_items:13,Can_you_see_my_screen:14,Collage:15,Companion:16,Coplay:17,Coview:18,Custom_video_capabilities:19,Dropin:20,Dtmf:21,E2ee_v2_msg:22,Effect_sync:23,Et_pluto_activity:24,Et_pluto_session:25,Et_test_activity:26,Et_test_session:27,Et_tubi_activity:28,Et_tubi_session:29,External_resolution_enabled:30,Hyperspace_copresence_state:31,Hyperspace_mic_state:32,Intenticons:33,Live_stream:34,Live_stream_app_message:35,Max_video_subscriptions:36,Media_sync:37,Media_sync_autoplay:38,Meeting_assistant:39,Meeting_transcription:40,Morpheo_grid:41,Multipeer_ar:42,Number_of_people:43,Opaque_blob:44,Photo_booth:45,Qna:46,Quizzes:47,Reactions:48,Role_assignments:49,Room_features_availability:50,Rooms_notes:51,Screenshare_floor_control:52,Screenshare_single_floor_control:53,Sctp_negotiation:54,Sideband:55,Simple:56,Simple_external:57,Simple_pass_through:58,Simple_passthrough:59,Snippets:60,Sound_effects:61,Whiteboard:62,Whiteboard_messenger:63,Workroom:64,Workrooms_ask_everyone_to_open:65,Workrooms_vr:66,Avatar_transport_state:67,Ambisonic:68,Cathode_extension:69,Biz_calling:70,Work_costreaming:71,Conversation_bot:72,Voip_zone:73,Admin_initiated_casting:74,Smart_glasses_assistant:75,Codec_avatar_2d:76,Custom_media_routing:77,Generic_floor_control:78});a.exports={CryptoAuthVerifierIdentity:c,DataSource:s,DataSourceCondition:u,ResolutionPath:l,TopicId:d}}),null);
__d("WebrtcEnumsTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum"))({OFFER:0,ANSWER:1,ICE_CANDIDATE:2,OK:3,HANG_UP:4,OTHER_DISMISS:5,PRANSWER:7,PING:8,PING_ACK:9,ICE_RESTART_OFFER:10,ICE_RESTART_ANSWER:11,OFFER_ACK:12,ANSWER_ACK:13,NOTIFY_MEDIA_STATE:14,ACK:15,INVALID:16,OFFER_NACK:17,NACK:18,VIDEO_REQUEST:19,SDP_UPDATE:20,SWITCH_TO_MULTIWAY:28,NEGOTIATE:30,PR_OFFER_ACK:32,CLIENT_REPORTED_EVENT:33}),s=e({OFFER:0,ANSWER:1}),u=e({LL_NIL:0,LL_BASIC:1,LL_DEBUG:2,LL_WARNING:3,LL_INFO:4,LL_VERBOSE:5}),c=e({IGNORE_CALL:0,HANGUP_CALL:1,IN_ANOTHER_CALL:2,ACCEPT_AFTER_HANGUP:3,NO_ANSWER_TIMEOUT:4,INCOMING_TIMEOUT:5,OTHER_INSTANCE_HANDLED:6,SIGNALING_MESSAGE_FAILED:7,CONNECTION_DROPPED:8,CLIENT_INTERRUPTED:9,WEBRTC_ERROR:10,CLIENT_ERROR:11,NO_PERMISSION:12,OTHER_NOT_CAPABLE:13,NO_UI_ERROR:14,UNSUPPORTED_VERSION:15,CALLER_NOT_VISIBLE:16,CARRIER_BLOCKED:17,OTHER_CARRIER_BLOCKED:18,CLIENT_ENCRYPTION_ERROR:19,MICROPHONE_PERMISSION_DENIED:20,CAMERA_PERMISSION_DENIED:21,SESSION_MIGRATED:22,RING_MUTED:23,MAX_ALLOWED_PARTICIPANTS_REACHED:24,CALLEE_REQUIRES_MULTIWAY:25,LIVE_NOT_ACKED:26,TX_ACK_TIMEDOUT:27,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:28,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:29,ANSWERED_BY_OTHER_USER:30,LONG_LASTING_AUDIO_ISSUE:31,ADMIN_CALLING_OWN_PAGE:32,PAGE_CALLS_BLOCKED:33}),d=e({UDP:0,TCP:1,SSLTCP:2}),m=e({HOST:0,SERVER_REFLEXIVE:1,PEER_REFLEXIVE:2,RELAY:3}),p=e({TCPTYPE_NONE:0,TCPTYPE_PASSIVE:1,TCPTYPE_ACTIVE:2,TCPTYPE_SIMOPEN:3}),_=e({SENDONLY:0,SENDRECV:1,RECVONLY:2,INACTIVE:3}),f=e({AUDIO:0,VIDEO:1,DATA:2}),g=e({AUDIO:0,VIDEO:1,SCREEN:2}),h=e({AES_CM_128_HMAC_SHA1_80:0,AES_CM_128_HMAC_SHA1_32:1,F8_128_HMAC_SHA1_80:2,AEAD_AES_256_GCM:8}),y=e({RTP_SAVPF:0,DTLS_SCTP:1,SCTP:2}),C=e({URN_IETF_PARAMS_RTP_HDREXT_SSRC_AUDIO_LEVEL:0,URN_IETF_PARAMS_RTP_HDREXT_TOFFSET:1,IETF_DRAFT_HOLMER_RMCAT_TRANSPORT_WIDE_CC_01:2,URN_3GPP_VIDEO_ORIENTATION:3,ABS_SEND_TIME:4,PLAYOUT_DELAY:5,VIDEO_CONTENT_TYPE:6,VIDEO_TIMING:7,RTP_MID:8,RTP_STREAM_ID:9,RTP_REPAIRED_STREAM_ID:10,ENCRYPT_EXTENSIONS:11,FRAME_MARKING:12,GENERIC_FRAME_DESCRIPTOR:13,RTP_LOSS_INFO:14,RTP_CONGESTION_INFO:15,RTP_AUDIO_DROP_INFO:16,FRAME_ENCRYPTION_INFO:17,GENERIC_FRAME_DESCRIPTOR_01:18,DEPENDENCY_DESCRIPTOR:19,COLOR_SPACE:20,ABS_CAPTURE_TIME:21,VIDEO_FRAME_TRACKING_ID:22,VIDEO_FRAME_INFO:23}),b=e({ISAC:0,SPEEX_ISAC_OBSOLETE:1,SPEEX:2,OPUS:3,PCMU_OBSOLETE:4,PCMA_OBSOLETE:5,CN:6,TELEPHONE_EVENT:7,VP8:8,RED:9,ULPFEC:10,H264:17,ISPX_WB_2:32,GOOGLE_DATA:33,AAC:36,AAC_LD:37,VP9:96,GOOGLE_SCTP_DATA:97,H265:98,RTX:99,FLEXFEC:100,MULTIPLEX:101,VIDEO_DATA:102,AV1:103,MLOW:104,MLOW_RED:105,RSFEC:106}),v=e({SILENCEBIT_OBSOLETE:0,SPEEXUSEJITTERBIT_OBSOLETE:1,USEINBANDFEC:2,USEADAPTIVEFEC_OBSOLETE:3,EXTERNALBWE_OBSOLETE:4,FEC_BEI_OBSOLETE:5,ISPX_ADAPTIVE_FEC:6,CBR:7,USEDTX:8}),S=e({MINPTIME:0,MAXAVERAGEBITRATE:1,SPROP_STEREO:2,STEREO:3,MAXPTIME:4,PTIME:5,FEC_BEI_OBSOLETE:6,PORT:7,H264PROFILELEVELID:8,PACKETIZATION_MODE:9,LEVEL_ASYMMETRY_ALLOWED:10,APT:11,MAXPLAYBACKRATE:12,REPAIR_WINDOW:13,EMPTY_KEY:14}),R=e({CR_NONE:0,CR_ACTIVE:1,CR_PASSIVE:2,CR_ACTPASS:3,CR_HOLDCONN:4}),L=e({EVENT_NONE:0,EVENT_MEDIA_CONNECTED:1});a.exports={CallEndReason:c,ClientReportedEventType:L,CodecName:b,CodecOption:S,CodecOptionBoolean:v,ConnectionRole:R,CryptoSuite:h,ExtmapUris:C,IceCandidateProtocolType:m,IceCandidateTcpType:p,IceCandidateTransport:d,MediaProtocol:y,MediaType:f,PayloadType:l,SdpNegotiateType:s,SendRecvMode:_,StreamType:g,UploadLogLevel:u}}),null);
__d("WebrtcSdpSerializers",["ThriftTypes","WebrtcEnumsTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){return{}}function u(){return{msid:"stream_label"}}function c(){return{id:""}}function d(){return{bwtype:"",bw:0}}function m(){return{numAudioChannels:1}}function p(){return{id:1,extensionAttributes:[]}}function _(){return{}}function f(){return{componentId:1,transport:o("WebrtcEnumsTypes").IceCandidateTransport.cast(0),generation:0}}function g(){return{port:1,protocol:o("WebrtcEnumsTypes").MediaProtocol.cast(0),sendRecvMode:o("WebrtcEnumsTypes").SendRecvMode.cast(1),hasRtcpMux:!0}}function h(){return{supportsMsid:!0}}function y(){return{}}function C(t,n){if(n.writeStructBegin("SsrcGroup"),t.semantics!=null&&(n.writeFieldBegin({fname:"semantics",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.semantics),n.writeFieldEnd()),t.ssrcIds!=null){n.writeFieldBegin({fname:"ssrcIds",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.I32,size:t.ssrcIds.length});for(var o of t.ssrcIds)n.writeI32(o);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function b(t,n){if(n.writeStructBegin("SsrcObject"),t.ssrcId!=null&&(n.writeFieldBegin({fname:"ssrcId",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.ssrcId),n.writeFieldEnd()),t.cname!=null&&(n.writeFieldBegin({fname:"cname",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.cname),n.writeFieldEnd()),n.writeFieldBegin({fname:"msid",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),t.msid!=null)n.writeString(t.msid);else{var o="stream_label";n.writeString(o)}n.writeFieldEnd(),t.msidAppData!=null&&(n.writeFieldBegin({fname:"msidAppData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.msidAppData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function v(t,n){if(n.writeStructBegin("RtcpFbVal"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.id!=null)n.writeString(t.id);else{var o="";n.writeString(o)}n.writeFieldEnd(),t.param!=null&&(n.writeFieldBegin({fname:"param",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.param),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function S(t,n){if(n.writeStructBegin("Bandwidth"),n.writeFieldBegin({fname:"bwtype",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.bwtype!=null)n.writeString(t.bwtype);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"bw",ftype:e.I32,fid:2}),t.bw!=null)n.writeI32(t.bw);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function R(t,n){if(n.writeStructBegin("CodecDescription"),t.payloadType!=null&&(n.writeFieldBegin({fname:"payloadType",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:1}),n.writeByte(t.payloadType),n.writeFieldEnd()),t.encodingName!=null){var o;n.writeFieldBegin({fname:"encodingName",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((o=t.encodingName)!=null?o:0),n.writeFieldEnd()}if(t.clockRateKhz!=null&&(n.writeFieldBegin({fname:"clockRateKhz",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:3}),n.writeByte(t.clockRateKhz),n.writeFieldEnd()),n.writeFieldBegin({fname:"numAudioChannels",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:4}),t.numAudioChannels!=null)n.writeByte(t.numAudioChannels);else{var a=1;n.writeByte(a)}if(n.writeFieldEnd(),t.fmtParameters!=null){n.writeFieldBegin({fname:"fmtParameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:5}),n.writeMapBegin({ktype:e.I32,vtype:e.STRING,size:Object.keys(t.fmtParameters).length});for(var i of Object.entries(t.fmtParameters)){var l,s=i[0],u=i[1];n.writeI32((l=Number(s))!=null?l:0),n.writeString(u)}n.writeMapEnd(),n.writeFieldEnd()}if(t.enabledOptions!=null){n.writeFieldBegin({fname:"enabledOptions",ftype:(e||(e=r("ThriftTypes"))).SET,fid:6}),n.writeSetBegin({etype:e.I32,size:t.enabledOptions.size});for(var c of t.enabledOptions)n.writeI32(c!=null?c:0);n.writeSetEnd(),n.writeFieldEnd()}if(t.rtcpFbParameters!=null){n.writeFieldBegin({fname:"rtcpFbParameters",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRING,size:Object.keys(t.rtcpFbParameters).length});for(var d of Object.entries(t.rtcpFbParameters)){var m=d[0],p=d[1];n.writeString(m),n.writeString(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.rtcpFbParamList!=null){n.writeFieldBegin({fname:"rtcpFbParamList",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:10}),n.writeListBegin({etype:e.STRUCT,size:t.rtcpFbParamList.length});for(var _ of t.rtcpFbParamList)v(_,n);n.writeListEnd(),n.writeFieldEnd()}t.videoWidth!=null&&(n.writeFieldBegin({fname:"videoWidth",ftype:(e||(e=r("ThriftTypes"))).I32,fid:8}),n.writeI32(t.videoWidth),n.writeFieldEnd()),t.videoHeight!=null&&(n.writeFieldBegin({fname:"videoHeight",ftype:(e||(e=r("ThriftTypes"))).I32,fid:9}),n.writeI32(t.videoHeight),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function L(t,n){if(n.writeStructBegin("Extmap"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.id!=null)n.writeI32(t.id);else{var o=1;n.writeI32(o)}if(n.writeFieldEnd(),t.uri!=null){var a;n.writeFieldBegin({fname:"uri",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((a=t.uri)!=null?a:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"extensionAttributes",ftype:e.LIST,fid:3}),t.extensionAttributes!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.extensionAttributes.length});for(var i of t.extensionAttributes)n.writeI32(i!=null?i:0);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:l.length});for(var s of l)n.writeI32(s!=null?s:0);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function E(t,n){if(n.writeStructBegin("CryptoParam"),t.tag!=null&&(n.writeFieldBegin({fname:"tag",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32(t.tag),n.writeFieldEnd()),t.suite!=null){var o;n.writeFieldBegin({fname:"suite",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),n.writeI32((o=t.suite)!=null?o:0),n.writeFieldEnd()}t.keyParams!=null&&(n.writeFieldBegin({fname:"keyParams",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.keyParams),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function k(t,n){if(n.writeStructBegin("IceCandidateSdp"),t.foundation!=null&&(n.writeFieldBegin({fname:"foundation",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.foundation),n.writeFieldEnd()),n.writeFieldBegin({fname:"componentId",ftype:(e||(e=r("ThriftTypes"))).BYTE,fid:2}),t.componentId!=null)n.writeByte(t.componentId);else{var a=1;n.writeByte(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transport",ftype:e.I32,fid:3}),t.transport!=null){var i;n.writeI32((i=t.transport)!=null?i:0)}else{var l=o("WebrtcEnumsTypes").IceCandidateTransport.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.priority!=null&&(n.writeFieldBegin({fname:"priority",ftype:(e||(e=r("ThriftTypes"))).I32,fid:4}),n.writeI32(t.priority),n.writeFieldEnd()),t.address!=null&&(n.writeFieldBegin({fname:"address",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.address),n.writeFieldEnd()),t.port!=null&&(n.writeFieldBegin({fname:"port",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32(t.port),n.writeFieldEnd()),t.protocolType!=null){var s;n.writeFieldBegin({fname:"protocolType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:7}),n.writeI32((s=t.protocolType)!=null?s:0),n.writeFieldEnd()}if(t.relatedAddress!=null&&(n.writeFieldBegin({fname:"relatedAddress",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:8}),n.writeString(t.relatedAddress),n.writeFieldEnd()),t.relatedPort!=null&&(n.writeFieldBegin({fname:"relatedPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:9}),n.writeI32(t.relatedPort),n.writeFieldEnd()),t.username!=null&&(n.writeFieldBegin({fname:"username",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.username),n.writeFieldEnd()),t.password!=null&&(n.writeFieldBegin({fname:"password",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:11}),n.writeString(t.password),n.writeFieldEnd()),n.writeFieldBegin({fname:"generation",ftype:e.I32,fid:12}),t.generation!=null)n.writeI32(t.generation);else{var u=0;n.writeI32(u)}if(n.writeFieldEnd(),t.tcptype!=null){var c;n.writeFieldBegin({fname:"tcptype",ftype:(e||(e=r("ThriftTypes"))).I32,fid:13}),n.writeI32((c=t.tcptype)!=null?c:0),n.writeFieldEnd()}t.networkId!=null&&(n.writeFieldBegin({fname:"networkId",ftype:(e||(e=r("ThriftTypes"))).I16,fid:14}),n.writeI16(t.networkId),n.writeFieldEnd()),t.networkCost!=null&&(n.writeFieldBegin({fname:"networkCost",ftype:(e||(e=r("ThriftTypes"))).I16,fid:15}),n.writeI16(t.networkCost),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function I(t,n){if(n.writeStructBegin("MediaDescription"),t.mediaType!=null){var a;n.writeFieldBegin({fname:"mediaType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),n.writeI32((a=t.mediaType)!=null?a:0),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"port",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.port!=null)n.writeI32(t.port);else{var i=1;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"protocol",ftype:e.I32,fid:3}),t.protocol!=null){var l;n.writeI32((l=t.protocol)!=null?l:0)}else{var s=o("WebrtcEnumsTypes").MediaProtocol.cast(0);n.writeI32(s!=null?s:0)}if(n.writeFieldEnd(),t.fmt!=null&&(n.writeFieldBegin({fname:"fmt",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:22}),n.writeString(t.fmt),n.writeFieldEnd()),t.mediaIceUserFrag!=null&&(n.writeFieldBegin({fname:"mediaIceUserFrag",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.mediaIceUserFrag),n.writeFieldEnd()),t.mediaIcePassword!=null&&(n.writeFieldBegin({fname:"mediaIcePassword",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.mediaIcePassword),n.writeFieldEnd()),t.mediaIceOptions!=null){n.writeFieldBegin({fname:"mediaIceOptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:6}),n.writeListBegin({etype:e.STRING,size:t.mediaIceOptions.length});for(var u of t.mediaIceOptions)n.writeString(u);n.writeListEnd(),n.writeFieldEnd()}if(t.mediaSslFingerprintHash!=null&&(n.writeFieldBegin({fname:"mediaSslFingerprintHash",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:7}),n.writeString(t.mediaSslFingerprintHash),n.writeFieldEnd()),t.mediaSslFingerprintDigest!=null&&(n.writeFieldBegin({fname:"mediaSslFingerprintDigest",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:8}),n.writeString(t.mediaSslFingerprintDigest),n.writeFieldEnd()),t.extmaps!=null){n.writeFieldBegin({fname:"extmaps",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.extmaps.length});for(var c of t.extmaps)L(c,n);n.writeListEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"sendRecvMode",ftype:e.I32,fid:10}),t.sendRecvMode!=null){var d;n.writeI32((d=t.sendRecvMode)!=null?d:0)}else{var m=o("WebrtcEnumsTypes").SendRecvMode.cast(1);n.writeI32(m!=null?m:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"hasRtcpMux",ftype:e.BOOL,fid:11}),t.hasRtcpMux!=null)n.writeBool(t.hasRtcpMux);else{var p=!0;n.writeBool(p)}if(n.writeFieldEnd(),t.rtcpReducedSize!=null&&(n.writeFieldBegin({fname:"rtcpReducedSize",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:25}),n.writeBool(t.rtcpReducedSize),n.writeFieldEnd()),t.cryptoParams!=null){n.writeFieldBegin({fname:"cryptoParams",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:12}),n.writeListBegin({etype:e.STRUCT,size:t.cryptoParams.length});for(var _ of t.cryptoParams)E(_,n);n.writeListEnd(),n.writeFieldEnd()}if(t.codecs!=null){n.writeFieldBegin({fname:"codecs",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:13}),n.writeListBegin({etype:e.STRUCT,size:t.codecs.length});for(var f of t.codecs)R(f,n);n.writeListEnd(),n.writeFieldEnd()}if(t.maxPTime!=null&&(n.writeFieldBegin({fname:"maxPTime",ftype:(e||(e=r("ThriftTypes"))).I32,fid:14}),n.writeI32(t.maxPTime),n.writeFieldEnd()),t.pTime!=null&&(n.writeFieldBegin({fname:"pTime",ftype:(e||(e=r("ThriftTypes"))).I32,fid:15}),n.writeI32(t.pTime),n.writeFieldEnd()),t.ssrcObjects!=null){n.writeFieldBegin({fname:"ssrcObjects",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:16}),n.writeListBegin({etype:e.STRUCT,size:t.ssrcObjects.length});for(var g of t.ssrcObjects)b(g,n);n.writeListEnd(),n.writeFieldEnd()}if(t.candidates!=null){n.writeFieldBegin({fname:"candidates",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:17}),n.writeListBegin({etype:e.STRUCT,size:t.candidates.length});for(var h of t.candidates)k(h,n);n.writeListEnd(),n.writeFieldEnd()}if(t.conferenceMode!=null&&(n.writeFieldBegin({fname:"conferenceMode",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:18}),n.writeBool(t.conferenceMode),n.writeFieldEnd()),t.ssrcGroups!=null){n.writeFieldBegin({fname:"ssrcGroups",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:19}),n.writeListBegin({etype:e.STRUCT,size:t.ssrcGroups.length});for(var y of t.ssrcGroups)C(y,n);n.writeListEnd(),n.writeFieldEnd()}if(t.connectionRole!=null){var v;n.writeFieldBegin({fname:"connectionRole",ftype:(e||(e=r("ThriftTypes"))).I32,fid:20}),n.writeI32((v=t.connectionRole)!=null?v:0),n.writeFieldEnd()}t.mid!=null&&(n.writeFieldBegin({fname:"mid",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:21}),n.writeString(t.mid),n.writeFieldEnd()),t.bandwidth!=null&&(n.writeFieldBegin({fname:"bandwidth",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:23}),S(t.bandwidth,n),n.writeFieldEnd()),t.sctpPort!=null&&(n.writeFieldBegin({fname:"sctpPort",ftype:(e||(e=r("ThriftTypes"))).I32,fid:24}),n.writeI32(t.sctpPort),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function T(t,n){if(n.writeStructBegin("SessionDescription"),t.sessionId!=null&&(n.writeFieldBegin({fname:"sessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sessionId),n.writeFieldEnd()),t.sessionVersion!=null&&(n.writeFieldBegin({fname:"sessionVersion",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.sessionVersion),n.writeFieldEnd()),n.writeFieldBegin({fname:"supportsMsid",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:3}),t.supportsMsid!=null)n.writeBool(t.supportsMsid);else{var o=!0;n.writeBool(o)}if(n.writeFieldEnd(),t.useIceLite!=null&&(n.writeFieldBegin({fname:"useIceLite",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:4}),n.writeBool(t.useIceLite),n.writeFieldEnd()),t.features!=null){n.writeFieldBegin({fname:"features",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:5}),n.writeListBegin({etype:e.STRING,size:t.features.length});for(var a of t.features)n.writeString(a);n.writeListEnd(),n.writeFieldEnd()}if(t.connectionRole!=null){var i;n.writeFieldBegin({fname:"connectionRole",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((i=t.connectionRole)!=null?i:0),n.writeFieldEnd()}if(t.bandwidth!=null&&(n.writeFieldBegin({fname:"bandwidth",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),S(t.bandwidth,n),n.writeFieldEnd()),t.transportBundle!=null){n.writeFieldBegin({fname:"transportBundle",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:8}),n.writeListBegin({etype:e.STRING,size:t.transportBundle.length});for(var l of t.transportBundle)n.writeString(l);n.writeListEnd(),n.writeFieldEnd()}if(t.commonCryptos!=null){n.writeFieldBegin({fname:"commonCryptos",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.commonCryptos.length});for(var s of t.commonCryptos)E(s,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function D(t,n){if(n.writeStructBegin("Sdp"),t.sessionDescription!=null&&(n.writeFieldBegin({fname:"sessionDescription",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),T(t.sessionDescription,n),n.writeFieldEnd()),t.mediaDescriptions!=null){n.writeFieldBegin({fname:"mediaDescriptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.mediaDescriptions.length});for(var o of t.mediaDescriptions)I(o,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function x(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.semantics=t.readString():t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.ssrcIds=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=t.readI32();n.ssrcIds.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function $(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.ssrcId=t.readI32():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.cname=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.msid=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.msidAppData=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.msid===void 0&&(n.msid="stream_label"),n}function P(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.param=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=""),n}function N(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.bwtype=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.bw=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.bwtype===void 0&&(n.bwtype=""),n.bw===void 0&&(n.bw=0),n}function M(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).BYTE?n.payloadType=t.readByte():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.encodingName=o("WebrtcEnumsTypes").CodecName.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).BYTE?n.clockRateKhz=t.readByte():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BYTE?n.numAudioChannels=t.readByte():t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).MAP){n.fmtParameters={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=o("WebrtcEnumsTypes").CodecOption.cast(t.readI32()),d=t.readString();c!=null&&(n.fmtParameters[c]=d)}}else t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).SET){n.enabledOptions=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=o("WebrtcEnumsTypes").CodecOptionBoolean.cast(t.readI32());n.enabledOptions.add(_)}}else t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.rtcpFbParameters={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=t.readString(),y=t.readString();n.rtcpFbParameters[h]=y}}else t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).LIST){n.rtcpFbParamList=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=P(t);n.rtcpFbParamList.push(v)}}else t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I32?n.videoWidth=t.readI32():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.videoHeight=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.numAudioChannels===void 0&&(n.numAudioChannels=1),n}function w(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.id=t.readI32():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.uri=o("WebrtcEnumsTypes").ExtmapUris.cast(t.readI32()):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.extensionAttributes=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("WebrtcEnumsTypes").ExtmapUris.cast(t.readI32());n.extensionAttributes.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=1),n.extensionAttributes===void 0&&(n.extensionAttributes=[]),n}function A(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.tag=t.readI32():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.suite=o("WebrtcEnumsTypes").CryptoSuite.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.keyParams=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function F(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.foundation=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).BYTE?n.componentId=t.readByte():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.transport=o("WebrtcEnumsTypes").IceCandidateTransport.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.priority=t.readI32():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.address=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.port=t.readI32():t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).I32?n.protocolType=o("WebrtcEnumsTypes").IceCandidateProtocolType.cast(t.readI32()):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRING?n.relatedAddress=t.readString():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).I32?n.relatedPort=t.readI32():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.username=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRING?n.password=t.readString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).I32?n.generation=t.readI32():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.tcptype=o("WebrtcEnumsTypes").IceCandidateTcpType.cast(t.readI32()):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).I16?n.networkId=t.readI16():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I16?n.networkCost=t.readI16():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.componentId===void 0&&(n.componentId=1),n.transport===void 0&&(n.transport=o("WebrtcEnumsTypes").IceCandidateTransport.cast(0)),n.generation===void 0&&(n.generation=0),n}function O(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.mediaType=o("WebrtcEnumsTypes").MediaType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.port=t.readI32():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.protocol=o("WebrtcEnumsTypes").MediaProtocol.cast(t.readI32()):t.skip(i);break;case 22:i===(e||(e=r("ThriftTypes"))).STRING?n.fmt=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaIceUserFrag=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaIcePassword=t.readString():t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).LIST){n.mediaIceOptions=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readString();n.mediaIceOptions.push(c)}}else t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaSslFingerprintHash=t.readString():t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).STRING?n.mediaSslFingerprintDigest=t.readString():t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.extmaps=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=w(t);n.extmaps.push(p)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).I32?n.sendRecvMode=o("WebrtcEnumsTypes").SendRecvMode.cast(t.readI32()):t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).BOOL?n.hasRtcpMux=t.readBool():t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).BOOL?n.rtcpReducedSize=t.readBool():t.skip(i);break;case 12:if(i===(e||(e=r("ThriftTypes"))).LIST){n.cryptoParams=[];for(var _=t.readListBegin(),f=0;f<_.size;f++){var g=A(t);n.cryptoParams.push(g)}}else t.skip(i);break;case 13:if(i===(e||(e=r("ThriftTypes"))).LIST){n.codecs=[];for(var h=t.readListBegin(),y=0;y<h.size;y++){var C=M(t);n.codecs.push(C)}}else t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).I32?n.maxPTime=t.readI32():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.pTime=t.readI32():t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcObjects=[];for(var b=t.readListBegin(),v=0;v<b.size;v++){var S=$(t);n.ssrcObjects.push(S)}}else t.skip(i);break;case 17:if(i===(e||(e=r("ThriftTypes"))).LIST){n.candidates=[];for(var R=t.readListBegin(),L=0;L<R.size;L++){var E=F(t);n.candidates.push(E)}}else t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).BOOL?n.conferenceMode=t.readBool():t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcGroups=[];for(var k=t.readListBegin(),I=0;I<k.size;I++){var T=x(t);n.ssrcGroups.push(T)}}else t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).I32?n.connectionRole=o("WebrtcEnumsTypes").ConnectionRole.cast(t.readI32()):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRING?n.mid=t.readString():t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bandwidth=N(t):t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).I32?n.sctpPort=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.port===void 0&&(n.port=1),n.protocol===void 0&&(n.protocol=o("WebrtcEnumsTypes").MediaProtocol.cast(0)),n.sendRecvMode===void 0&&(n.sendRecvMode=o("WebrtcEnumsTypes").SendRecvMode.cast(1)),n.hasRtcpMux===void 0&&(n.hasRtcpMux=!0),n}function B(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sessionId=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.sessionVersion=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).BOOL?n.supportsMsid=t.readBool():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).BOOL?n.useIceLite=t.readBool():t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).LIST){n.features=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=t.readString();n.features.push(c)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.connectionRole=o("WebrtcEnumsTypes").ConnectionRole.cast(t.readI32()):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.bandwidth=N(t):t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).LIST){n.transportBundle=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=t.readString();n.transportBundle.push(p)}}else t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.commonCryptos=[];for(var _=t.readListBegin(),f=0;f<_.size;f++){var g=A(t);n.commonCryptos.push(g)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.supportsMsid===void 0&&(n.supportsMsid=!0),n}function W(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.sessionDescription=B(t):t.skip(a);break;case 2:if(a===(e||(e=r("ThriftTypes"))).LIST){n.mediaDescriptions=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=O(t);n.mediaDescriptions.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}l.SsrcGroup$DefaultConstructor=s,l.SsrcObject$DefaultConstructor=u,l.RtcpFbVal$DefaultConstructor=c,l.Bandwidth$DefaultConstructor=d,l.CodecDescription$DefaultConstructor=m,l.Extmap$DefaultConstructor=p,l.CryptoParam$DefaultConstructor=_,l.IceCandidateSdp$DefaultConstructor=f,l.MediaDescription$DefaultConstructor=g,l.SessionDescription$DefaultConstructor=h,l.Sdp$DefaultConstructor=y,l.serializeSsrcGroup=C,l.serializeSsrcObject=b,l.serializeRtcpFbVal=v,l.serializeBandwidth=S,l.serializeCodecDescription=R,l.serializeExtmap=L,l.serializeCryptoParam=E,l.serializeIceCandidateSdp=k,l.serializeMediaDescription=I,l.serializeSessionDescription=T,l.serializeSdp=D,l.deserializeSsrcGroup=x,l.deserializeSsrcObject=$,l.deserializeRtcpFbVal=P,l.deserializeBandwidth=N,l.deserializeCodecDescription=M,l.deserializeExtmap=w,l.deserializeCryptoParam=A,l.deserializeIceCandidateSdp=F,l.deserializeMediaDescription=O,l.deserializeSessionDescription=B,l.deserializeSdp=W}),98);
__d("MultiwayCommonSerializers",["DataMessageSerializers","DataMessageTypes","MultiwayCommonTypes","MultiwaySharedSerializers","MultiwaySharedTypes","StateSyncSerializers","StateSyncTopicsConfigTypes","ThriftTypes","Utf8ToString","WebrtcSdpSerializers","WebrtcSignalingCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){var e;return{message:"",responseStatusCode:(e=o("MultiwayCommonTypes")).RtcResponseStatusCode.cast(0),responseSubCode:e.RtcResponseSubCode.cast(0),apiStatusCode:e.RtcApiStatusCode.cast(0),rtcLogSeverity:e.RtcLogSeverity.cast(0)}}function u(){return{}}function c(){return{media:{}}}function d(){return{body:"",msid:"",mid:""}}function m(){return{sourceKey:"",media:[],ssrcGroups:[]}}function p(){return{mediaStatus:{}}}function _(){return{sdpMLineIndex:"0",sdpMid:""}}function f(){return{stateStore:{},stateStoreV2:{}}}function g(){return{version:0}}function h(){return{encryptedTopic:"",encryptedData:Uint8Array.of(),senderId:Uint8Array.of(),messageType:o("MultiwayCommonTypes").E2eeDataMessageType.cast(0)}}function y(){return{fromVersion:"0",toVersion:"0",mediaUpdates:[]}}function C(){return{currentVersion:"0",mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0)}}function b(){return{callerUserId:"",calleeUserId:"",sessionId:""}}function v(){return{fromVersion:"0",toVersion:"0",mediaUpdates:[],renegotiationRequested:!1,multipleVideoStreamsAllowed:!1,mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),screenShareStreamAllowed:!1}}function S(){return{currentVersion:"0"}}function R(){return{}}function L(){return{reason:o("MultiwayCommonTypes").HangupReason.cast(0),detailedReasonString:""}}function E(){return{iceCandidateSdps:[]}}function k(){return{reason:o("MultiwayCommonTypes").DismissReason.cast(0),detailedReasonString:""}}function I(){return{joinMode:o("MultiwayCommonTypes").JoinMode.cast(0)}}function T(){return{state:o("MultiwayCommonTypes").ParticipantCallState.cast(0)}}function D(){return{}}function x(){return{}}function $(){return{}}function P(){return{version:"0",participantStates:{},groupsOfUsers:[]}}function N(){return{currentVersion:"0"}}function M(){return{subscriptions:[]}}function w(){return{message:o("DataMessageSerializers").DataMessage$DefaultConstructor()}}function A(){return{deliveryResult:{}}}function F(){return{usersToInvite:new Set}}function O(){return{smcTier:"",region:"",isUsfu:!1,isEdge:!1}}function B(){return{offer:u(),deviceCapabilities:new Set}}function W(){return{answer:u(),mediaStatus:{},initiator:"",isPendingApproval:!1,multipleVideoStreamsAllowed:!1,mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),groupsOfUsers:[],screenShareStreamAllowed:!1}}function q(){return{deviceCapabilities:new Set}}function U(){return{}}function V(){return{type:o("MultiwayCommonTypes").ClientEventType.cast(0)}}function H(){return{clientEvents:[]}}function G(){return{}}function z(){return{}}function j(){return{caller:"",otherParticipants:new Set,ringType:o("MultiwayCommonTypes").RingType.cast(0),mediaPath:o("MultiwaySharedTypes").MediaPath.cast(0),isTransferCall:!1}}function K(){return{deviceStatus:o("MultiwayCommonTypes").DeviceStatus.cast(0)}}function Q(){return{usersToRemove:new Set}}function X(){return{topic:"",version:0,topicId:o("StateSyncTopicsConfigTypes").TopicId.cast(0)}}function Y(){return{topic:"",version:0}}function J(){return{syncPayload:f(),topic:"",version:0,topicId:o("StateSyncTopicsConfigTypes").TopicId.cast(0)}}function Z(){return{topic:"",version:0}}function ee(){return{topic:"",version:0,data:Uint8Array.of()}}function te(){return{topic:"",version:0}}function ne(){return{approvalStatus:o("MultiwayCommonTypes").ApprovalStatus.cast(0),targetUsers:new Set}}function re(){return{id:""}}function oe(){return{actorId:"",baseId:""}}function ae(){return{type:o("MultiwayCommonTypes").MessageType.cast(0),conferenceName:"",transactionId:"",retryCount:0}}function ie(){return{}}function le(){return{messageHeader:ae(),messageBody:ie()}}function se(){return{users:new Set,allowMultipleJoins:!1,dismissOthersOnFirstJoin:!1,aliasId:""}}function ue(){return{}}function ce(t,n){if(n.writeStructBegin("RtcException"),n.writeFieldBegin({fname:"message",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.message!=null)n.writeString(t.message);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"responseStatusCode",ftype:e.I32,fid:2}),t.responseStatusCode!=null){var i;n.writeI32((i=t.responseStatusCode)!=null?i:0)}else{var l=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"responseSubCode",ftype:e.I32,fid:3}),t.responseSubCode!=null){var s;n.writeI32((s=t.responseSubCode)!=null?s:0)}else{var u=o("MultiwayCommonTypes").RtcResponseSubCode.cast(0);n.writeI32(u!=null?u:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"apiStatusCode",ftype:e.I32,fid:4}),t.apiStatusCode!=null){var c;n.writeI32((c=t.apiStatusCode)!=null?c:0)}else{var d=o("MultiwayCommonTypes").RtcApiStatusCode.cast(0);n.writeI32(d!=null?d:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"rtcLogSeverity",ftype:e.I32,fid:5}),t.rtcLogSeverity!=null){var m;n.writeI32((m=t.rtcLogSeverity)!=null?m:0)}else{var p=o("MultiwayCommonTypes").RtcLogSeverity.cast(0);n.writeI32(p!=null?p:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function de(t,n){n.writeStructBegin("SessionDescription"),t.sdpString!=null&&(n.writeFieldBegin({fname:"sdpString",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.sdpString),n.writeFieldEnd()),t.sdpThrift!=null&&(n.writeFieldBegin({fname:"sdpThrift",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),o("WebrtcSdpSerializers").serializeSdp(t.sdpThrift,n),n.writeFieldEnd()),t.sdpCompressionVersion!=null&&(n.writeFieldBegin({fname:"sdpCompressionVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.sdpCompressionVersion)),n.writeFieldEnd()),t.sdpCompressedData!=null&&(n.writeFieldBegin({fname:"sdpCompressedData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.sdpCompressedData),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function me(t,n){if(n.writeStructBegin("SessionDescriptionUpdate"),n.writeFieldBegin({fname:"media",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.media!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.media).length});for(var o of Object.entries(t.media)){var a=o[0],i=o[1];n.writeI32(Number(a)),pe(i,n)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeI32(Number(u)),pe(c,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function pe(t,n){if(n.writeStructBegin("MediaDescriptionUpdate"),n.writeFieldBegin({fname:"body",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.body!=null)n.writeString(t.body);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"msid",ftype:e.STRING,fid:2}),t.msid!=null)n.writeString(t.msid);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mid",ftype:e.STRING,fid:3}),t.mid!=null)n.writeString(t.mid);else{var i="";n.writeString(i)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function _e(t,n){if(n.writeStructBegin("ServerMediaUpdate"),n.writeFieldBegin({fname:"sourceKey",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.sourceKey!=null)n.writeString(t.sourceKey);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"media",ftype:e.LIST,fid:2}),t.media!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.media.length});for(var i of t.media)o("MultiwaySharedSerializers").serializeMedia(i,n);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:l.length});for(var s of l)o("MultiwaySharedSerializers").serializeMedia(s,n);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ssrcGroups",ftype:e.LIST,fid:3}),t.ssrcGroups!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.ssrcGroups.length});for(var u of t.ssrcGroups)o("MultiwaySharedSerializers").serializeSsrcGroup(u,n);n.writeListEnd()}else{var c=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:c.length});for(var d of c)o("MultiwaySharedSerializers").serializeSsrcGroup(d,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function fe(t,n){if(n.writeStructBegin("ClientMediaUpdate"),n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.mediaStatus!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var a of Object.entries(t.mediaStatus)){var i=a[0],l=a[1];n.writeString(i),n.writeBool(l)}n.writeMapEnd()}else{var s={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(s).length});for(var u of Object.entries(s)){var c=u[0],d=u[1];n.writeString(c),n.writeBool(d)}n.writeMapEnd()}n.writeFieldEnd(),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ge(t,n){if(n.writeStructBegin("IceCandidate"),t.candidateSdpString!=null&&(n.writeFieldBegin({fname:"candidateSdpString",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.candidateSdpString),n.writeFieldEnd()),n.writeFieldBegin({fname:"sdpMLineIndex",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),t.sdpMLineIndex!=null)n.writeI64(BigInt(t.sdpMLineIndex));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"sdpMid",ftype:e.STRING,fid:3}),t.sdpMid!=null)n.writeString(t.sdpMid);else{var i="";n.writeString(i)}n.writeFieldEnd(),t.candidateSdpThrift!=null&&(n.writeFieldBegin({fname:"candidateSdpThrift",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),o("WebrtcSdpSerializers").serializeIceCandidateSdp(t.candidateSdpThrift,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function he(t,n){if(n.writeStructBegin("SyncPayload"),n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.stateStore!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var a of Object.entries(t.stateStore)){var i=a[0],l=a[1];n.writeString(i),o("StateSyncSerializers").serializeState(l,n)}n.writeMapEnd()}else{var s={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(s).length});for(var u of Object.entries(s)){var c=u[0],d=u[1];n.writeString(c),o("StateSyncSerializers").serializeState(d,n)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"stateStoreV2",ftype:e.MAP,fid:4}),t.stateStoreV2!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var m of Object.entries(t.stateStoreV2)){var p,_=m[0],f=m[1];n.writeI32((p=Number(_))!=null?p:0),o("StateSyncSerializers").serializeState(f,n)}n.writeMapEnd()}else{var g={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).I32,vtype:e.STRUCT,size:Object.keys(g).length});for(var h of Object.entries(g)){var y,C=h[0],b=h[1];n.writeI32((y=Number(C))!=null?y:0),o("StateSyncSerializers").serializeState(b,n)}n.writeMapEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ye(t,n){if(n.writeStructBegin("SyncAck"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.version!=null)n.writeI32(t.version);else{var o=0;n.writeI32(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ce(t,n){if(n.writeStructBegin("E2eeData"),n.writeFieldBegin({fname:"encryptedTopic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.encryptedTopic!=null)n.writeString(t.encryptedTopic);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"encryptedData",ftype:e.STRING,fid:2}),t.encryptedData!=null)n.writeBinary(t.encryptedData);else{var i=Uint8Array.of();n.writeBinary(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"senderId",ftype:e.STRING,fid:3}),t.senderId!=null)n.writeBinary(t.senderId);else{var l=Uint8Array.of();n.writeBinary(l)}if(n.writeFieldEnd(),t.targetIds!=null){n.writeFieldBegin({fname:"targetIds",ftype:(e||(e=r("ThriftTypes"))).SET,fid:4}),n.writeSetBegin({etype:e.STRING,size:t.targetIds.size});for(var s of t.targetIds)n.writeBinary(s);n.writeSetEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"messageType",ftype:e.I32,fid:5}),t.messageType!=null){var u;n.writeI32((u=t.messageType)!=null?u:0)}else{var c=o("MultiwayCommonTypes").E2eeDataMessageType.cast(0);n.writeI32(c!=null?c:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function be(t,n){if(n.writeStructBegin("ClientMediaUpdateRequest"),n.writeFieldBegin({fname:"fromVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.fromVersion!=null)n.writeI64(BigInt(t.fromVersion));else{var o="0";n.writeI64(BigInt(o))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"toVersion",ftype:e.I64,fid:2}),t.toVersion!=null)n.writeI64(BigInt(t.toVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaUpdates",ftype:e.LIST,fid:3}),t.mediaUpdates!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.mediaUpdates.length});for(var i of t.mediaUpdates)fe(i,n);n.writeListEnd()}else{var l=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:l.length});for(var s of l)fe(s,n);n.writeListEnd()}n.writeFieldEnd(),t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),de(t.offer,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ve(t,n){if(n.writeStructBegin("ClientMediaUpdateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:6}),t.mediaPath!=null){var i;n.writeI32((i=t.mediaPath)!=null?i:0)}else{var l=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(l!=null?l:0)}if(n.writeFieldEnd(),t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var s of Object.entries(t.stateStore)){var u=s[0],c=s[1];n.writeString(u),o("StateSyncSerializers").serializeState(c,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:8}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var d of Object.entries(t.stateStoreV2)){var m,p=d[0],_=d[1];n.writeI32((m=Number(p))!=null?m:0),o("StateSyncSerializers").serializeState(_,n)}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Se(t,n){if(n.writeStructBegin("MultipleRelaysAllocationParameters"),n.writeFieldBegin({fname:"callerUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.callerUserId!=null)n.writeString(t.callerUserId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"calleeUserId",ftype:e.STRING,fid:2}),t.calleeUserId!=null)n.writeString(t.calleeUserId);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"sessionId",ftype:e.STRING,fid:3}),t.sessionId!=null)n.writeString(t.sessionId);else{var i="";n.writeString(i)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Re(t,n){if(n.writeStructBegin("ServerMediaUpdateRequest"),n.writeFieldBegin({fname:"fromVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.fromVersion!=null)n.writeI64(BigInt(t.fromVersion));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"toVersion",ftype:e.I64,fid:2}),t.toVersion!=null)n.writeI64(BigInt(t.toVersion));else{var i="0";n.writeI64(BigInt(i))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaUpdates",ftype:e.LIST,fid:3}),t.mediaUpdates!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.mediaUpdates.length});for(var l of t.mediaUpdates)_e(l,n);n.writeListEnd()}else{var s=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:s.length});for(var u of s)_e(u,n);n.writeListEnd()}if(n.writeFieldEnd(),t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),de(t.offer,n),n.writeFieldEnd()),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"renegotiationRequested",ftype:e.BOOL,fid:8}),t.renegotiationRequested!=null)n.writeBool(t.renegotiationRequested);else{var c=!1;n.writeBool(c)}if(n.writeFieldEnd(),t.prAnswer!=null&&(n.writeFieldBegin({fname:"prAnswer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),de(t.prAnswer,n),n.writeFieldEnd()),t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:10}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var d of Object.entries(t.stateStore)){var m=d[0],p=d[1];n.writeString(m),o("StateSyncSerializers").serializeState(p,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:11}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.multipleRelaysParameters!=null&&(n.writeFieldBegin({fname:"multipleRelaysParameters",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),Se(t.multipleRelaysParameters,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"multipleVideoStreamsAllowed",ftype:e.BOOL,fid:13}),t.multipleVideoStreamsAllowed!=null)n.writeBool(t.multipleVideoStreamsAllowed);else{var _=!1;n.writeBool(_)}if(n.writeFieldEnd(),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:15}),t.mediaPath!=null){var f;n.writeI32((f=t.mediaPath)!=null?f:0)}else{var g=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(g!=null?g:0)}if(n.writeFieldEnd(),t.update!=null&&(n.writeFieldBegin({fname:"update",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),me(t.update,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"screenShareStreamAllowed",ftype:e.BOOL,fid:17}),t.screenShareStreamAllowed!=null)n.writeBool(t.screenShareStreamAllowed);else{var h=!1;n.writeBool(h)}if(n.writeFieldEnd(),t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:18}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var y of Object.entries(t.stateStoreV2)){var C,b=y[0],v=y[1];n.writeI32((C=Number(b))!=null?C:0),o("StateSyncSerializers").serializeState(v,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.allowedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"allowedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:19}),n.writeSetBegin({etype:e.I32,size:t.allowedCustomVideoContentTypes.size});for(var S of t.allowedCustomVideoContentTypes)n.writeI32(S!=null?S:0);n.writeSetEnd(),n.writeFieldEnd()}t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Le(t,n){if(n.writeStructBegin("ServerMediaUpdateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var a="0";n.writeI64(BigInt(a))}n.writeFieldEnd(),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),de(t.answer,n),n.writeFieldEnd()),t.mediaStatus!=null&&(n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatus,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ee(e,t){t.writeStructBegin("TransferRequest"),t.writeFieldStop(),t.writeStructEnd()}function ke(t,n){if(n.writeStructBegin("HangupRequest"),n.writeFieldBegin({fname:"reason",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.reason!=null){var a;n.writeI32((a=t.reason)!=null?a:0)}else{var i=o("MultiwayCommonTypes").HangupReason.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"detailedReasonString",ftype:e.STRING,fid:2}),t.detailedReasonString!=null)n.writeString(t.detailedReasonString);else{var l="";n.writeString(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ie(t,n){if(n.writeStructBegin("IceCandidateRequest"),n.writeFieldBegin({fname:"iceCandidateSdps",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.iceCandidateSdps!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.iceCandidateSdps.length});for(var o of t.iceCandidateSdps)ge(o,n);n.writeListEnd()}else{var a=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:a.length});for(var i of a)ge(i,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Te(t,n){if(n.writeStructBegin("DismissRequest"),n.writeFieldBegin({fname:"reason",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.reason!=null){var a;n.writeI32((a=t.reason)!=null?a:0)}else{var i=o("MultiwayCommonTypes").DismissReason.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"detailedReasonString",ftype:e.STRING,fid:2}),t.detailedReasonString!=null)n.writeString(t.detailedReasonString);else{var l="";n.writeString(l)}n.writeFieldEnd(),t.callabilityResultErrorCode!=null&&(n.writeFieldBegin({fname:"callabilityResultErrorCode",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.callabilityResultErrorCode)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function De(t,n){if(n.writeStructBegin("EndpointSettings"),n.writeFieldBegin({fname:"joinMode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.joinMode!=null){var a;n.writeI32((a=t.joinMode)!=null?a:0)}else{var i=o("MultiwayCommonTypes").JoinMode.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function xe(t,n){if(n.writeStructBegin("ParticipantState"),n.writeFieldBegin({fname:"state",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.state!=null){var a;n.writeI32((a=t.state)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ParticipantCallState.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.userCapabilities!=null&&(n.writeFieldBegin({fname:"userCapabilities",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeBinary(t.userCapabilities),n.writeFieldEnd()),t.sctpNodeId!=null&&(n.writeFieldBegin({fname:"sctpNodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:3}),n.writeI64(BigInt(t.sctpNodeId)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function $e(t,n){n.writeStructBegin("ServerOnlyParticipantState"),t.userCountry!=null&&(n.writeFieldBegin({fname:"userCountry",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.userCountry),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Pe(t,n){n.writeStructBegin("UserProfile"),t.name!=null&&(n.writeFieldBegin({fname:"name",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.name),n.writeFieldEnd()),t.profilePictureUri!=null&&(n.writeFieldBegin({fname:"profilePictureUri",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.profilePictureUri),n.writeFieldEnd()),t.aliasId!=null&&(n.writeFieldBegin({fname:"aliasId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:3}),n.writeString(t.aliasId),n.writeFieldEnd()),t.thirdPartyId!=null&&(n.writeFieldBegin({fname:"thirdPartyId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.thirdPartyId),n.writeFieldEnd()),t.groupId!=null&&(n.writeFieldBegin({fname:"groupId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.groupId),n.writeFieldEnd()),t.avatarImageUri!=null&&(n.writeFieldBegin({fname:"avatarImageUri",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.avatarImageUri),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ne(t,n){n.writeStructBegin("ProductMetadata"),t.callerInfo!=null&&(n.writeFieldBegin({fname:"callerInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),Pe(t.callerInfo,n),n.writeFieldEnd()),t.liveBroadcastId!=null&&(n.writeFieldBegin({fname:"liveBroadcastId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.liveBroadcastId),n.writeFieldEnd()),t.callingTags!=null&&(n.writeFieldBegin({fname:"callingTags",ftype:(e||(e=r("ThriftTypes"))).I32,fid:3}),n.writeI32(t.callingTags),n.writeFieldEnd()),t.backingIdentifier!=null&&(n.writeFieldBegin({fname:"backingIdentifier",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.backingIdentifier),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Me(t,n){if(n.writeStructBegin("ConferenceStateRequest"),n.writeFieldBegin({fname:"version",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.version!=null)n.writeI64(BigInt(t.version));else{var a="0";n.writeI64(BigInt(a))}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"participantStates",ftype:e.MAP,fid:2}),t.participantStates!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(t.participantStates).length});for(var i of Object.entries(t.participantStates)){var l=i[0],s=i[1];n.writeString(l),xe(s,n)}n.writeMapEnd()}else{var u={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.STRUCT,size:Object.keys(u).length});for(var c of Object.entries(u)){var d=c[0],m=c[1];n.writeString(d),xe(m,n)}n.writeMapEnd()}if(n.writeFieldEnd(),t.userProfiles!=null){n.writeFieldBegin({fname:"userProfiles",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:3}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.userProfiles).length});for(var p of Object.entries(t.userProfiles)){var _=p[0],f=p[1];n.writeString(_),Pe(f,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:4}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var g of t.appMessages)o("DataMessageSerializers").serializeDataMessage(g,n);n.writeListEnd(),n.writeFieldEnd()}if(n.writeFieldBegin({fname:"groupsOfUsers",ftype:e.LIST,fid:5}),t.groupsOfUsers!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.groupsOfUsers.length});for(var h of t.groupsOfUsers)ct(h,n);n.writeListEnd()}else{var y=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:y.length});for(var C of y)ct(C,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function we(t,n){if(n.writeStructBegin("ConferenceStateResponse"),n.writeFieldBegin({fname:"currentVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:1}),t.currentVersion!=null)n.writeI64(BigInt(t.currentVersion));else{var o="0";n.writeI64(BigInt(o))}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ae(t,n){if(n.writeStructBegin("SubscriptionRequest"),n.writeFieldBegin({fname:"subscriptions",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.subscriptions!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.subscriptions.length});for(var a of t.subscriptions)o("MultiwaySharedSerializers").serializeSubscription(a,n);n.writeListEnd()}else{var i=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:i.length});for(var l of i)o("MultiwaySharedSerializers").serializeSubscription(l,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Fe(t,n){if(n.writeStructBegin("DataMessageRequest"),n.writeFieldBegin({fname:"message",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.message!=null)o("DataMessageSerializers").serializeDataMessage(t.message,n);else{var a=o("DataMessageSerializers").DataMessage$DefaultConstructor();o("DataMessageSerializers").serializeDataMessage(a,n)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Oe(t,n){if(n.writeStructBegin("DataMessageResponse"),n.writeFieldBegin({fname:"deliveryResult",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:1}),t.deliveryResult!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.I32,size:Object.keys(t.deliveryResult).length});for(var o of Object.entries(t.deliveryResult)){var a=o[0],i=o[1];n.writeString(a),n.writeI32(i!=null?i:0)}n.writeMapEnd()}else{var l={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.I32,size:Object.keys(l).length});for(var s of Object.entries(l)){var u=s[0],c=s[1];n.writeString(u),n.writeI32(c!=null?c:0)}n.writeMapEnd()}if(n.writeFieldEnd(),t.serviceTypeDeliveryResult!=null){n.writeFieldBegin({fname:"serviceTypeDeliveryResult",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:2}),n.writeMapBegin({ktype:e.I32,vtype:e.I32,size:Object.keys(t.serviceTypeDeliveryResult).length});for(var d of Object.entries(t.serviceTypeDeliveryResult)){var m,p=d[0],_=d[1];n.writeI32((m=Number(p))!=null?m:0),n.writeI32(_!=null?_:0)}n.writeMapEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Be(t,n){if(n.writeStructBegin("AddParticipantsRequest"),n.writeFieldBegin({fname:"usersToInvite",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.usersToInvite!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.usersToInvite.size});for(var a of t.usersToInvite)n.writeString(a);n.writeSetEnd()}else{var i=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:i.size});for(var l of i)n.writeString(l);n.writeSetEnd()}if(n.writeFieldEnd(),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:2}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var s of t.appMessages)o("DataMessageSerializers").serializeDataMessage(s,n);n.writeListEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function We(t,n){if(n.writeStructBegin("SfuAllocation"),n.writeFieldBegin({fname:"smcTier",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.smcTier!=null)n.writeString(t.smcTier);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"region",ftype:e.STRING,fid:2}),t.region!=null)n.writeString(t.region);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"isUsfu",ftype:e.BOOL,fid:3}),t.isUsfu!=null)n.writeBool(t.isUsfu);else{var i=!1;n.writeBool(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"isEdge",ftype:e.BOOL,fid:4}),t.isEdge!=null)n.writeBool(t.isEdge);else{var l=!1;n.writeBool(l)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function qe(t,n){if(n.writeStructBegin("JoinRequest"),n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.offer!=null)de(t.offer,n);else{var a=u();de(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"deviceCapabilities",ftype:e.SET,fid:2}),t.deviceCapabilities!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.deviceCapabilities.size});for(var i of t.deviceCapabilities)n.writeI32(i!=null?i:0);n.writeSetEnd()}else{var l=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:l.size});for(var s of l)n.writeI32(s!=null?s:0);n.writeSetEnd()}if(n.writeFieldEnd(),t.usersToCall!=null){n.writeFieldBegin({fname:"usersToCall",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),n.writeSetBegin({etype:e.STRING,size:t.usersToCall.size});for(var c of t.usersToCall)n.writeString(c);n.writeSetEnd(),n.writeFieldEnd()}if(t.mediaStatus!=null){n.writeFieldBegin({fname:"mediaStatus",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:4}),n.writeMapBegin({ktype:e.STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var d of Object.entries(t.mediaStatus)){var m=d[0],p=d[1];n.writeString(m),n.writeBool(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.userCapabilities!=null&&(n.writeFieldBegin({fname:"userCapabilities",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeBinary(t.userCapabilities),n.writeFieldEnd()),t.supportedExperiments!=null&&(n.writeFieldBegin({fname:"supportedExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:6}),n.writeString(t.supportedExperiments),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:9}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var _ of t.appMessages)o("DataMessageSerializers").serializeDataMessage(_,n);n.writeListEnd(),n.writeFieldEnd()}if(t.userToEscalate!=null&&(n.writeFieldBegin({fname:"userToEscalate",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.userToEscalate),n.writeFieldEnd()),t.escalatingCallId!=null&&(n.writeFieldBegin({fname:"escalatingCallId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:11}),n.writeI64(BigInt(t.escalatingCallId)),n.writeFieldEnd()),t.conferenceType!=null){var f;n.writeFieldBegin({fname:"conferenceType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:12}),n.writeI32((f=t.conferenceType)!=null?f:0),n.writeFieldEnd()}if(t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.answer!=null&&(n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.answer,n),n.writeFieldEnd()),t.syncPayload!=null&&(n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),he(t.syncPayload,n),n.writeFieldEnd()),t.usersToApproveFromWaitingRoom!=null){n.writeFieldBegin({fname:"usersToApproveFromWaitingRoom",ftype:(e||(e=r("ThriftTypes"))).SET,fid:16}),n.writeSetBegin({etype:e.STRING,size:t.usersToApproveFromWaitingRoom.size});for(var g of t.usersToApproveFromWaitingRoom)n.writeString(g);n.writeSetEnd(),n.writeFieldEnd()}if(t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),t.sfuAllocation!=null&&(n.writeFieldBegin({fname:"sfuAllocation",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),We(t.sfuAllocation,n),n.writeFieldEnd()),t.clientMediaMode!=null){var h;n.writeFieldBegin({fname:"clientMediaMode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:19}),n.writeI32((h=t.clientMediaMode)!=null?h:0),n.writeFieldEnd()}if(t.endpointSettings!=null&&(n.writeFieldBegin({fname:"endpointSettings",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),De(t.endpointSettings,n),n.writeFieldEnd()),t.backupSfuAllocation!=null&&(n.writeFieldBegin({fname:"backupSfuAllocation",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:21}),We(t.backupSfuAllocation,n),n.writeFieldEnd()),t.supportedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"supportedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:22}),n.writeSetBegin({etype:e.I32,size:t.supportedCustomVideoContentTypes.size});for(var y of t.supportedCustomVideoContentTypes)n.writeI32(y!=null?y:0);n.writeSetEnd(),n.writeFieldEnd()}t.configIntegrityOpaqueToken!=null&&(n.writeFieldBegin({fname:"configIntegrityOpaqueToken",ftype:(e||(e=r("ThriftTypes"))).I32,fid:23}),n.writeI32(t.configIntegrityOpaqueToken),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ue(t,n){if(n.writeStructBegin("JoinResponse"),n.writeFieldBegin({fname:"answer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.answer!=null)de(t.answer,n);else{var a=u();de(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaStatus",ftype:e.MAP,fid:2}),t.mediaStatus!=null){n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(t.mediaStatus).length});for(var i of Object.entries(t.mediaStatus)){var l=i[0],s=i[1];n.writeString(l),n.writeBool(s)}n.writeMapEnd()}else{var c={};n.writeMapBegin({ktype:(e||(e=r("ThriftTypes"))).STRING,vtype:e.BOOL,size:Object.keys(c).length});for(var d of Object.entries(c)){var m=d[0],p=d[1];n.writeString(m),n.writeBool(p)}n.writeMapEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"initiator",ftype:e.STRING,fid:3}),t.initiator!=null)n.writeString(t.initiator);else{var _="";n.writeString(_)}if(n.writeFieldEnd(),t.negotiatedExperiments!=null&&(n.writeFieldBegin({fname:"negotiatedExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeString(t.negotiatedExperiments),n.writeFieldEnd()),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:7}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var f of t.appMessages)o("DataMessageSerializers").serializeDataMessage(f,n);n.writeListEnd(),n.writeFieldEnd()}if(t.stateStore!=null){n.writeFieldBegin({fname:"stateStore",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:8}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRUCT,size:Object.keys(t.stateStore).length});for(var g of Object.entries(t.stateStore)){var h=g[0],y=g[1];n.writeString(h),o("StateSyncSerializers").serializeState(y,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:9}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),n.writeFieldBegin({fname:"isPendingApproval",ftype:e.BOOL,fid:10}),t.isPendingApproval!=null)n.writeBool(t.isPendingApproval);else{var C=!1;n.writeBool(C)}if(n.writeFieldEnd(),t.renegotiationOffer!=null&&(n.writeFieldBegin({fname:"renegotiationOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),de(t.renegotiationOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"multipleVideoStreamsAllowed",ftype:e.BOOL,fid:12}),t.multipleVideoStreamsAllowed!=null)n.writeBool(t.multipleVideoStreamsAllowed);else{var b=!1;n.writeBool(b)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:13}),t.mediaPath!=null){var v;n.writeI32((v=t.mediaPath)!=null?v:0)}else{var S=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(S!=null?S:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"groupsOfUsers",ftype:e.LIST,fid:14}),t.groupsOfUsers!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.groupsOfUsers.length});for(var R of t.groupsOfUsers)ct(R,n);n.writeListEnd()}else{var L=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:L.length});for(var E of L)ct(E,n);n.writeListEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"screenShareStreamAllowed",ftype:e.BOOL,fid:15}),t.screenShareStreamAllowed!=null)n.writeBool(t.screenShareStreamAllowed);else{var k=!1;n.writeBool(k)}if(n.writeFieldEnd(),t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),t.selfSctpNodeId!=null&&(n.writeFieldBegin({fname:"selfSctpNodeId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:17}),n.writeI64(BigInt(t.selfSctpNodeId)),n.writeFieldEnd()),t.stateStoreV2!=null){n.writeFieldBegin({fname:"stateStoreV2",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:18}),n.writeMapBegin({ktype:e.I32,vtype:e.STRUCT,size:Object.keys(t.stateStoreV2).length});for(var I of Object.entries(t.stateStoreV2)){var T,D=I[0],x=I[1];n.writeI32((T=Number(D))!=null?T:0),o("StateSyncSerializers").serializeState(x,n)}n.writeMapEnd(),n.writeFieldEnd()}if(t.allowedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"allowedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:19}),n.writeSetBegin({etype:e.I32,size:t.allowedCustomVideoContentTypes.size});for(var $ of t.allowedCustomVideoContentTypes)n.writeI32($!=null?$:0);n.writeSetEnd(),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function Ve(t,n){if(n.writeStructBegin("ConnectRequest"),t.sdp!=null&&(n.writeFieldBegin({fname:"sdp",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),de(t.sdp,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"deviceCapabilities",ftype:(e||(e=r("ThriftTypes"))).SET,fid:3}),t.deviceCapabilities!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:t.deviceCapabilities.size});for(var a of t.deviceCapabilities)n.writeI32(a!=null?a:0);n.writeSetEnd()}else{var i=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).I32,size:i.size});for(var l of i)n.writeI32(l!=null?l:0);n.writeSetEnd()}if(n.writeFieldEnd(),t.supportedCustomVideoContentTypes!=null){n.writeFieldBegin({fname:"supportedCustomVideoContentTypes",ftype:(e||(e=r("ThriftTypes"))).SET,fid:5}),n.writeSetBegin({etype:e.I32,size:t.supportedCustomVideoContentTypes.size});for(var s of t.supportedCustomVideoContentTypes)n.writeI32(s!=null?s:0);n.writeSetEnd(),n.writeFieldEnd()}t.prOffer!=null&&(n.writeFieldBegin({fname:"prOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),de(t.prOffer,n),n.writeFieldEnd()),t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:7}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function He(t,n){n.writeStructBegin("ConnectResponse"),t.sdp!=null&&(n.writeFieldBegin({fname:"sdp",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),de(t.sdp,n),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ge(t,n){if(n.writeStructBegin("ClientEvent"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ClientEventType.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),t.time!=null&&(n.writeFieldBegin({fname:"time",ftype:(e||(e=r("ThriftTypes"))).I64,fid:2}),n.writeI64(BigInt(t.time)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ze(t,n){if(n.writeStructBegin("ClientEventRequest"),n.writeFieldBegin({fname:"clientEvents",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:1}),t.clientEvents!=null){n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:t.clientEvents.length});for(var o of t.clientEvents)Ge(o,n);n.writeListEnd()}else{var a=[];n.writeListBegin({etype:(e||(e=r("ThriftTypes"))).STRUCT,size:a.length});for(var i of a)Ge(i,n);n.writeListEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function je(t,n){n.writeStructBegin("ThreadIdInfo"),t.groupThreadId!=null&&(n.writeFieldBegin({fname:"groupThreadId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),n.writeString(t.groupThreadId),n.writeFieldEnd()),t.peerId!=null&&(n.writeFieldBegin({fname:"peerId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),n.writeString(t.peerId),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Ke(e,t){t.writeStructBegin("ClientEventResponse"),t.writeFieldStop(),t.writeStructEnd()}function Qe(t,n){if(n.writeStructBegin("RingRequest"),n.writeFieldBegin({fname:"caller",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.caller!=null)n.writeString(t.caller);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"otherParticipants",ftype:e.SET,fid:2}),t.otherParticipants!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.otherParticipants.size});for(var i of t.otherParticipants)n.writeString(i);n.writeSetEnd()}else{var l=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:l.size});for(var s of l)n.writeString(s);n.writeSetEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"ringType",ftype:e.I32,fid:4}),t.ringType!=null){var u;n.writeI32((u=t.ringType)!=null?u:0)}else{var c=o("MultiwayCommonTypes").RingType.cast(0);n.writeI32(c!=null?c:0)}if(n.writeFieldEnd(),t.offeredExperiments!=null&&(n.writeFieldBegin({fname:"offeredExperiments",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.offeredExperiments),n.writeFieldEnd()),t.isScheduledCall!=null&&(n.writeFieldBegin({fname:"isScheduledCall",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:6}),n.writeBool(t.isScheduledCall),n.writeFieldEnd()),t.appMessages!=null){n.writeFieldBegin({fname:"appMessages",ftype:(e||(e=r("ThriftTypes"))).LIST,fid:8}),n.writeListBegin({etype:e.STRUCT,size:t.appMessages.length});for(var d of t.appMessages)o("DataMessageSerializers").serializeDataMessage(d,n);n.writeListEnd(),n.writeFieldEnd()}if(t.offer!=null&&(n.writeFieldBegin({fname:"offer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),de(t.offer,n),n.writeFieldEnd()),t.mediaStatusEx!=null&&(n.writeFieldBegin({fname:"mediaStatusEx",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),o("MultiwaySharedSerializers").serializeClientMediaStatus(t.mediaStatusEx,n),n.writeFieldEnd()),t.isPreconnectSupported!=null&&(n.writeFieldBegin({fname:"isPreconnectSupported",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:12}),n.writeBool(t.isPreconnectSupported),n.writeFieldEnd()),t.sdpOriginLocalId!=null&&(n.writeFieldBegin({fname:"sdpOriginLocalId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:13}),n.writeString(t.sdpOriginLocalId),n.writeFieldEnd()),t.unifiedOffer!=null&&(n.writeFieldBegin({fname:"unifiedOffer",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),de(t.unifiedOffer,n),n.writeFieldEnd()),n.writeFieldBegin({fname:"mediaPath",ftype:e.I32,fid:15}),t.mediaPath!=null){var m;n.writeI32((m=t.mediaPath)!=null?m:0)}else{var p=o("MultiwaySharedTypes").MediaPath.cast(0);n.writeI32(p!=null?p:0)}if(n.writeFieldEnd(),t.e2eeEnforcement!=null&&(n.writeFieldBegin({fname:"e2eeEnforcement",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),o("MultiwaySharedSerializers").serializeE2eeEnforcement(t.e2eeEnforcement,n),n.writeFieldEnd()),t.isLegacyCall!=null&&(n.writeFieldBegin({fname:"isLegacyCall",ftype:(e||(e=r("ThriftTypes"))).BOOL,fid:17}),n.writeBool(t.isLegacyCall),n.writeFieldEnd()),n.writeFieldBegin({fname:"isTransferCall",ftype:e.BOOL,fid:18}),t.isTransferCall!=null)n.writeBool(t.isTransferCall);else{var _=!1;n.writeBool(_)}if(n.writeFieldEnd(),t.relayInfo!=null&&(n.writeFieldBegin({fname:"relayInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),o("MultiwaySharedSerializers").serializeRelayInfo(t.relayInfo,n),n.writeFieldEnd()),t.overlayConfigs!=null){n.writeFieldBegin({fname:"overlayConfigs",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:21}),n.writeMapBegin({ktype:e.I32,vtype:e.I32,size:Object.keys(t.overlayConfigs).length});for(var f of Object.entries(t.overlayConfigs)){var g=f[0],h=f[1];n.writeI32(Number(g)),n.writeI32(h)}n.writeMapEnd(),n.writeFieldEnd()}t.productMetadata!=null&&(n.writeFieldBegin({fname:"productMetadata",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:22}),Ne(t.productMetadata,n),n.writeFieldEnd()),t.callerClientSessionId!=null&&(n.writeFieldBegin({fname:"callerClientSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:23}),n.writeString(t.callerClientSessionId),n.writeFieldEnd()),t.threadIdInfo!=null&&(n.writeFieldBegin({fname:"threadIdInfo",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:24}),je(t.threadIdInfo,n),n.writeFieldEnd()),t.linkUrl!=null&&(n.writeFieldBegin({fname:"linkUrl",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:25}),n.writeString(t.linkUrl),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function Xe(t,n){if(n.writeStructBegin("RingResponse"),n.writeFieldBegin({fname:"deviceStatus",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.deviceStatus!=null){var a;n.writeI32((a=t.deviceStatus)!=null?a:0)}else{var i=o("MultiwayCommonTypes").DeviceStatus.cast(0);n.writeI32(i!=null?i:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ye(t,n){if(n.writeStructBegin("RemoveParticipantsRequest"),n.writeFieldBegin({fname:"usersToRemove",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.usersToRemove!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.usersToRemove.size});for(var o of t.usersToRemove)n.writeString(o);n.writeSetEnd()}else{var a=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:a.size});for(var i of a)n.writeString(i);n.writeSetEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Je(t,n){if(n.writeStructBegin("UnsubscribeRequest"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var a="";n.writeString(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:2}),t.version!=null)n.writeI32(t.version);else{var i=0;n.writeI32(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"topicId",ftype:e.I32,fid:3}),t.topicId!=null){var l;n.writeI32((l=t.topicId)!=null?l:0)}else{var s=o("StateSyncTopicsConfigTypes").TopicId.cast(0);n.writeI32(s!=null?s:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function Ze(t,n){if(n.writeStructBegin("UnsubscribeResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:2}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function et(t,n){if(n.writeStructBegin("UpdateRequest"),n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.syncPayload!=null)he(t.syncPayload,n);else{var a=f();he(a,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"topic",ftype:e.STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var i="";n.writeString(i)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var l=0;n.writeI32(l)}if(n.writeFieldEnd(),t.data!=null&&(n.writeFieldBegin({fname:"data",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:4}),n.writeBinary(t.data),n.writeFieldEnd()),n.writeFieldBegin({fname:"topicId",ftype:e.I32,fid:5}),t.topicId!=null){var s;n.writeI32((s=t.topicId)!=null?s:0)}else{var u=o("StateSyncTopicsConfigTypes").TopicId.cast(0);n.writeI32(u!=null?u:0)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function tt(t,n){if(n.writeStructBegin("UpdateResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function nt(t,n){if(n.writeStructBegin("NotifyRequest"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"data",ftype:e.STRING,fid:4}),t.data!=null)n.writeBinary(t.data);else{var i=Uint8Array.of();n.writeBinary(i)}if(n.writeFieldEnd(),t.syncPayload!=null&&(n.writeFieldBegin({fname:"syncPayload",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),he(t.syncPayload,n),n.writeFieldEnd()),t.topicId!=null){var l;n.writeFieldBegin({fname:"topicId",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((l=t.topicId)!=null?l:0),n.writeFieldEnd()}n.writeFieldStop(),n.writeStructEnd()}function rt(t,n){if(n.writeStructBegin("NotifyResponse"),n.writeFieldBegin({fname:"topic",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:2}),t.topic!=null)n.writeString(t.topic);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"version",ftype:e.I32,fid:3}),t.version!=null)n.writeI32(t.version);else{var a=0;n.writeI32(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ot(t,n){if(n.writeStructBegin("ApprovalRequest"),n.writeFieldBegin({fname:"approvalStatus",ftype:(e||(e=r("ThriftTypes"))).I32,fid:2}),t.approvalStatus!=null){var a;n.writeI32((a=t.approvalStatus)!=null?a:0)}else{var i=o("MultiwayCommonTypes").ApprovalStatus.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"targetUsers",ftype:e.SET,fid:3}),t.targetUsers!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.targetUsers.size});for(var l of t.targetUsers)n.writeString(l);n.writeSetEnd()}else{var s=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:s.size});for(var u of s)n.writeString(u);n.writeSetEnd()}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function at(t,n){if(n.writeStructBegin("RtcSender"),n.writeFieldBegin({fname:"id",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.id!=null)n.writeString(t.id);else{var o="";n.writeString(o)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function it(t,n){if(n.writeStructBegin("RtcReceiver"),n.writeFieldBegin({fname:"actorId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:1}),t.actorId!=null)n.writeString(t.actorId);else{var o="";n.writeString(o)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"baseId",ftype:e.STRING,fid:2}),t.baseId!=null)n.writeString(t.baseId);else{var a="";n.writeString(a)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function lt(t,n){if(n.writeStructBegin("RtcMessageHeader"),n.writeFieldBegin({fname:"type",ftype:(e||(e=r("ThriftTypes"))).I32,fid:1}),t.type!=null){var a;n.writeI32((a=t.type)!=null?a:0)}else{var i=o("MultiwayCommonTypes").MessageType.cast(0);n.writeI32(i!=null?i:0)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"conferenceName",ftype:e.STRING,fid:2}),t.conferenceName!=null)n.writeString(t.conferenceName);else{var l="";n.writeString(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"transactionId",ftype:e.STRING,fid:3}),t.transactionId!=null)n.writeString(t.transactionId);else{var s="";n.writeString(s)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"retryCount",ftype:e.I16,fid:4}),t.retryCount!=null)n.writeI16(t.retryCount);else{var u=0;n.writeI16(u)}if(n.writeFieldEnd(),t.serverInfoData!=null&&(n.writeFieldBegin({fname:"serverInfoData",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:5}),n.writeString(t.serverInfoData),n.writeFieldEnd()),t.responseStatusCode!=null){var c;n.writeFieldBegin({fname:"responseStatusCode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:6}),n.writeI32((c=t.responseStatusCode)!=null?c:0),n.writeFieldEnd()}if(t.extensions!=null){n.writeFieldBegin({fname:"extensions",ftype:(e||(e=r("ThriftTypes"))).MAP,fid:7}),n.writeMapBegin({ktype:e.STRING,vtype:e.STRING,size:Object.keys(t.extensions).length});for(var d of Object.entries(t.extensions)){var m=d[0],p=d[1];n.writeString(m),n.writeString(p)}n.writeMapEnd(),n.writeFieldEnd()}if(t.sequenceNumber!=null&&(n.writeFieldBegin({fname:"sequenceNumber",ftype:(e||(e=r("ThriftTypes"))).I64,fid:8}),n.writeI64(BigInt(t.sequenceNumber)),n.writeFieldEnd()),t.clientSessionId!=null&&(n.writeFieldBegin({fname:"clientSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:9}),n.writeString(t.clientSessionId),n.writeFieldEnd()),t.responseStatusMessage!=null&&(n.writeFieldBegin({fname:"responseStatusMessage",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:10}),n.writeString(t.responseStatusMessage),n.writeFieldEnd()),t.responseSubCode!=null){var _;n.writeFieldBegin({fname:"responseSubCode",ftype:(e||(e=r("ThriftTypes"))).I32,fid:11}),n.writeI32((_=t.responseSubCode)!=null?_:0),n.writeFieldEnd()}if(t.collisionKey!=null&&(n.writeFieldBegin({fname:"collisionKey",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:12}),n.writeString(t.collisionKey),n.writeFieldEnd()),t.conferenceType!=null){var f;n.writeFieldBegin({fname:"conferenceType",ftype:(e||(e=r("ThriftTypes"))).I32,fid:13}),n.writeI32((f=t.conferenceType)!=null?f:0),n.writeFieldEnd()}if(t.serverSessionId!=null&&(n.writeFieldBegin({fname:"serverSessionId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:14}),n.writeString(t.serverSessionId),n.writeFieldEnd()),t.rtcHandle!=null&&(n.writeFieldBegin({fname:"rtcHandle",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:15}),n.writeString(t.rtcHandle),n.writeFieldEnd()),t.retryAfterMsec!=null&&(n.writeFieldBegin({fname:"retryAfterMsec",ftype:(e||(e=r("ThriftTypes"))).I32,fid:16}),n.writeI32(t.retryAfterMsec),n.writeFieldEnd()),t.receiverUserId!=null&&(n.writeFieldBegin({fname:"receiverUserId",ftype:(e||(e=r("ThriftTypes"))).STRING,fid:17}),n.writeString(t.receiverUserId),n.writeFieldEnd()),t.clientStack!=null){var g;n.writeFieldBegin({fname:"clientStack",ftype:(e||(e=r("ThriftTypes"))).I32,fid:18}),n.writeI32((g=t.clientStack)!=null?g:0),n.writeFieldEnd()}if(t.serverMsgTime!=null&&(n.writeFieldBegin({fname:"serverMsgTime",ftype:(e||(e=r("ThriftTypes"))).I64,fid:19}),n.writeI64(BigInt(t.serverMsgTime)),n.writeFieldEnd()),t.sender!=null&&(n.writeFieldBegin({fname:"sender",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:20}),at(t.sender,n),n.writeFieldEnd()),t.receiver!=null&&(n.writeFieldBegin({fname:"receiver",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:21}),it(t.receiver,n),n.writeFieldEnd()),t.messageTags!=null){n.writeFieldBegin({fname:"messageTags",ftype:(e||(e=r("ThriftTypes"))).SET,fid:22}),n.writeSetBegin({etype:e.I32,size:t.messageTags.size});for(var h of t.messageTags)n.writeI32(h!=null?h:0);n.writeSetEnd(),n.writeFieldEnd()}t.conferenceId!=null&&(n.writeFieldBegin({fname:"conferenceId",ftype:(e||(e=r("ThriftTypes"))).I64,fid:23}),n.writeI64(BigInt(t.conferenceId)),n.writeFieldEnd()),t.protocolVersion!=null&&(n.writeFieldBegin({fname:"protocolVersion",ftype:(e||(e=r("ThriftTypes"))).I32,fid:24}),n.writeI32(t.protocolVersion),n.writeFieldEnd()),t.bodyCompressionVersion!=null&&(n.writeFieldBegin({fname:"bodyCompressionVersion",ftype:(e||(e=r("ThriftTypes"))).I64,fid:25}),n.writeI64(BigInt(t.bodyCompressionVersion)),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function st(t,n){n.writeStructBegin("RtcMessageBody"),t.joinRequest!=null&&(n.writeFieldBegin({fname:"joinRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),qe(t.joinRequest,n),n.writeFieldEnd()),t.joinResponse!=null&&(n.writeFieldBegin({fname:"joinResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),Ue(t.joinResponse,n),n.writeFieldEnd()),t.serverMediaUpdateRequest!=null&&(n.writeFieldBegin({fname:"serverMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),Re(t.serverMediaUpdateRequest,n),n.writeFieldEnd()),t.serverMediaUpdateResponse!=null&&(n.writeFieldBegin({fname:"serverMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),Le(t.serverMediaUpdateResponse,n),n.writeFieldEnd()),t.hangupRequest!=null&&(n.writeFieldBegin({fname:"hangupRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),ke(t.hangupRequest,n),n.writeFieldEnd()),t.iceCandidateRequest!=null&&(n.writeFieldBegin({fname:"iceCandidateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),Ie(t.iceCandidateRequest,n),n.writeFieldEnd()),t.ringRequest!=null&&(n.writeFieldBegin({fname:"ringRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),Qe(t.ringRequest,n),n.writeFieldEnd()),t.ringResponse!=null&&(n.writeFieldBegin({fname:"ringResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),Xe(t.ringResponse,n),n.writeFieldEnd()),t.dismissRequest!=null&&(n.writeFieldBegin({fname:"dismissRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),Te(t.dismissRequest,n),n.writeFieldEnd()),t.conferenceStateRequest!=null&&(n.writeFieldBegin({fname:"conferenceStateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),Me(t.conferenceStateRequest,n),n.writeFieldEnd()),t.conferenceStateResponse!=null&&(n.writeFieldBegin({fname:"conferenceStateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),we(t.conferenceStateResponse,n),n.writeFieldEnd()),t.addParticipantsRequest!=null&&(n.writeFieldBegin({fname:"addParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),Be(t.addParticipantsRequest,n),n.writeFieldEnd()),t.subscriptionRequest!=null&&(n.writeFieldBegin({fname:"subscriptionRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),Ae(t.subscriptionRequest,n),n.writeFieldEnd()),t.clientMediaUpdateRequest!=null&&(n.writeFieldBegin({fname:"clientMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),be(t.clientMediaUpdateRequest,n),n.writeFieldEnd()),t.clientMediaUpdateResponse!=null&&(n.writeFieldBegin({fname:"clientMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),ve(t.clientMediaUpdateResponse,n),n.writeFieldEnd()),t.dataMessageRequest!=null&&(n.writeFieldBegin({fname:"dataMessageRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),Fe(t.dataMessageRequest,n),n.writeFieldEnd()),t.removeParticipantsRequest!=null&&(n.writeFieldBegin({fname:"removeParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),Ye(t.removeParticipantsRequest,n),n.writeFieldEnd()),t.dataMessageResponse!=null&&(n.writeFieldBegin({fname:"dataMessageResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:19}),Oe(t.dataMessageResponse,n),n.writeFieldEnd()),t.updateRequest!=null&&(n.writeFieldBegin({fname:"updateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:30}),et(t.updateRequest,n),n.writeFieldEnd()),t.updateResponse!=null&&(n.writeFieldBegin({fname:"updateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:31}),tt(t.updateResponse,n),n.writeFieldEnd()),t.notifyRequest!=null&&(n.writeFieldBegin({fname:"notifyRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:32}),nt(t.notifyRequest,n),n.writeFieldEnd()),t.notifyResponse!=null&&(n.writeFieldBegin({fname:"notifyResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:33}),rt(t.notifyResponse,n),n.writeFieldEnd()),t.connectRequest!=null&&(n.writeFieldBegin({fname:"connectRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:34}),Ve(t.connectRequest,n),n.writeFieldEnd()),t.connectResponse!=null&&(n.writeFieldBegin({fname:"connectResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:35}),He(t.connectResponse,n),n.writeFieldEnd()),t.clientEventRequest!=null&&(n.writeFieldBegin({fname:"clientEventRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:36}),ze(t.clientEventRequest,n),n.writeFieldEnd()),t.clientEventResponse!=null&&(n.writeFieldBegin({fname:"clientEventResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:37}),Ke(t.clientEventResponse,n),n.writeFieldEnd()),t.unsubscribeRequest!=null&&(n.writeFieldBegin({fname:"unsubscribeRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:40}),Je(t.unsubscribeRequest,n),n.writeFieldEnd()),t.unsubscribeResponse!=null&&(n.writeFieldBegin({fname:"unsubscribeResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:41}),Ze(t.unsubscribeResponse,n),n.writeFieldEnd()),t.approvalRequest!=null&&(n.writeFieldBegin({fname:"approvalRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:42}),ot(t.approvalRequest,n),n.writeFieldEnd()),t.transferRequest!=null&&(n.writeFieldBegin({fname:"transferRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:43}),Ee(t.transferRequest,n),n.writeFieldEnd()),n.writeFieldStop(),n.writeStructEnd()}function ut(t,n){if(n.writeStructBegin("RtcMultiwayMessage"),n.writeFieldBegin({fname:"messageHeader",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),t.messageHeader!=null)lt(t.messageHeader,n);else{var o=ae();lt(o,n)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"messageBody",ftype:e.STRUCT,fid:2}),t.messageBody!=null)st(t.messageBody,n);else{var a=ie();st(a,n)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function ct(t,n){if(n.writeStructBegin("GroupOfUsers"),n.writeFieldBegin({fname:"users",ftype:(e||(e=r("ThriftTypes"))).SET,fid:1}),t.users!=null){n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:t.users.size});for(var o of t.users)n.writeString(o);n.writeSetEnd()}else{var a=new Set;n.writeSetBegin({etype:(e||(e=r("ThriftTypes"))).STRING,size:a.size});for(var i of a)n.writeString(i);n.writeSetEnd()}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"allowMultipleJoins",ftype:e.BOOL,fid:2}),t.allowMultipleJoins!=null)n.writeBool(t.allowMultipleJoins);else{var l=!1;n.writeBool(l)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"dismissOthersOnFirstJoin",ftype:e.BOOL,fid:3}),t.dismissOthersOnFirstJoin!=null)n.writeBool(t.dismissOthersOnFirstJoin);else{var s=!1;n.writeBool(s)}if(n.writeFieldEnd(),n.writeFieldBegin({fname:"aliasId",ftype:e.STRING,fid:4}),t.aliasId!=null)n.writeString(t.aliasId);else{var u="";n.writeString(u)}n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd()}function dt(t,n){if(n.writeStructBegin("RtcMessageBodyVariant"),t.joinRequest!=null){n.writeFieldBegin({fname:"joinRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:1}),qe(t.joinRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.joinResponse!=null){n.writeFieldBegin({fname:"joinResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:2}),Ue(t.joinResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.serverMediaUpdateRequest!=null){n.writeFieldBegin({fname:"serverMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:3}),Re(t.serverMediaUpdateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.serverMediaUpdateResponse!=null){n.writeFieldBegin({fname:"serverMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:4}),Le(t.serverMediaUpdateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.hangupRequest!=null){n.writeFieldBegin({fname:"hangupRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:5}),ke(t.hangupRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.iceCandidateRequest!=null){n.writeFieldBegin({fname:"iceCandidateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:6}),Ie(t.iceCandidateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.ringRequest!=null){n.writeFieldBegin({fname:"ringRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:8}),Qe(t.ringRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.ringResponse!=null){n.writeFieldBegin({fname:"ringResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:9}),Xe(t.ringResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dismissRequest!=null){n.writeFieldBegin({fname:"dismissRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:10}),Te(t.dismissRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.conferenceStateRequest!=null){n.writeFieldBegin({fname:"conferenceStateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:11}),Me(t.conferenceStateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.conferenceStateResponse!=null){n.writeFieldBegin({fname:"conferenceStateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:12}),we(t.conferenceStateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.addParticipantsRequest!=null){n.writeFieldBegin({fname:"addParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:13}),Be(t.addParticipantsRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.subscriptionRequest!=null){n.writeFieldBegin({fname:"subscriptionRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:14}),Ae(t.subscriptionRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientMediaUpdateRequest!=null){n.writeFieldBegin({fname:"clientMediaUpdateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:15}),be(t.clientMediaUpdateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientMediaUpdateResponse!=null){n.writeFieldBegin({fname:"clientMediaUpdateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:16}),ve(t.clientMediaUpdateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dataMessageRequest!=null){n.writeFieldBegin({fname:"dataMessageRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:17}),Fe(t.dataMessageRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.removeParticipantsRequest!=null){n.writeFieldBegin({fname:"removeParticipantsRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:18}),Ye(t.removeParticipantsRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.dataMessageResponse!=null){n.writeFieldBegin({fname:"dataMessageResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:19}),Oe(t.dataMessageResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.updateRequest!=null){n.writeFieldBegin({fname:"updateRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:30}),et(t.updateRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.updateResponse!=null){n.writeFieldBegin({fname:"updateResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:31}),tt(t.updateResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.notifyRequest!=null){n.writeFieldBegin({fname:"notifyRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:32}),nt(t.notifyRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.notifyResponse!=null){n.writeFieldBegin({fname:"notifyResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:33}),rt(t.notifyResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.connectRequest!=null){n.writeFieldBegin({fname:"connectRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:34}),Ve(t.connectRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.connectResponse!=null){n.writeFieldBegin({fname:"connectResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:35}),He(t.connectResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientEventRequest!=null){n.writeFieldBegin({fname:"clientEventRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:36}),ze(t.clientEventRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.clientEventResponse!=null){n.writeFieldBegin({fname:"clientEventResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:37}),Ke(t.clientEventResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.unsubscribeRequest!=null){n.writeFieldBegin({fname:"unsubscribeRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:40}),Je(t.unsubscribeRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.unsubscribeResponse!=null){n.writeFieldBegin({fname:"unsubscribeResponse",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:41}),Ze(t.unsubscribeResponse,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.approvalRequest!=null){n.writeFieldBegin({fname:"approvalRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:42}),ot(t.approvalRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}if(t.transferRequest!=null){n.writeFieldBegin({fname:"transferRequest",ftype:(e||(e=r("ThriftTypes"))).STRUCT,fid:43}),Ee(t.transferRequest,n),n.writeFieldEnd(),n.writeFieldStop(),n.writeStructEnd();return}n.writeFieldStop(),n.writeStructEnd()}function mt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.message=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(t.readI32()):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(t.readI32()):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.apiStatusCode=o("MultiwayCommonTypes").RtcApiStatusCode.cast(t.readI32()):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.rtcLogSeverity=o("MultiwayCommonTypes").RtcLogSeverity.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.message===void 0&&(n.message=""),n.responseStatusCode===void 0&&(n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(0)),n.responseSubCode===void 0&&(n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(0)),n.apiStatusCode===void 0&&(n.apiStatusCode=o("MultiwayCommonTypes").RtcApiStatusCode.cast(0)),n.rtcLogSeverity===void 0&&(n.rtcLogSeverity=o("MultiwayCommonTypes").RtcLogSeverity.cast(0)),n}function pt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpString=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sdpThrift=o("WebrtcSdpSerializers").deserializeSdp(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.sdpCompressionVersion=t.readI64().toString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpCompressedData=t.readBinary():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n}function _t(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).MAP){n.media={};for(var l=t.readMapBegin(),s=0;s<l.size;s++){var u=t.readI32(),c=ft(t);n.media[u]=c}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.media===void 0&&(n.media={}),n}function ft(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.body=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.msid=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.mid=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.body===void 0&&(n.body=""),n.msid===void 0&&(n.msid=""),n.mid===void 0&&(n.mid=""),n}function gt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.sourceKey=t.readString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).LIST){n.media=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeMedia(t);n.media.push(c)}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.ssrcGroups=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("MultiwaySharedSerializers").deserializeSsrcGroup(t);n.ssrcGroups.push(p)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.sourceKey===void 0&&(n.sourceKey=""),n.media===void 0&&(n.media=[]),n.ssrcGroups===void 0&&(n.ssrcGroups=[]),n}function ht(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=t.readBool();n.mediaStatus[c]=d}}else t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.mediaStatus===void 0&&(n.mediaStatus={}),n}function yt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.candidateSdpString=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.sdpMLineIndex=t.readI64().toString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpMid=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.candidateSdpThrift=o("WebrtcSdpSerializers").deserializeIceCandidateSdp(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.sdpMLineIndex===void 0&&(n.sdpMLineIndex="0"),n.sdpMid===void 0&&(n.sdpMid=""),n}function Ct(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("StateSyncSerializers").deserializeState(t);n.stateStore[c]=d}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),f=o("StateSyncSerializers").deserializeState(t);_!=null&&(n.stateStoreV2[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.stateStore===void 0&&(n.stateStore={}),n.stateStoreV2===void 0&&(n.stateStoreV2={}),n}function bt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version=0),n}function vt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.encryptedTopic=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.encryptedData=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.senderId=t.readBinary():t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).SET){n.targetIds=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=o("Utf8ToString").Utf8ToString(t.readBinary());n.targetIds.add(c)}}else t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.messageType=o("MultiwayCommonTypes").E2eeDataMessageType.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.encryptedTopic===void 0&&(n.encryptedTopic=""),n.encryptedData===void 0&&(n.encryptedData=Uint8Array.of()),n.senderId===void 0&&(n.senderId=Uint8Array.of()),n.messageType===void 0&&(n.messageType=o("MultiwayCommonTypes").E2eeDataMessageType.cast(0)),n}function St(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.fromVersion=t.readI64().toString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I64?n.toVersion=t.readI64().toString():t.skip(a);break;case 3:if(a===(e||(e=r("ThriftTypes"))).LIST){n.mediaUpdates=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=ht(t);n.mediaUpdates.push(u)}}else t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.fromVersion===void 0&&(n.fromVersion="0"),n.toVersion===void 0&&(n.toVersion="0"),n.mediaUpdates===void 0&&(n.mediaUpdates=[]),n}function Rt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("StateSyncSerializers").deserializeState(t);n.stateStore[c]=d}}else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),f=o("StateSyncSerializers").deserializeState(t);_!=null&&(n.stateStoreV2[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n}function Lt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.callerUserId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.calleeUserId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.sessionId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.callerUserId===void 0&&(n.callerUserId=""),n.calleeUserId===void 0&&(n.calleeUserId=""),n.sessionId===void 0&&(n.sessionId=""),n}function Et(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.fromVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.toVersion=t.readI64().toString():t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).LIST){n.mediaUpdates=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=gt(t);n.mediaUpdates.push(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).BOOL?n.renegotiationRequested=t.readBool():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRUCT?n.prAnswer=pt(t):t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var d=t.readMapBegin(),m=0;m<d.size;m++){var p=t.readString(),_=o("StateSyncSerializers").deserializeState(t);n.stateStore[p]=_}}else t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).STRUCT?n.multipleRelaysParameters=Lt(t):t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).BOOL?n.multipleVideoStreamsAllowed=t.readBool():t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.update=_t(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).BOOL?n.screenShareStreamAllowed=t.readBool():t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),y=o("StateSyncSerializers").deserializeState(t);h!=null&&(n.stateStoreV2[h]=y)}}else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).SET){n.allowedCustomVideoContentTypes=new Set;for(var C=t.readSetBegin(),b=0;b<C.size;b++){var v=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.allowedCustomVideoContentTypes.add(v)}}else t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.fromVersion===void 0&&(n.fromVersion="0"),n.toVersion===void 0&&(n.toVersion="0"),n.mediaUpdates===void 0&&(n.mediaUpdates=[]),n.renegotiationRequested===void 0&&(n.renegotiationRequested=!1),n.multipleVideoStreamsAllowed===void 0&&(n.multipleVideoStreamsAllowed=!1),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.screenShareStreamAllowed===void 0&&(n.screenShareStreamAllowed=!1),n}function kt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatus=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n}function It(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;t.skip(a),t.readFieldEnd()}return t.readStructEnd(),n}function Tt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.reason=o("MultiwayCommonTypes").HangupReason.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.detailedReasonString=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.reason===void 0&&(n.reason=o("MultiwayCommonTypes").HangupReason.cast(0)),n.detailedReasonString===void 0&&(n.detailedReasonString=""),n}function Dt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.iceCandidateSdps=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=yt(t);n.iceCandidateSdps.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.iceCandidateSdps===void 0&&(n.iceCandidateSdps=[]),n}function xt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.reason=o("MultiwayCommonTypes").DismissReason.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.detailedReasonString=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.callabilityResultErrorCode=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.reason===void 0&&(n.reason=o("MultiwayCommonTypes").DismissReason.cast(0)),n.detailedReasonString===void 0&&(n.detailedReasonString=""),n}function $t(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.joinMode=o("MultiwayCommonTypes").JoinMode.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.joinMode===void 0&&(n.joinMode=o("MultiwayCommonTypes").JoinMode.cast(0)),n}function Pt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.state=o("MultiwayCommonTypes").ParticipantCallState.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.userCapabilities=t.readBinary():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I64?n.sctpNodeId=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.state===void 0&&(n.state=o("MultiwayCommonTypes").ParticipantCallState.cast(0)),n}function Nt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.userCountry=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function Mt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.name=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.profilePictureUri=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRING?n.aliasId=t.readString():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.thirdPartyId=t.readString():t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRING?n.groupId=t.readString():t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRING?n.avatarImageUri=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function wt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.callerInfo=Mt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.liveBroadcastId=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.callingTags=t.readI32():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.backingIdentifier=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function At(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I64?n.version=t.readI64().toString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.participantStates={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=Pt(t);n.participantStates[c]=d}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).MAP){n.userProfiles={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=t.readString(),f=Mt(t);n.userProfiles[_]=f}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var g=t.readListBegin(),h=0;h<g.size;h++){var y=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(y)}}else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).LIST){n.groupsOfUsers=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=pn(t);n.groupsOfUsers.push(v)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.version===void 0&&(n.version="0"),n.participantStates===void 0&&(n.participantStates={}),n.groupsOfUsers===void 0&&(n.groupsOfUsers=[]),n}function Ft(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).I64?n.currentVersion=t.readI64().toString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.currentVersion===void 0&&(n.currentVersion="0"),n}function Ot(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).LIST){n.subscriptions=[];for(var s=t.readListBegin(),u=0;u<s.size;u++){var c=o("MultiwaySharedSerializers").deserializeSubscription(t);n.subscriptions.push(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.subscriptions===void 0&&(n.subscriptions=[]),n}function Bt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.message=o("DataMessageSerializers").deserializeDataMessage(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.message===void 0&&(n.message=o("DataMessageSerializers").DataMessage$DefaultConstructor()),n}function Wt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).MAP){n.deliveryResult={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=o("DataMessageTypes").DataMessageStatusCode.cast(t.readI32());n.deliveryResult[c]=d}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.serviceTypeDeliveryResult={};for(var m=t.readMapBegin(),p=0;p<m.size;p++){var _=o("MultiwaySharedTypes").EndpointServiceType.cast(t.readI32()),f=o("DataMessageTypes").DataMessageStatusCode.cast(t.readI32());_!=null&&(n.serviceTypeDeliveryResult[_]=f)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deliveryResult===void 0&&(n.deliveryResult={}),n}function qt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToInvite=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.usersToInvite.add(c)}}else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(p)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.usersToInvite===void 0&&(n.usersToInvite=new Set),n}function Ut(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.smcTier=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.region=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.isUsfu=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).BOOL?n.isEdge=t.readBool():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.smcTier===void 0&&(n.smcTier=""),n.region===void 0&&(n.region=""),n.isUsfu===void 0&&(n.isUsfu=!1),n.isEdge===void 0&&(n.isEdge=!1),n}function Vt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).SET){n.deviceCapabilities=new Set;for(var s=t.readSetBegin(),c=0;c<s.size;c++){var d=o("MultiwayCommonTypes").Capability.cast(t.readI32());n.deviceCapabilities.add(d)}}else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToCall=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=t.readString();n.usersToCall.add(_)}}else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var f=t.readMapBegin(),g=0;g<f.size;g++){var h=t.readString(),y=t.readBool();n.mediaStatus[h]=y}}else t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.userCapabilities=t.readBinary():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRING?n.supportedExperiments=t.readString():t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var C=t.readListBegin(),b=0;b<C.size;b++){var v=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(v)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.userToEscalate=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I64?n.escalatingCallId=t.readI64().toString():t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).I32?n.conferenceType=o("MultiwaySharedTypes").ConferenceType.cast(t.readI32()):t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).SET){n.usersToApproveFromWaitingRoom=new Set;for(var S=t.readSetBegin(),R=0;R<S.size;R++){var L=t.readString();n.usersToApproveFromWaitingRoom.add(L)}}else t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sfuAllocation=Ut(t):t.skip(i);break;case 19:i===(e||(e=r("ThriftTypes"))).I32?n.clientMediaMode=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.endpointSettings=$t(t):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRUCT?n.backupSfuAllocation=Ut(t):t.skip(i);break;case 22:if(i===(e||(e=r("ThriftTypes"))).SET){n.supportedCustomVideoContentTypes=new Set;for(var E=t.readSetBegin(),k=0;k<E.size;k++){var I=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.supportedCustomVideoContentTypes.add(I)}}else t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).I32?n.configIntegrityOpaqueToken=t.readI32():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.offer===void 0&&(n.offer=u()),n.deviceCapabilities===void 0&&(n.deviceCapabilities=new Set),n}function Ht(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.answer=pt(t):t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).MAP){n.mediaStatus={};for(var s=t.readMapBegin(),c=0;c<s.size;c++){var d=t.readString(),m=t.readBool();n.mediaStatus[d]=m}}else t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.initiator=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.negotiatedExperiments=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var p=t.readListBegin(),_=0;_<p.size;_++){var f=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(f)}}else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStore={};for(var g=t.readMapBegin(),h=0;h<g.size;h++){var y=t.readString(),C=o("StateSyncSerializers").deserializeState(t);n.stateStore[y]=C}}else t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).BOOL?n.isPendingApproval=t.readBool():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRUCT?n.renegotiationOffer=pt(t):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).BOOL?n.multipleVideoStreamsAllowed=t.readBool():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 14:if(i===(e||(e=r("ThriftTypes"))).LIST){n.groupsOfUsers=[];for(var b=t.readListBegin(),v=0;v<b.size;v++){var S=pn(t);n.groupsOfUsers.push(S)}}else t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).BOOL?n.screenShareStreamAllowed=t.readBool():t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).I64?n.selfSctpNodeId=t.readI64().toString():t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).MAP){n.stateStoreV2={};for(var R=t.readMapBegin(),L=0;L<R.size;L++){var E=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()),k=o("StateSyncSerializers").deserializeState(t);E!=null&&(n.stateStoreV2[E]=k)}}else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).SET){n.allowedCustomVideoContentTypes=new Set;for(var I=t.readSetBegin(),T=0;T<I.size;T++){var D=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.allowedCustomVideoContentTypes.add(D)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.answer===void 0&&(n.answer=u()),n.mediaStatus===void 0&&(n.mediaStatus={}),n.initiator===void 0&&(n.initiator=""),n.isPendingApproval===void 0&&(n.isPendingApproval=!1),n.multipleVideoStreamsAllowed===void 0&&(n.multipleVideoStreamsAllowed=!1),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.groupsOfUsers===void 0&&(n.groupsOfUsers=[]),n.screenShareStreamAllowed===void 0&&(n.screenShareStreamAllowed=!1),n}function Gt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sdp=pt(t):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.deviceCapabilities=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=o("MultiwayCommonTypes").Capability.cast(t.readI32());n.deviceCapabilities.add(c)}}else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).SET){n.supportedCustomVideoContentTypes=new Set;for(var d=t.readSetBegin(),m=0;m<d.size;m++){var p=o("WebrtcSignalingCommonTypes").CustomVideoContentType.cast(t.readI32());n.supportedCustomVideoContentTypes.add(p)}}else t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).STRUCT?n.prOffer=pt(t):t.skip(i);break;case 7:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deviceCapabilities===void 0&&(n.deviceCapabilities=new Set),n}function zt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.sdp=pt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function jt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwayCommonTypes").ClientEventType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I64?n.time=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwayCommonTypes").ClientEventType.cast(0)),n}function Kt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).LIST){n.clientEvents=[];for(var l=t.readListBegin(),s=0;s<l.size;s++){var u=jt(t);n.clientEvents.push(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.clientEvents===void 0&&(n.clientEvents=[]),n}function Qt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.groupThreadId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.peerId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function Xt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;t.skip(a),t.readFieldEnd()}return t.readStructEnd(),n}function Yt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.caller=t.readString():t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).SET){n.otherParticipants=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.otherParticipants.add(c)}}else t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I32?n.ringType=o("MultiwayCommonTypes").RingType.cast(t.readI32()):t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.offeredExperiments=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).BOOL?n.isScheduledCall=t.readBool():t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).LIST){n.appMessages=[];for(var d=t.readListBegin(),m=0;m<d.size;m++){var p=o("DataMessageSerializers").deserializeDataMessage(t);n.appMessages.push(p)}}else t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRUCT?n.offer=pt(t):t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).STRUCT?n.mediaStatusEx=o("MultiwaySharedSerializers").deserializeClientMediaStatus(t):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).BOOL?n.isPreconnectSupported=t.readBool():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).STRING?n.sdpOriginLocalId=t.readString():t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRUCT?n.unifiedOffer=pt(t):t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).I32?n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(t.readI32()):t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).STRUCT?n.e2eeEnforcement=o("MultiwaySharedSerializers").deserializeE2eeEnforcement(t):t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).BOOL?n.isLegacyCall=t.readBool():t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).BOOL?n.isTransferCall=t.readBool():t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.relayInfo=o("MultiwaySharedSerializers").deserializeRelayInfo(t):t.skip(i);break;case 21:if(i===(e||(e=r("ThriftTypes"))).MAP){n.overlayConfigs={};for(var _=t.readMapBegin(),f=0;f<_.size;f++){var g=t.readI32(),h=t.readI32();n.overlayConfigs[g]=h}}else t.skip(i);break;case 22:i===(e||(e=r("ThriftTypes"))).STRUCT?n.productMetadata=wt(t):t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).STRING?n.callerClientSessionId=t.readString():t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).STRUCT?n.threadIdInfo=Qt(t):t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).STRING?n.linkUrl=t.readString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.caller===void 0&&(n.caller=""),n.otherParticipants===void 0&&(n.otherParticipants=new Set),n.ringType===void 0&&(n.ringType=o("MultiwayCommonTypes").RingType.cast(0)),n.mediaPath===void 0&&(n.mediaPath=o("MultiwaySharedTypes").MediaPath.cast(0)),n.isTransferCall===void 0&&(n.isTransferCall=!1),n}function Jt(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).I32?n.deviceStatus=o("MultiwayCommonTypes").DeviceStatus.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.deviceStatus===void 0&&(n.deviceStatus=o("MultiwayCommonTypes").DeviceStatus.cast(0)),n}function Zt(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).SET){n.usersToRemove=new Set;for(var l=t.readSetBegin(),s=0;s<l.size;s++){var u=t.readString();n.usersToRemove.add(u)}}else t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.usersToRemove===void 0&&(n.usersToRemove=new Set),n}function en(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.topicId===void 0&&(n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(0)),n}function tn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function nn(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.syncPayload===void 0&&(n.syncPayload=f()),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.topicId===void 0&&(n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(0)),n}function rn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function on(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).STRING?n.data=t.readBinary():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRUCT?n.syncPayload=Ct(t):t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.topicId=o("StateSyncTopicsConfigTypes").TopicId.cast(t.readI32()):t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n.data===void 0&&(n.data=Uint8Array.of()),n}function an(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.topic=t.readString():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).I32?n.version=t.readI32():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.topic===void 0&&(n.topic=""),n.version===void 0&&(n.version=0),n}function ln(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 2:i===(e||(e=r("ThriftTypes"))).I32?n.approvalStatus=o("MultiwayCommonTypes").ApprovalStatus.cast(t.readI32()):t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).SET){n.targetUsers=new Set;for(var s=t.readSetBegin(),u=0;u<s.size;u++){var c=t.readString();n.targetUsers.add(c)}}else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.approvalStatus===void 0&&(n.approvalStatus=o("MultiwayCommonTypes").ApprovalStatus.cast(0)),n.targetUsers===void 0&&(n.targetUsers=new Set),n}function sn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.id=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.id===void 0&&(n.id=""),n}function un(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRING?n.actorId=t.readString():t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRING?n.baseId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.actorId===void 0&&(n.actorId=""),n.baseId===void 0&&(n.baseId=""),n}function cn(t){var n={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:i===(e||(e=r("ThriftTypes"))).I32?n.type=o("MultiwayCommonTypes").MessageType.cast(t.readI32()):t.skip(i);break;case 2:i===(e||(e=r("ThriftTypes"))).STRING?n.conferenceName=t.readString():t.skip(i);break;case 3:i===(e||(e=r("ThriftTypes"))).STRING?n.transactionId=t.readString():t.skip(i);break;case 4:i===(e||(e=r("ThriftTypes"))).I16?n.retryCount=t.readI16():t.skip(i);break;case 5:i===(e||(e=r("ThriftTypes"))).STRING?n.serverInfoData=t.readString():t.skip(i);break;case 6:i===(e||(e=r("ThriftTypes"))).I32?n.responseStatusCode=o("MultiwayCommonTypes").RtcResponseStatusCode.cast(t.readI32()):t.skip(i);break;case 7:if(i===(e||(e=r("ThriftTypes"))).MAP){n.extensions={};for(var s=t.readMapBegin(),u=0;u<s.size;u++){var c=t.readString(),d=t.readString();n.extensions[c]=d}}else t.skip(i);break;case 8:i===(e||(e=r("ThriftTypes"))).I64?n.sequenceNumber=t.readI64().toString():t.skip(i);break;case 9:i===(e||(e=r("ThriftTypes"))).STRING?n.clientSessionId=t.readString():t.skip(i);break;case 10:i===(e||(e=r("ThriftTypes"))).STRING?n.responseStatusMessage=t.readString():t.skip(i);break;case 11:i===(e||(e=r("ThriftTypes"))).I32?n.responseSubCode=o("MultiwayCommonTypes").RtcResponseSubCode.cast(t.readI32()):t.skip(i);break;case 12:i===(e||(e=r("ThriftTypes"))).STRING?n.collisionKey=t.readString():t.skip(i);break;case 13:i===(e||(e=r("ThriftTypes"))).I32?n.conferenceType=o("MultiwaySharedTypes").ConferenceType.cast(t.readI32()):t.skip(i);break;case 14:i===(e||(e=r("ThriftTypes"))).STRING?n.serverSessionId=t.readString():t.skip(i);break;case 15:i===(e||(e=r("ThriftTypes"))).STRING?n.rtcHandle=t.readString():t.skip(i);break;case 16:i===(e||(e=r("ThriftTypes"))).I32?n.retryAfterMsec=t.readI32():t.skip(i);break;case 17:i===(e||(e=r("ThriftTypes"))).STRING?n.receiverUserId=t.readString():t.skip(i);break;case 18:i===(e||(e=r("ThriftTypes"))).I32?n.clientStack=o("WebrtcSignalingCommonTypes").ClientStack.cast(t.readI32()):t.skip(i);break;case 19:i===(e||(e=r("ThriftTypes"))).I64?n.serverMsgTime=t.readI64().toString():t.skip(i);break;case 20:i===(e||(e=r("ThriftTypes"))).STRUCT?n.sender=sn(t):t.skip(i);break;case 21:i===(e||(e=r("ThriftTypes"))).STRUCT?n.receiver=un(t):t.skip(i);break;case 22:if(i===(e||(e=r("ThriftTypes"))).SET){n.messageTags=new Set;for(var m=t.readSetBegin(),p=0;p<m.size;p++){var _=o("MultiwayCommonTypes").MessageTag.cast(t.readI32());n.messageTags.add(_)}}else t.skip(i);break;case 23:i===(e||(e=r("ThriftTypes"))).I64?n.conferenceId=t.readI64().toString():t.skip(i);break;case 24:i===(e||(e=r("ThriftTypes"))).I32?n.protocolVersion=t.readI32():t.skip(i);break;case 25:i===(e||(e=r("ThriftTypes"))).I64?n.bodyCompressionVersion=t.readI64().toString():t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),n.type===void 0&&(n.type=o("MultiwayCommonTypes").MessageType.cast(0)),n.conferenceName===void 0&&(n.conferenceName=""),n.transactionId===void 0&&(n.transactionId=""),n.retryCount===void 0&&(n.retryCount=0),n}function dn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.joinRequest=Vt(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRUCT?n.joinResponse=Ht(t):t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).STRUCT?n.serverMediaUpdateRequest=Et(t):t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRUCT?n.serverMediaUpdateResponse=kt(t):t.skip(a);break;case 5:a===(e||(e=r("ThriftTypes"))).STRUCT?n.hangupRequest=Tt(t):t.skip(a);break;case 6:a===(e||(e=r("ThriftTypes"))).STRUCT?n.iceCandidateRequest=Dt(t):t.skip(a);break;case 8:a===(e||(e=r("ThriftTypes"))).STRUCT?n.ringRequest=Yt(t):t.skip(a);break;case 9:a===(e||(e=r("ThriftTypes"))).STRUCT?n.ringResponse=Jt(t):t.skip(a);break;case 10:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dismissRequest=xt(t):t.skip(a);break;case 11:a===(e||(e=r("ThriftTypes"))).STRUCT?n.conferenceStateRequest=At(t):t.skip(a);break;case 12:a===(e||(e=r("ThriftTypes"))).STRUCT?n.conferenceStateResponse=Ft(t):t.skip(a);break;case 13:a===(e||(e=r("ThriftTypes"))).STRUCT?n.addParticipantsRequest=qt(t):t.skip(a);break;case 14:a===(e||(e=r("ThriftTypes"))).STRUCT?n.subscriptionRequest=Ot(t):t.skip(a);break;case 15:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientMediaUpdateRequest=St(t):t.skip(a);break;case 16:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientMediaUpdateResponse=Rt(t):t.skip(a);break;case 17:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dataMessageRequest=Bt(t):t.skip(a);break;case 18:a===(e||(e=r("ThriftTypes"))).STRUCT?n.removeParticipantsRequest=Zt(t):t.skip(a);break;case 19:a===(e||(e=r("ThriftTypes"))).STRUCT?n.dataMessageResponse=Wt(t):t.skip(a);break;case 30:a===(e||(e=r("ThriftTypes"))).STRUCT?n.updateRequest=nn(t):t.skip(a);break;case 31:a===(e||(e=r("ThriftTypes"))).STRUCT?n.updateResponse=rn(t):t.skip(a);break;case 32:a===(e||(e=r("ThriftTypes"))).STRUCT?n.notifyRequest=on(t):t.skip(a);break;case 33:a===(e||(e=r("ThriftTypes"))).STRUCT?n.notifyResponse=an(t):t.skip(a);break;case 34:a===(e||(e=r("ThriftTypes"))).STRUCT?n.connectRequest=Gt(t):t.skip(a);break;case 35:a===(e||(e=r("ThriftTypes"))).STRUCT?n.connectResponse=zt(t):t.skip(a);break;case 36:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientEventRequest=Kt(t):t.skip(a);break;case 37:a===(e||(e=r("ThriftTypes"))).STRUCT?n.clientEventResponse=Xt(t):t.skip(a);break;case 40:a===(e||(e=r("ThriftTypes"))).STRUCT?n.unsubscribeRequest=en(t):t.skip(a);break;case 41:a===(e||(e=r("ThriftTypes"))).STRUCT?n.unsubscribeResponse=tn(t):t.skip(a);break;case 42:a===(e||(e=r("ThriftTypes"))).STRUCT?n.approvalRequest=ln(t):t.skip(a);break;case 43:a===(e||(e=r("ThriftTypes"))).STRUCT?n.transferRequest=It(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n}function mn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:a===(e||(e=r("ThriftTypes"))).STRUCT?n.messageHeader=cn(t):t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).STRUCT?n.messageBody=dn(t):t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.messageHeader===void 0&&(n.messageHeader=ae()),n.messageBody===void 0&&(n.messageBody=ie()),n}function pn(t){var n={};for(t.readStructBegin();;){var o=t.readFieldBegin(),a=o.ftype,i=o.fid;if(a===(e||(e=r("ThriftTypes"))).STOP)break;switch(i){case 1:if(a===(e||(e=r("ThriftTypes"))).SET){n.users=new Set;for(var l=t.readSetBegin(),s=0;s<l.size;s++){var u=t.readString();n.users.add(u)}}else t.skip(a);break;case 2:a===(e||(e=r("ThriftTypes"))).BOOL?n.allowMultipleJoins=t.readBool():t.skip(a);break;case 3:a===(e||(e=r("ThriftTypes"))).BOOL?n.dismissOthersOnFirstJoin=t.readBool():t.skip(a);break;case 4:a===(e||(e=r("ThriftTypes"))).STRING?n.aliasId=t.readString():t.skip(a);break;default:t.skip(a)}t.readFieldEnd()}return t.readStructEnd(),n.users===void 0&&(n.users=new Set),n.allowMultipleJoins===void 0&&(n.allowMultipleJoins=!1),n.dismissOthersOnFirstJoin===void 0&&(n.dismissOthersOnFirstJoin=!1),n.aliasId===void 0&&(n.aliasId=""),n}function _n(t){var n,o={};for(t.readStructBegin();;){var a=t.readFieldBegin(),i=a.ftype,l=a.fid;if(i===(e||(e=r("ThriftTypes"))).STOP)break;switch(l){case 1:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.joinRequest=Vt(t),n="joinRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: joinRequest, previous deserialized field: "+n);else t.skip(i);break;case 2:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.joinResponse=Ht(t),n="joinResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: joinResponse, previous deserialized field: "+n);else t.skip(i);break;case 3:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.serverMediaUpdateRequest=Et(t),n="serverMediaUpdateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: serverMediaUpdateRequest, previous deserialized field: "+n);else t.skip(i);break;case 4:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.serverMediaUpdateResponse=kt(t),n="serverMediaUpdateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: serverMediaUpdateResponse, previous deserialized field: "+n);else t.skip(i);break;case 5:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.hangupRequest=Tt(t),n="hangupRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: hangupRequest, previous deserialized field: "+n);else t.skip(i);break;case 6:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.iceCandidateRequest=Dt(t),n="iceCandidateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: iceCandidateRequest, previous deserialized field: "+n);else t.skip(i);break;case 8:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.ringRequest=Yt(t),n="ringRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: ringRequest, previous deserialized field: "+n);else t.skip(i);break;case 9:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.ringResponse=Jt(t),n="ringResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: ringResponse, previous deserialized field: "+n);else t.skip(i);break;case 10:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dismissRequest=xt(t),n="dismissRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dismissRequest, previous deserialized field: "+n);else t.skip(i);break;case 11:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.conferenceStateRequest=At(t),n="conferenceStateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: conferenceStateRequest, previous deserialized field: "+n);else t.skip(i);break;case 12:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.conferenceStateResponse=Ft(t),n="conferenceStateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: conferenceStateResponse, previous deserialized field: "+n);else t.skip(i);break;case 13:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.addParticipantsRequest=qt(t),n="addParticipantsRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: addParticipantsRequest, previous deserialized field: "+n);else t.skip(i);break;case 14:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.subscriptionRequest=Ot(t),n="subscriptionRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: subscriptionRequest, previous deserialized field: "+n);else t.skip(i);break;case 15:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientMediaUpdateRequest=St(t),n="clientMediaUpdateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientMediaUpdateRequest, previous deserialized field: "+n);else t.skip(i);break;case 16:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientMediaUpdateResponse=Rt(t),n="clientMediaUpdateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientMediaUpdateResponse, previous deserialized field: "+n);else t.skip(i);break;case 17:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dataMessageRequest=Bt(t),n="dataMessageRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dataMessageRequest, previous deserialized field: "+n);else t.skip(i);break;case 18:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.removeParticipantsRequest=Zt(t),n="removeParticipantsRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: removeParticipantsRequest, previous deserialized field: "+n);else t.skip(i);break;case 19:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.dataMessageResponse=Wt(t),n="dataMessageResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: dataMessageResponse, previous deserialized field: "+n);else t.skip(i);break;case 30:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.updateRequest=nn(t),n="updateRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: updateRequest, previous deserialized field: "+n);else t.skip(i);break;case 31:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.updateResponse=rn(t),n="updateResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: updateResponse, previous deserialized field: "+n);else t.skip(i);break;case 32:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.notifyRequest=on(t),n="notifyRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: notifyRequest, previous deserialized field: "+n);else t.skip(i);break;case 33:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.notifyResponse=an(t),n="notifyResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: notifyResponse, previous deserialized field: "+n);else t.skip(i);break;case 34:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.connectRequest=Gt(t),n="connectRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: connectRequest, previous deserialized field: "+n);else t.skip(i);break;case 35:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.connectResponse=zt(t),n="connectResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: connectResponse, previous deserialized field: "+n);else t.skip(i);break;case 36:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientEventRequest=Kt(t),n="clientEventRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientEventRequest, previous deserialized field: "+n);else t.skip(i);break;case 37:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.clientEventResponse=Xt(t),n="clientEventResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: clientEventResponse, previous deserialized field: "+n);else t.skip(i);break;case 40:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.unsubscribeRequest=en(t),n="unsubscribeRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: unsubscribeRequest, previous deserialized field: "+n);else t.skip(i);break;case 41:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.unsubscribeResponse=tn(t),n="unsubscribeResponse";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: unsubscribeResponse, previous deserialized field: "+n);else t.skip(i);break;case 42:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.approvalRequest=ln(t),n="approvalRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: approvalRequest, previous deserialized field: "+n);else t.skip(i);break;case 43:if(i===(e||(e=r("ThriftTypes"))).STRUCT)if(n==null)o.transferRequest=It(t),n="transferRequest";else throw new Error("more than one field have been deserialized in union type: RtcMessageBodyVariant; current field: transferRequest, previous deserialized field: "+n);else t.skip(i);break;default:t.skip(i)}t.readFieldEnd()}return t.readStructEnd(),o}l.RtcException$DefaultConstructor=s,l.SessionDescription$DefaultConstructor=u,l.SessionDescriptionUpdate$DefaultConstructor=c,l.MediaDescriptionUpdate$DefaultConstructor=d,l.ServerMediaUpdate$DefaultConstructor=m,l.ClientMediaUpdate$DefaultConstructor=p,l.IceCandidate$DefaultConstructor=_,l.SyncPayload$DefaultConstructor=f,l.SyncAck$DefaultConstructor=g,l.E2eeData$DefaultConstructor=h,l.ClientMediaUpdateRequest$DefaultConstructor=y,l.ClientMediaUpdateResponse$DefaultConstructor=C,l.MultipleRelaysAllocationParameters$DefaultConstructor=b,l.ServerMediaUpdateRequest$DefaultConstructor=v,l.ServerMediaUpdateResponse$DefaultConstructor=S,l.TransferRequest$DefaultConstructor=R,l.HangupRequest$DefaultConstructor=L,l.IceCandidateRequest$DefaultConstructor=E,l.DismissRequest$DefaultConstructor=k,l.EndpointSettings$DefaultConstructor=I,l.ParticipantState$DefaultConstructor=T,l.ServerOnlyParticipantState$DefaultConstructor=D,l.UserProfile$DefaultConstructor=x,l.ProductMetadata$DefaultConstructor=$,l.ConferenceStateRequest$DefaultConstructor=P,l.ConferenceStateResponse$DefaultConstructor=N,l.SubscriptionRequest$DefaultConstructor=M,l.DataMessageRequest$DefaultConstructor=w,l.DataMessageResponse$DefaultConstructor=A,l.AddParticipantsRequest$DefaultConstructor=F,l.SfuAllocation$DefaultConstructor=O,l.JoinRequest$DefaultConstructor=B,l.JoinResponse$DefaultConstructor=W,l.ConnectRequest$DefaultConstructor=q,l.ConnectResponse$DefaultConstructor=U,l.ClientEvent$DefaultConstructor=V,l.ClientEventRequest$DefaultConstructor=H,l.ThreadIdInfo$DefaultConstructor=G,l.ClientEventResponse$DefaultConstructor=z,l.RingRequest$DefaultConstructor=j,l.RingResponse$DefaultConstructor=K,l.RemoveParticipantsRequest$DefaultConstructor=Q,l.UnsubscribeRequest$DefaultConstructor=X,l.UnsubscribeResponse$DefaultConstructor=Y,l.UpdateRequest$DefaultConstructor=J,l.UpdateResponse$DefaultConstructor=Z,l.NotifyRequest$DefaultConstructor=ee,l.NotifyResponse$DefaultConstructor=te,l.ApprovalRequest$DefaultConstructor=ne,l.RtcSender$DefaultConstructor=re,l.RtcReceiver$DefaultConstructor=oe,l.RtcMessageHeader$DefaultConstructor=ae,l.RtcMessageBody$DefaultConstructor=ie,l.RtcMultiwayMessage$DefaultConstructor=le,l.GroupOfUsers$DefaultConstructor=se,l.RtcMessageBodyVariant$DefaultConstructor=ue,l.serializeRtcException=ce,l.serializeSessionDescription=de,l.serializeSessionDescriptionUpdate=me,l.serializeMediaDescriptionUpdate=pe,l.serializeServerMediaUpdate=_e,l.serializeClientMediaUpdate=fe,l.serializeIceCandidate=ge,l.serializeSyncPayload=he,l.serializeSyncAck=ye,l.serializeE2eeData=Ce,l.serializeClientMediaUpdateRequest=be,l.serializeClientMediaUpdateResponse=ve,l.serializeMultipleRelaysAllocationParameters=Se,l.serializeServerMediaUpdateRequest=Re,l.serializeServerMediaUpdateResponse=Le,l.serializeTransferRequest=Ee,l.serializeHangupRequest=ke,l.serializeIceCandidateRequest=Ie,l.serializeDismissRequest=Te,l.serializeEndpointSettings=De,l.serializeParticipantState=xe,l.serializeServerOnlyParticipantState=$e,l.serializeUserProfile=Pe,l.serializeProductMetadata=Ne,l.serializeConferenceStateRequest=Me,l.serializeConferenceStateResponse=we,l.serializeSubscriptionRequest=Ae,l.serializeDataMessageRequest=Fe,l.serializeDataMessageResponse=Oe,l.serializeAddParticipantsRequest=Be,l.serializeSfuAllocation=We,l.serializeJoinRequest=qe,l.serializeJoinResponse=Ue,l.serializeConnectRequest=Ve,l.serializeConnectResponse=He,l.serializeClientEvent=Ge,l.serializeClientEventRequest=ze,l.serializeThreadIdInfo=je,l.serializeClientEventResponse=Ke,l.serializeRingRequest=Qe,l.serializeRingResponse=Xe,l.serializeRemoveParticipantsRequest=Ye,l.serializeUnsubscribeRequest=Je,l.serializeUnsubscribeResponse=Ze,l.serializeUpdateRequest=et,l.serializeUpdateResponse=tt,l.serializeNotifyRequest=nt,l.serializeNotifyResponse=rt,l.serializeApprovalRequest=ot,l.serializeRtcSender=at,l.serializeRtcReceiver=it,l.serializeRtcMessageHeader=lt,l.serializeRtcMessageBody=st,l.serializeRtcMultiwayMessage=ut,l.serializeGroupOfUsers=ct,l.serializeRtcMessageBodyVariant=dt,l.deserializeRtcException=mt,l.deserializeSessionDescription=pt,l.deserializeSessionDescriptionUpdate=_t,l.deserializeMediaDescriptionUpdate=ft,l.deserializeServerMediaUpdate=gt,l.deserializeClientMediaUpdate=ht,l.deserializeIceCandidate=yt,l.deserializeSyncPayload=Ct,l.deserializeSyncAck=bt,l.deserializeE2eeData=vt,l.deserializeClientMediaUpdateRequest=St,l.deserializeClientMediaUpdateResponse=Rt,l.deserializeMultipleRelaysAllocationParameters=Lt,l.deserializeServerMediaUpdateRequest=Et,l.deserializeServerMediaUpdateResponse=kt,l.deserializeTransferRequest=It,l.deserializeHangupRequest=Tt,l.deserializeIceCandidateRequest=Dt,l.deserializeDismissRequest=xt,l.deserializeEndpointSettings=$t,l.deserializeParticipantState=Pt,l.deserializeServerOnlyParticipantState=Nt,l.deserializeUserProfile=Mt,l.deserializeProductMetadata=wt,l.deserializeConferenceStateRequest=At,l.deserializeConferenceStateResponse=Ft,l.deserializeSubscriptionRequest=Ot,l.deserializeDataMessageRequest=Bt,l.deserializeDataMessageResponse=Wt,l.deserializeAddParticipantsRequest=qt,l.deserializeSfuAllocation=Ut,l.deserializeJoinRequest=Vt,l.deserializeJoinResponse=Ht,l.deserializeConnectRequest=Gt,l.deserializeConnectResponse=zt,l.deserializeClientEvent=jt,l.deserializeClientEventRequest=Kt,l.deserializeThreadIdInfo=Qt,l.deserializeClientEventResponse=Xt,l.deserializeRingRequest=Yt,l.deserializeRingResponse=Jt,l.deserializeRemoveParticipantsRequest=Zt,l.deserializeUnsubscribeRequest=en,l.deserializeUnsubscribeResponse=tn,l.deserializeUpdateRequest=nn,l.deserializeUpdateResponse=rn,l.deserializeNotifyRequest=on,l.deserializeNotifyResponse=an,l.deserializeApprovalRequest=ln,l.deserializeRtcSender=sn,l.deserializeRtcReceiver=un,l.deserializeRtcMessageHeader=cn,l.deserializeRtcMessageBody=dn,l.deserializeRtcMultiwayMessage=mn,l.deserializeGroupOfUsers=pn,l.deserializeRtcMessageBodyVariant=_n}),98);
__d("OculusMqttChannel",["CurrentUser","HorizonMetaIsCastingRoute","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";r("HorizonMetaIsCastingRoute").getIsCastingRoute()?r("MqttEnvInitializer").initialize(function(e){return new WebSocket(e,"horizon_webcasting")}):r("MqttEnvInitializer").initialize();function e(e){o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn);var t=r("CurrentUser").getAppID()==null?0x9d143786e51a6:Number(r("CurrentUser").getAppID());return new(r("MqttChannel"))({appId:t,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!0,clientCapabilities:r("MqttWebConfig").clientCapabilities,clientType:"websocket",deviceId:r("uuidv4")(),endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("CurrentUser").getPossiblyNonFacebookUserID()})}var s=null;function u(t){return s==null&&(s=e(t)),s}function c(){return s}function d(){s!=null&&(s.shutdown(),s=null)}l.getOculusMqttChannelInstance=u,l.getOculusMqttChannelInstanceDoNotCreate=c,l.shutdownAndClear=d}),98);
__d("OverlayConfigConstants",[],(function(t,n,r,o,a,i){"use strict";var e={OverlayConfigNumParameters:5544,OverlayConfigNotPresentFlagValue:-1},l=e;i.default=l}),66);
__d("OverlayConfigLayerSource",[],(function(t,n,r,o,a,i){"use strict";var e=Object.freeze({UNKNOWN:0,DEFAULT:1,MOBILECONFIG:2,APP_CRUCIBLE:3,APP_JNI:4,UNITTEST_CONFIG:5,SERVER:6,PLACEHOLDER:7,LS_MOBILECONFIG:8,APP_LS:9,APP_JS:10,BROWSER:11,APP_OVRRTC:12,APP_IG:13,MLITE4A_LEGACY_QE:14,APP_MLITE4A:15,APP_PORTAL:16,IG_LAUNCHER:17,APP_ARCHON:18,APP_WS:19,APP_NOX:20,APP_WEARABLE_MSNGR:21,APP_WEARABLE_IG:22,APP_ORCA_RSYS:23,APP_WILDE:24,APP_MKIOS:25,APP_MK4A:26,DYNAMIC:27,SDK_DEFAULT:28,APP_FB4A:29,APP_RSYS_SDK_SAMPLE:30,APP_BIZAPP:31,APP_WORKCHAT:32,APP_ARCHON_LOCAL_OVERRIDES:33,APP_CATHODE:34,APP_WR4I:35,APP_WR4A:36,APP_METACAM:37,HORIZON_EMERGENCY:38,APP_SOCIALPLATFORM:39,APP_TWILIGHT:40,APP_AR_CALLING_LOCAL_OVERRIDES:41,APP_TWILIGHT_CASTING:42,TWILIGHT_EMERGENCY:43,METACAM_EMERGENCY:44,CALL_SCOPED:45,APP_CASE50:46,APP_GENERIC:47,HORIZON_EXPERIMENTAL:48}),l=e;i.default=l}),66);
__d("OverlayConfigServerLayer",["OverlayConfigConstants","OverlayConfigLayerSource"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e){this.$1=e}e.createFromHeader=function(n){try{var t,r=n==null||(t=n.extensions)==null?void 0:t.oc1_json;if(r==null)return null;var o=JSON.parse(r),a=o==null?void 0:o.values;return a==null?null:new e(a)}catch(e){return null}};var t=e.prototype;return t.getLayerSource=function(){return r("OverlayConfigLayerSource").SERVER},t.getValue=function(t){var e=this.$1[String(t)];return e!=null?e:r("OverlayConfigConstants").OverlayConfigNotPresentFlagValue},t.logExposure=function(t){},e})();l.default=e}),98);
__d("RequestStreamBodyUtils",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){return u(atob(t))},l=function(t){return btoa(c(t))},s=function(t){var e=btoa(t),n=e.indexOf("=");return n===-1?e:e.substring(0,n)},u=function(t){for(var e=t,n=e.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=e.charCodeAt(o);return r},c=function(t){for(var e="",n=t.byteLength,r=0;r<n;r++)e+=String.fromCharCode(t[r]);return e};i.base64ToUint8Array=e,i.uint8ArrayToBase64=l,i.stringToBase64WithoutPadding=s,i.stringToUint8Array=u,i.uint8ArrayToString=c}),66);
__d("ZenonDGWLogger",["$InternalEnum","DGWStreamGroupCallbacks","QuickPerformanceLogger","ZenonAuditedCheckpointLogId","ZenonDebugLogger","ZenonInfraActionsLogger","ZenonLoggingUtils","ZenonODSLogger","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("$InternalEnum").Mirrored(["LOGGED_NONE","LOGGED_RETRY","LOGGED_FAILURE"]),u=r("qpl")._(398986999,"3052"),c=r("ZenonDebugLogger").getInstance(),d=!1,m=null;function p(e){d=!0,m=e}function _(t,n){if(o("ZenonLoggingUtils").shouldAllowLogging())switch(t.name){case"dgwStreamCreationInitiated":f(n,t.headers,t.dgwInfo);break;case"dgwStreamCreationSuccess":(e||(e=r("QuickPerformanceLogger"))).markerEnd(u,2,n);break;case"dgwStreamCreationError":c.logConsole("[DGW] Stream creation error: "+t.error),(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(u,{string:{error:t.error}},{instanceKey:n}),(e||(e=r("QuickPerformanceLogger"))).markerEnd(u,87,n);break;case"dgwStreamClosed":c.logConsole("[DGW] Stream closed"+(t.reason!=null?" - Reason: "+t.reason:"")+"}");break;case"dgwStreamError":c.logConsole("[DGW] Stream error: "+t.error);break;default:break}}function f(t,n,o){(e||(e=r("QuickPerformanceLogger"))).markerStart(u,t),e.markerAnnotate(u,{bool:{hasAuthToken:o.hasAuthToken},string:babelHelpers.extends({},n,{deviceId:o.deviceId,loggingId:o.loggingId,serviceId:o.serviceId,windowContext:o.windowContext})},{instanceKey:t}),e.markerPoint(u,"initStreamCreation",{instanceKey:t})}function g(e,t){var n="DGW_STREAM_ERROR_"+t+"_"+e;E(n),r("ZenonODSLogger").logCounter(n)}function h(){E("DGW_SERVER_HAS_FINISHED_SENDING_DATA"),r("ZenonODSLogger").logCounter("DGW_SERVER_HAS_FINISHED_SENDING_DATA")}function y(e){var t="DGW_STREAM_MUST_DRAIN_"+e;E(t),r("ZenonODSLogger").logCounter(t)}function C(){E("DGW_STREAM_RETRY"),r("ZenonODSLogger").logCounter("DGW_STREAM_RETRY")}function b(e){var t=e?"_"+e:"";E("DGW_STREAM_RETRY_SUCCEEDED"+t),r("ZenonODSLogger").logCounter("DGW_STREAM_RETRY_SUCCEEDED"+t)}function v(e){var t=e?"_"+e:"";E("DGW_STREAM_RETRY_FAILED"+t),r("ZenonODSLogger").logCounter("DGW_STREAM_RETRY_FAILED"+t)}function S(e,t){E("["+e+"] Stream closed - Reason: "+(t!=null?t:""))}function R(e){var t="DGW_STREAM_GROUP_ERROR_"+o("DGWStreamGroupCallbacks").dgwStreamGroupErrorToString(e);E(t),r("ZenonODSLogger").logCounter(t)}function L(e){var t="DGW_STREAM_GROUP_MUST_DRAIN_"+e;E(t),r("ZenonODSLogger").logCounter(t)}function E(e){d&&m!=null?m("[SW][ZP] [DGW] "+e):r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] [DGW] "+e})}l.RetryLogState=s,l.setSharedWorkerContext=p,l.logEvent=_,l.logDGWErrorToODS=g,l.logDGWServerHasFinishedToODS=h,l.logDGWStreamMustDrainToODS=y,l.logDGWRetryToODS=C,l.logDGWSucceededRetry=b,l.logDGWFailedRetry=v,l.logDGWStreamClose=S,l.logDGWStreamGroupError=R,l.logDGWStreamGroupMustDrain=L,l.logDGWCheckpoint=E}),98);
__d("ZenonDGWMessageQueue",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1=new Map}var t=e.prototype;return t.enqueue=function(t){this.$1.has(t.messageId)||this.$1.set(t.messageId,t)},t.dequeue=function(t){this.$1.delete(t)},t.sendAllWith=async function(t){this.$2(),await Promise.allSettled(this.$1.values().map(async function(e){e.succeeded=await t.send(e.data,e.timeoutInMs)}))},t.$2=function(){var e=this,t=Array.from(this.$1.values()).filter(function(t){return!e.$3(t)}).map(function(e){return e.messageId});t.forEach(function(t){return e.$1.delete(t)})},t.$3=function(t){var e=Date.now(),n=t.expiryTime,r=n!=null&&e>n;return!r&&!t.succeeded},e})();i.default=e}),66);
__d("ZenonDGWStreamGroupCoordinator",["DGWAuth","DGWClient","DGWConstants","DGWStreamGroupHandler","FBLogger","RawDGWClient","ZenonDGWLogger","err","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e=r("justknobx")._("5209"),s=r("justknobx")._("5210"),u=(function(){function t(e){this.$1=null,this.$3=e}var n=t.prototype;return n.$5=function(){var e=this;return new(r("DGWStreamGroupHandler"))(function(t){e.killStreamGroup(),o("ZenonDGWLogger").logDGWStreamGroupError(t),e.$3()},function(t){e.killStreamGroup(),o("ZenonDGWLogger").logDGWStreamGroupMustDrain(t),e.$3()},function(){e.killStreamGroup(),e.$3()})},n.setDGWConfig=function(t){this.$4=t,this.$1=this.getOrCreateRawDGWClientInstance()},n.establishStream=function(n,o,a){if(this.$2==null){var t,i={authToken:a.authToken,authType:a.authType,connectTimeoutMs:s,deviceId:a.deviceId,disableFalcoLogging:a.disableFalcoLogging,keepAliveMs:e,loggingId:a.loggingId,serviceId:(t=a.serviceId)!=null?t:"rpsignaling",streamGroupAppHeaders:{"stream-group":"group1"}};a.overrideUrl!=null&&(i.overrideUrl=a.overrideUrl);var l=this.$1?this.$1:r("DGWClient")();this.$2=l.createStreamGroup(this.$5(),i)}return this.$2.establishStream({disableFalcoLogging:a.disableFalcoLogging,groupedStreamHeaders:n,loggingId:a.loggingId},o)},n.getOrCreateRawDGWClientInstance=function(){if(this.$1!=null)return this.$1;if(this.$4==null){var e=r("err")("dgwConfig is required but was not provided");throw r("FBLogger")("zenon").catching(e).mustfix("Failed to create RawDGWClient: missing dgwConfig"),e}var t=this.$4;return new(o("RawDGWClient")).RawDGWClient({appId:t.appId,appVersion:t.appVersion,authToken:t.authToken,authType:o("DGWAuth").fromStringToDGWAuth(t.authType),dgwVersion:o("DGWConstants").DgwVersion.DGWVER_BIG_IDS,endpoint:t.endpoint,fbId:t.fbId,isUserLoggedIn:t.isUserLoggedIn})},n.killStreamGroup=function(){var e;(e=this.$2)==null||e.close(),this.$2=null},t})();l.default=u}),98);
__d("ZenonDeviceId",["ChannelClientID","WebStorage"],(function(t,n,r,o,a,i,l){"use strict";var e,s="chatd-deviceid";function u(){return o("ChannelClientID").getID()}function c(t){(e||(e=r("WebStorage"))).setAllowlistedKeyToLocalStorage(e.getLocalStorage(),s,t)}function d(){return(e||(e=r("WebStorage"))).getAllowlistedKeyFromLocalStorage(s)}function m(){var e;return(e=d())!=null?e:u()}l.getZenonDeviceId=u,l.setZenonLocalStorageDeviceId=c,l.getZenonLocalStorageDeviceId=d,l.getZenonLocalStorageDeviceIdWithFallback=m}),98);
__d("ZenonDGWStreamController",["DGWStream","EventEmitter","Random","Run","ZenonDGWLogger","ZenonDGWMessageQueue","ZenonDGWStreamGroupCoordinator","ZenonDeviceId","justknobx","promiseDone","qex","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("justknobx")._("1942"),u=r("justknobx")._("5207"),c=r("justknobx")._("5208"),d=(e=r("qex")._("3872"))!=null?e:!1,m=null,p=(function(e){function t(){var t;return t=e.call(this)||this,t.$ZenonDGWStreamController$p_6=o("Random").uint32(),t.$ZenonDGWStreamController$p_7="UNKNOWN",t.$ZenonDGWStreamController$p_8=o("ZenonDGWLogger").RetryLogState.LOGGED_NONE,t.$ZenonDGWStreamController$p_9="Disconnected",t.$ZenonDGWStreamController$p_10=s,t.$ZenonDGWStreamController$p_11=!1,t.$ZenonDGWStreamController$p_5={deviceId:o("ZenonDeviceId").getZenonDeviceId(),loggingId:r("uuidv4")(),serviceId:"rpsignaling"},t.$ZenonDGWStreamController$p_1=new(r("ZenonDGWStreamGroupCoordinator"))(function(){r("promiseDone")(t.$ZenonDGWStreamController$p_19())}),o("Run").onBeforeUnload(function(){t.$ZenonDGWStreamController$p_8===o("ZenonDGWLogger").RetryLogState.LOGGED_RETRY&&o("ZenonDGWLogger").logDGWFailedRetry()}),d&&(t.$ZenonDGWStreamController$p_2=new(r("ZenonDGWMessageQueue"))),t.$ZenonDGWStreamController$p_4={},t}babelHelpers.inheritsLoose(t,e),t.getControllerInstance=function(){return m||(m=new t),m};var n=t.prototype;return n.setHeaders=function(t){this.$ZenonDGWStreamController$p_4=t},n.setStreamOptions=function(t){this.$ZenonDGWStreamController$p_5=t},n.setDGWConfig=function(t){this.$ZenonDGWStreamController$p_18=t,this.$ZenonDGWStreamController$p_1.setDGWConfig(t)},n.setWindowContext=function(t){this.$ZenonDGWStreamController$p_7=t},n.getStream=function(){return this.$ZenonDGWStreamController$p_3},n.closeStream=function(t){this.$ZenonDGWStreamController$p_3!=null&&(this.$ZenonDGWStreamController$p_3.close(),this.$ZenonDGWStreamController$p_3=null,o("ZenonDGWLogger").logDGWStreamClose(this.$ZenonDGWStreamController$p_7,t))},n.$ZenonDGWStreamController$p_20=function(t){this.$ZenonDGWStreamController$p_9=t,this.emit("connectionStateEvent",t)},n.$ZenonDGWStreamController$p_21=function(){var e=this,t={onClose:function(n){e.$ZenonDGWStreamController$p_13==null||e.$ZenonDGWStreamController$p_13(n),e.$ZenonDGWStreamController$p_3=null},onDataReceived:function(n){e.$ZenonDGWStreamController$p_14==null||e.$ZenonDGWStreamController$p_14(n)},onError:function(n){e.$ZenonDGWStreamController$p_15==null||e.$ZenonDGWStreamController$p_15(n),o("ZenonDGWLogger").logDGWErrorToODS(n,e.$ZenonDGWStreamController$p_7),e.$ZenonDGWStreamController$p_19(n)},onServerHasFinishedSendingData:function(n){e.$ZenonDGWStreamController$p_17==null||e.$ZenonDGWStreamController$p_17(n),o("ZenonDGWLogger").logDGWServerHasFinishedToODS(),e.$ZenonDGWStreamController$p_19()},onStreamMustDrain:function(n,r){e.$ZenonDGWStreamController$p_16==null||e.$ZenonDGWStreamController$p_16(n,r),o("ZenonDGWLogger").logDGWStreamMustDrainToODS(r),e.$ZenonDGWStreamController$p_19()}};return t},n.$ZenonDGWStreamController$p_19=function(t){return t!=null&&!o("DGWStream").isRetryableError(t)||this.$ZenonDGWStreamController$p_10<=0?(o("ZenonDGWLogger").logEvent({error:String(t!=null?t:"drain"),name:"dgwStreamCreationError"},this.$ZenonDGWStreamController$p_6),this.$ZenonDGWStreamController$p_20("Disconnected"),this.$ZenonDGWStreamController$p_10<=0&&this.$ZenonDGWStreamController$p_8===o("ZenonDGWLogger").RetryLogState.LOGGED_RETRY&&(this.$ZenonDGWStreamController$p_8=o("ZenonDGWLogger").RetryLogState.LOGGED_FAILURE,o("ZenonDGWLogger").logDGWFailedRetry(t)),Promise.resolve()):(this.$ZenonDGWStreamController$p_8===o("ZenonDGWLogger").RetryLogState.LOGGED_NONE&&(this.$ZenonDGWStreamController$p_8=o("ZenonDGWLogger").RetryLogState.LOGGED_RETRY,o("ZenonDGWLogger").logDGWRetryToODS()),this.$ZenonDGWStreamController$p_12==null&&(this.closeStream("reestablishing stream"),this.$ZenonDGWStreamController$p_1.killStreamGroup(),this.$ZenonDGWStreamController$p_10--),this.establishAndGetStream())},n.restartStreamWithNewOptions=function(t){return this.closeStream("restarting with new options"),this.$ZenonDGWStreamController$p_1.killStreamGroup(),this.$ZenonDGWStreamController$p_5=t,this.establishAndGetStream()},n.setOnCloseCallback=function(t){this.$ZenonDGWStreamController$p_13=t},n.setOnDataReceivedCallback=function(t){this.$ZenonDGWStreamController$p_14=t},n.setOnErrorCallback=function(t){this.$ZenonDGWStreamController$p_15=t},n.setOnStreamMustDrainCallback=function(t){this.$ZenonDGWStreamController$p_16=t},n.setOnServerHasFinishedSendingDataCallback=function(t){this.$ZenonDGWStreamController$p_17=t},n.getConnectionState=function(){return this.$ZenonDGWStreamController$p_9},n.send=async function(t,n,r){var e,a,i,l={data:n,expiryTime:Date.now()+u,messageId:t,succeeded:!1,timeoutInMs:r!=null?r:c};(e=this.$ZenonDGWStreamController$p_2)==null||e.enqueue(l);var s=(a=await((i=this.$ZenonDGWStreamController$p_3)==null?void 0:i.send(l.data,l.timeoutInMs)))!=null?a:!1;if(!s)this.$ZenonDGWStreamController$p_19(o("DGWStream").StreamError.ACK_TIMEOUT);else{var d;l.succeeded=!0,(d=this.$ZenonDGWStreamController$p_2)==null||d.dequeue(l.messageId)}return s},n.establishAndGetStream=async function(){var e=this;if(this.$ZenonDGWStreamController$p_3)return this.$ZenonDGWStreamController$p_3;if(this.$ZenonDGWStreamController$p_12!=null)return await this.$ZenonDGWStreamController$p_12;var t=(async function(){try{var t;o("ZenonDGWLogger").logEvent({dgwInfo:{deviceId:e.$ZenonDGWStreamController$p_5.deviceId,hasAuthToken:e.$ZenonDGWStreamController$p_5.authToken!=null,loggingId:e.$ZenonDGWStreamController$p_5.loggingId,serviceId:e.$ZenonDGWStreamController$p_5.serviceId,windowContext:e.$ZenonDGWStreamController$p_7},headers:e.$ZenonDGWStreamController$p_4,name:"dgwStreamCreationInitiated"},e.$ZenonDGWStreamController$p_6),e.$ZenonDGWStreamController$p_20("Connecting");var n=await e.$ZenonDGWStreamController$p_1.establishStream(e.$ZenonDGWStreamController$p_4,e.$ZenonDGWStreamController$p_21(),e.$ZenonDGWStreamController$p_5);return o("ZenonDGWLogger").logEvent({name:"dgwStreamCreationSuccess"},e.$ZenonDGWStreamController$p_6),e.$ZenonDGWStreamController$p_8===o("ZenonDGWLogger").RetryLogState.LOGGED_RETRY&&o("ZenonDGWLogger").logDGWSucceededRetry(),e.$ZenonDGWStreamController$p_12=null,e.$ZenonDGWStreamController$p_10=s,e.$ZenonDGWStreamController$p_8=o("ZenonDGWLogger").RetryLogState.LOGGED_NONE,e.$ZenonDGWStreamController$p_20("Connected"),await((t=e.$ZenonDGWStreamController$p_2)==null?void 0:t.sendAllWith(n)),e.$ZenonDGWStreamController$p_3=n,n}catch(t){e.$ZenonDGWStreamController$p_12=null;var r=await e.$ZenonDGWStreamController$p_19(o("DGWStream").StreamError.isValid(t)?t:null);if(r)return r;throw t}})();return this.$ZenonDGWStreamController$p_12=t,t},t})(r("EventEmitter"));l.default=p}),98);
__d("ZenonIceStatsParser",[],(function(t,n,r,o,a,i){"use strict";function e(e){var t=[],n=e.split("\r\n");return n.forEach(function(e){l(e)&&t.push({gen:s(e),type:u(e)})}),t}function l(e){return e.indexOf("candidate:")>-1}function s(e){var t=0,n=e.match(/generation (\d+)/);return n&&(t=parseInt(n[1],10)),t}function u(e){var t=e.match(/typ (host|relay|srflx|prflx)/);return t?t[1]:"unknown"}i.extractIceInfo=e}),66);
__d("ZenonMWThriftMessageMap",["MultiwayCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e==null)return"UNKNOWN";switch(e){case o("MultiwayCommonTypes").MessageType.JOIN:return"JOIN";case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:return"SERVER_MEDIA_UPDATE";case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:return"ICE_CANDIDATE";case o("MultiwayCommonTypes").MessageType.HANGUP:return"HANGUP";case o("MultiwayCommonTypes").MessageType.RING:return"RING";case o("MultiwayCommonTypes").MessageType.DISMISS:return"DISMISS";case o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE:return"CONFERENCE_STATE";case o("MultiwayCommonTypes").MessageType.ADD_PARTICIPANTS:return"ADD_PARTICIPANTS";case o("MultiwayCommonTypes").MessageType.SUBSCRIPTION:return"SUBSCRIPTION";case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:return"CLIENT_MEDIA_UPDATE";case o("MultiwayCommonTypes").MessageType.DATA_MESSAGE:return"DATA_MESSAGE";case o("MultiwayCommonTypes").MessageType.REMOVE_PARTICIPANTS:return"REMOVE_PARTICIPANTS";case o("MultiwayCommonTypes").MessageType.PING:return"PING";case o("MultiwayCommonTypes").MessageType.NOTIFY:return"NOTIFY";case o("MultiwayCommonTypes").MessageType.CONNECT:return"CONNECT";case o("MultiwayCommonTypes").MessageType.CLIENT_EVENT:return"CLIENT_EVENT";case o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE:return"UNSUBSCRIBE";case o("MultiwayCommonTypes").MessageType.UPDATE:return"UPDATE";case o("MultiwayCommonTypes").MessageType.APPROVAL:return"APPROVAL";case o("MultiwayCommonTypes").MessageType.WAKEUP:return"WAKEUP";default:return"UNKNOWN"}}function s(e){switch(e.toLowerCase()){case"join":return o("MultiwayCommonTypes").MessageType.JOIN;case"server_media_update":return o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE;case"ice_candidate":return o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE;case"hangup":return o("MultiwayCommonTypes").MessageType.HANGUP;case"ring":return o("MultiwayCommonTypes").MessageType.RING;case"dismiss":return o("MultiwayCommonTypes").MessageType.DISMISS;case"conference_state":return o("MultiwayCommonTypes").MessageType.CONFERENCE_STATE;case"add_participants":return o("MultiwayCommonTypes").MessageType.ADD_PARTICIPANTS;case"subscription":return o("MultiwayCommonTypes").MessageType.SUBSCRIPTION;case"client_media_update":return o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE;case"data_message":return o("MultiwayCommonTypes").MessageType.DATA_MESSAGE;case"remove_participants":return o("MultiwayCommonTypes").MessageType.REMOVE_PARTICIPANTS;case"ping":return o("MultiwayCommonTypes").MessageType.PING;case"notify":return o("MultiwayCommonTypes").MessageType.NOTIFY;case"connect":return o("MultiwayCommonTypes").MessageType.CONNECT;case"client_event":return o("MultiwayCommonTypes").MessageType.CLIENT_EVENT;case"unsubscribe":return o("MultiwayCommonTypes").MessageType.UNSUBSCRIBE;case"update":return o("MultiwayCommonTypes").MessageType.UPDATE;case"approval":return o("MultiwayCommonTypes").MessageType.APPROVAL;case"wakeup":return o("MultiwayCommonTypes").MessageType.WAKEUP;default:return null}}l.messageTypeToString=e,l.messageTypeFromString=s}),98);
__d("ZenonEndCallReason",["$InternalEnum"],(function(t,n,r,o,a,i){var e=n("$InternalEnum")({BREAKOUT_SESSION_SWITCH_ROOM:"BreakoutSessionSwitchRoom",CALL_END_ACCEPT_AFTER_HANG_UP:"CallEndAcceptAfterHangUp",CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:"CallerHasAppealableCallingRestriction",CALLER_NOT_VISIBLE:"CallerNotVisible",CAMERA_PERMISSION_DENIED:"CameraPermissionDenied",CARRIER_BLOCKED:"CarrierBlocked",CLIENT_ENCRYPTION_ERROR:"ClientEncryptionError",CLIENT_ERROR:"ClientError",CLIENT_INTERRUPTED:"ClientInterrupted",CONNECTION_DROPPED:"ConnectionDropped",END_TO_END_ENCRYPTION_INVARIANT_VIOLATED:"EndToEndEncryptionInvariantViolated",HANGUP_CALL:"HangupCall",IGNORE_CALL:"IgnoreCall",IN_ANOTHER_CALL:"InAnotherCall",INACTIVE_TIMEOUT:"InactiveTimeout",INCOMING_TIMEOUT:"IncomingTimeout",MAX_ALLOWED_PARTICIPANTS_REACHED:"MaxAllowedParticipantsReached",MICROPHONE_PERMISSION_DENIED:"MicrophonePermissionDenied",NO_ANSWER_TIMEOUT:"NoAnswerTimeout",NO_PERMISSION:"NoPermission",NO_UI_SHOWN:"NoUIShown",OTHER_CARRIER_BLOCKED:"OtherCarrierBlocked",OTHER_INSTANCE_HANDLED:"OtherInstanceHandled",OTHER_NOT_CAPABLE:"OtherNotCapable",PRODUCT_SERVER_DEFINED_END_REASON:"ProductServerDefinedEndReason",REMOVED_BY_PARTICIPANT:"RemovedByParticipant",RING_MUTED:"RingMuted",SESSION_MIGRATED:"SessionMigrated",SIGNALING_MESSAGE_FAILED:"SignalingMessageFailed",TX_ACK_TIMEOUT:"TxAckTimeout",UNEXPECTED_END_OF_CALL:"UnexpectedEndOfCall",UNKNOWN:"Unknown",VERSION_UNSUPPORTED:"VersionUnsupported",WEBRTC_ERROR:"WebRTCError"}),l=e;i.default=l}),66);
__d("ZenonIncomingRingSDKTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["Hangup","OtherDismiss"]);i.ZenonCancelReason=e}),66);
__d("fbwebrtc_ClientStack",[],(function(t,n,r,o,a,i){var e=Object.freeze({OLD_CLIENT_PLATFORM_STACK:0,RSYS_X:1,IG_OLD_STACK:2,MLITE_OLD_STACK:3,SCOTCH:4,ZENON:5});i.default=e}),66);
__d("multiway_ApprovalStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({DENIED:0,APPROVED:1});i.default=e}),66);
__d("multiway_Capability",[],(function(t,n,r,o,a,i){var e=Object.freeze({SUPPORT_AUDIO_DEPRECATED:0,SUPPORT_VIDEO_DEPRECATED:1,SUPPORT_EXPERIMENTS_IN_JOIN_RESPONSE:2,SUPPORT_NEW_PARTICIPANT_STATES:3,SUPPORT_SDP_RENEGOTIATION:4,SUPPORT_MWPP:5,REQUIRE_FULL_SDP_IN_SMU:6,SUPPORT_PRECONNECT:7,SUPPORT_MWPP_DEESCALATION:8,SUPPORT_PARTICIPANT_STATE_UNCALLABLE:9,SUPPORT_MULTIPLE_VIDEO_STREAMS:10,REQUIRE_FULL_SDP_IN_SMU_OPTIMIZED:11,SUPPORT_MULTISTREAM_FEC:12,SUPPORT_DELTA_SMU:13,REQUIRE_DEFAULT_CHANNEL_SCREENSHARE:14,SUPPORT_SCREENSHARE_FLAG_IN_JOIN_RESPONSE_AND_SMU:15,SUPPORT_TEMPORAL_LAYER_JBE:16,REQUIRES_P2P_RELAY_INFO_VIA_SIGNALING:17,SUPPORT_NUMERIC_TOPICS:18,SUPPORT_PSEUDO_QUIC_CONNECTION:19,SUPPORT_SDP_SENDRECV:20});i.default=e}),66);
__d("multiway_ClientEventType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,MEDIA_CONNECTED:1});i.default=e}),66);
__d("multiway_ConferenceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,IGVIDEOCALL:9,ROOM:15,CRUCIBLE:20,MBS_WA:21,BOT:22,HORIZON:23,ULLC:24});i.default=e}),66);
__d("multiway_DeviceStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10});i.default=e}),66);
__d("multiway_DismissReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7,CALL_ENDED_BY_PRODUCT:9,JOIN_APPROVAL_DENIED:10,JOIN_APPROVAL_TIMEDOUT:11,UNSUPPORTED_VERSION:12,LIVE_NOT_ACKED:13,TX_ACK_TIMEDOUT:14,ANSWERED_BY_OTHER_USER:15,PARTICIPANT_SELF_TERMINATION:16,PARTICIPANT_REJOIN:17,LONG_LASTING_AUDIO_ISSUE:18,PRIMARY_ENDPOINT_HANGUP:19,RECONNECT_FAILED:20,E2EE_HARDENING_ERROR:21,CALL_ENDED_BY_EXTENSION:22,CALL_ENDED_BY_OVER_CAPACITY:23});i.default=e}),66);
__d("multiway_E2eeMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({E2EE_NOT_MANDATED:0,DEPRECATED_NO_REQUIREMENT:1,E2EE_MANDATED:2,E2EE_BYPASSED_USER_CONSENTED:3});i.default=e}),66);
__d("multiway_EndpointServiceType",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,COMPOSITING_SERVICE:1,MEDIA_SERVER:2,CATHODE_AMBISONIC:3,CATHODE_CAPTIONS:4,CATHODE_MEETING_SUMMARIZER:5,CATHODE_REALTIME_SHARED_STATE:6,RP_GENAI_SERVICE:7,SMART_GLASSES_ASSISTANT:8});i.default=e}),66);
__d("multiway_HangupReason",[],(function(t,n,r,o,a,i){var e=Object.freeze({IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5,SESSION_MIGRATED:6,E2EE_MANDATED_BUT_OFFER_DID_NOT_CONTAIN_E2EE:7,E2EE_MANDATED_BUT_ANSWER_DID_NOT_NEGOTIATE_E2EE:8,WEBRTC_ERROR:9,CONNECTION_DROPPED:10});i.default=e}),66);
__d("multiway_JoinMode",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRIMARY:0,SECONDARY:1});i.default=e}),66);
__d("multiway_MediaPath",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,SFU:1,P2P:2});i.default=e}),66);
__d("multiway_MediaPauseStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({NotPaused:0,Paused:1});i.default=e}),66);
__d("multiway_MessageTag",[],(function(t,n,r,o,a,i){var e=Object.freeze({PRANSWER:1001,INITIAL_ANSWER_TO_P2P_CALLER:1002,DEESCALATE_OFFER_TO_P2P_CALLEE:1003,DEESCALATE_ANSWER_TO_P2P_CALLER:1004,REQUEST_DEESCALATE_TO_P2P_CALLER:1005,REQUEST_ESCALATE:1006,REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:1007,REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:1008,PARTICIPANT_ADDED:1009,PARTICIPANT_REMOVED:1010,FIRST_REMOTE_ALERTED_FOR_INITIATOR:2001,FIRST_REMOTE_ANSWERED_FOR_INITIATOR:2002,CONTAIN_PENDING_APPROVAL_PARTICIPANTS:2003,KEEP_ALIVE_PING:3001,IS_INITIATOR:4001,PREGEN_SDP:4002});i.default=e}),66);
__d("multiway_MessageType",[],(function(t,n,r,o,a,i){var e=Object.freeze({JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,PING:18,UPDATE:20,NOTIFY:21,CONNECT:22,CLIENT_EVENT:23,UNSUBSCRIBE:25,APPROVAL:26,TRANSFER:27,WAKEUP:28});i.default=e}),66);
__d("multiway_ParticipantCallState",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11,RING_TYPE_UNSUPPORTED:12,PENDING_APPROVAL:13,APPROVED:14,FAILED_APPROVAL:15,HANGUP_IN_WAITING_ROOM:16,UNCALLABLE:17,UNCALLABLE_DELAYED:18});i.default=e}),66);
__d("multiway_RingType",[],(function(t,n,r,o,a,i){var e=Object.freeze({GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4,PEER_ESCALATED_VIDEO_CALL:5,PEER_ESCALATED_AUDIO_CALL:6,LIVE_AUDIO_ROOM:7,LIVE_WITH_ROOM:8});i.default=e}),66);
__d("multiway_RtcResponseStatusCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONFLICT:409,CONDITIONAL_REQUEST_FAILED:412,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503});i.default=e}),66);
__d("multiway_RtcResponseSubCode",[],(function(t,n,r,o,a,i){var e=Object.freeze({UNKNOWN:1e3,EXCEEDED_MAX_ALLOWED_PARTICIPANTS:1001,MEMBERSHIP_CHECK_FAIL:1002,CONFERENCE_THROTTLED:1003,ENDPOINT_THROTTLED:1004,MWS_MESSAGE_SENT_TO_INCORRECT_REGION:1005,UNSUPPORTED_REQUEST_TYPE:2e3,CLIENT_REQUEST_UNACCEPTABLE:2001,CLIENT_RESPONSE_UNACCEPTABLE:2002,RING_RESPONSE_BODY_NOT_SET:2004,SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:2005,INVALID_SDP:2006,INVALID_CONFERENCE_NAME:2007,SERVER_INFO_CONFERENCE_NAME_MISMATCH:2008,INVALID_USER_ID:2009,INCORRECT_VERSION_RANGE:2010,SENDER_ID_MISMATCH:2011,RECIPIENT_NOT_SPECIFIED:2012,FIELD_NOT_ALLOWED:2013,USERS_NOT_SPECIFIED:2015,REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:2016,INVALID_CALL_ID:2017,SESSION_DESCRIPTION_ID_MISMATCH:2018,EMPTY_CLIENT_MEDIA_UPDATES:2019,INVALID_SERVER_INFO_DATA:2020,INCORRECT_STATE_VERSION:2021,MISMATCHED_STATE_FOR_VERSION:2022,INVALID_STATE_VERSION:2023,NO_RESOLVER_FOUND:2024,MISSING_APPROVERLIST:2025,FULL_SDP_REQUIRED_IN_APPROVED_STATE:2026,INVALID_BROADCAST_ID:2027,INVALID_ENDPOINT_CONFIG:2028,INVALID_E2EE_STATE:2029,SFU_MODE_PREVENTED:2030,INVALID_CONFERENCE_STATE:2031,JOIN_REQUEST_DENIED:2032,EMPTY_USER_IDS:2033,MISSING_SDP_CONNECT_REQUEST:2034,CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:2035,MISSING_BODY_ENDPOINT:2101,MISSING_BODY_HEADER:2102,MISSING_BODY_BODY:2103,MISSING_BODY_PARAMS:2104,MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:2105,MISSING_BODY_DATA_MESSAGE_REQUEST:2106,MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:2107,MISSING_BODY_ADD_PARTICIPANTS_REQUEST:2108,MISSING_BODY_SUBSCRIPTION_REQUEST:2110,MISSING_BODY_JOIN_REQUEST:2111,MISSING_BODY_HANGUP_REQUEST:2112,MISSING_BODY_ICE_CANDIDATE_REQUEST:2113,MISSING_BODY_P2P_MESSAGE_REQUEST:2114,MISSING_BODY_UPDATE_REQUEST:2115,MISSING_BODY_CLIENT_EVENT_REQUEST:2116,MISSING_BODY_CONNECT_REQUEST:2117,MISSING_BODY_UNSUBSCRIBE_REQUEST:2118,MISSING_BODY_APPROVAL_REQUEST:2119,MISSING_ENDPOINT_USER_ID:2120,EMPTY_ENDPOINT_USER_ID:2121,MISSING_BODY_TRANSFER_REQUEST:2122,MISSING_BODY_GENERIC:2199,REQUESTOR_NOT_MEMBER_CONFERENCE:3002,NOT_BROADCAST_OWNER:3003,GUEST_NOT_INVITED:3004,GUEST_DISCONNECTED:3005,GUEST_INVITATION_EXPIRED:3006,PARTICIPANT_IN_PENDING_APPROVAL_STATE:3008,INVALID_MULTIWAY_PARAMS:3009,BROADCAST_ALREADY_STOPPED:4002,FAILED_TO_GENERATE_SDP_ANSWER:4003,FAILED_GENERATE_SESSION_DESCRIPTION:4004,SDP_SESSION_ID_MISMATCH:4005,MEDIA_ENDPOINT_GONE:4007,MEDIA_ENDPOINT_ALREADY_EXISTS:4008,MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:4009,LEGACY_MESSENGER_SENDER_UNSET:4010,FAILED_TO_SET_TRANSPORT_INFO:4011,NON_PRIMARY_MULTIWAY_SERVER:4012,FAILED_TO_GET_REMOTE_DESCRIPTION:4013,LOCAL_DESCRIPTION_NOT_SET:4014,INVALID_SDP_TYPE:4015,CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:4016,SDP_UNSET_ON_P2P_ANSWER:4017,MISSING_ICE_CANDIDATE_PAYLOAD:4018,P2P_PROTOCOL_UNSET:4019,CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:4020,LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:4021,CONNECT_UNSUPPORTED_IN_SFU_MODE:4022,CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:4023,RESOLVE_STATE_API_ERROR:4024,EXTERNAL_RESOLUTION_ERROR:4025,INTERNAL_RESOLUTION_ERROR:4026,RESOLUTION_DISABLED:4027,BROADCAST_ID_MISSING:4028,SDP_UNSET_ON_P2P_OFFER:4029,LEGACY_OFFER_MISSING_REQUIRED_VALUE:4031,MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:4032,CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:4033,OTHER_USER_ANSWERED_THE_CALL:4034,MEDIA_SERVER_DESERIALIZATION_ERROR:4035,REMOTE_SDP_TRACKID_MISMATCH:4036,SIGNALING_MESSAGE_TO_CLIENT_DROPPED:4037,DATA_CHANNEL_ENDPOINT_GONE:4038,DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:4039,CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:4040,P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:4041,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:4042,CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:4043,REQUEST_TIMEOUT:4044,TOO_MANY_MEDIA_TRACKS_IN_SDP:4045,CONFERENCE_NOT_FOUND:5001,CONFERENCE_IS_TERMINATING:5002,CONFERENCE_IS_TERMINATED:5003,CONFERENCE_NAME_EMPTY:5004,NONCE_EMPTY:5005,NONCE_MISMATCH:5006,CONFERENCE_HAS_GONE:5007,PARTICIPANT_HAS_GONE:5008,MEDIA_SERVER_NOT_FOUND:5009,CLIENT_TERMINATED:5010,JOIN_SESSION_RESULT_MISSING:5012,LOGGING_POLICY_RESULT_MISSING:5013,INVITE_USERS_RESULT_MISSING:5014,STATE_SYNC_RESULT_MISSING:5015,ENDPOINT_INFO_RESULT_MISSING:5016,CONFERENCE_NAME_MISMATCH:5017,UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:5018,SESSION_CONFIGURATION_RESULT_MISSING:5019,REMOVE_USERS_RESULT_MISSING:5020,MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:6001,CONFERENCE_INCAPABLE_RENEGOTIATION:6002,REJECTING_CMU_WHEN_SMU_PENDING:6003,PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:6004,PARTICIPANT_ALREADY_IN_WAITING_ROOM:6005,PARTICIPANT_NOT_IN_PENDING_APPROVAL:6006,USER_NOT_APPROVER_FOR_TARGET_USER:6007,UNSUPPORTED_CAPABILITIES:6008,PRODUCT_SERVER_DEFINED_END_REASON:6009,WWW_KILLSWITCHED_REQUEST:6010,CONFLICTING_MEDIA_PATH:6011,CONFLICTING_MEDIA_STATUS:6012,CONFLICTING_SESSION_DESCRIPTION:6013,OK:9e3});i.default=e}),66);
__d("multiway_SubscriptionType",[],(function(t,n,r,o,a,i){var e=Object.freeze({CNAME:0,TRACK:1,DOMINANT_SPEAKER:2});i.default=e}),66);
__d("multiway_VideoQuality",[],(function(t,n,r,o,a,i){var e=Object.freeze({LOW:0,MEDIUM:1,HIGH:2,HD:3,NUM_QUALITIES:4});i.default=e}),66);
__d("ZenonMWMessageTypes",["$InternalEnum","fbwebrtc_ClientStack","multiway_ApprovalStatus","multiway_Capability","multiway_ClientEventType","multiway_ConferenceType","multiway_DeviceStatus","multiway_DismissReason","multiway_E2eeMode","multiway_EndpointServiceType","multiway_HangupReason","multiway_JoinMode","multiway_MediaPath","multiway_MediaPauseStatus","multiway_MessageTag","multiway_MessageType","multiway_ParticipantCallState","multiway_RingType","multiway_RtcResponseStatusCode","multiway_RtcResponseSubCode","multiway_SubscriptionType","multiway_VideoQuality"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({DEFAULT_AUDIO:0,DEFAULT_VIDEO:1,SCREEN_AUDIO:2,SCREEN_VIDEO:3});l.ZenonMWClientStack=r("fbwebrtc_ClientStack"),l.ZenonMWApprovalStatus=r("multiway_ApprovalStatus"),l.ZenonMWCapability=r("multiway_Capability"),l.ZenonMWClientEventType=r("multiway_ClientEventType"),l.ZenonMWConferenceType=r("multiway_ConferenceType"),l.ZenonMWDeviceStatus=r("multiway_DeviceStatus"),l.ZenonMWDismissReason=r("multiway_DismissReason"),l.ZenonMWE2eeMode=r("multiway_E2eeMode"),l.ZenonMWEndpointServiceType=r("multiway_EndpointServiceType"),l.ZenonMWHangupReason=r("multiway_HangupReason"),l.ZenonMWMediaPath=r("multiway_MediaPath"),l.ZenonMWJoinMode=r("multiway_JoinMode"),l.ZenonMWMediaPauseStatus=r("multiway_MediaPauseStatus"),l.ZenonMWMessageTag=r("multiway_MessageTag"),l.ZenonMWSignalingPayloadType=r("multiway_MessageType"),l.ZenonMWParticipantCallState=r("multiway_ParticipantCallState"),l.ZenonMWRingType=r("multiway_RingType"),l.ZenonMWResponseStatusCode=r("multiway_RtcResponseStatusCode"),l.ZenonMWResponseSubCode=r("multiway_RtcResponseSubCode"),l.ZenonMWSubscriptionType=r("multiway_SubscriptionType"),l.ZenonMWVideoQuality=r("multiway_VideoQuality"),l.ZenonMWTrackLabel=e}),98);
__d("ZenonMediaError",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["ConnectionClosed","IceDisconnected","IceFailure","SetLocalSdpFailed","SetRemoteSdpFailed","RollbackSdpFailed","UnknownError"]);i.ZenonMediaError=e}),66);
__d("ZenonDismissReason",["$InternalEnum","FBLogger","ZenonIncomingRingSDKTypes","ZenonMWMessageTypes","ZenonMediaError"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=n("$InternalEnum")({IgnoreCall:0,HangupCall:1,InAnotherCall:2,AcceptAfterHangUp:3,NoAnswerTimeout:4,IncomingTimeout:5,OtherInstanceHandled:6,SignalingMessageFailed:7,ConnectionDropped:8,ClientInterrupted:9,WebRTCError:10,ClientError:11,NoPermission:12,OtherNotCapable:13,NoUIShown:14,VersionUnsupported:15,CallerNotVisible:16,CarrierBlocked:17,OtherCarrierBlocked:18,ClientEncryptionError:19,MicrophonePermissionDenied:20,CameraPermissionDenied:21,SessionMigrated:22,RingMuted:23,JoinApprovalDenied:24,RejectedByCallee:25,CallEndedByProduct:26,CallEnded:27,AnsweredOnAnotherDevice:28,RejectedOnAnotherDevice:29,CallCollision:30,MaxAllowedParticipantsReached:31,UnexpectedEndOfCall:32,TxAckTimeout:33,EndToEndEncryptionInvariantViolated:34,ProductServerDefinedEndReason:35,RemovedByParticipant:39,AnsweredByOtherUser:40,CallerHasAppealableCallingRestriction:41});function c(e){switch(e){case"BreakoutSessionSwitchRoom":return u.HangupCall;case"CallEndAcceptAfterHangUp":return u.AcceptAfterHangUp;case"CallerNotVisible":return u.CallerNotVisible;case"CarrierBlocked":return u.CarrierBlocked;case"ClientEncryptionError":return u.ClientEncryptionError;case"ClientError":return u.ClientError;case"ClientInterrupted":return u.ClientInterrupted;case"ConnectionDropped":return u.ConnectionDropped;case"HangupCall":return u.HangupCall;case"IgnoreCall":return u.IgnoreCall;case"InAnotherCall":return u.InAnotherCall;case"EndToEndEncryptionInvariantViolated":return u.EndToEndEncryptionInvariantViolated;case"InactiveTimeout":return u.CallEnded;case"IncomingTimeout":return u.IncomingTimeout;case"MaxAllowedParticipantsReached":return u.MaxAllowedParticipantsReached;case"NoAnswerTimeout":return u.NoAnswerTimeout;case"NoPermission":return u.NoPermission;case"NoUIShown":return u.NoUIShown;case"OtherCarrierBlocked":return u.OtherCarrierBlocked;case"OtherInstanceHandled":return u.OtherInstanceHandled;case"OtherNotCapable":return u.OtherNotCapable;case"SignalingMessageFailed":return u.SignalingMessageFailed;case"UnexpectedEndOfCall":return u.UnexpectedEndOfCall;case"Unknown":return u.CallEnded;case"VersionUnsupported":return u.VersionUnsupported;case"WebRTCError":return u.WebRTCError;case"MicrophonePermissionDenied":return u.MicrophonePermissionDenied;case"CameraPermissionDenied":return u.CameraPermissionDenied;case"SessionMigrated":return u.SessionMigrated;case"RingMuted":return u.RingMuted;case"TxAckTimeout":return u.TxAckTimeout;case"ProductServerDefinedEndReason":return u.ProductServerDefinedEndReason;case"RemovedByParticipant":return u.RemovedByParticipant;case"CallerHasAppealableCallingRestriction":return u.CallerHasAppealableCallingRestriction}}function d(e){switch(e){case u.CallEnded:case u.CallEndedByProduct:case u.HangupCall:return"HangupCall";case u.IgnoreCall:case u.JoinApprovalDenied:case u.RejectedByCallee:return"IgnoreCall";case u.InAnotherCall:return"InAnotherCall";case u.AcceptAfterHangUp:return"CallEndAcceptAfterHangUp";case u.NoAnswerTimeout:return"NoAnswerTimeout";case u.IncomingTimeout:return"IncomingTimeout";case u.AnsweredOnAnotherDevice:case u.CallCollision:case u.RejectedOnAnotherDevice:case u.OtherInstanceHandled:case u.AnsweredByOtherUser:return"OtherInstanceHandled";case u.SignalingMessageFailed:return"SignalingMessageFailed";case u.ConnectionDropped:return"ConnectionDropped";case u.ClientInterrupted:return"ClientInterrupted";case u.WebRTCError:return"WebRTCError";case u.ClientError:return"ClientError";case u.NoPermission:return"NoPermission";case u.OtherNotCapable:return"OtherNotCapable";case u.NoUIShown:return"NoUIShown";case u.VersionUnsupported:return"VersionUnsupported";case u.CallerNotVisible:return"CallerNotVisible";case u.CarrierBlocked:return"CarrierBlocked";case u.OtherCarrierBlocked:return"OtherCarrierBlocked";case u.ClientEncryptionError:return"ClientEncryptionError";case u.UnexpectedEndOfCall:return"UnexpectedEndOfCall";case u.MaxAllowedParticipantsReached:return"MaxAllowedParticipantsReached";case u.MicrophonePermissionDenied:return"MicrophonePermissionDenied";case u.CameraPermissionDenied:return"CameraPermissionDenied";case u.SessionMigrated:return"SessionMigrated";case u.RingMuted:return"RingMuted";case u.TxAckTimeout:return"TxAckTimeout";case u.EndToEndEncryptionInvariantViolated:return"EndToEndEncryptionInvariantViolated";case u.ProductServerDefinedEndReason:return"ProductServerDefinedEndReason";case u.RemovedByParticipant:return"RemovedByParticipant";case u.CallerHasAppealableCallingRestriction:return"CallerHasAppealableCallingRestriction"}return r("FBLogger")("rtc_www").mustfix("Unknown dismiss reason: %s",e),"Unknown"}function m(e){switch(e){case u.OtherInstanceHandled:case u.AnsweredOnAnotherDevice:case u.AnsweredByOtherUser:case u.RejectedOnAnotherDevice:return o("ZenonIncomingRingSDKTypes").ZenonCancelReason.OtherDismiss;default:return o("ZenonIncomingRingSDKTypes").ZenonCancelReason.Hangup}}function p(e){switch(e){case o("ZenonMediaError").ZenonMediaError.IceDisconnected:return u.ConnectionDropped;case o("ZenonMediaError").ZenonMediaError.ConnectionClosed:return u.HangupCall;case o("ZenonMediaError").ZenonMediaError.IceFailure:case o("ZenonMediaError").ZenonMediaError.SetLocalSdpFailed:case o("ZenonMediaError").ZenonMediaError.SetRemoteSdpFailed:case o("ZenonMediaError").ZenonMediaError.RollbackSdpFailed:return u.WebRTCError;case o("ZenonMediaError").ZenonMediaError.UnknownError:return u.UnexpectedEndOfCall}}function _(e){return f[e]}var f=Object.freeze((e={},e[(s=o("ZenonMWMessageTypes")).ZenonMWDismissReason.CALL_ENDED]=u.CallEnded,e[s.ZenonMWDismissReason.ANSWERED_ON_ANOTHER_DEVICE]=u.AnsweredOnAnotherDevice,e[s.ZenonMWDismissReason.ANSWERED_BY_OTHER_USER]=u.AnsweredByOtherUser,e[s.ZenonMWDismissReason.IN_ANOTHER_CALL]=u.InAnotherCall,e[s.ZenonMWDismissReason.CONNECTION_DROPPED]=u.ConnectionDropped,e[s.ZenonMWDismissReason.REJECTED_ON_ANOTHER_DEVICE]=u.RejectedOnAnotherDevice,e[s.ZenonMWDismissReason.REJECTED_BY_CALLEE]=u.RejectedByCallee,e[s.ZenonMWDismissReason.CALL_ENDED_BY_PRODUCT]=u.CallEndedByProduct,e[s.ZenonMWDismissReason.INTERNAL_ERROR]=u.SignalingMessageFailed,e[s.ZenonMWDismissReason.REMOVED_BY_PARTICIPANT]=u.RemovedByParticipant,e[s.ZenonMWDismissReason.TX_ACK_TIMEDOUT]=u.TxAckTimeout,e));l.ZenonDismissReason=u,l.endCallToDismissReason=c,l.dismissToEndCallReason=d,l.dismissReasonToCancelReason=m,l.mediaErrorToDismissReason=p,l.mwDismissToDmissReason=_}),98);
__d("ZenonMWThriftMessageTagUtils",["MultiwayCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case o("MultiwayCommonTypes").MessageTag.PRANSWER:return 1001;case o("MultiwayCommonTypes").MessageTag.INITIAL_ANSWER_TO_P2P_CALLER:return 1002;case o("MultiwayCommonTypes").MessageTag.DEESCALATE_OFFER_TO_P2P_CALLEE:return 1003;case o("MultiwayCommonTypes").MessageTag.DEESCALATE_ANSWER_TO_P2P_CALLER:return 1004;case o("MultiwayCommonTypes").MessageTag.REQUEST_DEESCALATE_TO_P2P_CALLER:return 1005;case o("MultiwayCommonTypes").MessageTag.REQUEST_ESCALATE:return 1006;case o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM:return 1007;case o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS:return 1008;case o("MultiwayCommonTypes").MessageTag.PARTICIPANT_ADDED:return 1009;case o("MultiwayCommonTypes").MessageTag.PARTICIPANT_REMOVED:return 1010;case o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ALERTED_FOR_INITIATOR:return 2001;case o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ANSWERED_FOR_INITIATOR:return 2002;case o("MultiwayCommonTypes").MessageTag.CONTAIN_PENDING_APPROVAL_PARTICIPANTS:return 2003;case o("MultiwayCommonTypes").MessageTag.KEEP_ALIVE_PING:return 3001;case o("MultiwayCommonTypes").MessageTag.IS_INITIATOR:return 4001;case o("MultiwayCommonTypes").MessageTag.PREGEN_SDP:return 4002}}function s(e){switch(e){case 1001:return o("MultiwayCommonTypes").MessageTag.PRANSWER;case 1002:return o("MultiwayCommonTypes").MessageTag.INITIAL_ANSWER_TO_P2P_CALLER;case 1003:return o("MultiwayCommonTypes").MessageTag.DEESCALATE_OFFER_TO_P2P_CALLEE;case 1004:return o("MultiwayCommonTypes").MessageTag.DEESCALATE_ANSWER_TO_P2P_CALLER;case 1005:return o("MultiwayCommonTypes").MessageTag.REQUEST_DEESCALATE_TO_P2P_CALLER;case 1006:return o("MultiwayCommonTypes").MessageTag.REQUEST_ESCALATE;case 1007:return o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_TO_ADMIT_FROM_WAITINGROOM;case 1008:return o("MultiwayCommonTypes").MessageTag.REQUEST_CLIENT_FULL_RENEGOTIATION_AGAINST_MWS;case 1009:return o("MultiwayCommonTypes").MessageTag.PARTICIPANT_ADDED;case 1010:return o("MultiwayCommonTypes").MessageTag.PARTICIPANT_REMOVED;case 2001:return o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ALERTED_FOR_INITIATOR;case 2002:return o("MultiwayCommonTypes").MessageTag.FIRST_REMOTE_ANSWERED_FOR_INITIATOR;case 2003:return o("MultiwayCommonTypes").MessageTag.CONTAIN_PENDING_APPROVAL_PARTICIPANTS;case 3001:return o("MultiwayCommonTypes").MessageTag.KEEP_ALIVE_PING;case 4001:return o("MultiwayCommonTypes").MessageTag.IS_INITIATOR;case 4002:return o("MultiwayCommonTypes").MessageTag.PREGEN_SDP}}function u(t){var n=[];return t==null||t.forEach(function(t){t&&n.push(e(t))}),n}l.toThriftMessageTag=s,l.fromThriftMessageTags=u}),98);
__d("ZenonCallsModelTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("$InternalEnum")).Mirrored(["Disconnected","Precontacting","Contacting","Ringing","PendingApproval","Approved","FailedApproval","Connecting","Connected","Reconnecting","ProvisionalRinging"]),s=e.Mirrored(["Facebook","Instagram","Messenger","Guest","WhatsApp","Workplace"]),u=e.Mirrored(["New","Connecting","PendingApproval","Connected","Terminating","Terminated"]),c=e.Mirrored(["Unknown","CallsBlocked","PageAdminPressedDecline"]),d=e.Mirrored(["None","PendingPeerFeedback","Declined","RemoteDeclined","LocalDeclined","Cancelled","TimedOut","Accepted","InitiatedFromPeer"]);i.ZenonCallParticipantState=l,i.ZenonCallParticipantType=s,i.ZenonCallState=u,i.ZenonEndCallSubreason=c,i.ZenonVideoEscalationStatus=d}),66);
__d("ZenonParticipantState",["$InternalEnum","ZenonCallsModelTypes"],(function(t,n,r,o,a,i,l){"use strict";var e=n("$InternalEnum")({UNKNOWN:0,ADDING:1,CONTACTING:2,RINGING:3,ACCEPTING:4,PRECONNECTING:5,CONNECTING:6,CONNECTED:7,REMOVING:8,DISCONNECTED:9,NO_ANSWER:10,REJECTED:11,UNREACHABLE:12,CONNECTION_DROPPED:13,PARTICIPANT_LIMIT_REACHED:14,IN_ANOTHER_CALL:15,RING_TYPE_UNSUPPORTED:16,PENDING_APPROVAL:17,APPROVING:18,DENYING:19,APPROVED:20,FAILED_APPROVAL:21,HANGUP_IN_WAITING_ROOM:22,RECONNECTING:23});function s(t){if(t==null)return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected;switch(t){case e.CONTACTING:case e.PRECONNECTING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Contacting;case e.RINGING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Ringing;case e.CONNECTING:case e.RECONNECTING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Connecting;case e.CONNECTED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Connected;case e.PENDING_APPROVAL:case e.APPROVING:case e.DENYING:case e.ACCEPTING:case e.ADDING:case e.REMOVING:return o("ZenonCallsModelTypes").ZenonCallParticipantState.PendingApproval;case e.APPROVED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Approved;case e.FAILED_APPROVAL:return o("ZenonCallsModelTypes").ZenonCallParticipantState.FailedApproval;case e.HANGUP_IN_WAITING_ROOM:case e.UNKNOWN:case e.DISCONNECTED:case e.NO_ANSWER:case e.REJECTED:case e.UNREACHABLE:case e.CONNECTION_DROPPED:case e.PARTICIPANT_LIMIT_REACHED:case e.IN_ANOTHER_CALL:case e.RING_TYPE_UNSUPPORTED:return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected}return o("ZenonCallsModelTypes").ZenonCallParticipantState.Disconnected}l.ZenonParticipantState=e,l.toCallParticipantState=s}),98);
__d("ZenonScreenShare",["UserAgent","ZenonAppProvider"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t;return e.length===1&&((t=e[0])==null?void 0:t.contentType)==="screen"}function s(){return!r("UserAgent").isBrowser("Safari")}function u(){return!o("ZenonAppProvider").isOculusCastingSite()}function c(){return!s()||!u()}l.isScreenSharingTrack=e,l.screenShareWithReplaceTrack=c}),98);
__d("ZenonSignalingTypes",[],(function(t,n,r,o,a,i){"use strict";var e={OK:0,REJECTED_FROM_VERSION_DOES_NOT_MATCH:1,METHOD_NOT_ALLOWED:2},l={CLIENT_TERMINATED:0};i.ZenonSignalingStatusCode=e,i.ZenonSignalingStatusSubCode=l}),66);
__d("addDevTierOverridesToHeaderExtensions",["gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t={multiwayCoreTier:"",multiwayWwwTier:""};return r("gkx")("25224")&&(t.multiwayWwwTier=s(e,"multiway_www_tier"),t.multiwayCoreTier=s(e,"multiway_core_tier")),t}function s(e,t){var n=t+"=",r=e.split(n);return r[1]?r.pop().split("&").shift():""}l.default=e}),98);
__d("ZenonMWThriftTranslatorUtils",["FBLogger","MultiwayCommonTypes","MultiwaySharedTypes","OverlayConfigServerLayer","RequestStreamBodyUtils","WebrtcSignalingCommonTypes","ZenonDismissReason","ZenonMWMessageTypes","ZenonMWThriftMessageTagUtils","ZenonParticipantState","ZenonScreenShare","ZenonSignalingProtocol","ZenonSignalingTypes","addDevTierOverridesToHeaderExtensions"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d="signalingDominantSpeakerUpdate",m="signalingVideoUploadUpdate",p="E2eeState",_=new Map(Array.from(o("MultiwaySharedTypes").ConferenceType.members(),function(e){return[o("MultiwaySharedTypes").ConferenceType.getName(e),e]}));function f(e,t,n,r){n===void 0&&(n=!1),e&&Object.keys(e).forEach(function(o){if(!(o===p&&r)){var a=e[o],i=a.data,l=a.version;if(i!=null){var s={data:i,eventName:"stateSyncNotifyRequest",responseRequired:n,topic:o,version:l};t.push(s)}}})}function g(e){if(e){var t=e[p];return t==null?void 0:t.data}}function h(e){if(e==null)return o("ZenonMWMessageTypes").ZenonMWMediaPath.UNKNOWN;switch(e){case o("MultiwaySharedTypes").MediaPath.SFU:return o("ZenonMWMessageTypes").ZenonMWMediaPath.SFU;case o("MultiwaySharedTypes").MediaPath.P2P:return o("ZenonMWMessageTypes").ZenonMWMediaPath.P2P;default:return o("ZenonMWMessageTypes").ZenonMWMediaPath.UNKNOWN}}function y(e){if(e==null)return o("ZenonParticipantState").ZenonParticipantState.UNKNOWN;switch(e){case o("MultiwayCommonTypes").ParticipantCallState.DISCONNECTED:return o("ZenonParticipantState").ZenonParticipantState.DISCONNECTED;case o("MultiwayCommonTypes").ParticipantCallState.NO_ANSWER:return o("ZenonParticipantState").ZenonParticipantState.NO_ANSWER;case o("MultiwayCommonTypes").ParticipantCallState.REJECTED:return o("ZenonParticipantState").ZenonParticipantState.REJECTED;case o("MultiwayCommonTypes").ParticipantCallState.UNREACHABLE:case o("MultiwayCommonTypes").ParticipantCallState.UNCALLABLE:return o("ZenonParticipantState").ZenonParticipantState.UNREACHABLE;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTION_DROPPED:return o("ZenonParticipantState").ZenonParticipantState.CONNECTION_DROPPED;case o("MultiwayCommonTypes").ParticipantCallState.CONTACTING:return o("ZenonParticipantState").ZenonParticipantState.CONTACTING;case o("MultiwayCommonTypes").ParticipantCallState.RINGING:return o("ZenonParticipantState").ZenonParticipantState.RINGING;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTING:return o("ZenonParticipantState").ZenonParticipantState.CONNECTING;case o("MultiwayCommonTypes").ParticipantCallState.CONNECTED:return o("ZenonParticipantState").ZenonParticipantState.CONNECTED;case o("MultiwayCommonTypes").ParticipantCallState.PARTICIPANT_LIMIT_REACHED:return o("ZenonParticipantState").ZenonParticipantState.PARTICIPANT_LIMIT_REACHED;case o("MultiwayCommonTypes").ParticipantCallState.IN_ANOTHER_CALL:return o("ZenonParticipantState").ZenonParticipantState.IN_ANOTHER_CALL;case o("MultiwayCommonTypes").ParticipantCallState.RING_TYPE_UNSUPPORTED:return o("ZenonParticipantState").ZenonParticipantState.RING_TYPE_UNSUPPORTED;case o("MultiwayCommonTypes").ParticipantCallState.PENDING_APPROVAL:return o("ZenonParticipantState").ZenonParticipantState.PENDING_APPROVAL;case o("MultiwayCommonTypes").ParticipantCallState.APPROVED:return o("ZenonParticipantState").ZenonParticipantState.APPROVED;case o("MultiwayCommonTypes").ParticipantCallState.FAILED_APPROVAL:return o("ZenonParticipantState").ZenonParticipantState.FAILED_APPROVAL;case o("MultiwayCommonTypes").ParticipantCallState.HANGUP_IN_WAITING_ROOM:return o("ZenonParticipantState").ZenonParticipantState.HANGUP_IN_WAITING_ROOM;default:return o("ZenonParticipantState").ZenonParticipantState.UNKNOWN}}function C(e){var t=null;return e!=null&&e.forEach(function(e){var n,r=(n=e.body)==null?void 0:n.genericMessage;if(r!=null&&r.topic==="collision_context_payload"){var a=r.data;if(a!=null){var i,l,s,u=JSON.parse(o("RequestStreamBodyUtils").uint8ArrayToString(a));t={groupThreadID:(i=u.group_thread_id)!=null?i:null,peerID:(l=u.peer_id)!=null?l:null,serverInfoData:(s=u.server_info_data)!=null?s:null}}}}),t}function b(e){var t=e&&e.length>0?e.find(function(e){var t;return((t=e.body)==null||(t=t.genericMessage)==null?void 0:t.topic)==="room_metadata"}):null;if(t){var n,r=(n=t.body)==null||(n=n.genericMessage)==null?void 0:n.data;if(r!=null){var a,i=JSON.parse(o("RequestStreamBodyUtils").uint8ArrayToString(r)),l=(a=t.header)==null?void 0:a.sender;if(i.link_hash!=null&&i.room_name!=null&&l!=null)return{linkHash:i.link_hash,profileURL:i.profile_url,ringSubtitle:i.ring_subtitle,roomName:i.room_name,sender:l}}}return null}function v(e){return e.reduce(function(e,t){var n,r,a=(n=t.body)==null||(n=n.genericMessage)==null?void 0:n.topic,i=(r=t.body)==null||(r=r.genericMessage)==null?void 0:r.data;return a!=null&&i!=null&&(e[a]=o("RequestStreamBodyUtils").uint8ArrayToString(i)),e},{})}function S(e){switch(e){case o("ZenonMWMessageTypes").ZenonMWMediaPath.SFU:return o("MultiwaySharedTypes").MediaPath.SFU;case o("ZenonMWMessageTypes").ZenonMWMediaPath.P2P:return o("MultiwaySharedTypes").MediaPath.P2P;default:return o("MultiwaySharedTypes").MediaPath.UNKNOWN}}function R(e,t,n){n===void 0&&(n=0);var r={fromVersion:t,tracks:[],version:n};return e!=null&&Object.keys(e.tracks).forEach(function(t){var n,o,a=e.tracks[t],i={enabled:a.enabled,name:(n=a.name)!=null?n:"",participantID:(o=a.owner)!=null?o:"0",trackID:t,type:L(a.label)};r.tracks.push(i)}),r}function L(e){if(e==null)return null;switch(e){case o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_AUDIO:return"audio";case o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_VIDEO:return"video";case o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_AUDIO:return"screen_audio";case o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_VIDEO:return"screen";default:return null}}function E(e,t){var n=r("OverlayConfigServerLayer").createFromHeader(t);if(n){var o={eventName:"overlayConfigServerUpdateRequest",serverLayer:n};e.push(o)}}function k(e){var t=e.header,n=e.rtcMessageBody,r=e.type,o=$(t,r),a={messageBody:n,messageHeader:o};return a}function I(e){var t=e.header,n=e.rtcMessageBody,r=e.statusCode,o=e.subCode,a=e.type,i=O(t,a,r,o),l={messageBody:n,messageHeader:i};return l}var T={IN_ANOTHER_CALL:(u=o("MultiwayCommonTypes")).DeviceStatus.IN_ANOTHER_CALL,NO_OP:null,NOT_SUPPORTED:u.DeviceStatus.NOT_SUPPORTED,OK:u.DeviceStatus.OK};function D(e,t){return Object.keys(e).map(function(n){var r=e[n];return{body:{genericMessage:{data:o("RequestStreamBodyUtils").stringToUint8Array(r),topic:n}},header:{recipients:new Set(t),topic_DEPRECATED:n}}})}function x(e){var t,n=e.clientSessionId,a=e.conferenceName,i=e.receiver,l=e.receiverUserId,s=e.sequenceNumber,u=e.serverInfoData,c=e.transactionId,d=e.type;if(l==null){var m=d!=null?o("MultiwayCommonTypes").MessageType.getName(d):"UNKNOWN";r("FBLogger")("rpweb").info("Allowing null receiverUserId for MessageType: %s",m)}var p=n,_={userID:"2"},f={actorID:(t=i==null?void 0:i.actorId)!=null?t:null,messageID:c,messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(e.messageTags),protocol:r("ZenonSignalingProtocol").MW,remoteInfo:_,retryCount:e.retryCount,roomInfo:{name:a},sequenceNumber:Number(s),signalingID:p,userInfo:{userID:l!=null?l:"1"}};return u!=null&&(f.remoteSignalingID=u),f}function $(e,t){var n,a,i,l=e.messageID,s=e.messageTags,u=e.remoteSignalingID,c=e.roomInfo,d=e.signalingID,m=r("addDevTierOverridesToHeaderExtensions")(window.location.href),p={clientStack:o("WebrtcSignalingCommonTypes").ClientStack.ZENON,conferenceName:(n=c.name)!=null?n:"",conferenceType:B((a=c.name)!=null?a:""),messageTags:new Set(s==null?void 0:s.map(function(e){return o("ZenonMWThriftMessageTagUtils").toThriftMessageTag(e)})),retryCount:e.retryCount,sequenceNumber:(i=e.sequenceNumber)==null?void 0:i.toString(),transactionId:l,type:t};return(m.multiwayCoreTier!==""||m.multiwayWwwTier!=="")&&(p.extensions=m),d!=null&&(p.clientSessionId=d),u!=null&&(p.serverInfoData=u),e.actorID!=null&&(p.sender={id:e.actorID}),p}function P(e){switch(e){case o("ZenonDismissReason").ZenonDismissReason.IgnoreCall:return o("MultiwayCommonTypes").HangupReason.IGNORE_CALL;case o("ZenonDismissReason").ZenonDismissReason.HangupCall:return o("MultiwayCommonTypes").HangupReason.HANGUP_CALL;case o("ZenonDismissReason").ZenonDismissReason.NoAnswerTimeout:return o("MultiwayCommonTypes").HangupReason.NO_ANSWER_TIMEOUT;case o("ZenonDismissReason").ZenonDismissReason.ClientError:return o("MultiwayCommonTypes").HangupReason.CLIENT_ERROR;case o("ZenonDismissReason").ZenonDismissReason.InAnotherCall:return o("MultiwayCommonTypes").HangupReason.IN_ANOTHER_CALL;case o("ZenonDismissReason").ZenonDismissReason.ClientInterrupted:return o("MultiwayCommonTypes").HangupReason.CLIENT_INTERRUPTED;case o("ZenonDismissReason").ZenonDismissReason.SessionMigrated:return o("MultiwayCommonTypes").HangupReason.SESSION_MIGRATED;default:return o("MultiwayCommonTypes").HangupReason.HANGUP_CALL}}function N(e){var t,n=(t=e.message.body)!=null?t:{},r=n.dominantSpeakerSignalingInfo,a=n.genericMessage,i=n.videoUploadSignalingInfo;return a?o("RequestStreamBodyUtils").uint8ArrayToString(a.data):r?JSON.stringify(r):i?JSON.stringify(i):null}function M(e){var t,n=(t=e.message.body)!=null?t:{},r=n.dominantSpeakerSignalingInfo,o=n.genericMessage,a=n.videoUploadSignalingInfo;return o?o.topic:r?d:a?m:null}function w(e){return e==null?null:e===1?o("MultiwaySharedTypes").EndpointServiceType.COMPOSITING_SERVICE:o("MultiwaySharedTypes").EndpointServiceType.UNKNOWN}function A(e){var t=F(e);return t!=null?t:o("ZenonDismissReason").ZenonDismissReason.CallEnded}function F(e){if(e==null)return null;switch(e){case o("MultiwayCommonTypes").DismissReason.CALL_ENDED:return o("ZenonDismissReason").ZenonDismissReason.CallEnded;case o("MultiwayCommonTypes").DismissReason.ANSWERED_ON_ANOTHER_DEVICE:return o("ZenonDismissReason").ZenonDismissReason.AnsweredOnAnotherDevice;case o("MultiwayCommonTypes").DismissReason.ANSWERED_BY_OTHER_USER:return o("ZenonDismissReason").ZenonDismissReason.AnsweredByOtherUser;case o("MultiwayCommonTypes").DismissReason.IN_ANOTHER_CALL:return o("ZenonDismissReason").ZenonDismissReason.InAnotherCall;case o("MultiwayCommonTypes").DismissReason.CONNECTION_DROPPED:return o("ZenonDismissReason").ZenonDismissReason.ConnectionDropped;case o("MultiwayCommonTypes").DismissReason.PRIMARY_ENDPOINT_HANGUP:return o("ZenonDismissReason").ZenonDismissReason.HangupCall;case o("MultiwayCommonTypes").DismissReason.REJECTED_ON_ANOTHER_DEVICE:return o("ZenonDismissReason").ZenonDismissReason.RejectedOnAnotherDevice;case o("MultiwayCommonTypes").DismissReason.REMOVED_BY_PARTICIPANT:return o("ZenonDismissReason").ZenonDismissReason.RemovedByParticipant;case o("MultiwayCommonTypes").DismissReason.REJECTED_BY_CALLEE:return o("ZenonDismissReason").ZenonDismissReason.RejectedByCallee;case o("MultiwayCommonTypes").DismissReason.INTERNAL_ERROR:return o("ZenonDismissReason").ZenonDismissReason.SignalingMessageFailed;case o("MultiwayCommonTypes").DismissReason.CALL_ENDED_BY_PRODUCT:return o("ZenonDismissReason").ZenonDismissReason.CallEndedByProduct;case o("MultiwayCommonTypes").DismissReason.TX_ACK_TIMEDOUT:return o("ZenonDismissReason").ZenonDismissReason.TxAckTimeout;default:return null}}function O(e,t,n,r){var a=$(e,t);return a.responseStatusCode=n!=null?n:o("MultiwayCommonTypes").RtcResponseStatusCode.OK,a.responseSubCode=r,a}function B(e){var t,n=e.indexOf(":");if(n===-1)return null;var r=e.slice(0,n);return(t=_.get(r))!=null?t:null}function W(e){var t={},n=!o("ZenonScreenShare").screenShareWithReplaceTrack();return e.tracks.forEach(function(e){var r={customAudioContentType:o("WebrtcSignalingCommonTypes").CustomAudioContentType.NONE,customVideoContentType:o("WebrtcSignalingCommonTypes").CustomVideoContentType.NONE,enabled:e.enabled},a=n?z(e.type):null;a!=null&&(r.label=a),t[e.trackID]=r}),{tracks:t}}function q(e){var t=T[e];return t!=null?t:o("MultiwayCommonTypes").DeviceStatus.OK}function U(e){var t={};return e.tracks.forEach(function(e){t[e.trackID]=e.enabled}),t}function V(e){return K[e]}function H(e){return e==null?null:Q[e]}function G(e){var t={};return e.forEach(function(e,n){t[n]={data:e.data,version:e.version}}),t}function z(e){switch(e){case"audio":return o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_AUDIO;case"video":return o("WebrtcSignalingCommonTypes").TrackLabel.DEFAULT_VIDEO;case"screen":return o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_VIDEO;case"screen_audio":return o("WebrtcSignalingCommonTypes").TrackLabel.SCREEN_AUDIO;default:return null}}function j(e){return e===o("MultiwaySharedTypes").EndpointServiceType.COMPOSITING_SERVICE?1:0}var K=Object.freeze((e={},e[(c=o("ZenonSignalingTypes")).ZenonSignalingStatusCode.OK]=u.RtcResponseStatusCode.OK,e[c.ZenonSignalingStatusCode.REJECTED_FROM_VERSION_DOES_NOT_MATCH]=u.RtcResponseStatusCode.CONDITIONAL_REQUEST_FAILED,e[c.ZenonSignalingStatusCode.METHOD_NOT_ALLOWED]=u.RtcResponseStatusCode.METHOD_NOT_ALLOWED,e)),Q=Object.freeze((s={},s[c.ZenonSignalingStatusSubCode.CLIENT_TERMINATED]=u.RtcResponseSubCode.CLIENT_TERMINATED,s));l.addThriftStateStoreSignalingEvents=f,l.fetchE2eeServerState=g,l.fromThriftMediaPath=h,l.fromThriftParticipantState=y,l.getCollisionContextFromThriftAppMessages=C,l.getRoomMetadataFromThriftAppMessages=b,l.mwThriftAppMessagesToSignalingAppMessages=v,l.toThriftMediaPath=S,l.toZenonMediaStatesFromThrift=R,l.toMWClientTrackContentTypeFromThrift=L,l.maybeAddOverlayConfigServerUpdateRequestFromThrift=E,l.createMWThriftRequest=k,l.createMWThriftResponse=I,l.signalingMessageAppMessagesToThriftMWAppMessages=D,l.mwThriftMessageHeaderToSignalingMessageHeader=x,l.toMWThriftHangupReason=P,l.getGenericMWThriftDataMessageData=N,l.getGenericMWThriftDataMessageTopic=M,l.toThriftServiceRecipient=w,l.fromMWThriftDismissReason=A,l.getConferenceTypeFromName=B,l.toThriftMWMediaStatusEx=W,l.toMWThriftDeviceStatus=q,l.toMWThriftMediaStatus=U,l.toMWThriftResponseStatusCode=V,l.toMWThriftResponseStatusSubCode=H,l.toThriftMWSyncStateStore=G,l.toMWThriftTrackLabel=z,l.toServiceRecipientType=j}),98);
__d("ZenonMWThriftMessageDebugLogger",["Log","LogHistory","MultiwayCommonTypes","ODS","RequestStreamBodyUtils","RpWebStateMachineLoggingBlocklist.experimental","ZenonAuditedCheckpointLogId","ZenonIceStatsParser","ZenonInfraActionsLogger","ZenonMWThriftMessageMap","ZenonMWThriftTranslatorUtils","formatDate","isEmployeeTestUserZenonLogging"],(function(t,n,r,o,a,i,l){"use strict";var e,s=(function(){function t(){this.$1=o("LogHistory").getInstance("webrtc"),this.$2=new Set(r("RpWebStateMachineLoggingBlocklist.experimental").MESSAGE_TYPES)}var n=t.prototype;return n.$3=function(t,n,o){n===void 0&&(n=!0);var e=r("formatDate")(new Date,"[H:i:s:X]",{skipPatternLocalization:!0});this.$1.log("Console",e+" "+t),n&&r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__PLATFORM,checkpoint:"[ZP] "+t,messageID:o})},n.$4=function(t){var e=t.messageHeader.responseStatusCode;return e!=null},n.logMWThriftMessage=function(t,n,a){if(this.$5(t,n,a),!!r("isEmployeeTestUserZenonLogging")()){var e=a.messageHeader,i=o("ZenonMWThriftMessageMap").messageTypeToString(a.messageHeader.type),l=this.$4(a)?"RESPONSE":"REQUEST",s=this.$6(a),u="[ms] "+t+" ["+n+"] "+i+" "+l+" [retryCount: "+e.retryCount+(s!=null?" details: "+s:"")+"]";this.$2.has(i)||this.$3(u,!0,e.transactionId)}},n.$5=function(n,r,a){var t=this.$7(n,r,a);t!==null&&(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_signaling",t)},n.$7=function(t,n,r){var e=r.messageBody,a=r.messageHeader,i="";if(a.type!=null)switch(a.type){case o("MultiwayCommonTypes").MessageType.DATA_MESSAGE:if(e.dataMessageRequest){var l;i=(l=o("ZenonMWThriftTranslatorUtils").getGenericMWThriftDataMessageTopic(e.dataMessageRequest))!=null?l:"undefined"}break;default:break}var s=this.$4(r)?"RESPONSE":"REQUEST",u=o("ZenonMWThriftMessageMap").messageTypeToString(a.type);return i===""?t+"-"+n+"-"+u+"-"+s:t+"-"+n+"-"+u+"-"+s+"-"+i},n.$6=function(t){var e=t.messageHeader;if(o("MultiwayCommonTypes").MessageType==null||e.type==null)return null;switch(e.type){case o("MultiwayCommonTypes").MessageType.JOIN:return this.$8(t);case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:return this.$9(t);case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:return this.$10(t);case o("MultiwayCommonTypes").MessageType.SUBSCRIPTION:return this.$11(t);case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:return this.$12(t);default:return null}},n.$8=function(t){var e,n,r,a,i=t.messageBody,l=t.messageHeader;if(this.$4(t)){var s,u,c,d;return JSON.stringify({hasAnswer:((s=i.joinResponse)==null?void 0:s.answer)!=null,hasRenegotiationOffer:((u=i.joinResponse)==null?void 0:u.renegotiationOffer)!=null,isPendingApproval:(c=i.joinResponse)==null?void 0:c.isPendingApproval,multipleVideoStreamsAllowed:(d=i.joinResponse)==null?void 0:d.multipleVideoStreamsAllowed,statusCode:l.responseStatusCode,subCode:l.responseSubCode})}return JSON.stringify({deviceCapabilities:(e=i.joinRequest)==null?void 0:e.deviceCapabilities,sdpType:((n=i.joinRequest)==null?void 0:n.offer)!=null?"offer":((r=i.joinRequest)==null?void 0:r.answer)!=null?"answer":"null",userCapabilities:(a=i.joinRequest)!=null&&a.userCapabilities?o("RequestStreamBodyUtils").uint8ArrayToString(i.joinRequest.userCapabilities):""})},n.$9=function(t){var e,n,r,o,a,i,l,s,u=t.messageBody,c=t.messageHeader;if(this.$4(t)){var d,m;return JSON.stringify({currentVersion:(d=u.serverMediaUpdateResponse)==null?void 0:d.currentVersion,hasAnswer:((m=u.serverMediaUpdateResponse)==null?void 0:m.answer)!=null,statusCode:c.responseStatusCode,subCode:c.responseSubCode})}return JSON.stringify({fromVersion:(e=u.serverMediaUpdateRequest)==null?void 0:e.fromVersion,messageTags:c.messageTags,renegotiationRequested:(n=(r=u.serverMediaUpdateRequest)==null?void 0:r.renegotiationRequested)!=null?n:!1,sdpType:(o=u.serverMediaUpdateRequest)!=null&&o.offer?"offer":(a=u.serverMediaUpdateRequest)!=null&&a.answer?"answer":(i=u.serverMediaUpdateRequest)!=null&&i.update?"delta":"empty",toVersion:(l=(s=u.serverMediaUpdateRequest)==null?void 0:s.toVersion)!=null?l:""})},n.$10=function(t){var e,n,r,o,a=t.messageBody,i=t.messageHeader;if(this.$4(t)){var l,s;return JSON.stringify({currentVersion:(l=(s=a.clientMediaUpdateResponse)==null?void 0:s.currentVersion)!=null?l:"",statusCode:i.responseStatusCode,subCode:i.responseSubCode})}return JSON.stringify({fromVersion:(e=(n=a.clientMediaUpdateRequest)==null?void 0:n.fromVersion)!=null?e:"",toVersion:(r=(o=a.clientMediaUpdateRequest)==null?void 0:o.toVersion)!=null?r:""})},n.$11=function(t){var e,n,r=t.messageBody;return this.$4(t)?null:JSON.stringify({subscriptions:(e=(n=r.subscriptionRequest)==null?void 0:n.subscriptions)!=null?e:""})},n.$12=function(t){var e,n=t.messageBody;if(this.$4(t))return null;var r=(e=n.iceCandidateRequest)==null?void 0:e.iceCandidateSdps.map(function(e){var t=e.candidateSdpString;if(t!=null)return o("ZenonIceStatsParser").extractIceInfo(t)});return JSON.stringify({iceCandidates:r})},n.logSendMultiwayThriftMessageFailure=function(n,a,i){(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","send_message_failure"),e.flush();var t=i?"Stack Trace: "+i.stack+".":"Error msg: "+n;r("ZenonInfraActionsLogger").logCheckpoint({auditId:r("ZenonAuditedCheckpointLogId").RP_ROOMS_INFRA_WWW__ERROR,checkpoint:"Failed to send MW Thrift message of type "+a+". "+t})},t})(),u=new s;l.default=u}),98);
__d("ZenonMWMessageReliabilityLogTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["RECEIVED_REQUEST","RECEIVED_RESPONSE","PROCESSING_REQUEST","START_PROCESSING_RESPONSE","PROCESSING_RESPONSE","PROCESSED_REQUEST","PROCESSED_RESPONSE","SENDING_REQUEST","SENDING_RESPONSE","SENT_REQUEST","SENT_REQUEST_FROM_HANDLER","SENT_RESPONSE","SEND_REQUEST_FAILED","SEND_REQUEST_FAILED_FROM_HANDLER","SEND_RESPONSE_FAILED","SENT_SM_EVENT","PROCESSED_SM_EVENT","REQUEST_AFTER_NULL_CHECK","REQUEST_AFTER_TRANSLATION"]);i.ZenonMWMessageReliabilityEvent=e}),66);
__d("ZenonMWThriftResponseStatusCodeUtils",["MultiwayCommonTypes","ZenonMWMessageTypes"],(function(t,n,r,o,a,i,l){"use strict";function e(e){switch(e){case o("MultiwayCommonTypes").RtcResponseStatusCode.OK:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.OK;case o("MultiwayCommonTypes").RtcResponseStatusCode.BAD_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.BAD_REQUEST;case o("MultiwayCommonTypes").RtcResponseStatusCode.UNAUTHORIZED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.UNAUTHORIZED;case o("MultiwayCommonTypes").RtcResponseStatusCode.NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseStatusCode.METHOD_NOT_ALLOWED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.METHOD_NOT_ALLOWED;case o("MultiwayCommonTypes").RtcResponseStatusCode.CONFLICT:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONFLICT;case o("MultiwayCommonTypes").RtcResponseStatusCode.CONDITIONAL_REQUEST_FAILED:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.CONDITIONAL_REQUEST_FAILED;case o("MultiwayCommonTypes").RtcResponseStatusCode.SERVER_INTERNAL_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.SERVER_INTERNAL_ERROR;case o("MultiwayCommonTypes").RtcResponseStatusCode.SERVICE_UNAVAILABLE:return o("ZenonMWMessageTypes").ZenonMWResponseStatusCode.SERVICE_UNAVAILABLE}}function s(e){switch(e){case o("MultiwayCommonTypes").RtcResponseSubCode.UNKNOWN:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNKNOWN;case o("MultiwayCommonTypes").RtcResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EXCEEDED_MAX_ALLOWED_PARTICIPANTS;case o("MultiwayCommonTypes").RtcResponseSubCode.MEMBERSHIP_CHECK_FAIL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEMBERSHIP_CHECK_FAIL;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_THROTTLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_THROTTLED;case o("MultiwayCommonTypes").RtcResponseSubCode.ENDPOINT_THROTTLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.ENDPOINT_THROTTLED;case o("MultiwayCommonTypes").RtcResponseSubCode.MWS_MESSAGE_SENT_TO_INCORRECT_REGION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MWS_MESSAGE_SENT_TO_INCORRECT_REGION;case o("MultiwayCommonTypes").RtcResponseSubCode.UNSUPPORTED_REQUEST_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNSUPPORTED_REQUEST_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_REQUEST_UNACCEPTABLE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_REQUEST_UNACCEPTABLE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_RESPONSE_UNACCEPTABLE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_RESPONSE_UNACCEPTABLE;case o("MultiwayCommonTypes").RtcResponseSubCode.RING_RESPONSE_BODY_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RING_RESPONSE_BODY_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SERVER_MEDIA_UPDATE_RESPONSE_BODY_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SDP:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SDP;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CONFERENCE_NAME:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CONFERENCE_NAME;case o("MultiwayCommonTypes").RtcResponseSubCode.SERVER_INFO_CONFERENCE_NAME_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SERVER_INFO_CONFERENCE_NAME_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.INCORRECT_VERSION_RANGE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INCORRECT_VERSION_RANGE;case o("MultiwayCommonTypes").RtcResponseSubCode.SENDER_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SENDER_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.RECIPIENT_NOT_SPECIFIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RECIPIENT_NOT_SPECIFIED;case o("MultiwayCommonTypes").RtcResponseSubCode.FIELD_NOT_ALLOWED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FIELD_NOT_ALLOWED;case o("MultiwayCommonTypes").RtcResponseSubCode.USERS_NOT_SPECIFIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.USERS_NOT_SPECIFIED;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUEST_UNACCEPTABLE_FOR_ENDPOINT_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CALL_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CALL_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.SESSION_DESCRIPTION_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SESSION_DESCRIPTION_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_CLIENT_MEDIA_UPDATES:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_CLIENT_MEDIA_UPDATES;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SERVER_INFO_DATA:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SERVER_INFO_DATA;case o("MultiwayCommonTypes").RtcResponseSubCode.INCORRECT_STATE_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INCORRECT_STATE_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.MISMATCHED_STATE_FOR_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISMATCHED_STATE_FOR_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_STATE_VERSION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_STATE_VERSION;case o("MultiwayCommonTypes").RtcResponseSubCode.NO_RESOLVER_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NO_RESOLVER_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_APPROVERLIST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_APPROVERLIST;case o("MultiwayCommonTypes").RtcResponseSubCode.FULL_SDP_REQUIRED_IN_APPROVED_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FULL_SDP_REQUIRED_IN_APPROVED_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_BROADCAST_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_BROADCAST_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_ENDPOINT_CONFIG:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_ENDPOINT_CONFIG;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_E2EE_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_E2EE_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.SFU_MODE_PREVENTED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SFU_MODE_PREVENTED;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_CONFERENCE_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_CONFERENCE_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.JOIN_REQUEST_DENIED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.JOIN_REQUEST_DENIED;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ENDPOINT:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ENDPOINT;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_HEADER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_HEADER;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_BODY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_BODY;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_PARAMS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_PARAMS;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_REMOVE_PARTICIPANTS_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_DATA_MESSAGE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_DATA_MESSAGE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CLIENT_MEDIA_UPDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ADD_PARTICIPANTS_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ADD_PARTICIPANTS_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_SUBSCRIPTION_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_SUBSCRIPTION_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_JOIN_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_JOIN_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_HANGUP_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_HANGUP_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_ICE_CANDIDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_ICE_CANDIDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_P2P_MESSAGE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_P2P_MESSAGE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_UPDATE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_UPDATE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CLIENT_EVENT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CLIENT_EVENT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_CONNECT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_CONNECT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_UNSUBSCRIBE_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_UNSUBSCRIBE_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_APPROVAL_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_APPROVAL_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_ENDPOINT_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_ENDPOINT_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_ENDPOINT_USER_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_ENDPOINT_USER_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_TRANSFER_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_TRANSFER_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_BODY_GENERIC:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_BODY_GENERIC;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUESTOR_NOT_MEMBER_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUESTOR_NOT_MEMBER_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.NOT_BROADCAST_OWNER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NOT_BROADCAST_OWNER;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_NOT_INVITED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_NOT_INVITED;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_DISCONNECTED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_DISCONNECTED;case o("MultiwayCommonTypes").RtcResponseSubCode.GUEST_INVITATION_EXPIRED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.GUEST_INVITATION_EXPIRED;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_IN_PENDING_APPROVAL_STATE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_IN_PENDING_APPROVAL_STATE;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_MULTIWAY_PARAMS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_MULTIWAY_PARAMS;case o("MultiwayCommonTypes").RtcResponseSubCode.BROADCAST_ALREADY_STOPPED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.BROADCAST_ALREADY_STOPPED;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_GENERATE_SDP_ANSWER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_GENERATE_SDP_ANSWER;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_GENERATE_SESSION_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_GENERATE_SESSION_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_SESSION_ID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_SESSION_ID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_ALREADY_EXISTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_ALREADY_EXISTS;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_ENDPOINT_EXISTS_DIFFERENT_SESSION_ID;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_MESSENGER_SENDER_UNSET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_MESSENGER_SENDER_UNSET;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_SET_TRANSPORT_INFO:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_SET_TRANSPORT_INFO;case o("MultiwayCommonTypes").RtcResponseSubCode.NON_PRIMARY_MULTIWAY_SERVER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NON_PRIMARY_MULTIWAY_SERVER;case o("MultiwayCommonTypes").RtcResponseSubCode.FAILED_TO_GET_REMOTE_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.FAILED_TO_GET_REMOTE_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.LOCAL_DESCRIPTION_NOT_SET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LOCAL_DESCRIPTION_NOT_SET;case o("MultiwayCommonTypes").RtcResponseSubCode.INVALID_SDP_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVALID_SDP_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_MEDIA_UPDATE_WITHOUT_REMOTE_SDP_INFO;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_UNSET_ON_P2P_ANSWER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_UNSET_ON_P2P_ANSWER;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_ICE_CANDIDATE_PAYLOAD:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_ICE_CANDIDATE_PAYLOAD;case o("MultiwayCommonTypes").RtcResponseSubCode.P2P_PROTOCOL_UNSET:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.P2P_PROTOCOL_UNSET;case o("MultiwayCommonTypes").RtcResponseSubCode.CREATE_ACK_FOR_INVALID_MESSAGE_TYPE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CREATE_ACK_FOR_INVALID_MESSAGE_TYPE;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_CLIENT_CANNOT_JOIN_SFU_MODE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_IN_SFU_MODE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_IN_SFU_MODE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_DURING_P2P_TO_SFU_ESCALATION;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_FOR_JOINED_ENDPOINTS;case o("MultiwayCommonTypes").RtcResponseSubCode.RESOLVE_STATE_API_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RESOLVE_STATE_API_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.EXTERNAL_RESOLUTION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EXTERNAL_RESOLUTION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.INTERNAL_RESOLUTION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INTERNAL_RESOLUTION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.RESOLUTION_DISABLED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.RESOLUTION_DISABLED;case o("MultiwayCommonTypes").RtcResponseSubCode.BROADCAST_ID_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.BROADCAST_ID_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.SDP_UNSET_ON_P2P_OFFER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SDP_UNSET_ON_P2P_OFFER;case o("MultiwayCommonTypes").RtcResponseSubCode.LEGACY_OFFER_MISSING_REQUIRED_VALUE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LEGACY_OFFER_MISSING_REQUIRED_VALUE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_STATE_SYNC_DESERIALIZATION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_UNSUPPORTED_FOR_PRECONNECTED_USERS;case o("MultiwayCommonTypes").RtcResponseSubCode.OTHER_USER_ANSWERED_THE_CALL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.OTHER_USER_ANSWERED_THE_CALL;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_DESERIALIZATION_ERROR:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_DESERIALIZATION_ERROR;case o("MultiwayCommonTypes").RtcResponseSubCode.REMOTE_SDP_TRACKID_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REMOTE_SDP_TRACKID_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.SIGNALING_MESSAGE_TO_CLIENT_DROPPED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SIGNALING_MESSAGE_TO_CLIENT_DROPPED;case o("MultiwayCommonTypes").RtcResponseSubCode.DATA_CHANNEL_ENDPOINT_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.DATA_CHANNEL_ENDPOINT_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.DATA_CHANNEL_ENDPOINT_ALREADY_EXISTS;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_IS_TERMINATING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_IS_TERMINATING;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_IS_TERMINATED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_IS_TERMINATED;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NAME_EMPTY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NAME_EMPTY;case o("MultiwayCommonTypes").RtcResponseSubCode.NONCE_EMPTY:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NONCE_EMPTY;case o("MultiwayCommonTypes").RtcResponseSubCode.NONCE_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.NONCE_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_HAS_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_HAS_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_HAS_GONE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_HAS_GONE;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_SERVER_NOT_FOUND:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_SERVER_NOT_FOUND;case o("MultiwayCommonTypes").RtcResponseSubCode.CLIENT_TERMINATED:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CLIENT_TERMINATED;case o("MultiwayCommonTypes").RtcResponseSubCode.MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MEDIA_CODECS_UNSUPPORTED_BY_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_INCAPABLE_RENEGOTIATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_INCAPABLE_RENEGOTIATION;case o("MultiwayCommonTypes").RtcResponseSubCode.REJECTING_CMU_WHEN_SMU_PENDING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REJECTING_CMU_WHEN_SMU_PENDING;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_NOT_SUBSCRIBED_TO_TOPIC;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_ALREADY_IN_WAITING_ROOM:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_ALREADY_IN_WAITING_ROOM;case o("MultiwayCommonTypes").RtcResponseSubCode.PARTICIPANT_NOT_IN_PENDING_APPROVAL:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PARTICIPANT_NOT_IN_PENDING_APPROVAL;case o("MultiwayCommonTypes").RtcResponseSubCode.USER_NOT_APPROVER_FOR_TARGET_USER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.USER_NOT_APPROVER_FOR_TARGET_USER;case o("MultiwayCommonTypes").RtcResponseSubCode.UNSUPPORTED_CAPABILITIES:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNSUPPORTED_CAPABILITIES;case o("MultiwayCommonTypes").RtcResponseSubCode.PRODUCT_SERVER_DEFINED_END_REASON:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.PRODUCT_SERVER_DEFINED_END_REASON;case o("MultiwayCommonTypes").RtcResponseSubCode.WWW_KILLSWITCHED_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.WWW_KILLSWITCHED_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_MEDIA_PATH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_MEDIA_PATH;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_MEDIA_STATUS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_MEDIA_STATUS;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFLICTING_SESSION_DESCRIPTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFLICTING_SESSION_DESCRIPTION;case o("MultiwayCommonTypes").RtcResponseSubCode.EMPTY_USER_IDS:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.EMPTY_USER_IDS;case o("MultiwayCommonTypes").RtcResponseSubCode.MISSING_SDP_CONNECT_REQUEST:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.MISSING_SDP_CONNECT_REQUEST;case o("MultiwayCommonTypes").RtcResponseSubCode.CALLER_HAS_APPEALABLE_CALLING_RESTRICTION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CALLER_HAS_APPEALABLE_CALLING_RESTRICTION;case o("MultiwayCommonTypes").RtcResponseSubCode.P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.P2P_CONNECT_UNSUPPORTED_AFTER_SFU_ESCALATION;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_CONFERENCE;case o("MultiwayCommonTypes").RtcResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONNECT_EXCEEDED_MAX_ALLOWED_ENDPOINTS_PER_USER;case o("MultiwayCommonTypes").RtcResponseSubCode.REQUEST_TIMEOUT:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REQUEST_TIMEOUT;case o("MultiwayCommonTypes").RtcResponseSubCode.TOO_MANY_MEDIA_TRACKS_IN_SDP:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.TOO_MANY_MEDIA_TRACKS_IN_SDP;case o("MultiwayCommonTypes").RtcResponseSubCode.OK:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.OK;case o("MultiwayCommonTypes").RtcResponseSubCode.ENDPOINT_INFO_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.ENDPOINT_INFO_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.INVITE_USERS_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.INVITE_USERS_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.JOIN_SESSION_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.JOIN_SESSION_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.LOGGING_POLICY_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.LOGGING_POLICY_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.STATE_SYNC_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.STATE_SYNC_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.CONFERENCE_NAME_MISMATCH:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.CONFERENCE_NAME_MISMATCH;case o("MultiwayCommonTypes").RtcResponseSubCode.SESSION_CONFIGURATION_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.SESSION_CONFIGURATION_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.REMOVE_USERS_RESULT_MISSING:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.REMOVE_USERS_RESULT_MISSING;case o("MultiwayCommonTypes").RtcResponseSubCode.UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME:return o("ZenonMWMessageTypes").ZenonMWResponseSubCode.UNEXPECTED_TRANSPORT_PARAMS_CONFERENCE_NAME}}l.getResponseStatusCodeFromThrift=e,l.getResponseSubCodeFromThrift=s}),98);
__d("ZenonTransportChannelStatus",["cr:17347"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:17347")}),98);
__d("ZenonMWThriftMessageQPLLogger",["DateConsts","QPLMsgTypesSitevarConfig","QPLUserFlow","ZenonLoggingUtils","ZenonMWMessageReliabilityLogTypes","ZenonMWThriftMessageMap","ZenonMWThriftMessageTagUtils","ZenonMWThriftResponseStatusCodeUtils","ZenonTransportChannelStatus","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=30*o("DateConsts").MS_PER_SEC,s=new Map,u=new(r("ZenonTransportChannelStatus"));function c(e,t,n){var a,i,l,s,u,c;if(o("ZenonLoggingUtils").shouldAllowLogging()){var d=e.messageHeader,L=o("ZenonMWThriftMessageMap").messageTypeToString(e.messageHeader.type).toLowerCase();if(r("QPLMsgTypesSitevarConfig").QPL_MSG_TYPES.includes(L)){var E=m(d.transactionId);switch(t){case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST:p(E,L,{connectionState:(a=n==null?void 0:n.connectionState)!=null?a:"",peerConnectionState:(i=n==null?void 0:n.peerConnectionState)!=null?i:"",signalingState:(l=n==null?void 0:n.signalingState)!=null?l:""},e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST:_(E);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE:f(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE:g(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_RESPONSE_FAILED:h(E,e,n==null?void 0:n.errorMessage);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST:y(E,L,{connectionState:(s=n==null?void 0:n.connectionState)!=null?s:"",peerConnectionState:(u=n==null?void 0:n.peerConnectionState)!=null?u:"",signalingState:(c=n==null?void 0:n.signalingState)!=null?c:""},e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_REQUEST:C(E);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_REQUEST_FAILED:b(E,n==null?void 0:n.errorMessage);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE:v(E,e);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_SM_EVENT:S(E,n==null?void 0:n.smEvent);return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_SM_EVENT:R(E,n==null?void 0:n.smEvent);return;default:return}}}}function d(e,t){o("ZenonLoggingUtils").shouldAllowLogging()&&r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{string:babelHelpers.extends({},t)},{instanceKey:+e})}function m(e){var t=isNaN(+e)?0:+e,n=9223372036854776e3;return Math.round(t%n)}function p(t,n,a,i){var l=u.getTransportName()+"State",c=babelHelpers.extends({},a,{messageType:n});if(c[l]=u.getConnectionState(),r("QPLUserFlow").start(r("qpl")._(398988976,"737"),{annotations:{int:{retryCount:i.messageHeader.retryCount},int_array:{messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(i.messageHeader.messageTags)},string:c},instanceKey:t,timeoutInMs:e}),i.messageBody.serverMediaUpdateRequest){var d=i.messageBody.serverMediaUpdateRequest,m=d.answer,p=d.offer,_=d.update;r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{string:{sdpType:p?"offer":m?"answer":_?"delta":"empty"}},{instanceKey:t})}var f=function(n){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),u.getTransportName()+"_"+n,{instanceKey:t})},g=u.addListener("connectionStateEvent",f);s.set(t,g)}function _(e){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"processed_request",{instanceKey:e})}function f(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sending_response",{instanceKey:e}),r("QPLUserFlow").addAnnotations(r("qpl")._(398988976,"737"),{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},{instanceKey:e})}function g(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").endSuccess(r("qpl")._(398988976,"737"),{annotations:{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},instanceKey:e});var l=s.get(e);l&&(u.removeListener(l),s.delete(e))}function h(e,t,n){var a=t.messageHeader,i=a.responseStatusCode,l=a.responseSubCode;r("QPLUserFlow").endFailure(r("qpl")._(398988976,"737"),"send_response_failed",{annotations:{int:{responseStatusCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(i):200,responseSubCode:l?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(l):9e3},string:{errorMessage:n}},instanceKey:e});var c=s.get(e);c&&(u.removeListener(c),s.delete(e))}function y(t,n,a,i){var l=u.getTransportName()+"State",s=babelHelpers.extends({},a,{messageType:n});s[l]=u.getConnectionState(),r("QPLUserFlow").start(r("qpl")._(398988976,"737"),{annotations:{int:{retryCount:i.messageHeader.retryCount},int_array:{messageTags:o("ZenonMWThriftMessageTagUtils").fromThriftMessageTags(i.messageHeader.messageTags)},string:s},instanceKey:t,timeoutInMs:e})}function C(e){r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sending_request",{instanceKey:e})}function b(e,t){r("QPLUserFlow").endFailure(r("qpl")._(398988976,"737"),"send_request_failed",{annotations:{string:{errorMessage:t}},instanceKey:e})}function v(e,t){var n=t.messageHeader,a=n.responseStatusCode,i=n.responseSubCode;r("QPLUserFlow").endSuccess(r("qpl")._(398988976,"737"),{annotations:{int:{responseStatusCode:a?o("ZenonMWThriftResponseStatusCodeUtils").getResponseStatusCodeFromThrift(a):200,responseSubCode:i?o("ZenonMWThriftResponseStatusCodeUtils").getResponseSubCodeFromThrift(i):9e3}},instanceKey:e})}function S(e,t){t!=null&&r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"sent_sm_event:"+t,{instanceKey:e})}function R(e,t){t!=null&&r("QPLUserFlow").addPoint(r("qpl")._(398988976,"737"),"processed_sm_event:"+t,{instanceKey:e})}l.log=c,l.updateState=d}),98);
__d("ZenonMWThriftMessageReliabilityLogger",["ODS","ZenonMWMessageReliabilityLogTypes","ZenonMWThriftMessageMap","ZenonMWThriftMessageQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s=new Map,u=new Map,c=new Map;function d(e){c.set(e,!0)}function m(e,t,n){var r=u.get(e);r&&k(r,t,n)}function p(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST)}function _(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_REQUEST)}function f(e){v(e)||k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_NULL_CHECK)}function g(e){v(e)||k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_TRANSLATION)}function h(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST)}function y(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_REQUEST)}function C(e){v(e)?k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE):k(e,o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST)}function b(e,t){var n=v(e)?o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_RESPONSE_FAILED:o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SEND_REQUEST_FAILED;k(e,n,{errorMessage:t})}function v(e){var t=e.messageHeader.responseStatusCode;return t!=null}function S(e){var t=isNaN(+e)?0:+e,n=9223372036854776e3;return Math.round(t%n)}function R(t,n){var r=o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type).toLowerCase(),a=v(t)?"response":"request";switch(n){case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_REQUEST:case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.RECEIVED_RESPONSE:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","receive_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSING_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","processing_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","processed_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENDING_RESPONSE:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","sending_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_TRANSLATION:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","after_translation_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.REQUEST_AFTER_NULL_CHECK:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","after_null_check_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_RESPONSE:case o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_REQUEST:(e||(e=o("ODS"))).bumpEntityKey(4083,"zenon_multiway","sent_"+a+"_"+r),(e||(e=o("ODS"))).flush();return;default:return}}var L={connectionState:"",peerConnectionState:"",signalingState:""};function E(e){var t=babelHelpers.extends({},L,e);if(L.connectionState!==t.connectionState||L.peerConnectionState!==t.peerConnectionState||L.signalingState!==t.signalingState){L=t;for(var n of s.keys())o("ZenonMWThriftMessageQPLLogger").updateState(n,e)}}function k(e,t,n){var r,a=e.messageHeader,i=(r=s.get(a.transactionId))!=null?r:new Set;s.set(a.transactionId,i),!(t!==o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.SENT_SM_EVENT&&t!==o("ZenonMWMessageReliabilityLogTypes").ZenonMWMessageReliabilityEvent.PROCESSED_SM_EVENT&&i.has(t))&&(i.add(t),u.set(a.transactionId,e),R(e,t),o("ZenonMWThriftMessageQPLLogger").log(e,t,babelHelpers.extends({},n,L)))}l.setE2eeIsMandatedForCall=d,l.logEventForTxid=m,l.logReceivedMessage=p,l.logProcessingMessage=_,l.logMessageAfterNullCheck=f,l.logMessageAfterTranslation=g,l.logProcessedMessage=h,l.logSendingMessage=y,l.logSentMessage=C,l.logSendMessageFailed=b,l.updateState=E}),98);
__d("ZenonMWThriftMessageSerializer",["CompactSerializer","MqttThriftHeaderSerializers","MultiwayCommonSerializers","TCompactProtocol","TReadBuffer"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t){t===void 0&&(t=!1);var n=o("CompactSerializer").serialize(e.messageHeader,o("MultiwayCommonSerializers").serializeRtcMessageHeader),r=o("CompactSerializer").serialize(e.messageBody,o("MultiwayCommonSerializers").serializeRtcMessageBody);if(t){var a=new Uint8Array(n.length+r.length);return a.set(n),a.set(r,n.length),a}var i={},l=o("CompactSerializer").serialize(i,o("MqttThriftHeaderSerializers").serializeMqttThriftHeader),s=new Uint8Array(l.length+n.length+r.length);return s.set(l),s.set(n,l.length),s.set(r,l.length+n.length),s}function s(e,t){t===void 0&&(t=!1);var n=new(r("TReadBuffer"))(e),a=new(r("TCompactProtocol"))(n);t||o("MqttThriftHeaderSerializers").deserializeMqttThriftHeader(a);var i=o("MultiwayCommonSerializers").deserializeRtcMessageHeader(a),l=o("MultiwayCommonSerializers").deserializeRtcMessageBody(a);return{messageBody:l,messageHeader:i}}l.serializeMWThriftMessage=e,l.deserializeMWThriftMessage=s}),98);
__d("SharedWorkerDGWSignalingListener",["FBLogger","ZenonDGWLogger","ZenonDGWStreamController","ZenonMWThriftMessageDebugLogger","ZenonMWThriftMessageReliabilityLogger","ZenonMWThriftMessageSerializer","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=r("ZenonDGWStreamController").getControllerInstance(),r("promiseDone")(this.$1.establishAndGetStream())}var t=e.prototype;return t.setLoggingEventHandler=function(t){this.$2=t},t.subscribe=function(t,n){var e=this;this.$1.setOnDataReceivedCallback(function(a){try{var i=o("ZenonMWThriftMessageSerializer").deserializeMWThriftMessage(a,!0);r("ZenonMWThriftMessageDebugLogger").logMWThriftMessage("RECEIVED","DGW Thrift",i),o("ZenonMWThriftMessageReliabilityLogger").logReceivedMessage(i),e.$2&&e.$2({mwThriftMessage:i,name:"mwThriftMessageRecv"}),n&&e.$3(i,n),t(i),o("ZenonMWThriftMessageReliabilityLogger").logProcessingMessage(i)}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("RECV_ERROR_LISTENER: "+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).warn("Error receiving DGW message in Shared Worker")}})},t.unsubscribe=function(){this.$1.closeStream()},t.$3=function(t,n){try{n(t)}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("RAW_MSG_ERROR_LISTENER: "+String(e)),r("FBLogger")("rtweb").catching(r("getErrorSafe")(e)).mustfix("Signaling messages should be json parsable")}},e})();l.default=e}),98);
__d("ZenonDGWTransportChannelStatus",["EventEmitter","ZenonDGWStreamController"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){var t;return t=e.call(this)||this,t.$ZenonDGWTransportChannelStatus$p_1=r("ZenonDGWStreamController").getControllerInstance(),t.$ZenonDGWTransportChannelStatus$p_1.addListener("connectionStateEvent",function(e){t.emit("connectionStateEvent",e)}),t}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getConnectionState=function(){return this.$ZenonDGWTransportChannelStatus$p_1.getConnectionState()},n.getTransportName=function(){return"dgw"},t})(r("EventEmitter"));l.default=e}),98);
__d("ZenonLoggingEventTypes",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["Send","Receive"]),l=n("$InternalEnum")({Primary:"primary",Secondary:"secondary"}),s="rtc_www";i.ZenonUpdateIceInfoDirection=e,i.ZenonJoinMode=l,i.tslogSource=s}),66);
__d("ZenonMqttChannel",["CurrentUser","FBLogger","MqttChannel","MqttEnv","MqttEnvInitializer","MqttWebConfig","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e=-1;try{if(r("MqttEnvInitializer").initialize(),o("MqttEnv").setIsUserLoggedInNow(r("CurrentUser").isLoggedIn),r("gkx")("11152")&&r("CurrentUser").getAppID()===String(0x4d31ba8e7e89d))e=949958857019662;else{var t;e=Number((t=r("CurrentUser").getAppID())!=null?t:r("MqttWebConfig").appID)}return new(r("MqttChannel"))({appId:e,capabilities:r("MqttWebConfig").capabilities,chatVisibility:!1,clientCapabilities:r("MqttWebConfig").clientCapabilities,endpoint:r("MqttWebConfig").endpoint,initialSubscribedTopics:r("MqttWebConfig").subscribedTopics,phpOverride:r("MqttWebConfig").hostNameOverride,pollingEndpoint:r("MqttWebConfig").pollingEndpoint,userFbid:r("MqttWebConfig").fbid})}catch(t){var n=r("getErrorSafe")(t);throw r("FBLogger")("rtc_www").catching(n).warn("[ZenonMqttChannel][%d] failed to create MqttChannel",e),n}}var s=e(),u=s;l.default=u}),98);
__d("getZenonMqttChannel",["CurrentUser","FBMqttChannel","HorizonWebMqttChannel","IGDOverLSMqttChannel","LiveChatWidgetMqttChannel","MDCMqttChannel","OculusMqttChannel","RpWebMqttEnabledAppIds.experimental","ZenonAppProvider","ZenonMqttChannel"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set(r("RpWebMqttEnabledAppIds.experimental").APP_IDS);function s(){return o("ZenonAppProvider").isInstagramApp()?o("IGDOverLSMqttChannel").getInstance():o("ZenonAppProvider").isOculusCastingSite()?o("OculusMqttChannel").getOculusMqttChannelInstance():o("ZenonAppProvider").isHorizonApp()?o("HorizonWebMqttChannel").getHorizonWebMqttChannelInstance():o("ZenonAppProvider").isMDCApp()?o("MDCMqttChannel").getMDCMqttChannelInstance():o("ZenonAppProvider").isWidgetLiveChatApp()?o("LiveChatWidgetMqttChannel").getLiveChatWidgetMqttChannelInstance():e.has(Number(r("CurrentUser").getAppID()))?r("ZenonMqttChannel"):r("FBMqttChannel")}l.default=s}),98);
__d("ZenonMQTTTransportChannelStatus",["EventEmitter","getZenonMqttChannel"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(e){function t(){var t;t=e.call(this)||this,t.$ZenonMQTTTransportChannelStatus$p_1=r("getZenonMqttChannel")();var n={onMQTTStateChanged:function(n){t.emit("connectionStateEvent",n)}};return t.$ZenonMQTTTransportChannelStatus$p_1.subscribeChannelEvents(n),t}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.getConnectionState=function(){return this.$ZenonMQTTTransportChannelStatus$p_1.getConnectionState()},n.getTransportName=function(){return"mqtt"},t})(r("EventEmitter"));l.default=e}),98);
__d("ZenonMWThriftMessageLogger",["MultiwayCommonTypes","ZenonLoggingEventTypes"],(function(t,n,r,o,a,i,l){"use strict";var e=new Set,s=new Set;function u(t,n){var r=t.messageHeader,a=t.messageBody;if(!(e.has(r.transactionId)||r.type==null)){switch(r.type){case o("MultiwayCommonTypes").MessageType.JOIN:a.joinRequest&&d(a.joinRequest,n);break;case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:a.iceCandidateRequest&&p(a.iceCandidateRequest,n,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send);break;case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:a.clientMediaUpdateRequest&&_(a.clientMediaUpdateRequest,n);break;case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:a.serverMediaUpdateResponse&&h(a.serverMediaUpdateResponse,n);break;default:break}e.add(r.transactionId)}}function c(e,t){var n=e.messageHeader,r=e.messageBody;if(!(s.has(n.transactionId)||n.type==null)){switch(n.type){case o("MultiwayCommonTypes").MessageType.JOIN:r.joinResponse&&m(r.joinResponse,t);break;case o("MultiwayCommonTypes").MessageType.ICE_CANDIDATE:r.iceCandidateRequest&&p(r.iceCandidateRequest,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive);break;case o("MultiwayCommonTypes").MessageType.CLIENT_MEDIA_UPDATE:r.clientMediaUpdateResponse&&f(r.clientMediaUpdateResponse,t);break;case o("MultiwayCommonTypes").MessageType.SERVER_MEDIA_UPDATE:r.serverMediaUpdateRequest&&g(r.serverMediaUpdateRequest,t);break;default:break}s.add(n.transactionId)}}function d(e,t){var n=e.answer,r=e.offer;t({name:"inviteSent"}),y(r,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send),n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function m(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function p(e,t,n){var r=e.iceCandidateSdps;r.forEach(function(e){e.candidateSdpString!=null&&t({direction:n,name:"updateIceInfo",sdpString:e.candidateSdpString})})}function _(e,t){var n=e.offer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function f(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function g(e,t){var n=e.answer,r=e.offer;r&&y(r,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive),n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Receive)}function h(e,t){var n=e.answer;n&&y(n,t,o("ZenonLoggingEventTypes").ZenonUpdateIceInfoDirection.Send)}function y(e,t,n){e.sdpString!=null&&t({direction:n,name:"updateIceInfo",sdpString:e.sdpString})}l.logSentMessage=u,l.logReceivedMessage=c}),98);
__d("ZenonSharedWorkerConstants",["MultiwayCommonTypes"],(function(t,n,r,o,a,i,l){"use strict";var e,s="CALL_HANDLED_IN_OTHER_TAB",u="connection-ack",c="LOGGING_EVENT",d="RAW_MW_THRIFT_MESSAGE",m="SIGNALING_MESSAGE",p="SIGNALING_MESSAGE_SENT",_="INIT_DGW_CONFIG",f="register",g="SEND_SIGNALING_MESSAGE",h=(e={},e[o("MultiwayCommonTypes").MessageType.DISMISS]="DISMISS",e[o("MultiwayCommonTypes").MessageType.HANGUP]="HANGUP",e[o("MultiwayCommonTypes").MessageType.JOIN]="JOIN",e);function y(e){var t;return(t=h[e])!=null?t:"UNKNOWN"}l.CALL_HANDLED_IN_OTHER_TAB=s,l.CONNECTION_ACK=u,l.LOGGING_EVENT=c,l.RAW_MW_THRIFT_MESSAGE=d,l.SIGNALING_MESSAGE=m,l.SIGNALING_MESSAGE_SENT=p,l.INIT_DGW_CONFIG=_,l.REGISTER=f,l.SEND_SIGNALING_MESSAGE=g,l.MESSAGE_TYPE_TO_STRING=h,l.messageTypeToString=y}),98);
__d("ZenonValidateMWThriftMessage",["FBLogger","MultiwayCommonTypes","ZenonInfraActionsLogger","ZenonMWThriftMessageMap"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.messageHeader.type,n=o("ZenonMWThriftMessageMap").messageTypeToString(t);return e.messageHeader.serverInfoData==null&&t!=null&&t!==o("MultiwayCommonTypes").MessageType.JOIN?(r("ZenonInfraActionsLogger").logCheckpoint({checkpoint:"[ZP][DROP] No remoteSignalingID in message: "+n}),r("FBLogger")("rtc_www").warn("[ZP][DROP] No remoteSignalingID in message: "+n),!1):!0}l.default=e}),98);
__d("ZenonSharedWorkerMWThriftMessageSender",["ZenonDGWLogger","ZenonDGWStreamController","ZenonMWThriftMessageDebugLogger","ZenonMWThriftMessageLogger","ZenonMWThriftMessageMap","ZenonMWThriftMessageReliabilityLogger","ZenonMWThriftMessageSerializer","ZenonValidateMWThriftMessage","err"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$3=r("ZenonDGWStreamController").getControllerInstance()}var t=e.prototype;return t.$4=async function(t){try{await this.$3.establishAndGetStream()}catch(n){var e=o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type);o("ZenonDGWLogger").logDGWCheckpoint("SEND_STREAM_ERROR: type="+e+" err="+String(n)),this.$5(t,"Failed to establish stream")}o("ZenonMWThriftMessageReliabilityLogger").logSendingMessage(t),r("ZenonMWThriftMessageDebugLogger").logMWThriftMessage("SENDING","DGW Thrift",t),this.$2&&o("ZenonMWThriftMessageLogger").logSentMessage(t,this.$2);var n=o("ZenonMWThriftMessageSerializer").serializeMWThriftMessage(t,!0),a=await this.$3.send(t.messageHeader.transactionId,n);if(a&&this.$2)this.$2({mwThriftMessage:t,name:"mwThriftMessageSent"});else if(!a){var i=o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type);o("ZenonDGWLogger").logDGWCheckpoint("SEND_FAIL: type="+i),this.$5(t,"Failed to send data")}},t.$5=function(t,n){var e=n!=null?n:"DGW Thrift Message Send Error";o("ZenonMWThriftMessageReliabilityLogger").logSendMessageFailed(t,"[DGW Thrift] "+e),r("ZenonMWThriftMessageDebugLogger").logSendMultiwayThriftMessageFailure(e,o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type))},t.sendMessage=function(t){return!t||!r("ZenonValidateMWThriftMessage")(t)?(o("ZenonDGWLogger").logDGWCheckpoint("SEND_INVALID_MSG"),Promise.reject(r("err")("Invalid MW Thrift message"))):this.$4(t)},t.setMessageReceiver=function(t){this.$1=t},t.setLoggingEventHandler=function(t){this.$2=t},e})();l.default=e}),98);
__d("ZenonSignalingSharedWorker",["CurrentWorkerMessagePort","FBLogger","MultiwayCommonTypes","SharedWorkerDGWSignalingListener","ZenonDGWLogger","ZenonDGWStreamController","ZenonMWThriftMessageMap","ZenonSharedWorkerConstants","ZenonSharedWorkerMWThriftMessageSender","getErrorSafe","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map,s=0,u=null,c=!1,d=!1,m=null,p=null;function _(){var e=o("CurrentWorkerMessagePort").getMessagePort();p=e,o("ZenonDGWLogger").setSharedWorkerContext(function(e){v({event:{checkpoint:e,name:"sharedWorkerCheckpoint"},type:o("ZenonSharedWorkerConstants").LOGGING_EVENT})}),e.addEventListener("message",function(t){C(t.data,e)})}function f(e){if(!c)try{e!=null&&(u=new(r("SharedWorkerDGWSignalingListener")));var t=u;t!=null&&(t.subscribe(function(e){return y(e)},function(e){return h(e)}),t.setLoggingEventHandler(function(e){g(e)}),c=!0,g({name:"dgwConnectionState",pending:!1}))}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("SUBSCRIBE_ERROR: Failed to initialize signaling subscription from Shared Worker"+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).warn("Failed to initialize signaling subscription from Shared Worker")}}function g(e){v({event:e,type:o("ZenonSharedWorkerConstants").LOGGING_EVENT})}function h(e){v({rawMessage:e,type:o("ZenonSharedWorkerConstants").RAW_MW_THRIFT_MESSAGE})}function y(t){var n=e.size;if(n===0){var r=o("ZenonMWThriftMessageMap").messageTypeToString(t.messageHeader.type);o("ZenonDGWLogger").logDGWCheckpoint("MESSAGE_DROPPED: 0_connections type="+r)}v({message:t,type:o("ZenonSharedWorkerConstants").SIGNALING_MESSAGE})}function C(e,t){if(!(typeof e!="object"||e==null||!("type"in e)||typeof e.type!="string")){if(e.type===o("ZenonSharedWorkerConstants").INIT_DGW_CONFIG&&"config"in e){var n=e.config;if(!d){var a;try{a=r("ZenonDGWStreamController").getControllerInstance()}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("INIT_ERROR_STREAM_CONTROLLER: "+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).mustfix("Failed to initialize ZenonDGWStreamController from Shared Worker");return}a.setWindowContext("SHARED_WORKER"),a.setStreamOptions({deviceId:n.deviceId,loggingId:r("uuidv4")(),serviceId:"rpsignaling"}),a.setDGWConfig(n),d=!0}f(n);return}else if(e.type===o("ZenonSharedWorkerConstants").REGISTER&&"windowType"in e&&(e.windowType==="CHILD"||e.windowType==="PARENT")){b(e.windowType,t);return}else if(e.type===o("ZenonSharedWorkerConstants").SEND_SIGNALING_MESSAGE&&"message"in e){S(e.message,t);return}}}function b(t,n){var r=s++;e.set(r,{connectionId:r,port:n,windowType:t}),n.postMessage({response:{from:"zenon_signaling_shared_worker",workerID:"zenon_signaling_worker_1"},type:o("ZenonSharedWorkerConstants").CONNECTION_ACK})}function v(t){if(p==null){o("ZenonDGWLogger").logDGWCheckpoint("BROADCAST_FAIL: broadcastPort not initialized, connections="+String(e.size));return}try{p.postMessage(t)}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("BROADCAST_FAIL: Error="+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).warn("Failed to broadcast message from Shared Worker to windows")}}function S(e,t){try{var n,a,i;m==null&&(m=new(r("ZenonSharedWorkerMWThriftMessageSender")),m.setLoggingEventHandler(function(e){g(e)}));var l=e,s=l==null||(n=l.messageHeader)==null?void 0:n.type,u=l==null||(a=l.messageHeader)==null?void 0:a.serverInfoData,c=l==null||(i=l.messageHeader)==null?void 0:i.clientSessionId;c!=null&&u!=null&&(s===o("MultiwayCommonTypes").MessageType.JOIN||s===o("MultiwayCommonTypes").MessageType.DISMISS||s===o("MultiwayCommonTypes").MessageType.HANGUP)&&v({clientSessionId:c,messageType:o("ZenonSharedWorkerConstants").messageTypeToString(s),serverInfoData:u,type:o("ZenonSharedWorkerConstants").CALL_HANDLED_IN_OTHER_TAB}),m!=null&&m.sendMessage(e).then(function(){t.postMessage({type:o("ZenonSharedWorkerConstants").SIGNALING_MESSAGE_SENT})}).catch(function(e){o("ZenonDGWLogger").logDGWCheckpoint("SEND_ERROR: "+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).mustfix("Failed to send outgoing message to DGW from Shared Worker")})}catch(e){o("ZenonDGWLogger").logDGWCheckpoint("OUTGOING_SENDER_ERROR: "+String(e)),r("FBLogger")("rpweb").catching(r("getErrorSafe")(e)).mustfix("Error processing outgoing message from Shared Worker")}}l.default=_}),98);
__d("ZenonSignalingSharedWorkerV2",["ZenonSignalingSharedWorker"],(function(t,n,r,o,a,i,l){"use strict";l.default=r("ZenonSignalingSharedWorker")}),98);/*FB_PKG_DELIM*/
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25483983211276282"}),null);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql",["EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={defaultValue:null,kind:"LocalArgument",name:"request_uuid"},t={defaultValue:null,kind:"LocalArgument",name:"virtual_device_id"},r={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},a={alias:null,args:null,concreteType:"FetchVirtualDeviceInfoMinosEpochSerializablePayload",kind:"LinkedField",name:"minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null},i=[{alias:null,args:[{fields:[{kind:"Variable",name:"request_uuid",variableName:"request_uuid"},{kind:"Variable",name:"virtual_device_id",variableName:"virtual_device_id"}],kind:"ObjectValue",name:"request"}],concreteType:"FetchVirtualDeviceInfoResponseWrapper",kind:"LinkedField",name:"fetch_virtual_device_info_for_device_addition_v2",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoError",kind:"LinkedField",name:"error",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoResponse",kind:"LinkedField",name:"data",plural:!1,selections:[{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEncryptedSecretValues",kind:"LinkedField",name:"encrypted_secret_values",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_anon_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_root_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_storage_private_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mailbox_root_key_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_oblivious_validation_token_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_ocmf_client_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_orf_client_state_v2",storageKey:null}],storageKey:null},r,{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_epoch_id",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoSyncEpochsPayload",kind:"LinkedField",name:"sync_epochs",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},o,{alias:null,args:null,kind:"ScalarField",name:"epoch_auth_public_key",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEpochDataSerializablePayload",kind:"LinkedField",name:"epoch_data_v2",plural:!1,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"epoch_root_key",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_active_epoch",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"prev_epoch_id",storageKey:null},a],storageKey:null},a],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,t],kind:"Fragment",metadata:null,name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,e],kind:"Operation",name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:i},params:{id:n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"),metadata:{},name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBGetLSVirtualDevices",["ReQL"],(function(t,n,r,o,a,i,l){"use strict";function e(e){return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups_virtual_devices))}l.getLSVirtualDevices=e}),98);
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop"),u=function(r,a){return s.load().then(function(t){var r=t.generateKeys(t.KeyPurpose.Encryption),o=r.pk,a=r.sk;return(e||(e=n("Promise"))).resolve([a.buffer,o.buffer])}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("create_auth_key_pair"),e).mustfix("failed to generate an auth key pair"),e})};u.__nop_name__="LSCreateAuthKeyPair",l.default=u}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_start"):t.resolve()},function(r){return e[0]!==void 0&&e[1]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_error_message",e[1]):t.resolve()},function(o){return t.sequence([function(r){return e[0]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[0],t.i64.cast([0,1415]),t.i64.cast([0,2]),e[1],void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[7]=t[0],t})},function(e){return r[7]?r[8]=!0:r[8]=!1,r[8]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[10]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[10]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[10],r[9],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,3])})},function(o){return e[2]?t.resolve(0):e[1]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",e[1]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e[1],r[7],t.i64.cast([0,3]))):t.resolve()},function(r){return e[0]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[0],"dasm_handle_wrong_recovery_code_sproc_end"):t.resolve()},function(e){return r[1]=t.i64.of_float(Date.now()),r[2]=t.i64.random(),r[4]="Finishing execution. Execution time: ",r[5]=t.i64.to_string(t.i64.sub(r[1],r[0])),r[6]=" ms",r[3]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",r[3],r[4],r[3],r[5],r[3],r[6]].join("")),t.i64.eq(t.i64.mod_(r[2],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[7]=",",r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[r[4],r[7],r[5],r[7],r[6]].join(""),r[8],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",e.__tables__=["secure_encrypted_backups_recovery_code_status"],a.exports=e}),null);
__d("LSIsValidEpochAnonIdFlow",[],(function(t,n,r,o,a,i){"use strict";var e=11;function l(t){if(t.byteLength>e)return!1;for(var n=new Int8Array(t),r=0,o=0;o<n.length;o++)r|=+(n[o]<48),r|=+(n[o]>57);return r===0}i.call=l}),66);
__d("LSIsValidEpochAnonId.nop",["LSIsValidEpochAnonIdFlow","LSResult","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e,s=function(a,i,l){return(e||(e=n("Promise"))).resolve(r("LSResult")(o("LSIsValidEpochAnonIdFlow").call(l)))};s.__nop_name__="LSIsValidEpochAnonId",l.default=s}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKey",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSHandleWrongRecoveryCode","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIsValidEpochAnonId.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSPublicEncryptionCreateDecryptedData.nop","LSQplAnnotateInt.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSSymmetricEncryptionCreateDecryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Beginning execution."),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_start"):t.resolve()},function(a){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(a,i){var l=a.done,s=a.value;return l?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_start"):t.resolve()},function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_start"):t.resolve()},function(r){return o[8]=e[3].get("encrypted_ocmf_client_state"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[8]).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(r){return t.blobs.neq(o[10],void 0)?t.resolve(o[11]=o[10]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[8]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[11]=o[41]}])},function(r){return o[12]=e[3].get("encrypted_oblivious_validation_token_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[12]).then(function(e){var t;return t=e,o[13]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[13]).then(function(e){var t;return t=e,o[14]=t[0],t})},function(r){return t.blobs.neq(o[14],void 0)?t.resolve(o[15]=o[14]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[12]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[15]=o[41]}])},function(r){return o[16]=e[3].get("encrypted_epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(r){return t.blobs.neq(o[18],void 0)?t.resolve(o[19]=o[18]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[16]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[19]=o[41]}])},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[19]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return o[20]=o[40]}]):t.resolve(o[20]=!1)},function(r){return o[20]?o[21]=o[19]:o[21]=void 0,o[22]=e[3].get("encrypted_epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[22]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(r){return t.blobs.neq(o[24],void 0)?t.resolve(o[25]=o[24]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[22]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[25]=o[41]}])},function(r){return o[26]=e[3].get("encrypted_mailbox_root_key_blob"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[26]).then(function(e){var t;return t=e,o[27]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(r){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[26]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[29]=o[41]}])},function(r){return o[30]=e[3].get("encrypted_epoch_storage_private_key"),o[30]!==void 0?t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[30]).then(function(e){var t;return t=e,o[40]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(r){return t.blobs.neq(o[41],void 0)?t.resolve(o[42]=o[41]):t.sequence([function(r){return t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),e[9],t.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),o[30]).then(function(e){var t;return t=e,o[43]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[43]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[42]=o[44]}])},function(e){return o[31]=o[42]}]):t.resolve(o[31]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_start"):t.resolve()},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[34]=t[0],o[35]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MA=="),o[35]).then(function(e){var t;return t=e,o[36]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,o[37]=t[0],o[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("MQ=="),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_end"):t.resolve()},function(a){return t.blobs.neq(o[11],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[11]).then(function(e){var t;return t=e,o[40]=t[0],o[41]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[46]=t[0],o[47]=t[1],t})},function(e){var t;return t=[o[40],o[41],o[46],o[47]],o[42]=t[0],o[43]=t[1],o[44]=t[2],o[45]=t[3],t}]):t.resolve((r=[o[40],o[41],void 0,void 0],o[42]=r[0],o[43]=r[1],o[44]=r[2],o[45]=r[3],r))},function(a){return t.blobs.neq(o[21],void 0)?t.blobs.neq(o[25],void 0)?t.blobs.neq(o[15],void 0)?t.blobs.neq(o[29],void 0)?t.sequence([function(r){return e[12]!==void 0?(o[61]=e[12].get("epoch_head"),o[46]=o[61]):o[46]=void 0,o[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]&&(o[61]=(o[47].push(t.i64.cast([0,0])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[49]=t[0],t})},function(e){return o[49]&&(o[61]=(o[47].push(t.i64.cast([0,2])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return o[50]&&(o[61]=(o[47].push(t.i64.cast([0,3])),o[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]&&(o[61]=(o[47].push(t.i64.cast([0,4])),o[47])),o[52]="",o[53]=t.i64.of_int32(o[47].length),t.i64.gt(o[53],t.i64.cast([0,0]))?t.loopAsync(o[53],function(e){return o[61]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[47],o[61]).then(function(e){var t;return t=e,o[62]=t[0],o[63]=t[1],t})},function(e){return o[52]=[o[52],"_",t.i64.to_string(o[62])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[52],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mg=="),o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return t.blobs.neq(o[55],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[55]).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[56]=o[61]}]):t.resolve(o[56]=void 0)},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_start"):t.resolve()},function(e){return t.forEach(t.db.table(168).fetch(),function(e){return e.delete()})},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(168).fetch([[[e[1]]]]),function(n){return t.i64.eq(n.backupId,e[1])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(n){return t.db.table(168).add({backupId:e[1],devicePublicKeyBlob:o[33],devicePrivateKeyBlob:o[32],epochStoragePublicKeyBlob:o[35],epochStoragePrivateKeyBlob:o[34],epochAuthPublicKeyBlob:o[38],epochAuthPrivateKeyBlob:o[37],mailboxRootKeyBlob:o[29],ocmfClientStateBlob:o[42],obliviousValidationTokenBlob:o[15],encryptionVersion:t.i64.cast([0,0]),revisionVersion:t.i64.cast([0,1]),authorityLevel:t.i64.cast([0,20]),backupTenancy:e[7]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_end"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_start"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_start"):t.resolve()},function(n){return t.forEach(t.filter(t.db.table(169).fetch([[[e[2]]]]),function(n){return t.i64.eq(n.epochId,e[2])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(169).add({epochId:e[2],authorityLevel:t.i64.cast([0,80]),backupId:e[1],epochAnonIdBlob:o[21],epochRootKeyBlob:o[25],epochStatus:t.i64.cast([0,1]),epochHead:o[46]})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_end"):t.resolve()},function(r){return o[57]=e[5].keys(),o[58]=t.i64.of_int32(o[57].length),e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateInt.nop"),t.i64.cast([0,1021646192]),e[8],"num_epochs",o[58]):t.resolve()},function(a){return t.i64.eq(o[58],t.i64.cast([0,1]))?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_skipped"):t.resolve()},function(r){return o[61]=e[5].has(t.i64.to_string(e[2])),o[61]?t.resolve(0):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] sync_epochs does not contain base epoch"),o[63]="sync_epochs does not contain base epoch",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_start"):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Triggering epoch derivation."),o[61]=r("justknobx")._("1310"),t.resolve()},function(r){return o[61]===!1&&(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Epoch rotation is disabled for the user but received more than one epoch."),t.blobs.neq(o[31],void 0)?t.sequence([function(e){return o[65]="Starting epoch derivation at base epoch of anon id (base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[66]=o[62]==null?"":o[62],o[63]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[63],o[65],o[63],o[66]].join("")),t.resolve()},function(r){return o[64]=e[5].get(t.i64.to_string(e[2])),o[64]!==void 0?t.sequence([function(n){return o[67]=o[64].get("minos_epoch"),o[67]!==void 0?(o[79]=o[67].get("epoch_head"),o[68]=o[79]):o[68]=void 0,o[69]=o[64].get("is_active_epoch"),o[69]?o[70]=t.i64.cast([0,1]):o[70]=t.i64.cast([0,2]),t.forEach(t.db.table(169).fetch([[[e[2]]]]),function(e){var n=e.update,r=e.item;return n({authorityLevel:t.i64.cast([0,80]),epochStatus:o[70],epochHead:o[68]})})},function(r){return o[71]=new t.Map,o[71].set("epoch_id",e[2]),o[71].set("authority_level",t.i64.cast([0,80])),o[71].set("backup_id",e[1]),o[71].set("epoch_anon_id_blob",o[21]),o[71].set("epoch_root_key_blob",o[25]),o[71].set("epoch_status",t.i64.cast([0,1])),o[71].set("epoch_head",o[46]),o[72]=o[71],o[73]=e[5].keys(),o[74]=t.i64.of_int32(o[73].length),t.i64.gt(o[74],t.i64.cast([0,0]))?t.loopAsync(o[74],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[73],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[72].get("epoch_id"),o[83]=o[72].get("backup_id"),o[84]=o[72].get("epoch_anon_id_blob"),o[85]=o[72].get("epoch_root_key_blob"),o[86]=o[72].get("epoch_status"),o[87]=o[72].get("authority_level"),o[88]=o[72].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("next_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[106].get("epoch_anon_id"),o[118]=o[106].get("minos_epoch"),o[118]!==void 0?(o[137]=o[118].get("epoch_head"),o[119]=o[137]):o[119]=void 0,o[120]=t.createArray(),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[137]=(o[120].push(t.i64.cast([0,32])),o[120]),o[121]="_",t.nativeOperation(n("LSGetBlobFromString.nop"),["epoch_chaining",o[121],t.blobs.to_string(o[84]),o[121],t.i64.to_string(o[82])].join("")).then(function(e){var t;return t=e,o[122]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[122],void 0,o[85],o[120]).then(function(e){var t;return t=e,o[123]=t[0],t})},function(e){return o[123]?o[124]=!1:o[124]=!0,o[124]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),o[138]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[138]].join("")),o[137]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[138],o[137],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[140]=t[0],t})},function(e){var t;return t=[o[139],o[140]],o[125]=t[0],o[126]=t[1],t}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[137]=t[0],o[138]=t[1],t})},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[123],t.i64.cast([0,1])).then(function(e){var t;return t=e,o[139]=t[0],o[140]=t[1],t})},function(e){var t;return t=[o[137],o[139]],o[125]=t[0],o[126]=t[1],t}])},function(r){return o[127]=o[106].get("encrypted_epoch_key"),t.blobs.neq(o[127],void 0)?t.sequence([function(r){return o[137]=o[106].get("epoch_auth_public_key"),o[138]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSPublicEncryptionCreateDecryptedData.nop"),e[6],o[31],o[137],o[126],t.blobs.of_string(["epoch_","_",t.blobs.to_string(o[138])].join("")),o[127]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return t.blobs.neq(o[139],void 0)?t.resolve(o[140]=o[139]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),o[142]="Couldn't decrypt epoch key. Returning null entropy",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[142]].join("")),o[141]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[142],o[141],t.i64.cast([0,3]))},function(e){return o[140]=void 0}])},function(e){return o[128]=o[140]}]):t.sequence([function(e){return o[140]="encrypted_epoch_key is null. Can't generate epoch entropy. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[128]=void 0}])},function(e){return t.blobs.neq(o[128],void 0)?t.sequence([function(e){return o[137]=t.createArray(),o[142]=(o[137].push(t.i64.cast([0,32])),o[137]),t.nativeOperation(n("LSGetBlobFromString.nop"),"epoch_root_key").then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),o[138],o[125],o[128],o[137]).then(function(e){var t;return t=e,o[139]=t[0],t})},function(e){return o[139]?o[140]=!1:o[140]=!0,o[140]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),o[143]="Unable to generate epoch root key.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[143]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[143],o[142],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[141]=o[144]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[139],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[142]=t[0],o[143]=t[1],t})},function(e){return o[141]=o[142]}])},function(e){return o[129]=o[141]}]):t.sequence([function(e){return o[140]="epoch entropy is null. Can't generate epoch root key. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){return o[129]=void 0}])},function(e){return t.blobs.neq(o[129],void 0)?t.sequence([function(e){return t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[117],epochRootKeyBlob:o[129],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[119]}):0})},function(e){var n;return n=[o[98],o[114],o[117],o[129],o[116],o[119],t.i64.cast([0,80])],o[130]=n[0],o[131]=n[1],o[132]=n[2],o[133]=n[3],o[134]=n[4],o[135]=n[5],o[136]=n[6],n}]):t.sequence([function(e){return o[140]="Epoch root key is null. Can't write the epoch to the table. epoch_anon_id(base64) = ",o[137]=o[106].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[137]).then(function(e){var t;return t=e,o[138]=t[0],t})},function(e){return o[141]=o[138]==null?"":o[138],o[139]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[139],o[140],o[139],o[141]].join("")),o[142]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[140],",",o[141]].join(""),o[142],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[130]=t[0],o[131]=t[1],o[132]=t[2],o[133]=t[3],o[134]=t[4],o[135]=t[5],o[136]=t[6],t}])},function(e){var t;return t=[o[130],o[131],o[132],o[133],o[134],o[135],o[136]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="1",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[72]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[75]=new t.Map,o[75].set("epoch_id",e[2]),o[75].set("authority_level",t.i64.cast([0,80])),o[75].set("backup_id",e[1]),o[75].set("epoch_anon_id_blob",o[21]),o[75].set("epoch_root_key_blob",o[25]),o[75].set("epoch_status",t.i64.cast([0,1])),o[75].set("epoch_head",o[46]),o[76]=o[75],o[77]=e[5].keys(),o[78]=t.i64.of_int32(o[77].length),t.i64.gt(o[78],t.i64.cast([0,0]))?t.loopAsync(o[78],function(r){return o[79]=r,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[77],o[79]).then(function(e){var t;return t=e,o[80]=t[0],o[81]=t[1],t})},function(r){return o[82]=o[76].get("epoch_id"),o[83]=o[76].get("backup_id"),o[84]=o[76].get("epoch_anon_id_blob"),o[85]=o[76].get("epoch_root_key_blob"),o[86]=o[76].get("epoch_status"),o[87]=o[76].get("authority_level"),o[88]=o[76].get("epoch_head"),o[89]=e[5].get(t.i64.to_string(o[82])),o[89]!==void 0?t.sequence([function(r){return o[98]=o[89].get("prev_epoch_id"),t.i64.neq(o[98],void 0)?t.sequence([function(r){return o[106]=e[5].get(t.i64.to_string(o[98])),o[106]!==void 0?t.sequence([function(e){return o[114]=o[106].get("backup_id"),o[115]=o[106].get("is_active_epoch"),o[115]?o[116]=t.i64.cast([0,1]):o[116]=t.i64.cast([0,2]),o[117]=o[89].get("epoch_data_v2"),o[117]!==void 0?t.sequence([function(e){return o[125]=t.createArray(),o[144]=(o[125].push(t.i64.cast([0,32])),o[125]),t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[126]=t[0],t})},function(e){return o[126]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_data_storage","_",o[126]].join("")),void 0,o[85],o[125]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[144]?o[145]=!1:o[145]=!0,o[145]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[148]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[148]].join("")),o[147]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[148],o[147],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[149]=t[0],t})},function(e){return o[146]=o[149]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[144],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[147]=t[0],o[148]=t[1],t})},function(e){return o[146]=o[147]}])},function(e){return o[127]=o[146]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[145]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[146]=t[0],t})},function(e){return o[127]=o[146]}])},function(e){return o[128]=o[117].get("epoch_anon_id"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[128]).then(function(e){var t;return t=e,o[129]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[129]).then(function(e){var t;return t=e,o[130]=t[0],t})},function(e){return t.blobs.neq(o[130],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSIsValidEpochAnonId.nop"),o[130]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[131]=o[144]}]):t.resolve(o[131]=!1)},function(e){return o[131]?o[132]=o[130]:o[132]=void 0,o[133]=o[117].get("epoch_root_key"),t.nativeOperation(n("LSSymmetricEncryptionCreateDecryptedString.nop"),o[127],t.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),o[133]).then(function(e){var t;return t=e,o[134]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Decode.nop"),o[134]).then(function(e){var t;return t=e,o[135]=t[0],t})},function(e){return t.blobs.neq(o[132],void 0)?t.sequence([function(e){return t.blobs.neq(o[135],void 0)?t.resolve((o[145]=new t.Map,o[145].set("epoch_anon_id",o[132]),o[145].set("epoch_root_key",o[135]),o[144]=o[145])):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_root_key. Returning null"),o[146]="Error while decrypting epoch_root_key. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[146]].join("")),o[145]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[146],o[145],t.i64.cast([0,3]))},function(e){return o[144]=void 0}])},function(e){return o[136]=o[144]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_anon_id. Returning null"),o[145]="Error while decrypting epoch_anon_id. Returning null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[145]].join("")),o[144]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[145],o[144],t.i64.cast([0,3]))},function(e){return o[136]=void 0}])},function(e){return o[136]!==void 0?t.sequence([function(e){return o[144]=o[136].get("epoch_anon_id"),o[145]=o[136].get("epoch_root_key"),o[146]=o[106].get("minos_epoch"),o[146]!==void 0?(o[148]=o[146].get("epoch_head"),o[147]=o[148]):o[147]=void 0,t.filter(t.db.table(169).fetch([[[o[98]]]]),function(e){return t.i64.eq(e.epochId,o[98])&&t.i64.gt(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(e){var n=e.done,r=e.value;return n?t.db.table(169).put({epochId:o[98],backupId:o[114],epochAnonIdBlob:o[144],epochRootKeyBlob:o[145],epochStatus:o[116],authorityLevel:t.i64.cast([0,80]),epochHead:o[147]}):0})},function(e){var n;return n=[o[98],o[114],o[144],o[145],o[116],o[147],t.i64.cast([0,80])],o[137]=n[0],o[138]=n[1],o[139]=n[2],o[140]=n[3],o[141]=n[4],o[142]=n[5],o[143]=n[6],n}]):t.sequence([function(e){return o[146]="Error while decrypting epoch data of epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[144]=t[0],t})},function(e){return o[147]=o[144]==null?"":o[144],o[145]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[145],o[146],o[145],o[147]].join("")),o[148]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[146],",",o[147]].join(""),o[148],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[137]=t[0],o[138]=t[1],o[139]=t[2],o[140]=t[3],o[141]=t[4],o[142]=t[5],o[143]=t[6],t}])},function(e){var t;return t=[o[137],o[138],o[139],o[140],o[141],o[142],o[143]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}]):t.sequence([function(e){return o[127]="Error while reading epoch_data_v2. This is expected if this is the root epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[125]=t[0],t})},function(e){return o[128]=o[125]==null?"":o[125],o[126]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[126],o[127],o[126],o[128]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[118]=t[0],o[119]=t[1],o[120]=t[2],o[121]=t[3],o[122]=t[4],o[123]=t[5],o[124]=t[6],t}])},function(e){var t;return t=[o[118],o[119],o[120],o[121],o[122],o[123],o[124]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),o[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ","",o[115]].join("")),o[114]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",o[115],o[114],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[107]=t[0],o[108]=t[1],o[109]=t[2],o[110]=t[3],o[111]=t[4],o[112]=t[5],o[113]=t[6],t}])},function(e){var t;return t=[o[107],o[108],o[109],o[110],o[111],o[112],o[113]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}]):t.sequence([function(e){return o[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[106]=t[0],t})},function(e){return o[109]=o[106]==null?"":o[106],o[110]=" , is_forward = ",o[111]="0",o[107]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[107],o[108],o[107],o[109],o[107],o[110],o[107],o[111]].join("")),t.resolve()},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[99]=t[0],o[100]=t[1],o[101]=t[2],o[102]=t[3],o[103]=t[4],o[104]=t[5],o[105]=t[6],t}])},function(e){var t;return t=[o[99],o[100],o[101],o[102],o[103],o[104],o[105]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}]):t.sequence([function(e){return o[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",t.nativeOperation(n("LSBase64Encode.nop"),o[84]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[101]=o[98]==null?"":o[98],o[99]="",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochDerivationUtils] ",o[99],o[100],o[99],o[101]].join("")),o[102]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[o[100],",",o[101]].join(""),o[102],t.i64.cast([0,3]))},function(e){var t;return t=[o[82],o[83],o[84],o[85],o[86],o[88],o[87]],o[90]=t[0],o[91]=t[1],o[92]=t[2],o[93]=t[3],o[94]=t[4],o[95]=t[5],o[96]=t[6],t}])},function(e){return o[97]=new t.Map,o[97].set("epoch_id",o[90]),o[97].set("backup_id",o[91]),o[97].set("epoch_anon_id_blob",o[92]),o[97].set("epoch_root_key_blob",o[93]),o[97].set("epoch_status",o[94]),o[97].set("epoch_head",o[95]),o[97].set("authority_level",o[96]),o[76]=o[97]}])}):t.resolve()},function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[79]=t[0],t})},function(e){return o[79]?o[80]=!0:o[80]=!1,o[80]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[82]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[82]].join("")),o[81]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[82],o[81],t.i64.cast([0,3]))):t.resolve()}])}]):((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected Error. A base epoch exists on client but not found on server"),o[67]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils","Unexpected Error. A base epoch exists on client but not found on server",o[67],t.i64.cast([0,3])))}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch storage private key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch storage private key is null"),o[63]="epoch storage private key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[63]].join("")),o[62]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[63],o[62],t.i64.cast([0,3]))}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_end"):t.resolve()}])},function(r){return t.db.table(169).fetch([[[e[4]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: No epochs keys found."):t.resolve()},function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] No epochs keys found."),o[59]=void 0}]):(a=l.item,o[61]=new t.Map,o[61].set("epoch_root_key",a.epochRootKeyBlob),o[61].set("epoch_anon_id",a.epochAnonIdBlob),o[61].set("epoch_id",e[4]),o[61].set("epoch_head",a.epochHead),o[59]=o[61])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_end"):t.resolve()},function(r){return o[59]!==void 0?t.sequence([function(e){return o[61]=o[59].get("epoch_anon_id"),o[62]=o[59].get("epoch_root_key"),o[63]=t.createArray(),o[69]=(o[63].push(t.i64.cast([0,32])),o[63]),t.nativeOperation(n("LSBase64Encode.nop"),o[61]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[64]].join("")),void 0,o[62],o[63]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return o[69]?o[70]=!1:o[70]=!0,o[70]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[73]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[73]].join("")),o[72]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[73],o[72],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[71]=o[74]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[69],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[71]=o[72]}])},function(e){return o[65]=o[71]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[70]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[70],o[69],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[65]=o[71]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[65],o[33]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[67]=o[59].get("epoch_root_key"),t.blobs.neq(o[67],void 0)?t.sequence([function(e){return o[69]=t.createArray(),o[75]=(o[69].push(t.i64.cast([0,18])),o[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[67],o[69]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[70]!==void 0?t.sequence([function(e){return o[75]=t.i64.of_int32(o[70].length),t.i64.ge(o[75],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[77]=t[0],o[78]=t[1],t})},function(e){return o[76]=o[77]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[78]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[78]].join("")),o[77]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[78],o[77],t.i64.cast([0,3]))},function(e){return o[76]=void 0}])},function(e){return o[71]=o[76]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[76]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[76]].join("")),o[75]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[76],o[75],t.i64.cast([0,3]))},function(e){return o[71]=void 0}])},function(e){return t.blobs.neq(o[71],void 0)?o[72]=!0:o[72]=!1,o[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[73]!==void 0?o[74]=o[73]:o[74]="encodingfailed",o[68]=o[74]}]):t.resolve(o[68]="null")},function(r){return t.blobs.neq(o[66],void 0)?t.sequence([function(e){return o[69]=o[59].get("epoch_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[33]).then(function(e){var t;return t=e,o[70]=t[0],t})},function(e){return o[88]=o[70]==null?"":o[70],t.nativeOperation(n("LSBase64Encode.nop"),o[66]).then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[87]=o[71]==null?"":o[71],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[72]=t[0],t})},function(e){return o[89]=o[72]==null?"":o[72],t.nativeOperation(n("LSBase64Encode.nop"),o[36]==null?t.blob("bnVsbA=="):o[36]).then(function(e){var t;return t=e,o[73]=t[0],t})},function(e){return o[90]=o[73]==null?"":o[73],t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[74]=t[0],t})},function(e){return o[91]=o[74]==null?"":o[74],t.nativeOperation(n("LSBase64Encode.nop"),o[39]==null?t.blob("bnVsbA=="):o[39]).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return o[92]=o[75]==null?"":o[75],t.nativeOperation(n("LSBase64Encode.nop"),o[43]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(r){return o[93]=o[76]==null?"":o[76],t.nativeOperation(n("LSBase64Encode.nop"),e[10]).then(function(e){var t;return t=e,o[77]=t[0],t})},function(e){return o[94]=o[77]==null?"":o[77],t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"private_key",o[32],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[78]=o[97]}]):t.resolve(o[78]=void 0)},function(e){return t.blobs.neq(o[78],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[79]=o[95]}]):t.resolve(o[79]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"ocmf_client_state",o[42],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[80]=o[97]}]):t.resolve(o[80]=void 0)},function(e){return t.blobs.neq(o[80],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[81]=o[95]}]):t.resolve(o[81]=void 0)},function(e){return t.blobs.neq(o[29],void 0)?t.sequence([function(e){return o[95]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[29],"epoch_storage_private_key",o[34],t.i64.cast([0,1]),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?o[97]=o[96]:o[97]=void 0,o[82]=o[97]}]):t.resolve(o[82]=void 0)},function(e){return t.blobs.neq(o[82],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[82]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[83]=o[95]}]):t.resolve(o[83]=void 0)},function(r){return o[84]=new t.Map,o[84].set("supported_encryption_versions",o[47]),o[84].set("client_version",t.i64.cast([0,1])),o[84].set("version_sig",o[56]==null?"":o[56]),e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_start"):t.resolve()},function(r){return t.i64.eq(e[7],t.i64.cast([0,2]))?t.resolve(o[85]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[85]=o[95]}])},function(e){return t.blobs.neq(o[85],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[33]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return t.blobs.neq(o[95],void 0)?t.resolve(o[96]=o[95]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[101]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[32],t.blob("Mw=="),o[85]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return t.blobs.neq(o[97],void 0)?t.resolve(o[98]=o[97]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[101]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[101]].join("")),o[100]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[101],o[100],t.i64.cast([0,3]))},function(e){return o[98]=void 0}])},function(e){return t.blobs.neq(o[98],void 0)?(t.blobs.neq(o[96],void 0)?(o[101]=new t.Map,o[101].set("armadillo_public_key",o[85]),o[101].set("armadillo_key_signature",o[98]),o[101].set("labyrinth_key_signature",o[96]),o[100]=o[101]):o[100]=void 0,o[99]=o[100]):o[99]=void 0,o[86]=o[99]}]):t.resolve(o[86]=void 0)},function(r){return o[86]!==void 0?t.sequence([function(e){return o[95]=o[86].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[95]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[97]=o[86].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[97]).then(function(e){var t;return t=e,o[98]=t[0],t})},function(e){return o[99]=o[86].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[99]).then(function(e){var t;return t=e,o[100]=t[0],t})},function(r){return o[105]=t.i64.cast([0,1e3]),o[101]=o[105],o[102]=new t.Map,o[102].set("backup_id",e[1]),o[102].set("device_epoch_hmac",o[87]),o[102].set("epoch_root_key_fingerprint",o[68]),o[102].set("device_public_key",o[88]),o[102].set("epoch_storage_pubkey",o[89]),o[102].set("epoch_storage_pubkey_sig",o[90]),o[102].set("epoch_auth_pubkey",o[91]),o[102].set("epoch_auth_pubkey_sig",o[92]),o[102].set("ocmf_rotation_token",o[93]),o[102].set("virtual_device_id",o[94]),o[102].set("device_registration_id",e[11]),o[102].set("base_epoch_id",o[69]),o[102].set("encryption_version_data",o[84]),o[102].set("private_key_debug_token",o[79]),o[102].set("ocmf_client_state_debug_token",o[81]),o[102].set("epoch_storage_pvtkey_debug_token",o[83]),o[102].set("trace_id",e[8]),o[102].set("occam_only_eligible",!0),o[102].set("armadillo_public_key",o[96]==null?"":o[96]),o[102].set("armadillo_key_signature",o[98]==null?"":o[98]),o[102].set("labyrinth_key_signature",o[100]==null?"":o[100]),o[103]=t.toJSON(o[102]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[103],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[101]).then(function(e){var t;return t=e,o[104]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] failed to get armadillo key and device signatures"),o[99]=t.i64.cast([0,1e3]),o[95]=o[99],o[96]=new t.Map,o[96].set("backup_id",e[1]),o[96].set("device_epoch_hmac",o[87]),o[96].set("epoch_root_key_fingerprint",o[68]),o[96].set("device_public_key",o[88]),o[96].set("epoch_storage_pubkey",o[89]),o[96].set("epoch_storage_pubkey_sig",o[90]),o[96].set("epoch_auth_pubkey",o[91]),o[96].set("epoch_auth_pubkey_sig",o[92]),o[96].set("ocmf_rotation_token",o[93]),o[96].set("virtual_device_id",o[94]),o[96].set("device_registration_id",e[11]),o[96].set("base_epoch_id",o[69]),o[96].set("encryption_version_data",o[84]),o[96].set("private_key_debug_token",o[79]),o[96].set("ocmf_client_state_debug_token",o[81]),o[96].set("epoch_storage_pvtkey_debug_token",o[83]),o[96].set("trace_id",e[8]),o[96].set("occam_only_eligible",!0),o[97]=t.toJSON(o[96]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50006]),o[97],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[95]).then(function(e){var t;return t=e,o[98]=t[0],t}))},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_end"):t.resolve()}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $device_epoch_hmac found to be null"):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $device_epoch_hmac found to be null"),o[70]="$device_epoch_hmac found to be null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[70]].join("")),o[69]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[70],o[69],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $latest_epoch_data is null."):t.resolve()},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,4])})},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $latest_epoch_data is null."),o[62]="$latest_epoch_data is null.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[62]].join("")),o[61]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[62],o[61],t.i64.cast([0,3]))}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $mailbox root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null"),o[47]="$mailbox root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: oblivious validation token is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null"),o[47]="oblivious validation token is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch root key is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null"),o[47]="epoch root key is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null",!1)}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch anon id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null"),o[47]="epoch anon id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[47]].join("")),o[46]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[47],o[46],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null",!1)}])}]):t.sequence([function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: orf client state v1 is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null"),o[41]="orf client state v1 is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",o[41]].join("")),o[40]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",o[41],o[40],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null",!1)}])},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]):(i=s.item,t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] An authoritative row already exists, aborting execution of addDeviceFromVirtualDevice"),t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,2])})},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_device_already_added"):t.resolve()},function(r){return e[8]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):t.resolve()}]))})},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_recovery_code_status","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",["LSAddDeviceWithVirtualDeviceAndDecryptionKey","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDeviceWithVirtualDeviceAndDecryptionKey"),a.taskId,a.backupId,a.epochId,a.encryptedSecretValues,a.lastEpochId,a.syncEpochs,a.epochStoragePublicKey,a.backupTenancy,a.traceId,a.blobDecryptionKey,a.virtualDeviceId,a.deviceRegistrationId,a.minosEpoch);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBAddDeviceGraphQL",["CometRelay","EBAPIQPLPoints","EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql","EBGetLSVirtualDevices","EBMinosCheckWasmFeatureSupport","FBLogger","I64","LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure","LSDict","LSEncryptedBackupsBackupTenancy","LSFactory","LSParseRecoveryCode_v2.nop","LSShape","LSVec","MWEncryptedBackupsDeviceRegistrationId","ReQL","WAArrayBufferUtils","WABase64","WAResultOrError","WorkerRelay","WorkerRelayNetwork","getErrorSafe","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=e!==void 0?e:e=n("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql");function c(e){var t=e.backupId,n=e.qplFlow,r=e.recoveryCode,a=e.storage,i=e.userId;return o("WorkerRelayNetwork").getWorkerNetworkExecute().then(function(){return m({backupId:t,fetchQueryGraphQLFn:function(t,n){return o("WorkerRelay").createWorkerQuery(t,n)},qplFlow:n,recoveryCode:r,storage:a,userId:i})}).catch(function(){return o("WAResultOrError").makeError("worker-environment-error")})}function d(e){var t=e.backupId,n=e.environment,r=e.qplFlow,a=e.recoveryCode,i=e.storage,l=e.userId;return m({backupId:t,fetchQueryGraphQLFn:function(t,r){return o("CometRelay").fetchQuery(n,t,r,{fetchPolicy:"network-only"}).toPromise()},qplFlow:r,recoveryCode:a,storage:i,userId:l})}async function m(e){var t=e.backupId,n=e.fetchQueryGraphQLFn,a=e.qplFlow,l=e.recoveryCode,c=e.storage,d=e.userId,m=await o("EBMinosCheckWasmFeatureSupport").checkWasmFeatureSupportAndGK();try{return g(c).then(function(e){var t=e!=null?e:d;return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_START),Promise.all([c.runInTransaction(function(e){return r("LSParseRecoveryCode_v2.nop")(e,0,l,t,r("LSVec").ofArray([]))},"readwrite","ui",void 0,i.id+":209"),Promise.resolve(t)])}).then(function(e){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_END);var l=e[0][0],d=e[0][1],g=e[1];if(l==null||d==null)return o("WAResultOrError").makeError("missing-mandatory-field");var h=o("WABase64").encodeB64(l);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_START),n(u,{request_uuid:g,virtual_device_id:h}).then(function(e){var n,u,g,h;if((e==null||(n=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:n.ok)===!1){var y,C,b;return a.addAnnotations({string:{fetch_vd_info_error_code:(y=e==null||(C=e.fetch_virtual_device_info_for_device_addition_v2)==null||(C=C.error)==null?void 0:C.code)!=null?y:""}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END),(e==null||(b=e.fetch_virtual_device_info_for_device_addition_v2)==null||(b=b.error)==null?void 0:b.code)==="NO_VIRTUAL_DEVICE_FOUND"?o("EBGetLSVirtualDevices").getLSVirtualDevices(c).then(function(e){return e.length>0&&a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_EXISTS),o("WAResultOrError").makeError("graphql-fetch-vd-error")}):o("WAResultOrError").makeError("graphql-fetch-vd-error")}a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END);var v=e==null||(u=e.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:u.data,S=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),R=(v==null?void 0:v.encrypted_secret_values)!=null?f(v==null?void 0:v.encrypted_secret_values):null,L=v==null?void 0:v.epoch_storage_public_key,E=v==null?void 0:v.epoch_id,k=v==null?void 0:v.last_epoch_id;if(v==null||S===""||R==null||E==null||L==null||k==null){var I=[];return v==null&&I.push("payload"),S===""&&I.push("deviceRegistrationId"),R==null&&I.push("validated_encrypted_secret_values"),E==null&&I.push("epoch_id"),L==null&&I.push("epoch_storage_public_key"),k==null&&I.push("last_epoch_id"),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_MISSING_GRAPHQL_FIELDS,{string_array:{missing_mandatory_field:I}}),o("WAResultOrError").makeError("missing-mandatory-field")}var T=new(r("LSDict"));v.sync_epochs.forEach(function(e){var t=p(e);t!=null&&e.epoch_id!=null&&T.set(e.epoch_id,o("LSShape").ofRecord(t))});var D=_({epoch_head:(g=v.minos_epoch)==null?void 0:g.epoch_head,self_epoch_signature:(h=v.minos_epoch)==null?void 0:h.self_epoch_signature});a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START);var x={backupId:t,backupTenancy:(s||(s=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),blobDecryptionKey:d,deviceRegistrationId:S,encryptedSecretValues:o("LSShape").ofRecord(R),epochId:s.of_string(E),epochStoragePublicKey:o("WABase64").decodeB64(L),lastEpochId:s.of_string(k),syncEpochs:T,taskId:s.of_int32(0),traceId:a.getQPLAttrs().instanceKey.toString(),virtualDeviceId:l};return(m||r("gkx")("17219"))&&(x=babelHelpers.extends({},x,{minosEpoch:D})),c.runInTransaction(function(e){return r("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure")(r("LSFactory")(e),x)},"readwrite",void 0,void 0,i.id+":382").then(function(){return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END),o("WAResultOrError").makeResult()}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("vd-and-decryption-key-sproc-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("graphql-fetch-vd-error")})}).catch(function(e){var t=r("getErrorSafe")(e);return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL,{string:{error_message:t.message}}),o("WAResultOrError").makeError("parse-recovery-code-error")})}catch(e){var h=r("getErrorSafe")(e);return r("FBLogger")("wmi_eb").catching(h).mustfix("Runtime error performing EBAddDeviceGraphQL: %s",h.message),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_RUNTIME_ERROR,{string:{error_message:h.message}}),Promise.resolve(o("WAResultOrError").makeError("runtime-error"))}}function p(e){var t=e.backup_id,n=e.encrypted_epoch_key,a=e.epoch_anon_id,i=e.epoch_auth_public_key,l=e.epoch_data_v2,u=e.epoch_id,c=e.is_active_epoch,d=e.minos_epoch,m=e.next_epoch_id,p=e.prev_epoch_id;if(t==null||a==null||i==null||u==null||c==null)return null;var _=d==null?void 0:d.epoch_head,f=d==null?void 0:d.self_epoch_signature,g=_!=null&&f!=null?o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(_),self_epoch_signature:o("WABase64").decodeB64(f)}):void 0,h=l==null?void 0:l.epoch_anon_id,y=l==null?void 0:l.epoch_root_key,C=h!=null&&y!=null?{epoch_anon_id:h,epoch_root_key:y}:null,b={backup_id:(s||(s=o("I64"))).of_string(t),encrypted_epoch_key:n!=null?o("WABase64").decodeB64(n):null,epoch_anon_id:o("WAArrayBufferUtils").stringToArrayBuffer(a),epoch_auth_public_key:o("WABase64").decodeB64(i),epoch_data_v2:C?o("LSShape").ofRecord(C):null,epoch_id:s.of_string(u),is_active_epoch:c,next_epoch_id:m!=null?(s||(s=o("I64"))).of_string(m):null,prev_epoch_id:p!=null?(s||(s=o("I64"))).of_string(p):null};return(r("gkx")("20911")||r("gkx")("17219"))&&(b=babelHelpers.extends({},b,{minos_epoch:g})),b}function _(e){var t=e.epoch_head,n=e.self_epoch_signature;return t==null||n==null?void 0:o("LSShape").ofRecord({epoch_head:o("WABase64").decodeB64(t),self_epoch_signature:o("WABase64").decodeB64(n)})}function f(e){var t=e.encrypted_epoch_anon_id,n=e.encrypted_epoch_root_key,r=e.encrypted_epoch_storage_private_key,o=e.encrypted_mailbox_root_key_blob,a=e.encrypted_oblivious_validation_token_blob,i=e.encrypted_ocmf_client_state,l=e.encrypted_orf_client_state_v2;return t==null||n==null||o==null||a==null||i==null?null:{encrypted_epoch_anon_id:t,encrypted_epoch_root_key:n,encrypted_epoch_storage_private_key:r,encrypted_mailbox_root_key_blob:o,encrypted_oblivious_validation_token_blob:a,encrypted_ocmf_client_state:i,encrypted_orf_client_state_v2:l}}function g(e){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.encrypted_backups)).then(function(e){var t=e==null?void 0:e.encryptionManagementDelegatorId;return t!=null?(s||(s=o("I64"))).to_string(t):null})}l.addDeviceGraphQLWorker=c,l.addDeviceGraphQL=d}),98);
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:t.i64.cast([0,1])})},function(e){return t.storedProcedure(n("LSGetLatestEpochKeys"),!1).then(function(e){var t;return t=e,r[2]=t[0],r[3]=t[1],t})},function(o){return r[2]!==void 0?t.sequence([function(o){return r[11]=r[2].get("epoch_keys"),r[12]=r[11].get("epoch_id"),r[13]=new t.Map,r[13].set("existing_device_id",e[1]),r[13].set("base_epoch_id",r[12]),r[14]=new t.Map,r[14].set("success",r[13]),r[15]=t.toJSON(r[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[4]=void 0}]):t.sequence([function(e){return r[3]!==void 0?t.sequence([function(e){return r[12]=r[3].get("error_message"),r[13]=r[3].get("error_code"),r[14]=new t.Map,r[14].set("error_code",r[13]),r[14].set("stored_procedure","onboardFromExistingDeviceStart"),r[14].set("error_message",r[12]),r[15]=new t.Map,r[15].set("failure",r[14]),r[16]=t.toJSON(r[15]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[16],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[18]=new t.Map,r[18].set("error_code",r[13]),r[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[18].set("error_message",""),r[11]=r[18]}]):t.sequence([function(e){return r[12]=new t.Map,r[12].set("error_code",t.i64.cast([0,603])),r[12].set("stored_procedure","onboardFromExistingDeviceStart"),r[12].set("error_message","Unknown error encountered"),r[13]=new t.Map,r[13].set("failure",r[12]),r[14]=t.toJSON(r[13]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",t.i64.cast([0,50036]),r[14],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[15]=t[0],t})},function(e){return r[16]=new t.Map,r[16].set("error_code",t.i64.cast([0,603])),r[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),r[16].set("error_message",""),r[11]=r[16]}])},function(e){return r[4]=r[11]}])},function(e){return r[5]=t.i64.of_float(Date.now()),r[6]=t.i64.random(),r[8]="Finishing execution. Execution time: ",r[9]=t.i64.to_string(t.i64.sub(r[5],r[0])),r[10]=" ms",r[7]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][onboardFromExistingDeviceStart] ",r[7],r[8],r[7],r[9],r[7],r[10]].join("")),t.i64.eq(t.i64.mod_(r[6],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[11]=",",r[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[r[8],r[11],r[9],r[11],r[10]].join(""),r[12],t.i64.cast([0,4]))):t.resolve()},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure",e.__tables__=["experiences_shared_state","device_metadata"],a.exports=e}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOnboardFromExistingDeviceStart"),a.backupId,a.previousDeviceId,a.newDeviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBAddDeviceWithKeys",["ClientConsistencyEventEmitter","CurrentAppID","EBAPIQPLPoints","EBDB","EBSMAPI","EBSMGatingUI","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ODS","Promise","QPLFlow","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","err","getErrorSafe","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_,f,g,h,y,C=r("requireDeferred")("MWEBUseLocalStorage").__setRef("EBAddDeviceWithKeys");function b(t){var a=t.backupId,l=t.db,_=t.newDeviceRegistrationId,b=t.previousDeviceId,S=t.source,R=t.trackAddingDevice;return new(y||(y=n("Promise")))(function(t,n){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys start"]))),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");var y=o("WAHashStringToNumber").hashStringToNumber(r("uuidv4")()),L=r("qpl")._(521473756,"2768"),E=S,k=o("QPLFlow").startQPLFlow(L,{annotations:{bool:{isEBAddDeviceWithKeys:!0,isInWorker:!1},string:{restore_type:E}},instanceKey:y,timeoutInMs:r("justknobx")._("2444")});k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"start"),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys caling LSOnboardFromExistingDeviceStartStoredProcedure"]))),l.runInTransaction(function(e){return r("LSOnboardFromExistingDeviceStartStoredProcedure")(r("LSFactory")(e),{backupId:a,newDeviceRegistrationId:_,previousDeviceId:b})},"readwrite",void 0,void 0,i.id+":103").then(function(e){var a=e[0];if(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a!=null){var i,s=o("LSShape").toRecord(a).error_message;switch(r("QPLUserFlow").addPoint((i=o("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),r("QPLUserFlow").addPoint(i.restoreQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM"),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:s,event:i.restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),k.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_code:(g||(g=o("I64"))).to_string(o("LSShape").toRecord(a).error_code),error_message:s}}),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithKeys sproc failed, isInWorker: false, error: ",""])),s),r("promiseDone")(o("EBDB").clearEbStores()),o("CurrentAppID").getAppID()){case 772021112871879 .toString():r("ClientConsistencyEventEmitter").emit("hardRefresh","eb_autorestore_error");break;default:r("ClientConsistencyEventEmitter").emit("softRefresh","eb_autorestore_error")}n(r("err")(s))}k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_START);var _=o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_client_state).subscribe(function(e,a){if(a.operation==="delete"){_();var i="[wmi][ebsm] EBAPI addDeviceWithKeys subscription failed, isInWorker: false, error: client state deleted";v(i,k,E),n(r("err")(i))}else if(a.operation==="add"||a.operation==="put"){var s=a.value,u=s.authorityLevel,y=s.deviceId;(g||(g=o("I64"))).equal(u,(h||(h=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))&&(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK"),k.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_END),_(),r("promiseDone")(o("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:l,stateKey:r("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys client state row added"]))),R(y),C.onReady(function(e){var t=e.mwEBCreateLocalStorageEntry,n=e.mwEBDeleteLocalStorageEntry;t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION),t(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2),n(r("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),o("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:l,onFailure:function(){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore failed"])))},onSuccess:function(){r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),o("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore success"])))}}),r("EBSMAPI").fetchBackupIds("EBAddDeviceWithKeys").catch(function(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["",""])),r("getErrorSafe")(e).message)}),k.endSuccess(),(f||(f=o("ODS"))).bumpEntityKey(7319,E,"success"),t())}})}).catch(function(e){var t="[wmi][ebsm] EBAPI addDeviceWithKeys sproc error, isInWorker: false, error: "+r("getErrorSafe")(e).message;v(t,k,E),n(r("err")(t))})})}function v(e,t,n){o("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{isBackendSetupOnFail:o("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),o("MWChatEncryptedBackupsLogging").endFailure({errorName:e,event:o("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),t.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_message:e}}),(f||(f=o("ODS"))).bumpEntityKey(7319,n,"fail"),o("WALogger").ERROR(_||(_=babelHelpers.taggedTemplateLiteralLoose(["",""])),e)}l.addDeviceWithEBKeys=b}),98);
__d("LSAddDevice",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_start"):t.resolve()},function(a){return r("justknobx")._("946")?t.sequence([function(e){return o[8]=t.createArray(),t.forEach(t.db.table(179).fetch(),function(e){var n=e.item;return t.sequence([function(e){return o[15]=n.taskId,t.db.table(2).fetch([[[o[15]]]]).next().then(function(e,t){var n=e.done,r=e.value;return n?o[13]=!1:(t=r.item,o[13]=!0)})},function(e){return o[13]?0:o[16]=(o[8].push(o[15]),o[8])}])})},function(e){return o[9]=t.i64.of_int32(o[8].length),t.i64.gt(o[9],t.i64.cast([0,0]))?t.loopAsync(o[9],function(e){return o[13]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[8],o[13]).then(function(e){var t;return t=e,o[14]=t[0],o[15]=t[1],t})},function(e){return t.forEach(t.db.table(179).fetch([[[o[14]]]]),function(e){return e.delete()})}])}):t.resolve()},function(e){return t.db.table(179).fetch().next().then(function(e,t){var n=e.done,r=e.value;return n?o[10]=!1:(t=r.item,o[10]=!0)})},function(r){return o[10]?t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device task already pending"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] add device task already pending"),o[14]="add device task already pending",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(e){return o[12]=t.i64.cast([0,1])}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_start"):t.resolve()},function(n){return o[13]=t.createArray(),t.forEach(t.filter(t.db.table(184).fetch(),function(n){return t.i64.eq(n.backupId,e[0])}),function(e){var n=e.item;return o[19]=new t.Map,o[19].set("virtual_device_id",n.virtualDeviceId),o[20]=(o[13].push(o[19]),o[13])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_vd_error_correction_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_start"):t.resolve()},function(e){return t.db.table(172).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[14]=void 0:(n=a.item,o[20]=n.encryptionManagementDelegatorId,t.i64.neq(o[20],void 0)?(t.i64.neq(o[20],t.i64.cast([0,0]))?o[21]=t.i64.to_string(o[20]):o[21]=void 0,o[19]=o[21]):o[19]=void 0,o[14]=o[19])})},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[16]=t[0],t})},function(r){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),e[1],o[14]==null?t.i64.to_string(o[16]):o[14],o[13]).then(function(e){var t;return t=e,o[17]=t[0],o[18]=t[1],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_parse_recovery_code_end"):t.resolve()},function(r){return t.blobs.neq(o[17],void 0)?t.blobs.neq(o[18],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[19]=t[0],t})},function(e){return t.db.table(178).put({pk:t.i64.cast([0,1]),recoveryCodeStatus:t.i64.cast([0,1])})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_start"):t.resolve()},function(r){return o[24]=t.i64.cast([0,1e3]),o[20]=o[24],o[21]=new t.Map,o[21].set("backup_id",e[0]),o[21].set("virtual_device_id",o[19]==null?"":o[19]),o[21].set("trace_id",void 0),o[22]=t.toJSON(o[21]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50007]),o[22],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[20]).then(function(e){var t;return t=e,o[23]=t[0],t})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_issue_fetch_virtual_device_task_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_start"):t.resolve()},function(n){return t.db.table(185).add({pk:t.i64.cast([0,1]),backupId:e[0],deviceRegistrationId:e[2],taskId:o[23]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_device_registration_id_end"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_start"):t.resolve()},function(e){return t.db.table(179).add({taskId:o[23],virtualDeviceId:o[17],blobDecryptionKey:o[18]})},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_insert_recovery_code_data_end"):t.resolve()}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. blob_decryption_key is null"):t.resolve()},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. blob_decryption_key is null",!0)}]):t.sequence([function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: Invalid recovery code. virtual_device_id is null"):t.resolve()},function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null"),o[20]="Invalid recovery code. virtual_device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",o[20]].join("")),o[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",o[20],o[19],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null",!0)}])},function(e){return o[12]=t.i64.cast([0,0])}])},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=o[12]}]):t.sequence([function(r){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[4]!==void 0?t.nativeOperation(n("LSQplAnnotateString.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_error","LSEncryptedBackupsAddDeviceStoredProcedure: add device flow is disabled"):t.resolve()},function(r){return e[4]!==void 0?t.nativeOperation(n("LSQplMarkPoint.nop"),t.i64.cast([0,1021646192]),e[4],"dasm_add_device_sproc_end"):t.resolve()},function(e){return o[1]=t.i64.cast([0,1])}])},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsAddDeviceStoredProcedure",e.__tables__=["secure_recovery_code_data","pending_tasks","encrypted_backups_virtual_devices","encrypted_backups","secure_encrypted_backups_recovery_code_status","device_metadata"];var s=e;l.default=s}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSAddDevice"),a.backupId,a.recoveryCode,a.deviceRegistrationId,a.backupTenancy,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSEncryptedBackupsRecoveryCodeStatus",[],(function(t,n,r,o,a,i){var e=Object.freeze({OPTIMISTIC:1,VALID:2,INVALID:3,SYSTEM_ERROR:4});i.default=e}),66);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.onFailure,a=t.onInvalidRecoveryCode,i=t.onSuccess,l=t.recoveryCodeStatusData;if((l==null?void 0:l.length)===1){var s=l[0].recoveryCodeStatus;switch((e||(e=o("I64"))).to_int32(s)){case r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return r("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case r("LSEncryptedBackupsRecoveryCodeStatus").INVALID:return a==null||a(),r("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case r("LSEncryptedBackupsRecoveryCodeStatus").VALID:return i==null||i(),r("LSEncryptedBackupsRecoveryCodeStatus").VALID;case r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:return n==null||n(),r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:n==null||n(),r("FBLogger")("wmi_eb").mustfix("Invalid Recovery Code Status type")}}}l.encryptedBackupsGetRecoveryCodeStatus=s}),98);
__d("EBAddDeviceWithRecoveryCode",["EBAPIQPLPoints","EBAddDeviceGraphQL","EBDeps","FBLogger","I64","LSAddDeviceStoredProcedure","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","MAWWaitForBackendSetup","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsRecoveryCodeStatus","ReQL","WALogger","WAResultOrError","isInstamadilloEB","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p=10;function _(e){var t=e.count,n=e.storage;return new Promise(function(e,a){if(t===p)return e();r("promiseDone")(o("ReQL").firstAsync(o("ReQL").fromTableAscending(n.tables.encrypted_backups)),function(r){var o=r==null?void 0:r.backupId;if(o!=null)return e(o);window.setTimeout(function(){e(_({count:t+1,storage:n}))},1e3)},function(e){return a(e)})})}function f(t){var n=t.environment,a=t.qplFlow,l=t.recoveryCode,p=t.userId,f=function(){},y=!1,C=new Promise(function(e,t){window.setTimeout(function(){y||(r("FBLogger")("wmi_eb").warn("Add device failed by timeout 90 sec"),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT),e("ADD_DEVICE_TIMEOUT"))},r("justknobx")._("4226"))}),b=new Promise(async function(t,g){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var y=await o("EBDeps").getDeps().getLSDB();a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),f=y.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(e,n){if(n.operation!=="delete"){var i=[n.value];a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS),o("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS),f(),t("ADD_DEVICE_FAILED_TO_GET_RC_STATUS")},onInvalidRecoveryCode:function(){h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE),f(),t("INVALID_RECOVERY_CODE")},onSuccess:function(){a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_END),a.endSuccess({bool:{isBackendSetupOnSuccess:o("EBDeps").getDeps().isBackendSetupSuccessful()}}),f(),r("promiseDone")(o("EBDeps").getDeps().trackAddingNewDevice()),t("SUCCESS")},recoveryCodeStatusData:i})}}),r("promiseDone")(_({count:0,storage:y}),function(_){if(_!=null)if(r("isInstamadilloEB")()){o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc start"])));var b=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();return b===""?(h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL),f(),g("deviceRegistrationId is not defined")):(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START),y.runInTransaction(function(e){return r("LSAddDeviceStoredProcedure")(r("LSFactory")(e),{backupId:_,backupTenancy:(d||(d=o("I64"))).of_int32(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:b,recoveryCode:l})},"readwrite",void 0,void 0,i.id+":232").then(function(e){var t=e[0];if(!(d||(d=o("I64"))).equal(t,(m||(m=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{bool:{is_backend_setup:o("MAWWaitForBackendSetup").isBackendSetupSuccessful()}}),f(),g("Add device sproc failed");a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc success"])))}).catch(function(e){throw a.addAnnotations({string:{error_message:e.message}}),e}))}else{o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql start"]))),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_START);var C=n!=null?o("EBAddDeviceGraphQL").addDeviceGraphQL({backupId:_,environment:n,qplFlow:a,recoveryCode:l,storage:y,userId:p}):o("EBAddDeviceGraphQL").addDeviceGraphQLWorker({backupId:_,qplFlow:a,recoveryCode:l,storage:y,userId:p});return C.then(function(e){if(e.success)a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql success"])));else return h(a,o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,{string:{fail_result:e.error}}),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL),f(),t("ADD_DEVICE_GRAPHQL_ERROR")})}else return h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND),f(),t("ADD_DEVICE_ERROR_BACKUP_ID_NOT_DEFINED")},function(e){return r("FBLogger")("wmi_eb").catching(e).mustfix("Add device failed. Could not find backup."),h(a,o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{string:{error_message:e.message}}),f(),t("ADD_DEVICE_ERROR_COULD_NOT_READ_BACKUP_TABLE")})});return Promise.race([b,C]).then(function(e){return y=!0,g(e)})}function g(e){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError(e)}var h=function(t,n,r){t.endFail(n,babelHelpers.extends({},r!=null?r:{},{bool:{isBackendSetupOnFail:o("EBDeps").getDeps().isBackendSetupSuccessful()}}))};l.addDeviceWithRecoveryCode=f}),98);
__d("EBAddVirtualDevice",["EBDeps","EBLogger","I64","LSEncryptedBackupsOpStatus","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=r("requireDeferred")("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData").__setRef("EBAddVirtualDevice");async function c(t){var n=t.actionType,a=t.qplFlow,i=t.recoveryCodeData;a.addPoint("add_virtual_device_get_db_start");var l=await o("EBDeps").getDeps().getLSDB();return a.addPoint("add_virtual_device_get_db_end"),a.addPoint("add_virtual_device_sproc_start"),new Promise(function(t,c){return u.onReady(function(u){var c=l.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(l.tables.secure_encrypted_backups_recovery_code_status)),function(n){if(n!=null&&n.length===1){var a=n[0].recoveryCodeStatus;return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID))?(c(),t(o("WAResultOrError").makeResult())):(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").INVALID))?(c(),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_INVALID"))):void 0}})});r("promiseDone")(u.initializeCreateExtraVirtualDeviceStoredProcedure(l,(e||(e=o("I64"))).of_int32(n),i),function(n){a.addPoint("add_virtual_device_sproc_end");var i=n[0];if(!(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)))return(e||(e=o("I64"))).equal(i,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))?(a.endFail("add_virtual_device_sproc_failure"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - failure"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_FAILURE"))):(a.addPoint("add_virtual_device_sproc_fail_unknown"),o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device - unknown"),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_STATUS_UNKNOWN")))},function(){return o("EBLogger").EBLogger().mustfix("Error while creating extra virtual device."),t(o("WAResultOrError").makeError("ADD_VIRTUAL_DEVICE_ERROR"))})})})}l.addVirtualDevice=c}),98);
__d("EBDeleteBackupsOnClient",["EBAPIQPLPoints","EBDeps","EBSMAPI","QPLFlow","Random","ReQL","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";async function e(e){var t=e.reason,n=o("Random").uint32(),a=o("QPLFlow").startQPLFlow(r("qpl")._(521485243,"1081"),{annotations:{string:{reason:t}},instanceKey:n});try{var i;a.addPoint((i=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.GET_DB_START);var l=await o("EBDeps").getDeps().getLSDB();a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.GET_DB_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_START),await l.runInTransaction(async function(e){var t,n;a.addPoint((t=o("EBAPIQPLPoints")).EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_START);var r=await(n=o("ReQL")).toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_client_state));await Promise.all(r.map(function(t){return e.secure_encrypted_backups_client_state.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_CLIENT_STATE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_START);var i=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_epochs));await Promise.all(i.map(function(t){return e.secure_encrypted_backups_epochs.delete(t.epochId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_EPOCHS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_START);var l=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_generated_recovery_code));await Promise.all(l.map(function(t){return e.secure_encrypted_backups_generated_recovery_code.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_START);var s=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups));await Promise.all(s.map(function(t){return e.encrypted_backups.put(babelHelpers.extends({},t,{backupId:void 0}))})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_ENCRYPTED_BACKUPS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_START);var u=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_metadata));await Promise.all(u.map(function(t){return e.encrypted_backups_metadata.delete(t.backupId)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_METADATA_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_START);var c=await n.toArrayAsync(n.fromTableAscending(e.encrypted_backups_virtual_devices));await Promise.all(c.map(function(t){return e.encrypted_backups_virtual_devices.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_VIRTUAL_DEVICES_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_START);var d=await n.toArrayAsync(n.fromTableAscending(e.secure_encrypted_backups_recovery_code_status));await Promise.all(d.map(function(t){return e.secure_encrypted_backups_recovery_code_status.delete(t.pk)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_RECOVERY_CODE_STATUS_END),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_START);var m=await n.toArrayAsync(n.fromTableAscending(e.pending_backups_context_v2));await Promise.all(m.map(async function(t){var n=t.pendingBackupTaskId;n!=null&&await e.pending_tasks.delete(n)})),a.addPoint(t.EBDeleteBackupsOnClientQPLPoints.CLEAR_PENDING_BACKUPS_END)},"readwrite"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.TRANSACTION_END),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_START),await r("EBSMAPI").fetchBackupIds("deleteBackupsOnClient"),a.addPoint(i.EBDeleteBackupsOnClientQPLPoints.FETCH_BACKUP_IDS_END),a.endSuccess()}catch(e){var s=r("getErrorSafe")(e);throw a.endFail("runtime_error",{string:{error_message:s.message}}),e}}l.deleteBackupsOnClient=e}),98);
__d("LSDeleteBackups",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Beginning execution."),r("justknobx")._("803")?t.sequence([function(r){return t.db.table(168).fetch([[[e[0]]]]).next().then(function(r,a){var i=r.done,l=r.value;return i?((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Row not found in client state table for the backupidDeleting the backup without deleting mailbox"),o[9]=new t.Map,o[9].set("backup_id",e[0]),o[9].set("trace_id",e[1]),o[9].set("backup_deletion_source",e[2]),o[10]=t.toJSON(o[9]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[10],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[11]=t[0],t})):(a=l.item,t.sequence([function(r){return o[13]=a.deviceId,t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(e[0])).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),o[9]).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),a.ocmfClientStateBlob,o[10]).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[11]).then(function(e){var t;return t=e,o[12]=t[0],t})},function(r){return t.i64.neq(o[13],void 0)?(o[14]=new t.Map,o[14].set("device_id",o[13]),o[14].set("mailbox_partial_id",o[12]==null?"":o[12]),o[14].set("trace_id",e[1]),o[14].set("backup_deletion_source",e[2]),o[15]=t.toJSON(o[14]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50014]),o[15],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[16]=t[0],t})):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] device_id is null"),o[15]="device_id is null",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ","",o[15]].join("")),o[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",o[15],o[14],t.i64.cast([0,3]))},function(r){return o[16]=new t.Map,o[16].set("backup_id",e[0]),o[16].set("trace_id",e[1]),o[16].set("backup_deletion_source",e[2]),o[17]=t.toJSON(o[16]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50011]),o[17],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[1],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[18]=t[0],t})}])}]))})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] backup deletion flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsDeleteBackupsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSDeleteBackupsStoredProcedure",["LSDeleteBackups","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeleteBackups"),a.backupId,a.traceId,a.backupDeletionSource);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("encryptedBackupsDeleteBackupsStoredProcedure",["LSDeleteBackupsStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSResult","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(async function(l){var s=r("LSResult")((e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE));if(l!=null){var u=l.backupId;u!=null&&(s=await t.runInTransaction(function(t){return r("LSDeleteBackupsStoredProcedure")(r("LSFactory")(t),{backupDeletionSource:(e||(e=o("LSIntEnum"))).ofNumber(n),backupId:u,traceId:a})},"readwrite",void 0,void 0,i.id+":37"))}return s})}l.default=s}),98);
__d("EBDeleteEncryptedBackup",["EBAPIQPLPoints","EBDeps","EBSMAPI","LSEncryptedBackupsOpStatus","LSIntEnum","WAResultOrError","WATagsLogger","encryptedBackupsDeleteBackupsStoredProcedure","getSafeQplErrorMessage","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["EB","EBAPIDeleteEncryptedBackup"]);async function c(t){var n=t.qplFlow,a=t.reason;n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_START);var i=await o("EBDeps").getDeps().getLSDB();return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_GET_DB_END),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_START),new Promise(function(t,l){r("encryptedBackupsDeleteBackupsStoredProcedure")(i,a,n.getQPLAttrs().instanceKey.toString()).then(function(e){var a=e[0];if(a===(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_FAIL),n.endFail("delete_eb_sproc_fail"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_FAIL"));return}n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_SUCCESS);var l=i.tables.encrypted_backups.subscribe(function(e,a){if(a.operation==="put"){if(a.value.backupId==null)return n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_TASK_SUCCESS),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_START),r("promiseDone")(r("EBSMAPI").fetchBackupIds("EBDeleteEncryptedBackup"),function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endSuccess()},function(){n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END),n.endFail("fetch_backup_ids_fail")}),t(o("WAResultOrError").makeResult()),l();n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_DELETE_OPERATION)}else n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_PUT_OPERATION)},void 0,["backupId"])}).catch(function(r){u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Exception while calling deleteBackups stored procedure: ",""])),r),n.addPoint(o("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_ERROR,{string:{error:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(r)}}),n.endFail("delete_eb_sproc_error"),t(o("WAResultOrError").makeError("DELETE_EB_SPROC_ERROR"))})})}l.deleteEncryptedBackup=c}),98);
__d("EBFetchBackupIds",["EBDeps","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWEBODSEntityName.enum","ODS","err","justknobx","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,n){(e||(e=o("ODS"))).bumpEntityKey(7319,r("MWEBODSEntityName.enum").MW_EBSM_FETCH_BACKUP_IDS,t+".sproc"),n.addPoint("eb_fetch_backup_ids_get_storage_start");var a=await o("EBDeps").getDeps().getLSDB();return n.addPoint("eb_fetch_backup_ids_get_storage_ended"),new Promise(function(e,t){var i,l=a.tables.encrypted_backups.subscribe(function(t,a){if(a.operation==="delete"||!(s||(s=o("I64"))).equal(a.value.authorityLevel,(u||(u=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))){a.operation==="delete"?n.addPoint("eb_fetch_backup_ids_delete_detected"):n.addPoint("eb_fetch_backup_ids_authority_level_not_auth");return}l(),window.clearTimeout(i),n.addPoint("eb_fetch_backup_ids_success"),n.endSuccess(),e()});n.addPoint("eb_fetch_backup_ids_sproc_start"),r("promiseDone")(a.runInTransaction(function(e){return r("LSFetchBackupIdsStoredProcedure")(r("LSFactory")(e),{backupTenancy:(u||(u=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1}).then(function(){n.addPoint("eb_fetch_backup_ids_sproc_ended"),i=window.setTimeout(function(){n.endFail("eb_fetch_backup_ids_timeout"),t(r("err")("[wmi][ebapi] Timeout fetching backup ids"))},r("justknobx")._("3868"))})},"readwrite"))})}function d(e,t){return c(e,t)}l.fetchBackupIds=d}),98);
__d("EBGenerateRecoveryCode",["Base64Utils","EBDeps","LSEncryptedBackupsOpStatus","LSFactory","LSGenerateRecoveryCodeStoredProcedure","LSIntEnum","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("EBDeps").getDeps().getLSDB(),a=t.virtualDeviceType;return n.runInTransaction(function(e){return r("LSGenerateRecoveryCodeStoredProcedure")(r("LSFactory")(e),{virtualDeviceType:a})},"readwrite",void 0,void 0,i.id+":35").then(function(t){var n=t[0],a=t[1],i=t[2];return(e||(e=o("LSIntEnum"))).toNumber(a)!==r("LSEncryptedBackupsOpStatus").SUCCESS?o("WAResultOrError").makeError("sproc_failure"):o("WAResultOrError").makeResult({recoveryCode:n,virtualDeviceId:i!=null?o("Base64Utils").fromArrayBuffer(i):void 0})})}l.generateRecoveryCode=s}),98);
__d("EBGetEBStateQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="23909871918604871"}),null);
__d("EBGetEBStateQuery.graphql",["EBGetEBStateQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBGetEBStateQuery",selections:[{kind:"RequiredField",field:t,action:"LOG",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBGetEBStateQuery",selections:[t]},params:{id:n("EBGetEBStateQuery_facebookRelayOperation"),metadata:{},name:"EBGetEBStateQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBGetEBState",["EBGetEBStateQuery.graphql","FBLogger","MAWOneTimeCodeGating","RelayHooks","WAResultOrError","XPlatRelayEnvironment","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e!==void 0?e:e=n("EBGetEBStateQuery.graphql");async function u(){try{var e,t,n,a,i,l,u,c,d,m,p,_,f,g,h,y,C,b,v,S,R,L,E,k=await o("RelayHooks").fetchQuery(o("XPlatRelayEnvironment").getRelayEnvironment(),s,{}).toPromise().then(function(e){return e}),I=k==null||(e=k.viewer)==null?void 0:e.backup_state;if(I===1||I===0)return o("WAResultOrError").makeResult({backupStatus:I});var T=(t=k==null||(n=k.viewer)==null||(n=n.encrypted_backup)==null?void 0:n.virtual_devices)!=null?t:[],D=T.filter(function(e){return e.device_type==="HSM"}),x=T.filter(function(e){return e.device_type==="OFFLINE"});return o("WAResultOrError").makeResult({backupStatus:(k==null||(a=k.viewer)==null?void 0:a.backup_state)!=null?k.viewer.backup_state:0,ebState:{backupMetadata:{backupId:(i=k==null||(l=k.viewer)==null||(l=l.encrypted_backup)==null?void 0:l.id)!=null?i:"",creationTime:(u=k==null||(c=k.viewer)==null||(c=c.encrypted_backup)==null?void 0:c.backup_creation_time)!=null?u:0,deviceCreatedOn:(d=D[0].device_created_on)!=null?d:"",removalStatus:"",requiresHsmMigration:D[0].migration_status!=="DOES_NOT_REQUIRE_MIGRATION",virtualDeviceCreationTime:(m=(p=D[0])==null?void 0:p.creation_time)!=null?m:0,virtualDeviceId:(_=(f=D[0])==null?void 0:f.id)!=null?_:"",virtualDeviceType:(g=(h=D[0])==null?void 0:h.device_type)!=null?g:""},backupTenancy:(y=k==null||(C=k.viewer)==null||(C=C.encrypted_backup)==null?void 0:C.backup_tenancy)!=null?y:"PRODUCTION",hasOtcEligibleDevices:!!(o("MAWOneTimeCodeGating").isOneTimeCodeEnabled()&&(k==null||(b=k.viewer)==null||(b=b.encrypted_backup)==null?void 0:b.has_otc_eligible_devices)!==!1),hasSeenEbAutoRestoreNotice:(v=k==null||(S=k.viewer)==null||(S=S.encrypted_backup)==null?void 0:S.has_seen_eb_auto_restore_notice)!=null?v:!1,isPINCodeRegistered:((R=D[0])==null?void 0:R.id)!=null,isUserOptedOut:(L=k==null||(E=k.viewer)==null||(E=E.encrypted_backup)==null?void 0:E.is_user_opted_out)!=null?L:!1,offlineDevicesCount:x.length}})}catch(e){return r("FBLogger")("wmi_eb").catching(r("getErrorSafe")(e)).mustfix("Failed to check EB enabled"),o("WAResultOrError").makeResult({backupStatus:0})}}l.GetEbState=u}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop"),s=function(n,a){return e.load().then(function(e){return r("LSResult")(e.scalar.getRandom().buffer)}).catch(function(e){throw o("CryptoLogger").captureError(o("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),e).mustfix("Failed to init OCMF client."),e})};s.__nop_name__="LSOcmfClientInit_v2",l.default=s}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=function(a,i,l){var t=o("CryptoLogger").CryptoLogger("ope_encrypt");if((s||(s=o("I64"))).gt(l,r("LSMaxInt32")))return t.mustfix("numBytes '"+String(l)+"' too large. Returning an empty array"),(e||(e=n("Promise"))).resolve(r("LSResult")(new Uint8Array(0).buffer));for(var u=(s||(s=o("I64"))).to_int32(l),c=new Uint8Array(u),d=65536,m=0;m<u;m+=d){var p=c.subarray(m,m+Math.min(u-m,d));o("XPlatReactCrypto").getRandomValues(p)}return(e||(e=n("Promise"))).resolve(r("LSResult")(c.buffer))};u.__nop_name__="LSRandom",l.default=u}),98);
__d("LSGenerateInitialDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[33]=new t.Map,r[33].set("error_msg","Expected a nonempty query result"),r[33].set("code",t.i64.cast([0,3])),r[33].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[34]=t.createArray(),r[35]=(r[34].push(r[33]),r[34]),o=[void 0,r[34]],r[2]=o[0],r[3]=o[1]):(n=l.item,r[33]=new t.Map,r[33].set("backup_id",n.backupId),r[33].set("device_public_key_blob",n.devicePublicKeyBlob),r[33].set("device_private_key_blob",n.devicePrivateKeyBlob),r[33].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[33].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[33].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[33].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[33].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[33].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[33].set("orf_client_state_v2_blob",void 0),r[33].set("orf_v2_authority_level",void 0),r[33].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[33].set("device_id",n.deviceId),r[33].set("backup_tenancy",n.backupTenancy),r[33].set("encryption_version",n.encryptionVersion),r[33].set("revision_version",n.revisionVersion),r[33].set("initialize_restore_result",void 0),r[33].set("device_creation_timestamp_sec",void 0),r[33].set("authority_level",n.authorityLevel),a=[r[33],void 0],r[2]=a[0],r[3]=a[1])})},function(e){return r[5]=new t.Map,r[5].set("value",r[2]),r[5].set("errors",r[3]),r[6]=r[5].get("value"),r[6]!==void 0?t.sequence([function(e){return r[33]=r[6].get("backup_id"),r[34]=r[6].get("device_public_key_blob"),r[35]=r[6].get("device_private_key_blob"),r[36]=r[6].get("epoch_storage_public_key_blob"),r[37]=r[6].get("epoch_storage_private_key_blob"),r[38]=r[6].get("epoch_auth_public_key_blob"),r[39]=r[6].get("epoch_auth_private_key_blob"),r[40]=r[6].get("mailbox_root_key_blob"),r[41]=r[6].get("ocmf_client_state_blob"),r[42]=r[6].get("orf_client_state_v2_blob"),r[43]=r[6].get("orf_v2_authority_level"),r[44]=r[6].get("oblivious_validation_token_blob"),r[45]=r[6].get("device_id"),r[46]=r[6].get("backup_tenancy"),r[47]=r[6].get("encryption_version"),r[48]=r[6].get("revision_version"),r[49]=r[6].get("initialize_restore_result"),r[50]=r[6].get("device_creation_timestamp_sec"),r[51]=r[6].get("authority_level"),t.i64.neq(r[45],void 0)?t.sequence([function(e){return r[70]=void 0,t.i64.neq(r[70],void 0)?t.resolve(r[71]=r[70]):t.sequence([function(e){return r[74]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[75]=t[0],t})},function(e){return r[75]&&(r[84]=(r[74].push(t.i64.cast([0,0])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[76]=t[0],t})},function(e){return r[76]&&(r[84]=(r[74].push(t.i64.cast([0,2])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[77]=t[0],t})},function(e){return r[77]&&(r[84]=(r[74].push(t.i64.cast([0,3])),r[74])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return r[78]&&(r[84]=(r[74].push(t.i64.cast([0,4])),r[74])),r[79]=t.createArray(),r[80]=t.i64.of_int32(r[74].length),t.i64.gt(r[80],t.i64.cast([0,0]))?t.loopAsync(r[80],function(e){return r[84]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[74],r[84]).then(function(e){var t;return t=e,r[85]=t[0],r[86]=t[1],t})},function(e){return r[87]=(r[79].push(r[85]),r[79])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[84]=t.createArray(),r[85]=t.i64.of_int32(r[79].length),t.i64.gt(r[85],t.i64.cast([0,0]))?t.loopAsync(r[85],function(e){return r[87]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[79],r[87]).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return r[90]=(r[84].push(t.i64.to_string(r[88])),r[84])}])}):t.resolve()},function(e){return r[86]=r[84].join(","),r[81]=r[86]}])},function(e){return r[79].some(function(e){return t.i64.eq(r[47],e)})?r[82]=r[47]:r[82]=void 0,t.i64.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}])},function(e){var n;return t.i64.neq(r[71],void 0)?r[72]=r[71]:r[72]=t.i64.cast([0,0]),t.i64.neq(r[46],void 0)?r[73]=r[46]:r[73]=t.i64.cast([0,1]),n=[r[33],r[45],r[40],r[41],void 0,void 0,r[72],r[73],r[38],r[39],r[34],r[35],r[36],r[37],r[44],r[51],void 0,void 0],r[52]=n[0],r[53]=n[1],r[54]=n[2],r[55]=n[3],r[56]=n[4],r[57]=n[5],r[58]=n[6],r[59]=n[7],r[60]=n[8],r[61]=n[9],r[62]=n[10],r[63]=n[11],r[64]=n[12],r[65]=n[13],r[66]=n[14],r[67]=n[15],r[68]=n[16],r[69]=n[17]}]):t.sequence([function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[70]=t.i64.random(),r[71]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[72]=t[0],r[73]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[74]=t[0],r[75]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[78]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[82]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[109]=(r[82].push(t.i64.cast([0,0])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[109]=(r[82].push(t.i64.cast([0,2])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]&&(r[109]=(r[82].push(t.i64.cast([0,3])),r[82])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]&&(r[109]=(r[82].push(t.i64.cast([0,4])),r[82])),r[87]=t.i64.of_int32(r[82].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.sub(r[87],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[88]=t[0],r[89]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[70]]]]),function(e){return t.i64.eq(e.backupId,r[70])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[70],deviceId:r[71],devicePublicKeyBlob:r[73],devicePrivateKeyBlob:r[72],epochStoragePublicKeyBlob:r[75],epochStoragePrivateKeyBlob:r[74],epochAuthPublicKeyBlob:r[77],epochAuthPrivateKeyBlob:r[76],mailboxRootKeyBlob:r[78],ocmfClientStateBlob:r[79],obliviousValidationTokenBlob:r[81],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[88],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[90]=a[0],r[91]=a[1],r[92]=a[2],r[93]=a[3],r[94]=a[4],r[95]=a[5],r[96]=a[6],r[97]=a[7],r[98]=a[8],r[99]=a[9],r[100]=a[10],r[101]=a[11],r[102]=a[12],r[103]=a[13],r[104]=a[14],r[105]=a[15],r[106]=a[16],r[107]=a[17],a):(o=l.item,t.sequence([function(e){return r[114]=o.backupTenancy,r[113]=o.encryptionVersion,r[109]=void 0,t.i64.neq(r[109],void 0)?t.resolve(r[110]=r[109]):t.sequence([function(e){return r[115]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[116]=t[0],t})},function(e){return r[116]&&(r[125]=(r[115].push(t.i64.cast([0,0])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[117]=t[0],t})},function(e){return r[117]&&(r[125]=(r[115].push(t.i64.cast([0,2])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[118]=t[0],t})},function(e){return r[118]&&(r[125]=(r[115].push(t.i64.cast([0,3])),r[115])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[119]=t[0],t})},function(e){return r[119]&&(r[125]=(r[115].push(t.i64.cast([0,4])),r[115])),r[120]=t.createArray(),r[121]=t.i64.of_int32(r[115].length),t.i64.gt(r[121],t.i64.cast([0,0]))?t.loopAsync(r[121],function(e){return r[125]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[115],r[125]).then(function(e){var t;return t=e,r[126]=t[0],r[127]=t[1],t})},function(e){return r[128]=(r[120].push(r[126]),r[120])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[125]=t.createArray(),r[126]=t.i64.of_int32(r[120].length),t.i64.gt(r[126],t.i64.cast([0,0]))?t.loopAsync(r[126],function(e){return r[128]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[120],r[128]).then(function(e){var t;return t=e,r[129]=t[0],r[130]=t[1],t})},function(e){return r[131]=(r[125].push(t.i64.to_string(r[129])),r[125])}])}):t.resolve()},function(e){return r[127]=r[125].join(","),r[122]=r[127]}])},function(e){return r[120].some(function(e){return t.i64.eq(r[113],e)})?r[123]=r[113]:r[123]=void 0,t.i64.neq(r[123],void 0)?r[124]=r[123]:r[124]=void 0,r[110]=r[124]}])},function(e){var n;return t.i64.neq(r[110],void 0)?r[111]=r[110]:r[111]=t.i64.cast([0,0]),t.i64.neq(r[114],void 0)?r[112]=r[114]:r[112]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[111],r[112],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[90]=n[0],r[91]=n[1],r[92]=n[2],r[93]=n[3],r[94]=n[4],r[95]=n[5],r[96]=n[6],r[97]=n[7],r[98]=n[8],r[99]=n[9],r[100]=n[10],r[101]=n[11],r[102]=n[12],r[103]=n[13],r[104]=n[14],r[105]=n[15],r[106]=n[16],r[107]=n[17]}]))})},function(e){var t;return t=[r[90],r[91],r[92],r[93],r[94],r[95],r[96],r[97],r[98],r[99],r[100],r[101],r[102],r[103],r[104],r[105],r[106],r[107]],r[52]=t[0],r[53]=t[1],r[54]=t[2],r[55]=t[3],r[56]=t[4],r[57]=t[5],r[58]=t[6],r[59]=t[7],r[60]=t[8],r[61]=t[9],r[62]=t[10],r[63]=t[11],r[64]=t[12],r[65]=t[13],r[66]=t[14],r[67]=t[15],r[68]=t[16],r[69]=t[17],t}])},function(e){var t;return t=[r[52],r[53],r[54],r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}]):t.sequence([function(e){return r[33]=r[5].get("errors"),r[34]=r[5].get("errors"),t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})},function(e){return r[35]=t.i64.random(),r[36]=t.i64.random(),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[37]=t[0],r[38]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[39]=t[0],r[40]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[41]=t[0],r[42]=t[1],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientInit_v2.nop")).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSRandom.nop"),t.i64.cast([0,32])).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return r[47]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]&&(r[74]=(r[47].push(t.i64.cast([0,0])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]&&(r[74]=(r[47].push(t.i64.cast([0,2])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[50]=t[0],t})},function(e){return r[50]&&(r[74]=(r[47].push(t.i64.cast([0,3])),r[47])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]&&(r[74]=(r[47].push(t.i64.cast([0,4])),r[47])),r[52]=t.i64.of_int32(r[47].length),t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[47],t.i64.sub(r[52],t.i64.cast([0,1]))).then(function(e){var t;return t=e,r[53]=t[0],r[54]=t[1],t})},function(e){return t.forEach(t.filter(t.db.table(168).fetch([[[r[35]]]]),function(e){return t.i64.eq(e.backupId,r[35])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[35],deviceId:r[36],devicePublicKeyBlob:r[38],devicePrivateKeyBlob:r[37],epochStoragePublicKeyBlob:r[40],epochStoragePrivateKeyBlob:r[39],epochAuthPublicKeyBlob:r[42],epochAuthPrivateKeyBlob:r[41],mailboxRootKeyBlob:r[43],ocmfClientStateBlob:r[44],obliviousValidationTokenBlob:r[46],authorityLevel:t.i64.cast([0,20]),encryptionVersion:r[53],revisionVersion:t.i64.cast([0,1]),backupTenancy:t.i64.cast([0,1])})},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,o){var a,i=e.done,l=e.value;return i?(a=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.i64.cast([0,20]),void 0,void 0],r[55]=a[0],r[56]=a[1],r[57]=a[2],r[58]=a[3],r[59]=a[4],r[60]=a[5],r[61]=a[6],r[62]=a[7],r[63]=a[8],r[64]=a[9],r[65]=a[10],r[66]=a[11],r[67]=a[12],r[68]=a[13],r[69]=a[14],r[70]=a[15],r[71]=a[16],r[72]=a[17],a):(o=l.item,t.sequence([function(e){return r[79]=o.backupTenancy,r[78]=o.encryptionVersion,r[74]=void 0,t.i64.neq(r[74],void 0)?t.resolve(r[75]=r[74]):t.sequence([function(e){return r[80]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[81]&&(r[90]=(r[80].push(t.i64.cast([0,0])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]&&(r[90]=(r[80].push(t.i64.cast([0,2])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]&&(r[90]=(r[80].push(t.i64.cast([0,3])),r[80])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[84]=t[0],t})},function(e){return r[84]&&(r[90]=(r[80].push(t.i64.cast([0,4])),r[80])),r[85]=t.createArray(),r[86]=t.i64.of_int32(r[80].length),t.i64.gt(r[86],t.i64.cast([0,0]))?t.loopAsync(r[86],function(e){return r[90]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[80],r[90]).then(function(e){var t;return t=e,r[91]=t[0],r[92]=t[1],t})},function(e){return r[93]=(r[85].push(r[91]),r[85])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[90]=t.createArray(),r[91]=t.i64.of_int32(r[85].length),t.i64.gt(r[91],t.i64.cast([0,0]))?t.loopAsync(r[91],function(e){return r[93]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[85],r[93]).then(function(e){var t;return t=e,r[94]=t[0],r[95]=t[1],t})},function(e){return r[96]=(r[90].push(t.i64.to_string(r[94])),r[90])}])}):t.resolve()},function(e){return r[92]=r[90].join(","),r[87]=r[92]}])},function(e){return r[85].some(function(e){return t.i64.eq(r[78],e)})?r[88]=r[78]:r[88]=void 0,t.i64.neq(r[88],void 0)?r[89]=r[88]:r[89]=void 0,r[75]=r[89]}])},function(e){var n;return t.i64.neq(r[75],void 0)?r[76]=r[75]:r[76]=t.i64.cast([0,0]),t.i64.neq(r[79],void 0)?r[77]=r[79]:r[77]=t.i64.cast([0,1]),n=[o.backupId,o.deviceId,o.mailboxRootKeyBlob,o.ocmfClientStateBlob,void 0,void 0,r[76],r[77],o.epochAuthPublicKeyBlob,o.epochAuthPrivateKeyBlob,o.devicePublicKeyBlob,o.devicePrivateKeyBlob,o.epochStoragePublicKeyBlob,o.epochStoragePrivateKeyBlob,o.obliviousValidationTokenBlob,o.authorityLevel,void 0,void 0],r[55]=n[0],r[56]=n[1],r[57]=n[2],r[58]=n[3],r[59]=n[4],r[60]=n[5],r[61]=n[6],r[62]=n[7],r[63]=n[8],r[64]=n[9],r[65]=n[10],r[66]=n[11],r[67]=n[12],r[68]=n[13],r[69]=n[14],r[70]=n[15],r[71]=n[16],r[72]=n[17]}]))})},function(e){var t;return t=[r[55],r[56],r[57],r[58],r[59],r[60],r[61],r[62],r[63],r[64],r[65],r[66],r[67],r[68],r[69],r[70],r[71],r[72]],r[7]=t[0],r[8]=t[1],r[9]=t[2],r[10]=t[3],r[11]=t[4],r[12]=t[5],r[13]=t[6],r[14]=t[7],r[15]=t[8],r[16]=t[9],r[17]=t[10],r[18]=t[11],r[19]=t[12],r[20]=t[13],r[21]=t[14],r[22]=t[15],r[23]=t[16],r[24]=t[17],t}])},function(o){var a;return t.i64.neq(r[7],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[18],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[17],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[19],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[15],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[10],void 0)?t.sequence([function(o){var a;return t.blobs.neq(r[9],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MA=="),r[19]).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[18],t.blob("MQ=="),r[15]).then(function(e){var t;return t=e,r[46]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(r[7])).then(function(e){var t;return t=e,r[47]=t[0],t})},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),t.blob("bWFpbGJveF9pZF9zY29wZQ=="),r[47]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return t.nativeOperation(n("LSOcmfClientMap.nop"),r[10],r[48]).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[49]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(n){var o;return r[51]=new t.Map,r[51].set("optimistic_backup_id",r[7]),r[51].set("device_private_key",r[18]),r[51].set("device_public_key",r[17]),r[51].set("epoch_storage_public_key",r[19]),r[51].set("epoch_storage_public_key_sig",r[45]==null?t.blob("bnVsbA=="):r[45]),r[51].set("epoch_auth_public_key",r[15]),r[51].set("epoch_auth_public_key_sig",r[46]==null?t.blob("bnVsbA=="):r[46]),r[51].set("ocmf_client_state",r[10]),r[51].set("mailbox_partial_id",r[50]==null?"":r[50]),r[51].set("mailbox_root_key",r[9]),r[51].set("device_registration_id",e[0]),r[51].set("orf_client_state_v2",void 0),o=[r[51],void 0],r[43]=o[0],r[44]=o[1]}]):t.resolve((r[45]=new t.Map,r[45].set("error_code",t.i64.cast([0,9])),r[45].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[45].set("error_message",""),a=[void 0,r[45]],r[43]=a[0],r[44]=a[1]))},function(e){var t;return t=[r[43],r[44]],r[41]=t[0],r[42]=t[1],t}]):t.resolve((r[43]=new t.Map,r[43].set("error_code",t.i64.cast([0,9])),r[43].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[43].set("error_message",""),a=[void 0,r[43]],r[41]=a[0],r[42]=a[1]))},function(e){var t;return t=[r[41],r[42]],r[39]=t[0],r[40]=t[1],t}]):t.resolve((r[41]=new t.Map,r[41].set("error_code",t.i64.cast([0,9])),r[41].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[41].set("error_message",""),a=[void 0,r[41]],r[39]=a[0],r[40]=a[1]))},function(e){var t;return t=[r[39],r[40]],r[37]=t[0],r[38]=t[1],t}]):t.resolve((r[39]=new t.Map,r[39].set("error_code",t.i64.cast([0,9])),r[39].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[39].set("error_message",""),a=[void 0,r[39]],r[37]=a[0],r[38]=a[1]))},function(e){var t;return t=[r[37],r[38]],r[35]=t[0],r[36]=t[1],t}]):t.resolve((r[37]=new t.Map,r[37].set("error_code",t.i64.cast([0,9])),r[37].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[37].set("error_message",""),a=[void 0,r[37]],r[35]=a[0],r[36]=a[1]))},function(e){var t;return t=[r[35],r[36]],r[33]=t[0],r[34]=t[1],t}]):t.resolve((r[35]=new t.Map,r[35].set("error_code",t.i64.cast([0,9])),r[35].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[35].set("error_message",""),a=[void 0,r[35]],r[33]=a[0],r[34]=a[1]))},function(e){var t;return t=[r[33],r[34]],r[25]=t[0],r[26]=t[1],t}]):t.resolve((r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),a=[void 0,r[33]],r[25]=a[0],r[26]=a[1]))},function(e){return r[27]=t.i64.of_float(Date.now()),r[28]=t.i64.random(),r[30]="Finishing execution. Execution time: ",r[31]=t.i64.to_string(t.i64.sub(r[27],r[0])),r[32]=" ms",r[29]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialDeviceSetupPayload] ",r[29],r[30],r[29],r[31],r[29],r[32]].join("")),t.i64.eq(t.i64.mod_(r[28],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[33]=",",r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialDeviceSetupPayload",[r[30],r[33],r[31],r[33],r[32]].join(""),r[34],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[25],r[26]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSGenerateInitialEpochSetupPayload",["LSCreateMinosEpochParams.nop","LSCreateSymmetricEncryptionSecretKey.nop","LSGetNextEpochAnonId.nop","LSLogMebClientEvent.nop","LSStoreEpoch","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialEpochSetupPayload] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.epochStatus,t.i64.cast([0,1]))&&t.i64.eq(e.authorityLevel,t.i64.cast([0,20]))}).next().then(function(a,i){var l,s=a.done,u=a.value;return s?t.sequence([function(e){return(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Generating new initial epoch."),t.nativeOperation(n("LSGetNextEpochAnonId.nop"),void 0).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSymmetricEncryptionSecretKey.nop")).then(function(e){var t;return t=e,o[17]=t[0],t})},function(e){return r("gkx")("11690")&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[17],o[16],void 0,void 0,void 0).then(function(e){var t;return t=e,o[20]=t[0],o[21]=t[1],o[22]=t[2],o[23]=t[3],o[24]=t[4],o[25]=t[5],t})},function(e){return o[18]=o[23]}]):t.resolve(o[18]=void 0)},function(r){return o[19]=t.i64.random(),t.storedProcedure(n("LSStoreEpoch"),o[19],e[0],o[16],o[17],t.i64.cast([0,1]),t.i64.cast([0,20]),!1,o[18])},function(e){var t;return t=[o[19],o[16],o[17],void 0,void 0,o[18]],o[2]=t[0],o[3]=t[1],o[4]=t[2],o[5]=t[3],o[6]=t[4],o[7]=t[5],t}]):(i=u.item,(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Using local optimistic initial epoch."),l=[i.epochId,i.epochAnonIdBlob,i.epochRootKeyBlob,void 0,void 0,i.epochHead],o[2]=l[0],o[3]=l[1],o[4]=l[2],o[5]=l[3],o[6]=l[4],o[7]=l[5])})},function(e){return o[9]=new t.Map,o[9].set("optimistic_epoch_id",o[2]),o[9].set("epoch_anon_id",o[3]),o[9].set("epoch_root_key",o[4]),o[10]=t.i64.of_float(Date.now()),o[11]=t.i64.random(),o[13]="Finishing execution. Execution time: ",o[14]=t.i64.to_string(t.i64.sub(o[10],o[0])),o[15]=" ms",o[12]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialEpochSetupPayload] ",o[12],o[13],o[12],o[14],o[12],o[15]].join("")),t.i64.eq(t.i64.mod_(o[11],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[16]=",",o[17]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialEpochSetupPayload",[o[13],o[16],o[14],o[16],o[15]].join(""),o[17],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[o[9],void 0],a[0]=t[0],a[1]=t[1],t}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSGenerateInitialVirtualDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[1]!==void 0?t.sequence([function(o){return r[10]=e[1].get("recovery_code"),r[11]=e[1].get("virtual_device_type"),r[12]=e[1].get("cloud_service_account"),r[13]=e[1].get("hsm_pin_normalization_status"),r[14]=e[1].get("security_question_type"),r[15]=e[1].get("trusted_contact_id"),r[16]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),r[10],t.i64.to_string(r[17]),r[16]).then(function(e){var t;return t=e,r[18]=t[0],r[19]=t[1],t})},function(o){return t.blobs.neq(r[19],void 0)?t.sequence([function(o){return t.blobs.neq(r[18],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[24]=t[0],t})},function(o){return r[24]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[34]=new t.Map,r[34].set("error_msg","Expected a nonempty query result"),r[34].set("code",t.i64.cast([0,3])),r[34].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[35]=t.createArray(),r[36]=(r[35].push(r[34]),r[35]),o=[void 0,r[35]],r[27]=o[0],r[28]=o[1]):(n=l.item,r[34]=new t.Map,r[34].set("backup_id",n.backupId),r[34].set("device_public_key_blob",n.devicePublicKeyBlob),r[34].set("device_private_key_blob",n.devicePrivateKeyBlob),r[34].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[34].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[34].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[34].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[34].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[34].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[34].set("orf_client_state_v2_blob",void 0),r[34].set("orf_v2_authority_level",void 0),r[34].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[34].set("device_id",n.deviceId),r[34].set("backup_tenancy",n.backupTenancy),r[34].set("encryption_version",n.encryptionVersion),r[34].set("revision_version",n.revisionVersion),r[34].set("initialize_restore_result",void 0),r[34].set("device_creation_timestamp_sec",void 0),r[34].set("authority_level",n.authorityLevel),a=[r[34],void 0],r[27]=a[0],r[28]=a[1])})},function(e){var o;return r[30]=new t.Map,r[30].set("value",r[27]),r[30].set("errors",r[28]),r[31]=r[30].get("value"),r[31]!==void 0?t.sequence([function(e){var o;return r[34]=r[31].get("backup_id"),r[35]=r[31].get("device_public_key_blob"),r[36]=r[31].get("device_private_key_blob"),r[37]=r[31].get("epoch_storage_public_key_blob"),r[38]=r[31].get("epoch_storage_private_key_blob"),r[39]=r[31].get("epoch_auth_public_key_blob"),r[40]=r[31].get("epoch_auth_private_key_blob"),r[41]=r[31].get("mailbox_root_key_blob"),r[42]=r[31].get("ocmf_client_state_blob"),r[43]=r[31].get("orf_client_state_v2_blob"),r[44]=r[31].get("orf_v2_authority_level"),r[45]=r[31].get("oblivious_validation_token_blob"),r[46]=r[31].get("device_id"),r[47]=r[31].get("backup_tenancy"),r[48]=r[31].get("encryption_version"),r[49]=r[31].get("revision_version"),r[50]=r[31].get("initialize_restore_result"),r[51]=r[31].get("device_creation_timestamp_sec"),r[52]=r[31].get("authority_level"),t.i64.neq(r[46],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[107]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[117]=(r[107].push(t.i64.cast([0,0])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[109]&&(r[117]=(r[107].push(t.i64.cast([0,2])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[110]=t[0],t})},function(e){return r[110]&&(r[117]=(r[107].push(t.i64.cast([0,3])),r[107])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[111]=t[0],t})},function(e){return r[111]&&(r[117]=(r[107].push(t.i64.cast([0,4])),r[107])),r[112]=t.createArray(),r[113]=t.i64.of_int32(r[107].length),t.i64.gt(r[113],t.i64.cast([0,0]))?t.loopAsync(r[113],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[112].push(r[118]),r[112])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[117]=t.createArray(),r[118]=t.i64.of_int32(r[112].length),t.i64.gt(r[118],t.i64.cast([0,0]))?t.loopAsync(r[118],function(e){return r[120]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[112],r[120]).then(function(e){var t;return t=e,r[121]=t[0],r[122]=t[1],t})},function(e){return r[123]=(r[117].push(t.i64.to_string(r[121])),r[117])}])}):t.resolve()},function(e){return r[119]=r[117].join(","),r[114]=r[119]}])},function(e){return r[112].some(function(e){return t.i64.eq(r[48],e)})?r[115]=r[48]:r[115]=void 0,t.i64.neq(r[115],void 0)?r[116]=r[115]:r[116]=void 0,r[56]=r[116]}])},function(e){return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[47],void 0)?r[58]=r[47]:r[58]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[59]=t[0],r[60]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[61]=t[0],r[62]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[59],t.blob("MA=="),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[64]=r[24].get("epoch_anon_id"),r[65]=r[24].get("epoch_root_key"),r[66]=t.createArray(),r[107]=(r[66].push(t.i64.cast([0,32])),r[66]),t.nativeOperation(n("LSBase64Encode.nop"),r[64]).then(function(e){var t;return t=e,r[67]=t[0],t})},function(e){return r[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[67]].join("")),void 0,r[65],r[66]).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]?r[108]=!1:r[108]=!0,r[108]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[111]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[111]].join("")),r[110]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[111],r[110],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[112]=t[0],t})},function(e){return r[109]=r[112]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[107],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[110]=t[0],r[111]=t[1],t})},function(e){return r[109]=r[110]}])},function(e){return r[68]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[68]=r[109]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[68],r[60]).then(function(e){var t;return t=e,r[69]=t[0],t})},function(e){return t.blobs.neq(r[69],void 0)?t.resolve(r[70]=r[69]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[108]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[70]=r[109]}])},function(e){return r[71]=r[24].get("epoch_root_key"),r[72]=t.createArray(),r[107]=(r[72].push(t.i64.cast([0,18])),r[72]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[71],r[72]).then(function(e){var t;return t=e,r[73]=t[0],t})},function(e){return r[73]!==void 0?t.sequence([function(e){return r[107]=t.i64.of_int32(r[73].length),t.i64.ge(r[107],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[73],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[109]=t[0],r[110]=t[1],t})},function(e){return r[108]=r[109]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[110]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[110]].join("")),r[109]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[110],r[109],t.i64.cast([0,3]))},function(e){return r[108]=void 0}])},function(e){return r[74]=r[108]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[108]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[108],r[107],t.i64.cast([0,3]))},function(e){return r[74]=void 0}])},function(e){return t.blobs.neq(r[74],void 0)?r[75]=!0:r[75]=!1,r[75]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[42]).then(function(e){var t;return t=e,r[76]=t[0],r[77]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){var t;return t=[r[76],r[77],r[107],r[108]],r[78]=t[0],r[79]=t[1],r[80]=t[2],r[81]=t[3],t}]):t.resolve((o=[r[76],r[77],void 0,void 0],r[78]=o[0],r[79]=o[1],r[80]=o[2],r[81]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[59]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[108]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[108]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[78]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[108]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[45]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[108]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[41]).then(function(e){var t;return t=e,r[94]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[94]==null?"":r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return r[95]!==void 0?r[96]=r[95]:r[96]="",r[96]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[108]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[97]=r[24].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[97]).then(function(e){var t;return t=e,r[98]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[98]==null?"":r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return r[99]!==void 0?r[100]=r[99]:r[100]="",r[100]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[108]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){return r[101]=r[24].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[101]).then(function(e){var t;return t=e,r[102]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[19],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[102]==null?"":r[102]).then(function(e){var t;return t=e,r[103]=t[0],t})},function(e){return r[103]!==void 0?r[104]=r[103]:r[104]="",r[104]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[108]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[108],r[107],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[105]=new t.Map,r[105].set("encrypted_device_private_key",r[84]),r[105].set("encrypted_epoch_storage_private_key",r[87]),r[105].set("encrypted_ocmf_client_state",r[90]),r[105].set("encrypted_orf_client_state_v2",void 0),r[105].set("encrypted_oblivious_validation_token_blob",r[93]),r[105].set("encrypted_mailbox_root_key_blob",r[96]),r[105].set("encrypted_epoch_anon_id",r[100]),r[105].set("encrypted_epoch_root_key",r[104]),r[106]=new t.Map,r[106].set("virtual_device_public_key",r[60]),r[106].set("virtual_device_id",r[18]),r[106].set("virtual_device_epoch_storage_public_key",r[62]),r[106].set("virtual_device_epoch_storage_public_key_sig",r[63]==null?t.blob("bnVsbA=="):r[63]),r[106].set("device_epoch_hmac",r[70]),r[106].set("epoch_root_key_fingerprint",r[74]),r[106].set("virtual_device_type",r[11]),r[106].set("action_type",t.i64.cast([0,1])),r[106].set("ocmf_rotation_token",r[79]),r[106].set("encrypted_secret_values_payload",r[105]),r[106].set("cloud_service_account",r[12]),r[106].set("hsm_pin_normalization_status",r[13]),r[106].set("security_question_type",r[14]),r[106].set("trusted_contact_id",r[15]),n=[r[106],void 0],r[53]=n[0],r[54]=n[1]}]):t.resolve((r[55]=new t.Map,r[55].set("error_code",t.i64.cast([0,9])),r[55].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[55].set("error_message",""),o=[void 0,r[55]],r[53]=o[0],r[54]=o[1]))},function(e){var t;return t=[r[53],r[54]],r[32]=t[0],r[33]=t[1],t}]):t.resolve((r[34]=r[30].get("errors"),r[35]=r[30].get("errors"),r[36]=new t.Map,r[36].set("error_code",t.i64.cast([0,9])),r[36].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[36].set("error_message",""),o=[void 0,r[36]],r[32]=o[0],r[33]=o[1]))},function(e){var t;return t=[r[32],r[33]],r[25]=t[0],r[26]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[28]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[28]].join("")),r[27]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[28],r[27],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[29]=new t.Map,r[29].set("error_code",t.i64.cast([0,11])),r[29].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[29].set("error_message",""),n=[void 0,r[29]],r[25]=n[0],r[26]=n[1]}])},function(e){var t;return t=[r[25],r[26]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[25]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,10])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[20]=t[0],r[21]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[23]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[23]].join("")),r[22]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[23],r[22],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[24]=new t.Map,r[24].set("error_code",t.i64.cast([0,10])),r[24].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[24].set("error_message",""),n=[void 0,r[24]],r[20]=n[0],r[21]=n[1]}])},function(e){var t;return t=[r[20],r[21]],r[2]=t[0],r[3]=t[1],t}]):t.sequence([function(o){return t.db.table(174).fetch([[[t.i64.cast([0,1])]]]).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] No recovery code found in recovery code table"),r[14]="No recovery code found in recovery code table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[14]].join("")),r[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[14],r[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[15]=new t.Map,r[15].set("error_code",t.i64.cast([0,501])),r[15].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[15].set("error_message",""),n=[void 0,r[15]],r[10]=n[0],r[11]=n[1]}]):(a=l.item,t.sequence([function(e){return r[13]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,r[14]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),a.recoveryCode,t.i64.to_string(r[14]),r[13]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(o){return t.blobs.neq(r[16],void 0)?t.sequence([function(o){return t.blobs.neq(r[15],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!0).then(function(e){var t;return t=e,r[21]=t[0],t})},function(o){return r[21]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[31]=new t.Map,r[31].set("error_msg","Expected a nonempty query result"),r[31].set("code",t.i64.cast([0,3])),r[31].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[32]=t.createArray(),r[33]=(r[32].push(r[31]),r[32]),o=[void 0,r[32]],r[24]=o[0],r[25]=o[1]):(n=l.item,r[31]=new t.Map,r[31].set("backup_id",n.backupId),r[31].set("device_public_key_blob",n.devicePublicKeyBlob),r[31].set("device_private_key_blob",n.devicePrivateKeyBlob),r[31].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[31].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[31].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[31].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[31].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[31].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[31].set("orf_client_state_v2_blob",void 0),r[31].set("orf_v2_authority_level",void 0),r[31].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[31].set("device_id",n.deviceId),r[31].set("backup_tenancy",n.backupTenancy),r[31].set("encryption_version",n.encryptionVersion),r[31].set("revision_version",n.revisionVersion),r[31].set("initialize_restore_result",void 0),r[31].set("device_creation_timestamp_sec",void 0),r[31].set("authority_level",n.authorityLevel),a=[r[31],void 0],r[24]=a[0],r[25]=a[1])})},function(e){var o;return r[27]=new t.Map,r[27].set("value",r[24]),r[27].set("errors",r[25]),r[28]=r[27].get("value"),r[28]!==void 0?t.sequence([function(e){var o;return r[31]=r[28].get("backup_id"),r[32]=r[28].get("device_public_key_blob"),r[33]=r[28].get("device_private_key_blob"),r[34]=r[28].get("epoch_storage_public_key_blob"),r[35]=r[28].get("epoch_storage_private_key_blob"),r[36]=r[28].get("epoch_auth_public_key_blob"),r[37]=r[28].get("epoch_auth_private_key_blob"),r[38]=r[28].get("mailbox_root_key_blob"),r[39]=r[28].get("ocmf_client_state_blob"),r[40]=r[28].get("orf_client_state_v2_blob"),r[41]=r[28].get("orf_v2_authority_level"),r[42]=r[28].get("oblivious_validation_token_blob"),r[43]=r[28].get("device_id"),r[44]=r[28].get("backup_tenancy"),r[45]=r[28].get("encryption_version"),r[46]=r[28].get("revision_version"),r[47]=r[28].get("initialize_restore_result"),r[48]=r[28].get("device_creation_timestamp_sec"),r[49]=r[28].get("authority_level"),t.i64.neq(r[43],void 0)?t.sequence([function(e){return r[52]=void 0,t.i64.neq(r[52],void 0)?t.resolve(r[53]=r[52]):t.sequence([function(e){return r[104]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[105]=t[0],t})},function(e){return r[105]&&(r[114]=(r[104].push(t.i64.cast([0,0])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[106]&&(r[114]=(r[104].push(t.i64.cast([0,2])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[107]=t[0],t})},function(e){return r[107]&&(r[114]=(r[104].push(t.i64.cast([0,3])),r[104])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[108]=t[0],t})},function(e){return r[108]&&(r[114]=(r[104].push(t.i64.cast([0,4])),r[104])),r[109]=t.createArray(),r[110]=t.i64.of_int32(r[104].length),t.i64.gt(r[110],t.i64.cast([0,0]))?t.loopAsync(r[110],function(e){return r[114]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],r[114]).then(function(e){var t;return t=e,r[115]=t[0],r[116]=t[1],t})},function(e){return r[117]=(r[109].push(r[115]),r[109])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[114]=t.createArray(),r[115]=t.i64.of_int32(r[109].length),t.i64.gt(r[115],t.i64.cast([0,0]))?t.loopAsync(r[115],function(e){return r[117]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[109],r[117]).then(function(e){var t;return t=e,r[118]=t[0],r[119]=t[1],t})},function(e){return r[120]=(r[114].push(t.i64.to_string(r[118])),r[114])}])}):t.resolve()},function(e){return r[116]=r[114].join(","),r[111]=r[116]}])},function(e){return r[109].some(function(e){return t.i64.eq(r[45],e)})?r[112]=r[45]:r[112]=void 0,t.i64.neq(r[112],void 0)?r[113]=r[112]:r[113]=void 0,r[53]=r[113]}])},function(e){return t.i64.neq(r[53],void 0)?r[54]=r[53]:r[54]=t.i64.cast([0,0]),t.i64.neq(r[44],void 0)?r[55]=r[44]:r[55]=t.i64.cast([0,1]),t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[56]=t[0],r[57]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[58]=t[0],r[59]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[56],t.blob("MA=="),r[59]).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[61]=r[21].get("epoch_anon_id"),r[62]=r[21].get("epoch_root_key"),r[63]=t.createArray(),r[104]=(r[63].push(t.i64.cast([0,32])),r[63]),t.nativeOperation(n("LSBase64Encode.nop"),r[61]).then(function(e){var t;return t=e,r[64]=t[0],t})},function(e){return r[64]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[64]].join("")),void 0,r[62],r[63]).then(function(e){var t;return t=e,r[104]=t[0],t})},function(e){return r[104]?r[105]=!1:r[105]=!0,r[105]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[108]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[108]].join("")),r[107]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[108],r[107],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[109]=t[0],t})},function(e){return r[106]=r[109]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[104],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[107]=t[0],r[108]=t[1],t})},function(e){return r[106]=r[107]}])},function(e){return r[65]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[105]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[65]=r[106]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[65],r[57]).then(function(e){var t;return t=e,r[66]=t[0],t})},function(e){return t.blobs.neq(r[66],void 0)?t.resolve(r[67]=r[66]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),r[105]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[106]=t[0],t})},function(e){return r[67]=r[106]}])},function(e){return r[68]=r[21].get("epoch_root_key"),r[69]=t.createArray(),r[104]=(r[69].push(t.i64.cast([0,18])),r[69]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[68],r[69]).then(function(e){var t;return t=e,r[70]=t[0],t})},function(e){return r[70]!==void 0?t.sequence([function(e){return r[104]=t.i64.of_int32(r[70].length),t.i64.ge(r[104],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[70],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[106]=t[0],r[107]=t[1],t})},function(e){return r[105]=r[106]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[107]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[107]].join("")),r[106]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[107],r[106],t.i64.cast([0,3]))},function(e){return r[105]=void 0}])},function(e){return r[71]=r[105]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[105]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[105],r[104],t.i64.cast([0,3]))},function(e){return r[71]=void 0}])},function(e){return t.blobs.neq(r[71],void 0)?r[72]=!0:r[72]=!1,r[72]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[39]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[104]=t[0],r[105]=t[1],t})},function(e){var t;return t=[r[73],r[74],r[104],r[105]],r[75]=t[0],r[76]=t[1],r[77]=t[2],r[78]=t[3],t}]):t.resolve((o=[r[73],r[74],void 0,void 0],r[75]=o[0],r[76]=o[1],r[77]=o[2],r[78]=o[3],o))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[79]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),r[79]==null?"":r[79]).then(function(e){var t;return t=e,r[80]=t[0],t})},function(e){return r[80]!==void 0?r[81]=r[80]:r[81]="",r[81]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),r[105]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),r[82]==null?"":r[82]).then(function(e){var t;return t=e,r[83]=t[0],t})},function(e){return r[83]!==void 0?r[84]=r[83]:r[84]="",r[84]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),r[105]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[75]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),r[85]==null?"":r[85]).then(function(e){var t;return t=e,r[86]=t[0],t})},function(e){return r[86]!==void 0?r[87]=r[86]:r[87]="",r[87]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),r[105]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[42]).then(function(e){var t;return t=e,r[88]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),r[88]==null?"":r[88]).then(function(e){var t;return t=e,r[89]=t[0],t})},function(e){return r[89]!==void 0?r[90]=r[89]:r[90]="",r[90]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),r[105]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[38]).then(function(e){var t;return t=e,r[91]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),r[91]==null?"":r[91]).then(function(e){var t;return t=e,r[92]=t[0],t})},function(e){return r[92]!==void 0?r[93]=r[92]:r[93]="",r[93]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),r[105]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[94]=r[21].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[94]).then(function(e){var t;return t=e,r[95]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),r[95]==null?"":r[95]).then(function(e){var t;return t=e,r[96]=t[0],t})},function(e){return r[96]!==void 0?r[97]=r[96]:r[97]="",r[97]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),r[105]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){return r[98]=r[21].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[98]).then(function(e){var t;return t=e,r[99]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),r[16],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),r[99]==null?"":r[99]).then(function(e){var t;return t=e,r[100]=t[0],t})},function(e){return r[100]!==void 0?r[101]=r[100]:r[101]="",r[101]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),r[105]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[105]].join("")),r[104]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[105],r[104],t.i64.cast([0,3]))):t.resolve()},function(e){var n;return r[102]=new t.Map,r[102].set("encrypted_device_private_key",r[81]),r[102].set("encrypted_epoch_storage_private_key",r[84]),r[102].set("encrypted_ocmf_client_state",r[87]),r[102].set("encrypted_orf_client_state_v2",void 0),r[102].set("encrypted_oblivious_validation_token_blob",r[90]),r[102].set("encrypted_mailbox_root_key_blob",r[93]),r[102].set("encrypted_epoch_anon_id",r[97]),r[102].set("encrypted_epoch_root_key",r[101]),r[103]=new t.Map,r[103].set("virtual_device_public_key",r[57]),r[103].set("virtual_device_id",r[15]),r[103].set("virtual_device_epoch_storage_public_key",r[59]),r[103].set("virtual_device_epoch_storage_public_key_sig",r[60]==null?t.blob("bnVsbA=="):r[60]),r[103].set("device_epoch_hmac",r[67]),r[103].set("epoch_root_key_fingerprint",r[71]),r[103].set("virtual_device_type",a.virtualDeviceType),r[103].set("action_type",t.i64.cast([0,1])),r[103].set("ocmf_rotation_token",r[76]),r[103].set("encrypted_secret_values_payload",r[102]),r[103].set("cloud_service_account",a.cloudServiceAccount),r[103].set("hsm_pin_normalization_status",a.hsmPinNormalizationStatus),r[103].set("security_question_type",void 0),r[103].set("trusted_contact_id",void 0),n=[r[103],void 0],r[50]=n[0],r[51]=n[1]}]):t.resolve((r[52]=new t.Map,r[52].set("error_code",t.i64.cast([0,9])),r[52].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[52].set("error_message",""),o=[void 0,r[52]],r[50]=o[0],r[51]=o[1]))},function(e){var t;return t=[r[50],r[51]],r[29]=t[0],r[30]=t[1],t}]):t.resolve((r[31]=r[27].get("errors"),r[32]=r[27].get("errors"),r[33]=new t.Map,r[33].set("error_code",t.i64.cast([0,9])),r[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[33].set("error_message",""),o=[void 0,r[33]],r[29]=o[0],r[30]=o[1]))},function(e){var t;return t=[r[29],r[30]],r[22]=t[0],r[23]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),r[25]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[25]].join("")),r[24]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[25],r[24],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[26]=new t.Map,r[26].set("error_code",t.i64.cast([0,11])),r[26].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[26].set("error_message",""),n=[void 0,r[26]],r[22]=n[0],r[23]=n[1]}])},function(e){var t;return t=[r[22],r[23]],r[19]=t[0],r[20]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[22]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[22]].join("")),r[21]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[22],r[21],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[23]=new t.Map,r[23].set("error_code",t.i64.cast([0,10])),r[23].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[23].set("error_message",""),n=[void 0,r[23]],r[19]=n[0],r[20]=n[1]}])},function(e){var t;return t=[r[19],r[20]],r[17]=t[0],r[18]=t[1],t}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),r[20]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",r[20]].join("")),r[19]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",r[20],r[19],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[0],!0,void 0)},function(e){var n;return r[21]=new t.Map,r[21].set("error_code",t.i64.cast([0,10])),r[21].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),r[21].set("error_message",""),n=[void 0,r[21]],r[17]=n[0],r[18]=n[1]}])},function(e){var t;return t=[r[17],r[18]],r[10]=t[0],r[11]=t[1],t}]))})},function(e){var t;return t=[r[10],r[11]],r[2]=t[0],r[3]=t[1],t}])},function(e){return r[4]=t.i64.of_float(Date.now()),r[5]=t.i64.random(),r[7]="Finishing execution. Execution time: ",r[8]=t.i64.to_string(t.i64.sub(r[4],r[0])),r[9]=" ms",r[6]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] ",r[6],r[7],r[6],r[8],r[6],r[9]].join("")),t.i64.eq(t.i64.mod_(r[5],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[10]=",",r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateInitialVirtualDeviceSetupPayload",[r[7],r[10],r[8],r[10],r[9]].join(""),r[11],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[2],r[3]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_generated_recovery_code"],a.exports=e}),null);
__d("LSInitializeBackupV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateMinosEpochParams.nop","LSCreateSignature_v2.nop","LSGenerateInitialDeviceSetupPayload","LSGenerateInitialEpochSetupPayload","LSGenerateInitialVirtualDeviceSetupPayload","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","gkx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(r){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][initializeBackupV2] Beginning execution."),o[1]=t.i64.of_float(Date.now()),t.storedProcedure(n("LSGenerateInitialDeviceSetupPayload"),e[0]).then(function(e){var t;return t=e,o[2]=t[0],o[3]=t[1],t})},function(r){var a,i,l;return o[2]!==void 0?t.sequence([function(e){return o[15]=o[2].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[16]=t[0],t})},function(e){return o[17]=o[2].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[17]).then(function(e){var t;return t=e,o[18]=t[0],t})},function(e){return o[19]=o[2].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[21]=o[2].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[21]).then(function(e){var t;return t=e,o[22]=t[0],t})},function(e){return o[23]=o[2].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[24]=t[0],t})},function(e){return o[25]=o[2].get("ocmf_client_state"),t.nativeOperation(n("LSBase64Encode.nop"),o[25]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[27]=o[2].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[27]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return o[29]=o[2].get("device_private_key"),o[30]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[31]&&(o[44]=(o[30].push(t.i64.cast([0,0])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[32]=t[0],t})},function(e){return o[32]&&(o[44]=(o[30].push(t.i64.cast([0,2])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[33]&&(o[44]=(o[30].push(t.i64.cast([0,3])),o[30])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[34]=t[0],t})},function(e){return o[34]&&(o[44]=(o[30].push(t.i64.cast([0,4])),o[30])),o[35]="",o[36]=t.i64.of_int32(o[30].length),t.i64.gt(o[36],t.i64.cast([0,0]))?t.loopAsync(o[36],function(e){return o[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[30],o[44]).then(function(e){var t;return t=e,o[45]=t[0],o[46]=t[1],t})},function(e){return o[35]=[o[35],"_",t.i64.to_string(o[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",o[35],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[29],t.blob("Mg=="),o[37]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.blobs.neq(o[38],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return o[39]=o[44]}]):t.resolve(o[39]=void 0)},function(n){var r;return o[40]=o[2].get("optimistic_backup_id"),o[41]=o[2].get("mailbox_partial_id"),o[42]=new t.Map,o[42].set("supported_encryption_versions",o[30]),o[42].set("client_version",t.i64.cast([0,1])),o[42].set("version_sig",o[39]==null?"":o[39]),o[43]=new t.Map,o[43].set("device_public_key",o[16]==null?"":o[16]),o[43].set("epoch_storage_public_key",o[18]==null?"":o[18]),o[43].set("epoch_storage_public_key_sig",o[20]==null?"":o[20]),o[43].set("epoch_auth_public_key",o[22]==null?"":o[22]),o[43].set("epoch_auth_public_key_sig",o[24]==null?"":o[24]),o[43].set("device_registration_id",e[0]),o[43].set("ocmf_client_state",o[26]==null?"":o[26]),o[43].set("mailbox_partial_id",o[41]),o[43].set("mailbox_root_key",o[28]==null?"":o[28]),o[43].set("encryption_version_data",o[42]),r=[o[43],o[40],!0,t.i64.cast([0,0])],o[4]=r[0],o[5]=r[1],o[6]=r[2],o[7]=r[3]}]):t.resolve((o[3]!==void 0?(o[19]=o[3].get("error_code"),a=[void 0,t.i64.cast([-1,4294967295]),!1,o[19]],o[15]=a[0],o[16]=a[1],o[17]=a[2],o[18]=a[3]):(i=[void 0,t.i64.cast([-1,4294967295]),!1,t.i64.cast([0,12])],o[15]=i[0],o[16]=i[1],o[17]=i[2],o[18]=i[3]),l=[o[15],o[16],o[17],o[18]],o[4]=l[0],o[5]=l[1],o[6]=l[2],o[7]=l[3]))},function(a){return o[6]?t.sequence([function(a){return o[4]!==void 0?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var r,a,i=e.done,l=e.value;return i?(o[25]=new t.Map,o[25].set("error_msg","Expected a nonempty query result"),o[25].set("code",t.i64.cast([0,3])),o[25].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),o[26]=t.createArray(),o[27]=(o[26].push(o[25]),o[26]),r=[void 0,o[26]],o[16]=r[0],o[17]=r[1]):(n=l.item,o[25]=new t.Map,o[25].set("backup_id",n.backupId),o[25].set("device_public_key_blob",n.devicePublicKeyBlob),o[25].set("device_private_key_blob",n.devicePrivateKeyBlob),o[25].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),o[25].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),o[25].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),o[25].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),o[25].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),o[25].set("ocmf_client_state_blob",n.ocmfClientStateBlob),o[25].set("orf_client_state_v2_blob",void 0),o[25].set("orf_v2_authority_level",void 0),o[25].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),o[25].set("device_id",n.deviceId),o[25].set("backup_tenancy",n.backupTenancy),o[25].set("encryption_version",n.encryptionVersion),o[25].set("revision_version",n.revisionVersion),o[25].set("initialize_restore_result",void 0),o[25].set("device_creation_timestamp_sec",void 0),o[25].set("authority_level",n.authorityLevel),a=[o[25],void 0],o[16]=a[0],o[17]=a[1])})},function(e){var a;return o[19]=new t.Map,o[19].set("value",o[16]),o[19].set("errors",o[17]),o[20]=o[19].get("value"),o[20]!==void 0?t.sequence([function(e){var a;return o[25]=o[20].get("backup_id"),o[26]=o[20].get("device_public_key_blob"),o[27]=o[20].get("device_private_key_blob"),o[28]=o[20].get("epoch_storage_public_key_blob"),o[29]=o[20].get("epoch_storage_private_key_blob"),o[30]=o[20].get("epoch_auth_public_key_blob"),o[31]=o[20].get("epoch_auth_private_key_blob"),o[32]=o[20].get("mailbox_root_key_blob"),o[33]=o[20].get("ocmf_client_state_blob"),o[34]=o[20].get("orf_client_state_v2_blob"),o[35]=o[20].get("orf_v2_authority_level"),o[36]=o[20].get("oblivious_validation_token_blob"),o[37]=o[20].get("device_id"),o[38]=o[20].get("backup_tenancy"),o[39]=o[20].get("encryption_version"),o[40]=o[20].get("revision_version"),o[41]=o[20].get("initialize_restore_result"),o[42]=o[20].get("device_creation_timestamp_sec"),o[43]=o[20].get("authority_level"),t.i64.neq(o[37],void 0)?t.sequence([function(e){return o[47]=void 0,t.i64.neq(o[47],void 0)?t.resolve(o[48]=o[47]):t.sequence([function(e){return o[58]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]&&(o[68]=(o[58].push(t.i64.cast([0,0])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,o[60]=t[0],t})},function(e){return o[60]&&(o[68]=(o[58].push(t.i64.cast([0,2])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,o[61]=t[0],t})},function(e){return o[61]&&(o[68]=(o[58].push(t.i64.cast([0,3])),o[58])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[62]&&(o[68]=(o[58].push(t.i64.cast([0,4])),o[58])),o[63]=t.createArray(),o[64]=t.i64.of_int32(o[58].length),t.i64.gt(o[64],t.i64.cast([0,0]))?t.loopAsync(o[64],function(e){return o[68]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[58],o[68]).then(function(e){var t;return t=e,o[69]=t[0],o[70]=t[1],t})},function(e){return o[71]=(o[63].push(o[69]),o[63])}])}):t.resolve()},function(e){return t.sequence([function(e){return o[68]=t.createArray(),o[69]=t.i64.of_int32(o[63].length),t.i64.gt(o[69],t.i64.cast([0,0]))?t.loopAsync(o[69],function(e){return o[71]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[63],o[71]).then(function(e){var t;return t=e,o[72]=t[0],o[73]=t[1],t})},function(e){return o[74]=(o[68].push(t.i64.to_string(o[72])),o[68])}])}):t.resolve()},function(e){return o[70]=o[68].join(","),o[65]=o[70]}])},function(e){return o[63].some(function(e){return t.i64.eq(o[39],e)})?o[66]=o[39]:o[66]=void 0,t.i64.neq(o[66],void 0)?o[67]=o[66]:o[67]=void 0,o[48]=o[67]}])},function(e){return t.i64.neq(o[48],void 0)?o[49]=o[48]:o[49]=t.i64.cast([0,0]),t.i64.neq(o[38],void 0)?o[50]=o[38]:o[50]=t.i64.cast([0,1]),o[51]=new t.Map,o[51].set("device_id",o[37]),o[51].set("public_key",o[26]),o[52]=t.createArray(),o[58]=(o[52].push(o[51]),o[52]),t.storedProcedure(n("LSGenerateInitialEpochSetupPayload"),o[25],o[52]).then(function(e){var t;return t=e,o[53]=t[0],o[54]=t[1],t})},function(e){var a,i,l;return o[53]!==void 0?t.sequence([function(e){return o[58]=o[53].get("epoch_anon_id"),o[59]=o[53].get("epoch_root_key"),t.blobs.neq(o[59],void 0)?t.sequence([function(e){return o[76]=t.createArray(),o[82]=(o[76].push(t.i64.cast([0,18])),o[76]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[59],o[76]).then(function(e){var t;return t=e,o[77]=t[0],t})},function(e){return o[77]!==void 0?t.sequence([function(e){return o[82]=t.i64.of_int32(o[77].length),t.i64.ge(o[82],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[77],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[84]=t[0],o[85]=t[1],t})},function(e){return o[83]=o[84]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[85]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[85]].join("")),o[84]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[85],o[84],t.i64.cast([0,3]))},function(e){return o[83]=void 0}])},function(e){return o[78]=o[83]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[83]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[83]].join("")),o[82]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[83],o[82],t.i64.cast([0,3]))},function(e){return o[78]=void 0}])},function(e){return t.blobs.neq(o[78],void 0)?o[79]=!0:o[79]=!1,o[79]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[80]=t[0],t})},function(e){return o[80]!==void 0?o[81]=o[80]:o[81]="encodingfailed",o[60]=o[81]}]):t.resolve(o[60]="null")},function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[52],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[61]=t[0],o[62]=t[1],t})},function(e){return o[63]=o[61].get("public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[63]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[65]=o[61].get("public_key"),o[66]=t.createArray(),o[76]=(o[66].push(t.i64.cast([0,32])),o[66]),t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[67]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[67]].join("")),void 0,o[59],o[66]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return o[76]?o[77]=!1:o[77]=!0,o[77]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[80]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[80]].join("")),o[79]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[80],o[79],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[81]=t[0],t})},function(e){return o[78]=o[81]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[76],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[79]=t[0],o[80]=t[1],t})},function(e){return o[78]=o[79]}])},function(e){return o[68]=o[78]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[77]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[77]].join("")),o[76]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[77],o[76],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[78]=t[0],t})},function(e){return o[68]=o[78]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[68],o[65]).then(function(e){var t;return t=e,o[69]=t[0],t})},function(e){return r("gkx")("11690")&&r("gkx")("16269")?t.sequence([function(e){return t.nativeOperation(n("LSCreateMinosEpochParams.nop"),o[59],o[58],void 0,void 0,void 0).then(function(e){var t;return t=e,o[76]=t[0],o[77]=t[1],o[78]=t[2],o[79]=t[3],o[80]=t[4],o[81]=t[5],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[76]).then(function(e){var t;return t=e,o[82]=t[0],t})},function(e){return o[82]!==void 0?o[83]=o[82]:o[83]="",t.nativeOperation(n("LSBase64Encode.nop"),o[78]).then(function(e){var t;return t=e,o[84]=t[0],t})},function(e){return o[84]!==void 0?o[85]=o[84]:o[85]="",t.nativeOperation(n("LSBase64Encode.nop"),o[77]).then(function(e){var t;return t=e,o[86]=t[0],t})},function(e){return o[86]!==void 0?o[87]=o[86]:o[87]="",t.nativeOperation(n("LSBase64Encode.nop"),o[79]).then(function(e){var t;return t=e,o[88]=t[0],t})},function(e){return o[88]!==void 0?o[89]=o[88]:o[89]="",t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),void 0).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[96]!==void 0?o[97]=o[96]:o[97]="",o[90]=o[97]}]):t.resolve(o[90]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[80]).then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[91]!==void 0?o[92]=o[91]:o[92]="",t.blobs.neq(o[81],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[81]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return o[96]!==void 0?o[97]=o[96]:o[97]="",o[93]=o[97]}]):t.resolve(o[93]=void 0)},function(e){return o[94]=new t.Map,o[94].set("mailbox_encryption_public_key",o[83]),o[94].set("mailbox_auth_public_key",o[85]),o[94].set("mailbox_signing_public_key",o[87]),o[94].set("epoch_head",o[89]),o[94].set("previous_epoch_head",o[90]),o[94].set("self_signature",o[92]),o[94].set("prev_signature",o[93]),o[94]!==void 0?t.resolve(o[95]=o[94]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBEpochUtils] Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair"),o[97]="Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBEpochUtils] ","",o[97]].join("")),o[96]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBEpochUtils",o[97],o[96],t.i64.cast([0,3]))},function(e){return o[95]=void 0}])},function(e){return o[70]=o[95]}]):t.resolve(o[70]=void 0)},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[58]).then(function(e){var t;return t=e,o[71]=t[0],t})},function(e){return o[72]=o[53].get("optimistic_epoch_id"),t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return o[73]=o[76]}]):t.resolve(o[73]=void 0)},function(e){var n;return o[74]=new t.Map,o[74].set("device_pub",o[64]==null?"":o[64]),o[74].set("hmac",o[73]==null?"":o[73]),o[74].set("encrypted_epoch_key",void 0),o[74].set("epoch_root_key_fingerprint",o[60]),o[75]=new t.Map,o[75].set("epoch_data",""),o[75].set("epoch_anon_id",o[71]==null?"":o[71]),o[75].set("minos_epoch_creation_params",o[70]),o[75].set("optimistic_epoch_id",o[72]),o[75].set("membership",o[74]),n=[o[75],!0,t.i64.cast([0,0])],o[55]=n[0],o[56]=n[1],o[57]=n[2]}]):t.resolve((o[54]!==void 0?(o[61]=o[54].get("error_code"),a=[void 0,!1,o[61]],o[58]=a[0],o[59]=a[1],o[60]=a[2]):(i=[void 0,!1,t.i64.cast([0,14])],o[58]=i[0],o[59]=i[1],o[60]=i[2]),l=[o[58],o[59],o[60]],o[55]=l[0],o[56]=l[1],o[57]=l[2]))},function(e){var t;return t=[o[55],o[56],o[57]],o[44]=t[0],o[45]=t[1],o[46]=t[2],t}]):t.resolve((a=[void 0,!1,t.i64.cast([0,9])],o[44]=a[0],o[45]=a[1],o[46]=a[2],a))},function(e){var t;return t=[o[44],o[45],o[46]],o[21]=t[0],o[22]=t[1],o[23]=t[2],t}]):t.resolve((o[25]=o[19].get("errors"),o[26]=o[19].get("errors"),a=[void 0,!1,t.i64.cast([0,9])],o[21]=a[0],o[22]=a[1],o[23]=a[2]))},function(r){return o[22]?t.sequence([function(r){return o[21]!==void 0?t.sequence([function(r){return t.storedProcedure(n("LSGenerateInitialVirtualDeviceSetupPayload"),o[5],e[2]).then(function(e){var t;return t=e,o[26]=t[0],o[27]=t[1],t})},function(e){var r,a,i;return o[26]!==void 0?t.sequence([function(e){return o[32]=o[26].get("virtual_device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[32]).then(function(e){var t;return t=e,o[33]=t[0],t})},function(e){return o[34]=o[26].get("virtual_device_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[35]=t[0],t})},function(e){return o[36]=o[26].get("virtual_device_epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[36]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[38]=o[26].get("virtual_device_epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[40]=o[26].get("device_epoch_hmac"),t.nativeOperation(n("LSBase64Encode.nop"),o[40]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return o[42]=o[26].get("epoch_root_key_fingerprint"),t.blobs.neq(o[42],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[42]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return o[43]=o[54]}]):t.resolve(o[43]=void 0)},function(e){return o[44]=o[26].get("ocmf_rotation_token"),t.nativeOperation(n("LSBase64Encode.nop"),o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){var n;return o[46]=o[26].get("encrypted_secret_values_payload"),o[47]=o[26].get("virtual_device_type"),o[48]=o[26].get("action_type"),o[49]=o[26].get("cloud_service_account"),o[50]=o[26].get("hsm_pin_normalization_status"),o[51]=o[26].get("security_question_type"),o[52]=o[26].get("trusted_contact_id"),o[53]=new t.Map,o[53].set("virtual_device_public_key",o[33]==null?"":o[33]),o[53].set("virtual_device_id",o[35]==null?"":o[35]),o[53].set("virtual_device_epoch_storage_public_key",o[37]==null?"":o[37]),o[53].set("virtual_device_epoch_storage_public_key_sig",o[39]==null?"":o[39]),o[53].set("encrypted_secret_values",o[46]),o[53].set("device_epoch_hmac",o[41]==null?"":o[41]),o[53].set("epoch_root_key_fingerprint",o[43]),o[53].set("ocmf_rotation_token",o[45]==null?"":o[45]),o[53].set("virtual_device_type",o[47]),o[53].set("action_type",o[48]),o[53].set("cloud_service_account",o[49]),o[53].set("hsm_pin_normalization_status",o[50]),o[53].set("security_question_type",o[51]),o[53].set("trusted_contact_id",o[52]),n=[o[53],!0,t.i64.cast([0,0])],o[28]=n[0],o[29]=n[1],o[30]=n[2]}]):t.resolve((o[27]!==void 0?(o[35]=o[27].get("error_code"),r=[void 0,!1,o[35]],o[32]=r[0],o[33]=r[1],o[34]=r[2]):(a=[void 0,!1,t.i64.cast([0,16])],o[32]=a[0],o[33]=a[1],o[34]=a[2]),i=[o[32],o[33],o[34]],o[28]=i[0],o[29]=i[1],o[30]=i[2]))},function(r){return o[29]?t.sequence([function(r){return o[28]!==void 0?t.sequence([function(r){return o[33]=new t.Map,o[33].set("optimistic_backup_id",o[5]),o[33].set("device_payload",o[4]),o[33].set("epoch_payload",o[21]),o[33].set("virtual_device_payload",o[28]),o[38]=t.i64.cast([0,1e3]),o[34]=o[38],o[35]=new t.Map,o[35].set("success",o[33]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,o[34]).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[32]=t.i64.cast([0,0])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null virtual device payload"),o[34]="Null virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[34]].join("")),o[33]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[34],o[33],t.i64.cast([0,3]))},function(r){return o[35]=new t.Map,o[35].set("error_code",o[30]),o[35].set("error_message","Null virtual device payload"),o[35].set("stored_procedure","initializeBackupV2"),o[36]=new t.Map,o[36].set("failure",o[35]),o[36].set("request_id",e[1]),o[37]=t.toJSON(o[36]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[37],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return o[32]=t.i64.cast([0,1])}])},function(e){return o[31]=o[32]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create virtual device payload"),o[33]="Could not create virtual device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[33]].join("")),o[32]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[33],o[32],t.i64.cast([0,3]))},function(r){return o[34]=new t.Map,o[34].set("error_code",o[30]),o[34].set("error_message","Could not create virtual device payload"),o[34].set("stored_procedure","initializeBackupV2"),o[35]=new t.Map,o[35].set("failure",o[34]),o[35].set("request_id",e[1]),o[36]=t.toJSON(o[35]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[36],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[37]=t[0],t})},function(e){return o[31]=t.i64.cast([0,1])}])},function(e){return o[25]=o[31]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null epoch payload"),o[27]="Null epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[27]].join("")),o[26]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[27],o[26],t.i64.cast([0,3]))},function(r){return o[28]=new t.Map,o[28].set("error_code",o[23]),o[28].set("error_message","Null epoch payload"),o[28].set("stored_procedure","initializeBackupV2"),o[29]=new t.Map,o[29].set("failure",o[28]),o[29].set("request_id",e[1]),o[30]=t.toJSON(o[29]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[30],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[31]=t[0],t})},function(e){return o[25]=t.i64.cast([0,1])}])},function(e){return o[24]=o[25]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create epoch payload"),o[26]="Could not create epoch payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[26]].join("")),o[25]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[26],o[25],t.i64.cast([0,3]))},function(r){return o[27]=new t.Map,o[27].set("error_code",o[23]),o[27].set("error_message","Could not create epoch payload"),o[27].set("stored_procedure","initializeBackupV2"),o[28]=new t.Map,o[28].set("failure",o[27]),o[28].set("request_id",e[1]),o[29]=t.toJSON(o[28]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[29],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[30]=t[0],t})},function(e){return o[24]=t.i64.cast([0,1])}])},function(e){return o[15]=o[24]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null device payload"),o[17]="Null device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[17]].join("")),o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[17],o[16],t.i64.cast([0,3]))},function(r){return o[18]=new t.Map,o[18].set("error_code",o[7]),o[18].set("error_message","Null device payload"),o[18].set("stored_procedure","initializeBackupV2"),o[19]=new t.Map,o[19].set("failure",o[18]),o[19].set("request_id",e[1]),o[20]=t.toJSON(o[19]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[20],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[21]=t[0],t})},function(e){return o[15]=t.i64.cast([0,1])}])},function(e){return o[8]=o[15]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create device payload"),o[16]="Could not create device payload",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",o[16]].join("")),o[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",o[16],o[15],t.i64.cast([0,3]))},function(r){return o[17]=new t.Map,o[17].set("error_code",o[7]),o[17].set("error_message","Could not create device payload"),o[17].set("stored_procedure","initializeBackupV2"),o[18]=new t.Map,o[18].set("failure",o[17]),o[18].set("request_id",e[1]),o[19]=t.toJSON(o[18]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50033]),o[19],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[20]=t[0],t})},function(e){return o[8]=t.i64.cast([0,1])}])},function(e){return o[9]=t.i64.of_float(Date.now()),o[10]=t.i64.random(),o[12]="Finishing execution. Execution time: ",o[13]=t.i64.to_string(t.i64.sub(o[9],o[0])),o[14]=" ms",o[11]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][initializeBackupV2] ",o[11],o[12],o[11],o[13],o[11],o[14]].join("")),t.i64.eq(t.i64.mod_(o[10],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[15]=",",o[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"initializeBackupV2",[o[12],o[15],o[13],o[15],o[14]].join(""),o[16],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[8]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsInitializeBackupV2StoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"];var s=e;l.default=s}),98);
__d("LSInitializeBackupV2StoredProcedure",["LSInitializeBackupV2","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSInitializeBackupV2"),a.deviceRegistrationId,a.requestId,a.recoveryCodeData);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupV2StoredProcedure","LSShape"],(function(t,n,r,o,a,i,l){"use strict";function e(e,t,n,a){return e.runInTransaction(function(e){return r("LSInitializeBackupV2StoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:t,recoveryCodeData:a?o("LSShape").ofRecord(a):void 0,requestId:n!=null?n:""})},"readwrite",void 0,void 0,i.id+":28")}l.initializeBackupStoredProcedure=e}),98);
__d("EBInitializeBackup",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSIntEnum","MAWTraceUtils","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeBackup","Random","RecoveryCodeDB","WAResultOrError","getErrorSafe","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),a=o("Random").uint32();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),i=o.filter(function(e){return e.virtualDeviceType===t&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});i.length>0&&await n.stores.persisted_recovery_code.bulkDelete(i),await n.stores.persisted_recovery_code.bulkPut([{authorityLevel:r("LSAuthorityLevel").OPTIMISTIC,pk:a,recoveryCode:e,virtualDeviceType:t}])},"EBDB - persist recovery code optimistic")}async function c(e,t){var n=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await n.runInTransaction(["persisted_recovery_code"],"readwrite",async function(n){var o=await n.stores.persisted_recovery_code.readAll(),a=o.find(function(n){return n.recoveryCode===e&&n.virtualDeviceType===t&&n.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});a!=null&&await n.stores.persisted_recovery_code.bulkPut([babelHelpers.extends({},a,{authorityLevel:r("LSAuthorityLevel").AUTHORITATIVE})])},"RecoveryCodeDB - update recovery code to authoritative")}async function d(e){var t=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB();await t.runInTransaction(["persisted_recovery_code"],"readwrite",async function(t){var n=await t.stores.persisted_recovery_code.readAll(),o=n.filter(function(t){return t.virtualDeviceType===e&&t.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC}).map(function(e){return e.pk});o.length>0&&await t.stores.persisted_recovery_code.bulkDelete(o)},"RecoveryCodeDB - cleanup recovery code optimistic")}var m=!1,p=new Map;async function _(t,n,a){if(r("justknobx")._("5261")&&m===!0)return o("EBLogger").EBLogger().warn("initializeBackup: init in progress"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_RUNNING),Promise.resolve(o("WAResultOrError").makeError("init_in_progress"));m=!0;var i=null;try{if((e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))){var l=await o("RecoveryCodeDB").getOrCreateRecoveryCodeDB(),_=await l.runInTransaction(["persisted_recovery_code"],"readonly",async function(e){var t=await e.stores.persisted_recovery_code.readAll(),n=t.find(function(e){return e.virtualDeviceType===16&&e.authorityLevel===r("LSAuthorityLevel").OPTIMISTIC});return n!=null?{pk:n.pk,recoveryCode:n.recoveryCode}:null},"RecoveryCodeDB - read existing optimistic recovery code");t.addAnnotations({bool:{is_auto_eb_retry:_!=null}});var f=r("justknobx")._("776");if(_!=null&&f)return o("EBLogger").EBLogger().mustfix("Auto EB initBackup retry prevented by killswitch: wmi/armadillo:stop_auto_eb_initbackup_retry"),t.endFail("auto_eb_retry_prevented_by_killswitch"),await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"));if(_!=null)i=_.recoveryCode,t.addAnnotations({int:{recovery_code_db_pk:_.pk}});else{var g=await r("EBSMAPI").generateRecoveryCode({virtualDeviceType:n});if(g.success===!1)return t.endFail("generate_recovery_code_failure"),m=!1,g;g.success===!0&&(i=g.value.recoveryCode,await u(i,16))}}}catch(a){var h=r("getErrorSafe")(a);return t.endFail("auto_eb_init_failed"),o("EBLogger").EBLogger().catching(h).mustfix("Auto EB init failed."),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),m=!1,Promise.resolve(o("WAResultOrError").makeError("auto_eb_init_failed"))}var y=function(){},C=new Promise(function(e,n){window.setTimeout(function(){y(),o("EBLogger").EBLogger().warn("Init backup failed by timeout"),t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_TIMEOUT),e(o("WAResultOrError").makeError("timed_out"))},r("justknobx")._("4211"))}),b=new Promise(async function(l,u){var m=o("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(t.addAnnotations({string:{deviceRegistrationId:m}}),m===""){t.endFail("device_registration_id_null"),l(o("WAResultOrError").makeError("device_registration_id_null"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_START);var _=await o("EBDeps").getDeps().getLSDB();t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.GET_DB_END),y=_.tables.secure_encrypted_backups_client_state.subscribe(async function(a,u){if(u.operation==="delete"){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SUBSCRIPTION_DELETE,{int:{deleteAuthorityLevel:(e||(e=o("I64"))).to_int32(u.prevValue.authorityLevel),deleteBackupId:e.to_int32(u.prevValue.backupId),deleteInputVirtualDeviceType:e.to_int32(n)}});return}var d=u.value,m=d.authorityLevel,p=d.backupId;(e||(e=o("I64"))).equal(m,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))?(t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_END),i!=null&&(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await c(i,16),y(),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_START),r("EBSMAPI").fetchBackupIds("EBInitializeBackup").finally(function(){t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_END),t.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice()}),l(o("WAResultOrError").makeResult(p))):t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.OPTIMISTIC_CLIENT_STATE,{int:{ocsAuthorityLevel:(e||(e=o("I64"))).to_int32(m),ocsBackupId:e.to_int32(p),ocsInputVirtualDeviceType:e.to_int32(n)},string:{ocsOperation:u.operation}})}),p.set(t.getQPLAttrs().instanceKey.toString(),{clientStateUnsubscribe:y,qplFlow:t,resolve:l}),t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_START);var f=await o("MWEncryptedBackupsInitializeBackup").initializeBackupStoredProcedure(_,m,o("MAWTraceUtils").stringToTraceId(t.getQPLAttrs().instanceKey.toString()),a),g=f[0];if((e||(e=o("I64"))).equal(g,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE))){t.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_FAIL),(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),l(o("WAResultOrError").makeError("sproc_failure"));return}t.addPoint(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_END,{int:{sproc_status:(e||(e=o("I64"))).to_int32(g)}})});return Promise.race([b,C]).then(function(e){return e}).finally(function(){p.delete(t.getQPLAttrs().instanceKey.toString()),m=!1})}async function f(t,n,r){var a=p.get(t);a!=null&&(a.resolve(o("WAResultOrError").makeError("initialize_backup_fail")),a.qplFlow.endFail(o("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_FAIL,{string:{errorMsg:n}}),a.clientStateUnsubscribe()),r!=null&&(e||(e=o("I64"))).equal(r,(s||(s=o("LSIntEnum"))).ofNumber(16))&&await d(16),p.delete(t)}l.initializeBackup=_,l.resolveInitializeBackupPromiseWithError=f}),98);
__d("EBOptOut",["EBAPIQPLPoints","EBDeps","EBSMAPI","ReQL","WAResultOrError","promiseDone","requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("encryptedBackupsOptOutOfBackup").__setRef("EBOptOut");function s(t){var n=t.qplFlow;return new Promise(function(t,a){return void e.load().then(async function(e){n.addPoint("eb_opt_out_get_db_start");var a=await o("EBDeps").getDeps().getLSDB();n.addPoint("eb_opt_out_get_db_end"),r("promiseDone")(e.optOutOfBackupStoredProcedure(a),function(e){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_END);var i=a.tables.secure_encrypted_backups_client_state.subscribe(function(){r("promiseDone")(o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)),function(e){if(e!=null)if(e.length===0)r("promiseDone")(r("EBSMAPI").fetchBackupIds("useEncryptedBackupsOptOutOfBackupDeferred.react").finally(function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_TASK_END),n.endSuccess(),i(),t(o("WAResultOrError").makeResult())}));else{n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_EXISTS);return}else n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_ROW_NULL),n.endFail("opt_out_backup_row_null"),i(),t(o("WAResultOrError").makeError("EB_OPT_OUT_CLIENT_STATE_NULL"))})})},function(){n.addPoint(o("EBAPIQPLPoints").EBOptOutQPLPoints.OPT_OUT_BACKUP_SPROC_FAIL),n.endFail("opt_out_backup_sproc_fail"),t(o("WAResultOrError").makeError("EB_OPT_OUT_SPROC_FAILURE"))})})})}l.ebOptOut=s}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][generateLocalKeys] Beginning execution."),r[1]=t.i64.of_float(Date.now()),e[0]?t.sequence([function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!0}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[29]=new t.Map,r[29].set("error_msg","Expected a nonempty query result"),r[29].set("code",t.i64.cast([0,3])),r[29].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[30]=t.createArray(),r[31]=(r[30].push(r[29]),r[30]),o=[void 0,r[30]],r[17]=o[0],r[18]=o[1]):(n=l.item,r[29]=new t.Map,r[29].set("backup_id",n.backupId),r[29].set("device_public_key_blob",n.devicePublicKeyBlob),r[29].set("device_private_key_blob",n.devicePrivateKeyBlob),r[29].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[29].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[29].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[29].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[29].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[29].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[29].set("orf_client_state_v2_blob",void 0),r[29].set("orf_v2_authority_level",void 0),r[29].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[29].set("device_id",n.deviceId),r[29].set("backup_tenancy",n.backupTenancy),r[29].set("encryption_version",n.encryptionVersion),r[29].set("revision_version",n.revisionVersion),r[29].set("initialize_restore_result",void 0),r[29].set("device_creation_timestamp_sec",void 0),r[29].set("authority_level",n.authorityLevel),a=[r[29],void 0],r[17]=a[0],r[18]=a[1])})},function(e){return r[20]=new t.Map,r[20].set("value",r[17]),r[20].set("errors",r[18]),r[21]=r[20].get("value"),r[21]!==void 0?t.sequence([function(e){return r[29]=r[21].get("backup_id"),r[30]=r[21].get("device_public_key_blob"),r[31]=r[21].get("device_private_key_blob"),r[32]=r[21].get("epoch_storage_public_key_blob"),r[33]=r[21].get("epoch_storage_private_key_blob"),r[34]=r[21].get("epoch_auth_public_key_blob"),r[35]=r[21].get("epoch_auth_private_key_blob"),r[36]=r[21].get("mailbox_root_key_blob"),r[37]=r[21].get("ocmf_client_state_blob"),r[38]=r[21].get("orf_client_state_v2_blob"),r[39]=r[21].get("orf_v2_authority_level"),r[40]=r[21].get("oblivious_validation_token_blob"),r[41]=r[21].get("device_id"),r[42]=r[21].get("backup_tenancy"),r[43]=r[21].get("encryption_version"),r[44]=r[21].get("revision_version"),r[45]=r[21].get("initialize_restore_result"),r[46]=r[21].get("device_creation_timestamp_sec"),r[47]=r[21].get("authority_level"),t.i64.neq(r[41],void 0)?t.sequence([function(e){return r[55]=void 0,t.i64.neq(r[55],void 0)?t.resolve(r[56]=r[55]):t.sequence([function(e){return r[59]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[60]=t[0],t})},function(e){return r[60]&&(r[69]=(r[59].push(t.i64.cast([0,0])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[61]&&(r[69]=(r[59].push(t.i64.cast([0,2])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[62]=t[0],t})},function(e){return r[62]&&(r[69]=(r[59].push(t.i64.cast([0,3])),r[59])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[63]=t[0],t})},function(e){return r[63]&&(r[69]=(r[59].push(t.i64.cast([0,4])),r[59])),r[64]=t.createArray(),r[65]=t.i64.of_int32(r[59].length),t.i64.gt(r[65],t.i64.cast([0,0]))?t.loopAsync(r[65],function(e){return r[69]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[59],r[69]).then(function(e){var t;return t=e,r[70]=t[0],r[71]=t[1],t})},function(e){return r[72]=(r[64].push(r[70]),r[64])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[69]=t.createArray(),r[70]=t.i64.of_int32(r[64].length),t.i64.gt(r[70],t.i64.cast([0,0]))?t.loopAsync(r[70],function(e){return r[72]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[64],r[72]).then(function(e){var t;return t=e,r[73]=t[0],r[74]=t[1],t})},function(e){return r[75]=(r[69].push(t.i64.to_string(r[73])),r[69])}])}):t.resolve()},function(e){return r[71]=r[69].join(","),r[66]=r[71]}])},function(e){return r[64].some(function(e){return t.i64.eq(r[43],e)})?r[67]=r[43]:r[67]=void 0,t.i64.neq(r[67],void 0)?r[68]=r[67]:r[68]=void 0,r[56]=r[68]}])},function(e){var n;return t.i64.neq(r[56],void 0)?r[57]=r[56]:r[57]=t.i64.cast([0,0]),t.i64.neq(r[42],void 0)?r[58]=r[42]:r[58]=t.i64.cast([0,1]),n=[!0,r[30],r[31],r[32],r[33],r[34],r[35]],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),r[56]="Fetching keys locally failed. Reason: 24",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[56]].join("")),r[55]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[56],r[55],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[48]=n[0],r[49]=n[1],r[50]=n[2],r[51]=n[3],r[52]=n[4],r[53]=n[5],r[54]=n[6],n}])},function(e){var t;return t=[r[48],r[49],r[50],r[51],r[52],r[53],r[54]],r[22]=t[0],r[23]=t[1],r[24]=t[2],r[25]=t[3],r[26]=t[4],r[27]=t[5],r[28]=t[6],t}]):t.sequence([function(e){return r[29]=r[20].get("errors"),r[30]=r[20].get("errors"),(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),r[32]="Fetching keys locally failed. Reason: 1",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",r[32]].join("")),r[31]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",r[32],r[31],t.i64.cast([0,3]))},function(e){var n;return n=[!1,t.blob("ZGV2aWNlX3B1YmxpY19rZXk="),t.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),t.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),t.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],r[22]=n[0],r[23]=n[1],r[24]=n[2],r[25]=n[3],r[26]=n[4],r[27]=n[5],r[28]=n[6],n}])},function(e){var t;return t=[r[22],r[23],r[24],r[25],r[26],r[27],r[28]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}]):t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,r[17]=t[0],r[18]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,r[19]=t[0],r[20]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateAuthKeyPair.nop")).then(function(e){var t;return t=e,r[21]=t[0],r[22]=t[1],t})},function(e){var t;return t=[!0,r[18],r[17],r[20],r[19],r[22],r[21]],r[2]=t[0],r[3]=t[1],r[4]=t[2],r[5]=t[3],r[6]=t[4],r[7]=t[5],r[8]=t[6],t}])},function(e){var o;return r[2]?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MA=="),r[5]).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[4],t.blob("MQ=="),r[7]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){var n;return r[19]=new t.Map,r[19].set("device_private_key",r[4]),r[19].set("device_public_key",r[3]),r[20]=new t.Map,r[20].set("epoch_storage_private_key",r[6]),r[20].set("epoch_storage_public_key",r[5]),r[21]=new t.Map,r[21].set("epoch_auth_private_key",r[8]),r[21].set("epoch_auth_public_key",r[7]),r[22]=new t.Map,r[22].set("device_key",r[19]),r[22].set("epoch_storage_key",r[20]),r[22].set("epoch_storage_public_key_sig",r[17]==null?t.blob("bnVsbA=="):r[17]),r[22].set("epoch_auth_key",r[21]),r[22].set("epoch_auth_public_key_sig",r[18]==null?t.blob("bnVsbA=="):r[18]),n=[r[22],void 0],r[9]=n[0],r[10]=n[1]}]):t.resolve((r[17]=new t.Map,r[17].set("error_code",t.i64.cast([0,9])),r[17].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),r[17].set("error_message",""),o=[void 0,r[17]],r[9]=o[0],r[10]=o[1]))},function(e){return r[11]=t.i64.of_float(Date.now()),r[12]=t.i64.random(),r[14]="Finishing execution. Execution time: ",r[15]=t.i64.to_string(t.i64.sub(r[11],r[0])),r[16]=" ms",r[13]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][generateLocalKeys] ",r[13],r[14],r[13],r[15],r[13],r[16]].join("")),t.i64.eq(t.i64.mod_(r[12],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[17]=",",r[18]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"generateLocalKeys",[r[14],r[17],r[15],r[17],r[16]].join(""),r[18],t.i64.cast([0,4]))):t.resolve()},function(e){var t;return t=[r[9],r[10]],o[0]=t[0],o[1]=t[1],t}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGenerateLocalKeysStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state"],a.exports=e}),null);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return r[8]?r[9]=!0:r[9]=!1,r[9]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[11]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[11]].join("")),r[10]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[11],r[10],t.i64.cast([0,3]))):t.resolve()}])},function(o){return t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}).next().then(function(o,a){var i=o.done,l=o.value;return i?t.sequence([function(e){return t.db.table(168).fetch().next().then(function(e,r){var o=e.done,a=e.value;return o?0:(r=a.item,t.storedProcedure(n("LSDeleteBackupOnClient"),r.backupId,void 0,!1,void 0,"null",!0))})},function(o){return r[8]=e[0].get("backup_id"),t.storedProcedure(n("LSGenerateLocalKeys"),!1).then(function(e){var t;return t=e,r[9]=t[0],r[10]=t[1],t})},function(o){return r[9]!==void 0?t.sequence([function(e){return r[11]=r[9].get("device_key"),r[12]=r[9].get("epoch_storage_key"),r[13]=r[9].get("epoch_auth_key"),r[14]=r[11].get("device_private_key"),r[15]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[16]=t[0],t})},function(e){return r[16]&&(r[44]=(r[15].push(t.i64.cast([0,0])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[17]=t[0],t})},function(e){return r[17]&&(r[44]=(r[15].push(t.i64.cast([0,2])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[18]&&(r[44]=(r[15].push(t.i64.cast([0,3])),r[15])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[19]=t[0],t})},function(e){return r[19]&&(r[44]=(r[15].push(t.i64.cast([0,4])),r[15])),r[20]="",r[21]=t.i64.of_int32(r[15].length),t.i64.gt(r[21],t.i64.cast([0,0]))?t.loopAsync(r[21],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[15],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[20]=[r[20],"_",t.i64.to_string(r[45])].join("")}])}):t.resolve()},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),["supported_versions_",r[20],"revision_version_",t.i64.to_string(t.i64.cast([0,1]))].join("")).then(function(e){var t;return t=e,r[22]=t[0],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),r[14],t.blob("Mg=="),r[22]).then(function(e){var t;return t=e,r[23]=t[0],t})},function(e){return t.blobs.neq(r[23],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[23]).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[24]=r[44]}]):t.resolve(r[24]=void 0)},function(o){return r[25]=e[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),r[25]).then(function(e){var t;return t=e,r[26]=t[0],r[27]=t[1],t})},function(e){var o;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,r[44]=t[0],r[45]=t[1],t})},function(e){var t;return t=[r[26],r[27],r[44],r[45]],r[28]=t[0],r[29]=t[1],r[30]=t[2],r[31]=t[3],t}]):t.resolve((o=[r[26],r[27],void 0,void 0],r[28]=o[0],r[29]=o[1],r[30]=o[2],r[31]=o[3],o))},function(n){return r[32]=r[11].get("device_public_key"),r[33]=r[11].get("device_private_key"),r[34]=r[12].get("epoch_storage_public_key"),r[35]=r[12].get("epoch_storage_private_key"),r[36]=r[13].get("epoch_auth_public_key"),r[37]=r[13].get("epoch_auth_private_key"),r[38]=e[0].get("mailbox_root_key"),r[39]=e[0].get("oblivious_validation_token"),t.forEach(t.filter(t.db.table(168).fetch([[[r[8]]]]),function(e){return t.i64.eq(e.backupId,r[8])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,20]))}),function(e){return e.delete()})},function(e){return t.db.table(168).add({backupId:r[8],devicePublicKeyBlob:r[32],devicePrivateKeyBlob:r[33],epochStoragePublicKeyBlob:r[34],epochStoragePrivateKeyBlob:r[35],epochAuthPublicKeyBlob:r[36],epochAuthPrivateKeyBlob:r[37],mailboxRootKeyBlob:r[38],ocmfClientStateBlob:r[28],obliviousValidationTokenBlob:r[39],authorityLevel:t.i64.cast([0,20]),backupTenancy:t.i64.cast([0,1]),revisionVersion:t.i64.cast([0,1]),encryptionVersion:t.i64.cast([0,0])})},function(o){return r[40]=e[0].get("add_peer_epoch_data"),r[41]=t.i64.of_int32(r[40].length),t.i64.gt(r[41],t.i64.cast([0,0]))?t.loopAsync(r[41],function(e){return r[44]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[40],r[44]).then(function(e){var t;return t=e,r[45]=t[0],r[46]=t[1],t})},function(e){return r[47]=r[45].get("epoch_id"),r[48]=r[45].get("epoch_anon_id"),r[49]=r[45].get("epoch_root_key"),r[50]=r[45].get("epoch_status"),r[51]=r[45].get("epoch_head"),t.forEach(t.filter(t.db.table(169).fetch([[[r[47]]]]),function(e){return t.i64.eq(e.epochId,r[47])&&t.i64.lt(e.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(e){return t.db.table(169).add({epochId:r[47],authorityLevel:t.i64.cast([0,80]),backupId:r[8],epochAnonIdBlob:r[48],epochRootKeyBlob:r[49],epochStatus:r[50],epochHead:r[51]})}])}):t.resolve()},function(e){return t.count(t.db.table(169).fetch()).then(function(e){return r[42]=e})},function(e){return t.i64.le(r[42],t.i64.cast([0,1]))?t.sequence([function(e){return t.db.table(169).fetch().next().then(function(e,o){var a=e.done,i=e.value;return a?t.sequence([function(e){return r[46]="No epoch available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[46]].join("")),r[47]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[46]].join(""),r[47],t.i64.cast([0,3]))},function(e){return r[44]=void 0}]):(o=i.item,r[46]=new t.Map,r[46].set("epoch_id",o.epochId),r[46].set("backup_id",o.backupId),r[46].set("epoch_anon_id_blob",o.epochAnonIdBlob),r[46].set("epoch_root_key_blob",o.epochRootKeyBlob),r[46].set("epoch_status",o.epochStatus),r[46].set("epoch_head",o.epochHead),r[46].set("authority_level",o.authorityLevel),r[44]=r[46])})},function(e){return r[43]=r[44]}]):t.sequence([function(e){return r[44]="Multiple epochs available in epochs table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[44]].join("")),r[45]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[44]].join(""),r[45],t.i64.cast([0,3]))},function(e){return r[43]=void 0}])},function(o){return r[43]!==void 0?t.sequence([function(e){return r[44]=r[43].get("epoch_anon_id_blob"),r[45]=r[43].get("epoch_root_key_blob"),r[46]=r[11].get("device_public_key"),r[47]=t.createArray(),r[51]=(r[47].push(t.i64.cast([0,32])),r[47]),t.nativeOperation(n("LSBase64Encode.nop"),r[44]).then(function(e){var t;return t=e,r[48]=t[0],t})},function(e){return r[48]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",r[48]].join("")),void 0,r[45],r[47]).then(function(e){var t;return t=e,r[51]=t[0],t})},function(e){return r[51]?r[52]=!1:r[52]=!0,r[52]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),r[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[55]].join("")),r[54]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[55],r[54],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[56]=t[0],t})},function(e){return r[53]=r[56]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[51],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[54]=t[0],r[55]=t[1],t})},function(e){return r[53]=r[54]}])},function(e){return r[49]=r[53]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),r[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",r[52],r[51],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[49]=r[53]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),r[49],r[46]).then(function(e){var t;return t=e,r[50]=t[0],t})},function(o){return t.blobs.neq(r[50],void 0)?t.sequence([function(e){return r[51]=r[11].get("device_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[51]).then(function(e){var t;return t=e,r[52]=t[0],t})},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[50]).then(function(e){var t;return t=e,r[53]=t[0],t})},function(e){return r[54]=r[43].get("epoch_root_key_blob"),t.blobs.neq(r[54],void 0)?t.sequence([function(e){return r[81]=t.createArray(),r[87]=(r[81].push(t.i64.cast([0,18])),r[81]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,r[54],r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return r[82]!==void 0?t.sequence([function(e){return r[87]=t.i64.of_int32(r[82].length),t.i64.ge(r[87],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[82],t.i64.cast([0,0])).then(function(e){var t;return t=e,r[89]=t[0],r[90]=t[1],t})},function(e){return r[88]=r[89]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),r[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[90]].join("")),r[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[90],r[89],t.i64.cast([0,3]))},function(e){return r[88]=void 0}])},function(e){return r[83]=r[88]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),r[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",r[88]].join("")),r[87]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",r[88],r[87],t.i64.cast([0,3]))},function(e){return r[83]=void 0}])},function(e){return t.blobs.neq(r[83],void 0)?r[84]=!0:r[84]=!1,r[84]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),r[83]).then(function(e){var t;return t=e,r[85]=t[0],t})},function(e){return r[85]!==void 0?r[86]=r[85]:r[86]="encodingfailed",r[55]=r[86]}]):t.resolve(r[55]="null")},function(e){return r[56]=r[12].get("epoch_storage_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[56]).then(function(e){var t;return t=e,r[57]=t[0],t})},function(e){return r[58]=r[9].get("epoch_storage_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[58]).then(function(e){var t;return t=e,r[59]=t[0],t})},function(e){return r[60]=r[13].get("epoch_auth_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),r[60]).then(function(e){var t;return t=e,r[61]=t[0],t})},function(e){return r[62]=r[9].get("epoch_auth_public_key_sig"),t.nativeOperation(n("LSBase64Encode.nop"),r[62]).then(function(e){var t;return t=e,r[63]=t[0],t})},function(o){return r[64]=r[11].get("device_private_key"),r[65]=e[0].get("mailbox_root_key"),r[66]=r[12].get("epoch_storage_private_key"),t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"private_key",r[64],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[67]=r[83]}]):t.resolve(r[67]=void 0)},function(e){return t.blobs.neq(r[67],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[67]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[68]=r[81]}]):t.resolve(r[68]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"ocmf_client_state",r[28],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[69]=r[83]}]):t.resolve(r[69]=void 0)},function(e){return t.blobs.neq(r[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[69]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[70]=r[81]}]):t.resolve(r[70]=void 0)},function(e){return t.blobs.neq(r[65],void 0)?t.sequence([function(e){return r[81]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),r[65],"epoch_storage_private_key",r[66],t.i64.cast([0,1]),r[81]).then(function(e){var t;return t=e,r[82]=t[0],t})},function(e){return t.blobs.neq(r[82],void 0)?r[83]=r[82]:r[83]=void 0,r[71]=r[83]}]):t.resolve(r[71]=void 0)},function(e){return t.blobs.neq(r[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),r[71]).then(function(e){var t;return t=e,r[81]=t[0],t})},function(e){return r[72]=r[81]}]):t.resolve(r[72]=void 0)},function(o){return r[73]=e[0].get("backup_id"),t.nativeOperation(n("LSBase64Encode.nop"),r[29]).then(function(e){var t;return t=e,r[74]=t[0],t})},function(o){return r[75]=e[0].get("server_data_id"),r[76]=r[43].get("epoch_id"),r[77]=new t.Map,r[77].set("supported_encryption_versions",r[15]),r[77].set("client_version",t.i64.cast([0,1])),r[77].set("version_sig",r[24]==null?"":r[24]),r[78]=new t.Map,r[78].set("backup_id",r[73]),r[78].set("device_epoch_hmac",r[53]==null?"":r[53]),r[78].set("epoch_root_key_fingerprint",r[55]),r[78].set("device_public_key",r[52]==null?"":r[52]),r[78].set("epoch_auth_pubkey",r[61]==null?"":r[61]),r[78].set("epoch_auth_pubkey_sig",r[63]==null?"":r[63]),r[78].set("epoch_storage_pubkey",r[57]==null?"":r[57]),r[78].set("epoch_storage_pubkey_sig",r[59]==null?"":r[59]),r[78].set("ocmf_rotation_token",r[74]==null?"":r[74]),r[78].set("server_data_id",r[75]),r[78].set("device_registration_id",e[1]),r[78].set("base_epoch_id",r[76]),r[78].set("encryption_version_data",r[77]),r[78].set("private_key_debug_token",r[68]),r[78].set("ocmf_client_state_debug_token",r[70]),r[78].set("epoch_storage_pvtkey_debug_token",r[72]),r[78].set("trace_id",void 0),r[78].set("occam_only_eligible",!0),r[79]=t.toJSON(r[78]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50017]),r[79],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[80]=t[0],t})}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",r[51],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),r[44]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",r[44],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),r[11]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",r[11],t.i64.cast([0,3]))},function(e){return t.storedProcedure(n("LSDeleteBackupOnClient"),r[8],"backup_init_flow",!0,void 0,void 0,!1)},function(e){return t.forEach(t.db.table(169).fetch(),function(e){return e.delete()})}])}]):(a=l.item,r[8]="An authoritative row already exists, aborting execution of add peer device",r[8]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",r[8]].join("")),r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",r[8],r[9],t.i64.cast([0,3]))):t.resolve())})},function(e){return r[2]=t.i64.of_float(Date.now()),r[3]=t.i64.random(),r[5]="Finishing execution. Execution time: ",r[6]=t.i64.to_string(t.i64.sub(r[2],r[0])),r[7]=" ms",r[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",r[4],r[5],r[4],r[6],r[4],r[7]].join("")),t.i64.eq(t.i64.mod_(r[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[8]=",",r[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[r[5],r[8],r[6],r[8],r[7]].join(""),r[9],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",t.i64.cast([0,0]),void 0)},function(o){return t.nativeOperation(n("LSDeserializeFromJsonIntoDictionaryV2.nop"),e[0]).then(function(e){var t;return t=e,r[0]=t[0],t})},function(e){return t.nativeOperation(n("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",t.i64.cast([0,0]),void 0)},function(e){return r[1]=r[0].get("temp_ocmf_client_state"),t.nativeOperation(n("LSBase64Decode.nop"),r[1]).then(function(e){var t;return t=e,r[2]=t[0],t})},function(e){return r[3]=r[0].get("mailbox_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[3]).then(function(e){var t;return t=e,r[4]=t[0],t})},function(e){return r[5]=r[0].get("oblivious_validation_token"),t.nativeOperation(n("LSBase64Decode.nop"),r[5]).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[7]=t.createArray(),r[8]=r[0].get("add_peer_epoch_data_serializable"),r[9]=t.i64.of_int32(r[8].length),t.i64.gt(r[9],t.i64.cast([0,0]))?t.loopAsync(r[9],function(e){return r[14]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[8],r[14]).then(function(e){var t;return t=e,r[15]=t[0],r[16]=t[1],t})},function(e){return r[17]=r[15].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Decode.nop"),r[17]).then(function(e){var t;return t=e,r[18]=t[0],t})},function(e){return r[19]=r[15].get("epoch_root_key"),t.nativeOperation(n("LSBase64Decode.nop"),r[19]).then(function(e){var t;return t=e,r[20]=t[0],t})},function(e){return r[21]=r[15].get("epoch_id"),r[22]=r[15].get("epoch_status"),r[23]=new t.Map,r[23].set("epoch_id",r[21]),r[23].set("epoch_anon_id",r[18]==null?t.blob(""):r[18]),r[23].set("epoch_root_key",r[20]==null?t.blob(""):r[20]),r[23].set("epoch_status",r[22]),r[24]=r[15].get("epoch_head"),r[24]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSBase64Decode.nop"),r[24]).then(function(e){var t;return t=e,r[25]=t[0],t})},function(e){return r[23].set("epoch_head",r[25])}]):t.resolve()},function(e){return r[25]=(r[7].push(r[23]),r[7])}])}):t.resolve()},function(o){return r[10]=r[0].get("backup_id"),r[11]=r[0].get("server_data_id"),r[12]=new t.Map,r[12].set("backup_id",r[10]),r[12].set("server_data_id",r[11]),r[12].set("temp_ocmf_client_state",r[2]==null?t.blob(""):r[2]),r[12].set("mailbox_root_key",r[4]==null?t.blob(""):r[4]),r[12].set("oblivious_validation_token",r[6]==null?t.blob(""):r[6]),r[12].set("add_peer_epoch_data",r[7]),r[12]!==void 0?t.sequence([function(o){return t.storedProcedure(n("LSFinishAddPeerDevice"),r[12],e[1])},function(e){return r[13]=!0}]):t.resolve(r[13]=!1)},function(e){return o[0]=r[13]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSDeserializeSecretsAndAddDevice"),a.serializedPayload,a.deviceRegistrationId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBOtcAddDevice",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","I64","LSDeserializeSecretsAndAddDeviceStoredProcedure","LSEncryptedBackupsRecoveryCodeStatus","LSFactory","LSIntEnum","ReQL","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t){var n=t.initiatorId,a=t.qplFlow,i=t.secrets,l=function(){};a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var u=await o("EBDeps").getDeps().getLSDB();return a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END),a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_START),new Promise(function(t,d){return u.runInTransaction(function(e){return r("LSDeserializeSecretsAndAddDeviceStoredProcedure")(r("LSFactory")(e),{deviceRegistrationId:n,serializedPayload:i})},"readwrite").then(function(n){var i=n[0];if(a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_END),!i)return a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_FAILURE),t(c("OTC_ADD_DEVICE_SPROC_FAILURE"));l=o("ReQL").fromTableAscending(u.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(n,i){if(i.operation==="add"||i.operation==="put"){l();var u=i.value.recoveryCodeStatus;if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").VALID)))a.addPoint(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SUCCESS),a.endSuccess(),o("EBMainThreadEBDBApiDeferred").addNewDevice(),t(c("SUCCESS"));else if((e||(e=o("I64"))).equal(u,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SYSTEM_ERROR),o("EBLogger").EBLogger().mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),t(c("OTC_ADD_DEVICE_SYSTEM_ERROR"));else{var d="PAKE: Unexpected recovery code status: "+(e||(e=o("I64"))).to_int32(u);a.endFail(o("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS,{string:{errorMessage:d}}),o("EBLogger").EBLogger("wmi_eb").mustfix(d),t(c("OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS",d))}}})}).catch(function(e){l(),t(c("OTC_ADD_DEVICE_SPROC_ERROR",o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)))})})}function c(e,t){return e==="SUCCESS"?o("WAResultOrError").makeResult():o("WAResultOrError").makeError({errorMessage:t,status:e})}l.otcAddDevice=u}),98);
__d("EBRepairEpochQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="25352669137720538"}),null);
__d("EBRepairEpochQuery.graphql",["EBRepairEpochQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null}],r={alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"request",variableName:"input"}],concreteType:"XFBRepairEpochResponse",kind:"LinkedField",name:"repair_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"target_device_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_sync_reason",storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:t,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null},{alias:null,args:null,concreteType:"XFBMinosEpoch",kind:"LinkedField",name:"to_minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"error_code",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EBRepairEpochQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("EBRepairEpochQuery_facebookRelayOperation"),metadata:{},name:"EBRepairEpochQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("EBRepairEpochQuery",["EBRepairEpochQuery.graphql","WAResultOrError","createWorkerQuery"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var a,i=e!==void 0?e:e=n("EBRepairEpochQuery.graphql"),l=await r("createWorkerQuery")(i,{input:t}),s=l==null||(a=l.viewer)==null||(a=a.encrypted_backup)==null||(a=a.mailbox)==null?void 0:a.repair_epoch;return(s==null?void 0:s.is_success)===!0&&(s==null?void 0:s.epoch_derivation_set)!=null?o("WAResultOrError").makeResult(s.epoch_derivation_set):(s==null?void 0:s.exception_string)!=null?o("WAResultOrError").makeError({errorCode:s.error_code,message:s.exception_string}):o("WAResultOrError").makeError({message:"Repair epoch failed"})}l.RepairEpochQuery=s}),98);
__d("EBRepairEpochs",["Base64Utils","EBAPIQPLPoints","EBDeps","EBDeriveAndStoreEpochs","EBEpochUtils","EBGetClientState","EBRepairEpochQuery","I64","LSAuthorityLevel","LSIntEnum","QPLFlow","Random","ReQL","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n=o("Random").uint32(),a=String(n),i=o("QPLFlow").startQPLFlow(r("qpl")._(521474335,"1476"),{annotations:{string:{traceId:a}},instanceKey:n});try{i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_START);var l=await o("EBGetClientState").getClientState(t);if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_CLIENT_STATE_END),l==null)return i.endFail("client_state_is_missing"),o("WAResultOrError").makeError({message:"Client state is missing"});var u=l.backupId,c=l.deviceId;if(u==null||c==null)return i.endFail("backup_id_or_device_id_is_missing"),o("WAResultOrError").makeError({message:"Backup ID or device ID is missing"});i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_START);var d=await o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.secure_encrypted_backups_epochs));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.GET_EPOCHS_END);var m=await Promise.all(d.filter(function(t){return(e||(e=o("I64"))).equal(t.authorityLevel,(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").AUTHORITATIVE))}).map(async function(t){var n=await o("EBEpochUtils").getFingerPrint(t.epochRootKeyBlob,"MEBEpochRootKey");return{epoch_id:(e||(e=o("I64"))).to_string(t.epochId),fingerprint:{sensitive_string_value:o("Base64Utils").fromArrayBuffer(n)}}}));i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_START);var p=await o("EBRepairEpochQuery").RepairEpochQuery({backup_id:u,device_id:c,locally_available_epochs:m,trace_id:a});if(i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.REPAIR_EPOCH_QUERY_END),!p.success){var _;return i.endFail("repair_epoch_query_failed",{string:{error_code:String((_=p.error.errorCode)!=null?_:"none"),error_message:p.error.message}}),p}return i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_START),await o("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(t,p.value),i.addPoint(o("EBAPIQPLPoints").EBRepairEpochsQPLPoints.DERIVE_AND_STORE_EPOCHS_END),i.endSuccess(),p}catch(e){var f=r("getErrorSafe")(e);return i.endFail("runtime_error",{string:{error_message:f.message}}),o("WAResultOrError").makeError({message:f.message})}}l.EBRepairEpochs=u}),98);
__d("LSGetRemoveVirtualDeviceRequestStatus",["LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(o){return t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(o,a){var i=o.done,l=o.value;return i?r[0]=t.i64.cast([0,3]):(a=l.item,t.sequence([function(o){return r[3]=a.removalStatus,t.i64.eq(r[3],t.i64.cast([0,1]))?t.resolve(r[2]=t.i64.cast([0,1])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,2]))?t.resolve(r[4]=t.i64.cast([0,0])):t.sequence([function(o){return t.i64.eq(r[3],t.i64.cast([0,3]))?t.resolve(r[5]=t.i64.cast([0,2])):t.sequence([function(o){return r[6]=["Unknown RemoveVirtualDeviceStatus found ",t.i64.to_string(r[3])].join(""),r[6]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure] ","",r[6]].join("")),r[7]=t.createArray(),e[1]!==void 0&&(r[8]=(r[7].push(e[1]),r[7])),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",r[6],r[7],t.i64.cast([0,3]))):t.resolve()},function(e){return r[5]=t.i64.cast([-1,4294967295])}])},function(e){return r[4]=r[5]}])},function(e){return r[2]=r[4]}])},function(e){return r[0]=r[2]}]))})},function(e){return o[0]=r[0]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsGetRemoveVirtualDeviceRequestStatusStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure",["LSGetRemoveVirtualDeviceRequestStatus","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSGetRemoveVirtualDeviceRequestStatus"),a.virtualDeviceId,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSRemoveVirtualDevice",["LSAppendDataTraceAddon","LSBase64Encode.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(a){return t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[5]?r[6]=!0:r[6]=!1,r[6]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[8]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[8]].join("")),r[7]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[8],r[7],t.i64.cast([0,3]))):t.resolve()}])},function(n){return e[1]!==void 0?r[0]=e[1]:r[0]="vd_removal:remove_vd_task",t.islc(t.filter(t.db.table(184).fetch(),function(n){return t.blobs.eq(n.virtualDeviceId,e[0])}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,t){var n,o,a=e.done,i=e.value;return a?(n=[void 0,void 0],r[1]=n[0],r[2]=n[1],n):(t=i.item,o=[t.pk,t.backupId],r[1]=o[0],r[2]=o[1])})},function(o){return t.i64.neq(r[2],void 0)?t.sequence([function(o){return t.nativeOperation(n("LSBase64Encode.nop"),e[0]).then(function(e){var t;return t=e,r[5]=t[0],t})},function(e){return r[6]=new t.Map,r[6].set("backup_id",r[2]),r[6].set("virtual_device_id",r[5]==null?"":r[5]),r[6].set("removal_reason",r[0]),r[6].set("trace_id",void 0),r[7]=t.toJSON(r[6]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50024]),r[7],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[8]=t[0],t})},function(e){return t.i64.neq(r[1],void 0)?t.forEach(t.db.table(184).fetch([[[r[1]]]]),function(e){var n=e.update,r=e.item;return n({removalStatus:t.i64.cast([0,2])})}):t.resolve()},function(e){return r[4]=t.i64.cast([0,0])}]):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[6]=t[0],t})},function(e){return r[6]?r[7]=!0:r[7]=!1,r[7]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[9]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[9]].join("")),r[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[9],r[8],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[5]="Backup not found",r[5]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure] ","",r[5]].join("")),r[6]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",r[5],r[6],t.i64.cast([0,3]))):t.resolve()},function(e){return r[4]=t.i64.cast([0,1])}])},function(e){return o[0]=r[4]}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsRemoveVirtualDeviceStoredProcedure",e.__tables__=["encrypted_backups_virtual_devices"],a.exports=e}),null);
__d("LSRemoveVirtualDeviceStoredProcedure",["LSRemoveVirtualDevice","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSRemoveVirtualDevice"),a.virtualDeviceId,a.removalReason,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("EBRevokeVirtualDevice",["Base64Utils","EBAPIQPLPoints","EBDeps","I64","LSEncryptedBackupsOpStatus","LSFactory","LSGetRemoveVirtualDeviceRequestStatusStoredProcedure","LSIntEnum","LSRemoveVirtualDeviceStoredProcedure","WAResultOrError","getSafeQplErrorMessage"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(t,n){var a,i=function(){},l=(a=n.getQPLAttrs().instanceKey.toString())!=null?a:"";n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_START);var u=await o("EBDeps").getDeps().getLSDB();n.addPoint(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_END);var c=o("Base64Utils").toArrayBuffer(t),d=function(t){return u.runInTransaction(function(e){return r("LSGetRemoveVirtualDeviceRequestStatusStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:t})},"readonly").then(function(e){return e[0]})};return u.runInTransaction(function(e){return r("LSRemoveVirtualDeviceStoredProcedure")(r("LSFactory")(e),{traceId:l,virtualDeviceId:c})},"readwrite").then(function(t){var a=t[0];return(e||(e=o("I64"))).equal(a,(s||(s=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS))?new Promise(function(e,t){i=u.tables.encrypted_backups_virtual_devices.subscribe(function(){d(c).then(function(t){switch((s||(s=o("LSIntEnum"))).toNumber(t)){case 0:return;case 2:case-1:i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_STATUS_INTERNAL_ERROR),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_STATUS_INTERNAL_ERROR"));return;case 1:case 3:i(),n.endSuccess(),e(o("WAResultOrError").makeResult());return}}).catch(function(t){i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_DB_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(t)}}),e(o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_GET_SPROC_ERROR"))})})}):(i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE"))},function(e){return i(),n.endFail(o("EBAPIQPLPoints").EBRevokeVirtualDeviceQPLPoints.REVOKE_VIRTUAL_DEVICE_SPROC_ERROR,{string:{errorMessage:o("getSafeQplErrorMessage").getSafeQPLErrorMessage(e)}}),o("WAResultOrError").makeError("REVOKE_VIRTUAL_DEVICE_SPROC_FAILURE")})}l.revokeVirtualDevice=u}),98);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(e){return t.sequence([function(e){return r[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] Beginning execution."),t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[13]=t[0],t})},function(e){return r[13]?r[14]=!0:r[14]=!1,r[14]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[16]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[16]].join("")),r[15]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[16],r[15],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.islc(t.filter(t.db.table(168).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))||!1}),0,t.i64.to_float(t.i64.cast([0,1]))).next().then(function(e,n){var o,a,i=e.done,l=e.value;return i?(r[13]=new t.Map,r[13].set("error_msg","Expected a nonempty query result"),r[13].set("code",t.i64.cast([0,3])),r[13].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),r[14]=t.createArray(),r[15]=(r[14].push(r[13]),r[14]),o=[void 0,r[14]],r[1]=o[0],r[2]=o[1]):(n=l.item,r[13]=new t.Map,r[13].set("backup_id",n.backupId),r[13].set("device_public_key_blob",n.devicePublicKeyBlob),r[13].set("device_private_key_blob",n.devicePrivateKeyBlob),r[13].set("epoch_storage_public_key_blob",n.epochStoragePublicKeyBlob),r[13].set("epoch_storage_private_key_blob",n.epochStoragePrivateKeyBlob),r[13].set("epoch_auth_public_key_blob",n.epochAuthPublicKeyBlob),r[13].set("epoch_auth_private_key_blob",n.epochAuthPrivateKeyBlob),r[13].set("mailbox_root_key_blob",n.mailboxRootKeyBlob),r[13].set("ocmf_client_state_blob",n.ocmfClientStateBlob),r[13].set("orf_client_state_v2_blob",void 0),r[13].set("orf_v2_authority_level",void 0),r[13].set("oblivious_validation_token_blob",n.obliviousValidationTokenBlob),r[13].set("device_id",n.deviceId),r[13].set("backup_tenancy",n.backupTenancy),r[13].set("encryption_version",n.encryptionVersion),r[13].set("revision_version",n.revisionVersion),r[13].set("initialize_restore_result",void 0),r[13].set("device_creation_timestamp_sec",void 0),r[13].set("authority_level",n.authorityLevel),a=[r[13],void 0],r[1]=a[0],r[2]=a[1])})},function(e){return r[4]=new t.Map,r[4].set("value",r[1]),r[4].set("errors",r[2]),r[5]=r[4].get("value"),r[5]!==void 0?t.sequence([function(e){return r[13]=r[5].get("backup_id"),r[14]=r[5].get("device_public_key_blob"),r[15]=r[5].get("device_private_key_blob"),r[16]=r[5].get("epoch_storage_public_key_blob"),r[17]=r[5].get("epoch_storage_private_key_blob"),r[18]=r[5].get("epoch_auth_public_key_blob"),r[19]=r[5].get("epoch_auth_private_key_blob"),r[20]=r[5].get("mailbox_root_key_blob"),r[21]=r[5].get("ocmf_client_state_blob"),r[22]=r[5].get("orf_client_state_v2_blob"),r[23]=r[5].get("orf_v2_authority_level"),r[24]=r[5].get("oblivious_validation_token_blob"),r[25]=r[5].get("device_id"),r[26]=r[5].get("backup_tenancy"),r[27]=r[5].get("encryption_version"),r[28]=r[5].get("revision_version"),r[29]=r[5].get("initialize_restore_result"),r[30]=r[5].get("device_creation_timestamp_sec"),r[31]=r[5].get("authority_level"),t.i64.neq(r[25],void 0)?t.sequence([function(e){return r[33]=void 0,t.i64.neq(r[33],void 0)?t.resolve(r[34]=r[33]):t.sequence([function(e){return r[41]=t.createArray(),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,0])).then(function(e){var t;return t=e,r[42]=t[0],t})},function(e){return r[42]&&(r[51]=(r[41].push(t.i64.cast([0,0])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,2])).then(function(e){var t;return t=e,r[43]=t[0],t})},function(e){return r[43]&&(r[51]=(r[41].push(t.i64.cast([0,2])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,3])).then(function(e){var t;return t=e,r[44]=t[0],t})},function(e){return r[44]&&(r[51]=(r[41].push(t.i64.cast([0,3])),r[41])),t.storedProcedure(n("LSIsEncryptionVersionSecure"),t.i64.cast([0,4])).then(function(e){var t;return t=e,r[45]=t[0],t})},function(e){return r[45]&&(r[51]=(r[41].push(t.i64.cast([0,4])),r[41])),r[46]=t.createArray(),r[47]=t.i64.of_int32(r[41].length),t.i64.gt(r[47],t.i64.cast([0,0]))?t.loopAsync(r[47],function(e){return r[51]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[41],r[51]).then(function(e){var t;return t=e,r[52]=t[0],r[53]=t[1],t})},function(e){return r[54]=(r[46].push(r[52]),r[46])}])}):t.resolve()},function(e){return t.sequence([function(e){return r[51]=t.createArray(),r[52]=t.i64.of_int32(r[46].length),t.i64.gt(r[52],t.i64.cast([0,0]))?t.loopAsync(r[52],function(e){return r[54]=e,t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),r[46],r[54]).then(function(e){var t;return t=e,r[55]=t[0],r[56]=t[1],t})},function(e){return r[57]=(r[51].push(t.i64.to_string(r[55])),r[51])}])}):t.resolve()},function(e){return r[53]=r[51].join(","),r[48]=r[53]}])},function(e){return r[46].some(function(e){return t.i64.eq(r[27],e)})?r[49]=r[27]:r[49]=void 0,t.i64.neq(r[49],void 0)?r[50]=r[49]:r[50]=void 0,r[34]=r[50]}])},function(e){return t.i64.neq(r[34],void 0)?r[35]=r[34]:r[35]=t.i64.cast([0,0]),t.i64.neq(r[26],void 0)?r[36]=r[26]:r[36]=t.i64.cast([0,1]),t.filter(t.db.table(2).fetch(),function(e){return e.context==="50013"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[37]=!1:(t=o.item,r[37]=!0)})},function(e){return t.filter(t.db.table(2).fetch(),function(e){return e.context==="50025"}).next().then(function(e,t){var n=e.done,o=e.value;return n?r[39]=!1:(t=o.item,r[39]=!0)})},function(e){return r[37]||r[39]?(r[41]="Another sync job is already in progress. Terminating this.",r[41]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[41]].join("")),r[42]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[41],r[42],t.i64.cast([0,3]))):t.resolve()):t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,r[49]=t[0],t})},function(e){return r[49]?r[50]=!0:r[50]=!1,r[50]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),r[52]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",r[52]].join("")),r[51]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",r[52],r[51],t.i64.cast([0,3]))):t.resolve()}])},function(e){return r[41]=t.createArray(),t.forEach(t.filter(t.db.table(169).fetch(),function(e){return t.i64.eq(e.authorityLevel,t.i64.cast([0,80]))}),function(e){var t=e.item;return r[49]=(r[41].push(t.epochId),r[41])})},function(e){return r[47]="Queried locally available epochs. Count: ",r[42]=t.i64.of_int32(r[41].length),r[48]=t.i64.to_string(r[42]),r[43]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][MEBEpochClientUtils] ",r[43],r[47],r[43],r[48]].join("")),t.resolve()},function(e){return r[44]=new t.Map,r[44].set("backup_id",r[13]),r[44].set("device_id",r[25]),r[44].set("locally_available_epochs",r[41]),r[44].set("trace_id",void 0),r[45]=t.toJSON(r[44]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",t.i64.cast([0,50025]),r[45],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,r[46]=t[0],t})}])},function(e){return r[32]=!0}]):t.sequence([function(e){return r[33]=["Failed to load client state: ","","NULL_DEVICE_ID"].join(""),r[33]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[33]].join("")),r[34]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[33],r[34],t.i64.cast([0,3]))):t.resolve()},function(e){return r[32]=!1}])},function(e){return r[6]=r[32]}]):t.sequence([function(e){return r[13]=r[4].get("errors"),r[14]=r[4].get("errors"),r[15]=["Failed to load client state: ","","BACKUP_NOT_FOUND"].join(""),r[15]!==void 0?((function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",r[15]].join("")),r[16]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",r[15],r[16],t.i64.cast([0,3]))):t.resolve()},function(e){return r[6]=!1}])},function(e){return r[7]=t.i64.of_float(Date.now()),r[8]=t.i64.random(),r[10]="Finishing execution. Execution time: ",r[11]=t.i64.to_string(t.i64.sub(r[7],r[0])),r[12]=" ms",r[9]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ",r[9],r[10],r[9],r[11],r[9],r[12]].join("")),t.i64.eq(t.i64.mod_(r[8],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(r[13]=",",r[14]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",[r[10],r[13],r[11],r[13],r[12]].join(""),r[14],t.i64.cast([0,4]))):t.resolve()}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSEncryptedBackupsSyncEpochsStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","pending_tasks","secure_encrypted_backups_epochs"],a.exports=e}),null);
__d("LSSyncEpochsStoredProcedure",["LSSyncEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t){var a=t.storedProcedure(r("LSSyncEpochs"));return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}l.default=s}),98);
__d("EBSyncEpochs",["EBAPIQPLPoints","EBDeps","LSFactory","LSSyncEpochsStoredProcedure","QPLFlow","Random","WAResultOrError","getErrorSafe","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e=new Map;function s(t,n){if(n==null){for(var r of e.entries()){var a=r[0],i=r[1];i.unsub(),window.clearTimeout(i.timeout),i.resolve(o("WAResultOrError").makeError(t)),e.delete(a)}return}var l=e.get(n);l!=null&&(l.unsub(),window.clearTimeout(l.timeout),l.resolve(o("WAResultOrError").makeError(t)),e.delete(n))}async function u(){var t=await o("EBDeps").getDeps().getLSDB(),n,a=o("Random").uint32(),l=String(a),s=o("QPLFlow").startQPLFlow(r("qpl")._(521475098,"1328"),{annotations:{string:{traceId:l}},instanceKey:a});return new Promise(async function(a,u){var c=t.tables.secure_encrypted_backups_epochs.subscribe(function(t,r){if(r.operation!=="delete")return c(),window.clearTimeout(n),e.delete(l),s.endSuccess(),a(o("WAResultOrError").makeResult())});s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_START),await t.runInTransaction(function(e){return r("LSSyncEpochsStoredProcedure")(r("LSFactory")(e))},"readwrite",void 0,void 0,i.id+":95").then(function(){s.addPoint(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_SPROC_END),n=window.setTimeout(function(){return e.delete(l),s.endFail(o("EBAPIQPLPoints").EBSyncEpochsQPLPoints.SYNC_EPOCH_TIMEOUT),u(o("WAResultOrError").makeError("timeout"))},12e4),e.set(l,{resolve:a,timeout:n,unsub:c})}).catch(function(t){var n=r("getErrorSafe")(t);return c(),e.delete(l),u(o("WAResultOrError").makeError(n.message))})})}l.resolveSyncEpochsWithError=s,l.EBSyncEpochs=u}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeData",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(a){return t.sequence([function(n){return o[0]=e[2].get("recovery_code"),o[1]=e[2].get("virtual_device_type"),o[2]=e[2].get("cloud_service_account"),o[3]=e[2].get("hsm_pin_normalization_status"),o[4]=e[2].get("security_question_type"),o[5]=e[2].get("trusted_contact_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[6]=t.i64.cast([0,1]):(n=a.item,o[9]=n.backupTenancy,t.i64.neq(o[9],void 0)?o[8]=o[9]:o[8]=t.i64.cast([0,1]),o[6]=o[8])})},function(a){return t.i64.eq(o[6],t.i64.cast([0,1]))&&o[0]==="1SHADOWTESTINGRECOVERYCODE00000000000000"?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Used."),o[9]="Invalid Recovery Code Used.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[9]].join("")),o[8]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[9],o[8],t.i64.cast([0,3]))):t.sequence([function(e){return o[8]=t.createArray(),t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[9]=t[0],t})},function(e){return t.nativeOperation(n("LSParseRecoveryCode_v2.nop"),o[0],t.i64.to_string(o[9]),o[8]).then(function(e){var t;return t=e,o[10]=t[0],o[11]=t[1],t})},function(a){return t.blobs.neq(o[11],void 0)?t.blobs.neq(o[10],void 0)?t.sequence([function(e){return t.storedProcedure(n("LSGetOpenEpochKeys"),!1).then(function(e){var t;return t=e,o[12]=t[0],t})},function(a){return o[12]!==void 0?t.sequence([function(a){return o[79]=r("justknobx")._("1310"),e[3]!==void 0?o[79]?t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2866]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.sequence([function(r){return e[3]!==void 0?t.storedProcedure(n("LSAppendDataTraceAddon"),e[3],t.i64.cast([0,2867]),t.i64.cast([0,2]),void 0,void 0):t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!0:o[90]=!1,o[90]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[92]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[92]].join("")),o[91]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[92],o[91],t.i64.cast([0,3]))):t.resolve()}]):t.resolve()},function(e){return o[79]?t.resolve():t.sequence([function(e){return t.count(t.db.table(169).fetch()).then(function(e){return o[89]=e})},function(e){return t.i64.gt(o[89],t.i64.cast([0,1]))?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Multiple rows in $epoch_tables."),o[91]="Multiple rows in $epoch_tables.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[91]].join("")),o[90]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[91],o[90],t.i64.cast([0,3]))):t.resolve()}])},function(e){return t.nativeOperation(n("LSCreateSignatureKeyPair.nop")).then(function(e){var t;return t=e,o[13]=t[0],o[14]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateEncryptionKeyPair.nop")).then(function(e){var t;return t=e,o[15]=t[0],o[16]=t[1],t})},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("MA=="),o[16]).then(function(e){var t;return t=e,o[17]=t[0],t})},function(r){return o[80]=t.blob(""),o[81]=t.blob(""),o[82]=t.blob(""),t.db.table(168).fetch([[[e[1]]]]).next().then(function(e,r){var a,i=e.done,l=e.value;return i?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Row with backupid not found in client state table"),o[90]="Row with backupid not found in client state table",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){var t;return t=[o[80],o[81],void 0,o[82]],o[18]=t[0],o[19]=t[1],o[20]=t[2],o[21]=t[3],t}]):(r=l.item,a=[r.obliviousValidationTokenBlob,r.mailboxRootKeyBlob,r.deviceId,r.ocmfClientStateBlob],o[18]=a[0],o[19]=a[1],o[20]=a[2],o[21]=a[3])})},function(e){return t.blobs.eq(o[18],o[80])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] oblivious_token is empty!"),o[90]="oblivious_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[19],o[81])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] mailbox_root_key is empty!"),o[90]="mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.blobs.eq(o[21],o[82])?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ocmf_client_state is empty!"),o[90]="ocmf_client_state is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[23]=o[12].get("epoch_anon_id"),o[24]=o[12].get("epoch_root_key"),o[25]=t.createArray(),o[89]=(o[25].push(t.i64.cast([0,32])),o[25]),t.nativeOperation(n("LSBase64Encode.nop"),o[23]).then(function(e){var t;return t=e,o[26]=t[0],t})},function(e){return o[26]!==void 0?t.sequence([function(e){return t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blobs.of_string(["epoch_devices","_",o[26]].join("")),void 0,o[24],o[25]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[89]?o[90]=!1:o[90]=!0,o[90]?t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),o[93]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[93]].join("")),o[92]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[93],o[92],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[91]=o[94]}]):t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[89],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[92]=t[0],o[93]=t[1],t})},function(e){return o[91]=o[92]}])},function(e){return o[27]=o[91]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),o[90]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoEpochUtils] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[27]=o[91]}])},function(e){return t.nativeOperation(n("LSHmac_v2.nop"),o[27],o[14]).then(function(e){var t;return t=e,o[28]=t[0],t})},function(e){return t.blobs.neq(o[28],void 0)?t.resolve(o[29]=o[28]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] device_epoch_hmac is null!"),o[90]="device_epoch_hmac is null!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),"").then(function(e){var t;return t=e,o[91]=t[0],t})},function(e){return o[29]=o[91]}])},function(e){return o[30]=o[12].get("epoch_root_key"),t.blobs.neq(o[30],void 0)?t.sequence([function(e){return o[89]=t.createArray(),o[95]=(o[89].push(t.i64.cast([0,18])),o[89]),t.nativeOperation(n("LSCreateDerivedKeys.nop"),t.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,o[30],o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return o[90]!==void 0?t.sequence([function(e){return o[95]=t.i64.of_int32(o[90].length),t.i64.ge(o[95],t.i64.cast([0,1]))?t.sequence([function(e){return t.nativeTypeOperation("Array",n("LSArrayGetObjectAt"),o[90],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[97]=t[0],o[98]=t[1],t})},function(e){return o[96]=o[97]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),o[98]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[98]].join("")),o[97]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[98],o[97],t.i64.cast([0,3]))},function(e){return o[96]=void 0}])},function(e){return o[91]=o[96]}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),o[96]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBFingerprint] ","",o[96]].join("")),o[95]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBFingerprint",o[96],o[95],t.i64.cast([0,3]))},function(e){return o[91]=void 0}])},function(e){return t.blobs.neq(o[91],void 0)?o[92]=!0:o[92]=!1,o[92]||((function(e){t.logger(e).mustfix(e)})("LS::assert is failed. Attempting to coerce a null value to nonnull."),t.throw("LS::assert is failed. Attempting to coerce a null value to nonnull.")),t.nativeOperation(n("LSBase64Encode.nop"),o[91]).then(function(e){var t;return t=e,o[93]=t[0],t})},function(e){return o[93]!==void 0?o[94]=o[93]:o[94]="encodingfailed",o[31]=o[94]}]):t.resolve(o[31]="null")},function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),o[21]).then(function(e){var t;return t=e,o[32]=t[0],o[33]=t[1],t})},function(e){var r;return t.blobs.neq(void 0,void 0)?t.sequence([function(e){return t.nativeOperation(n("LSOcmfClientEvolve_v2.nop"),void 0).then(function(e){var t;return t=e,o[89]=t[0],o[90]=t[1],t})},function(e){var t;return t=[o[32],o[33],o[89],o[90]],o[34]=t[0],o[35]=t[1],o[36]=t[2],o[37]=t[3],t}]):t.resolve((r=[o[32],o[33],void 0,void 0],o[34]=r[0],o[35]=r[1],o[36]=r[2],o[37]=r[3],r))},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[13]).then(function(e){var t;return t=e,o[38]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),o[38]==null?"":o[38]).then(function(e){var t;return t=e,o[39]=t[0],t})},function(e){return o[39]!==void 0?o[40]=o[39]:o[40]="",o[40]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_device_private_key is empty!"),o[90]="encrypted_device_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[15]).then(function(e){var t;return t=e,o[41]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),o[41]==null?"":o[41]).then(function(e){var t;return t=e,o[42]=t[0],t})},function(e){return o[42]!==void 0?o[43]=o[42]:o[43]="",o[43]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_storage_private_key is empty!"),o[90]="encrypted_epoch_storage_private_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[34]).then(function(e){var t;return t=e,o[44]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),o[44]==null?"":o[44]).then(function(e){var t;return t=e,o[45]=t[0],t})},function(e){return o[45]!==void 0?o[46]=o[45]:o[46]="",o[46]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),o[90]="encrypted_orf_client_state_v1_shape is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[18]).then(function(e){var t;return t=e,o[47]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),o[47]==null?"":o[47]).then(function(e){var t;return t=e,o[48]=t[0],t})},function(e){return o[48]!==void 0?o[49]=o[48]:o[49]="",o[49]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_oblivious_validation_token is empty!"),o[90]="encrypted_oblivious_validation_token is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[19]).then(function(e){var t;return t=e,o[50]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),o[50]==null?"":o[50]).then(function(e){var t;return t=e,o[51]=t[0],t})},function(e){return o[51]!==void 0?o[52]=o[51]:o[52]="",o[52]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_mailbox_root_key is empty!"),o[90]="encrypted_mailbox_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[53]=o[12].get("epoch_anon_id"),t.nativeOperation(n("LSBase64Encode.nop"),o[53]).then(function(e){var t;return t=e,o[54]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),o[54]==null?"":o[54]).then(function(e){var t;return t=e,o[55]=t[0],t})},function(e){return o[55]!==void 0?o[56]=o[55]:o[56]="",o[56]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_anon_id is empty!"),o[90]="encrypted_epoch_anon_id is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[57]=o[12].get("epoch_root_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[57]).then(function(e){var t;return t=e,o[58]=t[0],t})},function(e){return t.nativeOperation(n("LSSymmetricEncryptionCreateEncryptedString.nop"),o[11],t.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),o[58]==null?"":o[58]).then(function(e){var t;return t=e,o[59]=t[0],t})},function(e){return o[59]!==void 0?o[60]=o[59]:o[60]="",o[60]===""?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] encrypted_epoch_root_key is empty!"),o[90]="encrypted_epoch_root_key is empty!",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[90]].join("")),o[89]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[90],o[89],t.i64.cast([0,3]))):t.resolve()},function(e){return o[61]=new t.Map,o[61].set("encrypted_device_private_key",o[40]),o[61].set("encrypted_epoch_storage_private_key",o[43]),o[61].set("encrypted_ocmf_client_state",o[46]),o[61].set("encrypted_orf_client_state_v2",void 0),o[61].set("encrypted_oblivious_validation_token_blob",o[49]),o[61].set("encrypted_mailbox_root_key_blob",o[52]),o[61].set("encrypted_epoch_anon_id",o[56]),o[61].set("encrypted_epoch_root_key",o[60]),t.nativeOperation(n("LSBase64Encode.nop"),o[10]).then(function(e){var t;return t=e,o[62]=t[0],t})},function(e){return o[83]=o[62]==null?"":o[62],t.nativeOperation(n("LSBase64Encode.nop"),o[14]).then(function(e){var t;return t=e,o[63]=t[0],t})},function(e){return o[84]=o[63]==null?"":o[63],t.nativeOperation(n("LSBase64Encode.nop"),o[16]).then(function(e){var t;return t=e,o[64]=t[0],t})},function(e){return o[85]=o[64]==null?"":o[64],t.nativeOperation(n("LSBase64Encode.nop"),o[17]==null?t.blob("bnVsbA=="):o[17]).then(function(e){var t;return t=e,o[65]=t[0],t})},function(e){return o[86]=o[65]==null?"":o[65],t.nativeOperation(n("LSBase64Encode.nop"),o[29]).then(function(e){var t;return t=e,o[66]=t[0],t})},function(e){return o[87]=o[66]==null?"":o[66],t.nativeOperation(n("LSBase64Encode.nop"),o[35]).then(function(e){var t;return t=e,o[67]=t[0],t})},function(e){return o[88]=o[67]==null?"":o[67],t.nativeOperation(n("LSGetBlobFromString.nop"),o[0]).then(function(e){var t;return t=e,o[68]=t[0],t})},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"private_key",o[13],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[69]=o[91]}]):t.resolve(o[69]=void 0)},function(e){return t.blobs.neq(o[69],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[69]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[70]=o[89]}]):t.resolve(o[70]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"ocmf_client_state",o[34],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[71]=o[91]}]):t.resolve(o[71]=void 0)},function(e){return t.blobs.neq(o[71],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[71]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[72]=o[89]}]):t.resolve(o[72]=void 0)},function(e){return t.blobs.neq(o[19],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[19],"epoch_storage_private_key",o[15],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[73]=o[91]}]):t.resolve(o[73]=void 0)},function(e){return t.blobs.neq(o[73],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[73]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[74]=o[89]}]):t.resolve(o[74]=void 0)},function(e){return t.storedProcedure(n("LSGetViewerFBID")).then(function(e){var t;return t=e,o[75]=t[0],t})},function(e){return t.nativeOperation(n("LSGetBlobFromString.nop"),t.i64.to_string(o[75])).then(function(e){var t;return t=e,o[76]=t[0],t})},function(e){return t.blobs.neq(o[76],void 0)?t.sequence([function(e){return o[89]=new t.Map,t.nativeOperation(n("LSCreateDebugToken.nop"),o[76],"recovery_code",o[68],t.i64.cast([0,1]),o[89]).then(function(e){var t;return t=e,o[90]=t[0],t})},function(e){return t.blobs.neq(o[90],void 0)?o[91]=o[90]:o[91]=void 0,o[77]=o[91]}]):t.resolve(o[77]=void 0)},function(e){return t.blobs.neq(o[77],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSBase64Encode.nop"),o[77]).then(function(e){var t;return t=e,o[89]=t[0],t})},function(e){return o[78]=o[89]}]):t.resolve(o[78]=void 0)},function(r){return t.i64.neq(o[20],void 0)?t.sequence([function(e){return o[89]=o[12].get("epoch_id"),t.db.table(168).fetch().next().then(function(e,n){var r=e.done,a=e.value;return r?o[90]=t.i64.cast([0,1]):(n=a.item,o[95]=n.backupTenancy,t.i64.neq(o[95],void 0)?o[94]=o[95]:o[94]=t.i64.cast([0,1]),o[90]=o[94])})},function(e){return t.i64.eq(o[90],t.i64.cast([0,2]))?t.resolve(o[92]=void 0):t.sequence([function(e){return t.nativeOperation(n("LSGetArmadilloPublicKey.nop")).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return o[92]=o[94]}])},function(e){return t.blobs.neq(o[92],void 0)?t.sequence([function(e){return t.nativeOperation(n("LSCreateSignatureWithArmadilloKey.nop"),o[14]).then(function(e){var t;return t=e,o[94]=t[0],t})},function(e){return t.blobs.neq(o[94],void 0)?t.resolve(o[95]=o[94]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),o[100]="Failed to create labyrinth signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[95]=void 0}])},function(e){return t.nativeOperation(n("LSCreateSignature_v2.nop"),o[13],t.blob("Mw=="),o[92]).then(function(e){var t;return t=e,o[96]=t[0],t})},function(e){return t.blobs.neq(o[96],void 0)?t.resolve(o[97]=o[96]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),o[100]="Failed to create armadillo signature",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",o[100]].join("")),o[99]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",o[100],o[99],t.i64.cast([0,3]))},function(e){return o[97]=void 0}])},function(e){return t.blobs.neq(o[97],void 0)?(t.blobs.neq(o[95],void 0)?(o[100]=new t.Map,o[100].set("armadillo_public_key",o[92]),o[100].set("armadillo_key_signature",o[97]),o[100].set("labyrinth_key_signature",o[95]),o[99]=o[100]):o[99]=void 0,o[98]=o[99]):o[98]=void 0,o[93]=o[98]}]):t.resolve(o[93]=void 0)},function(r){return o[93]!==void 0?t.sequence([function(e){return o[94]=o[93].get("armadillo_public_key"),t.nativeOperation(n("LSBase64Encode.nop"),o[94]).then(function(e){var t;return t=e,o[95]=t[0],t})},function(e){return o[96]=o[93].get("armadillo_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[96]).then(function(e){var t;return t=e,o[97]=t[0],t})},function(e){return o[98]=o[93].get("labyrinth_key_signature"),t.nativeOperation(n("LSBase64Encode.nop"),o[98]).then(function(e){var t;return t=e,o[99]=t[0],t})},function(r){return o[100]=new t.Map,o[100].set("backup_id",e[1]),o[100].set("request_device_id",o[20]),o[100].set("virtual_device_id",o[83]),o[100].set("encrypted_secret_values",o[61]),o[100].set("public_key",o[84]),o[100].set("epoch_storage_pubkey",o[85]),o[100].set("epoch_storage_pubkey_sig",o[86]),o[100].set("device_epoch_hmac",o[87]),o[100].set("epoch_root_key_fingerprint",o[31]),o[100].set("ocmf_rotation_token",o[88]),o[100].set("is_init",!1),o[100].set("epoch_id",o[89]),o[100].set("virtual_device_type",o[1]),o[100].set("action_type",e[0]),o[100].set("private_key_debug_token",o[70]),o[100].set("ocmf_client_state_debug_token",o[72]),o[100].set("epoch_storage_pvtkey_debug_token",o[74]),o[100].set("recovery_code_debug_token",o[78]),o[100].set("trace_id",e[3]),o[100].set("cloud_service_account",o[2]),o[100].set("hsm_pin_normalization_status",o[3]),o[100].set("security_question_type",o[4]),o[100].set("trusted_contact_id",o[5]),o[100].set("armadillo_public_key",o[95]==null?"":o[95]),o[100].set("armadillo_key_signature",o[97]==null?"":o[97]),o[100].set("labyrinth_key_signature",o[99]==null?"":o[99]),o[101]=t.toJSON(o[100]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[101],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[102]=t[0],t})}]):((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] failed to get armadillo key and device signatures"),o[94]=new t.Map,o[94].set("backup_id",e[1]),o[94].set("request_device_id",o[20]),o[94].set("virtual_device_id",o[83]),o[94].set("encrypted_secret_values",o[61]),o[94].set("public_key",o[84]),o[94].set("epoch_storage_pubkey",o[85]),o[94].set("epoch_storage_pubkey_sig",o[86]),o[94].set("device_epoch_hmac",o[87]),o[94].set("epoch_root_key_fingerprint",o[31]),o[94].set("ocmf_rotation_token",o[88]),o[94].set("is_init",!1),o[94].set("epoch_id",o[89]),o[94].set("virtual_device_type",o[1]),o[94].set("action_type",e[0]),o[94].set("private_key_debug_token",o[70]),o[94].set("ocmf_client_state_debug_token",o[72]),o[94].set("epoch_storage_pvtkey_debug_token",o[74]),o[94].set("recovery_code_debug_token",o[78]),o[94].set("trace_id",e[3]),o[94].set("cloud_service_account",o[2]),o[94].set("hsm_pin_normalization_status",o[3]),o[94].set("security_question_type",o[4]),o[94].set("trusted_contact_id",o[5]),o[95]=t.toJSON(o[94]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",t.i64.cast([0,50004]),o[95],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),e[3],t.i64.cast([0,0])).then(function(e){var t;return t=e,o[96]=t[0],t}))}]):t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Epoch keys are unavailable."),o[14]="Epoch keys are unavailable.",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[14],o[13],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}]):t.sequence([function(e){return(function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] Invalid Recovery Code Provided"),o[13]="Invalid Recovery Code Provided",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure] ","",o[13]].join("")),o[12]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure",o[13],o[12],t.i64.cast([0,3]))},function(r){return t.storedProcedure(n("LSHandleCreateVirtualDeviceFailure"),e[1],!1,e[3])}])}])}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",e.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];var s=e;l.default=s}),98);
__d("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure",["LSCreateExtraVirtualDeviceWithRecoveryCodeData","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSCreateExtraVirtualDeviceWithRecoveryCodeData"),a.actionType,a.backupId,a.recoveryCodeData,a.traceId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("LSOptOutOfBackup",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(t,n,r,o,a,i,l){function e(){var e=arguments,t=e[e.length-1],o=[],a=[];return t.sequence([function(i){return t.sequence([function(a){return o[0]=t.i64.of_float(Date.now()),(function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] Beginning execution."),r("justknobx")._("1099")?t.sequence([function(e){return t.sequence([function(e){return t.resolve()},function(e){return t.storedProcedure(n("LSIsMobileClient")).then(function(e){var t;return t=e,o[11]=t[0],t})},function(e){return o[11]?o[12]=!0:o[12]=!1,o[12]?((function(e){t.logger(e).mustfix(e)})("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),o[14]="LSDataTraceMciTraceLog native op not supported",(function(e){t.logger(e).mustfix(e)})(["[EncryptedBackups][MEBTraceUtils] ","",o[14]].join("")),o[13]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"MEBTraceUtils",o[14],o[13],t.i64.cast([0,3]))):t.resolve()}])},function(r){return o[8]=new t.Map,o[8].set("backup_id",e[0]),o[8].set("trace_id",void 0),o[9]=t.toJSON(o[8]),t.storedProcedure(n("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_opt_out",t.i64.cast([0,50019]),o[9],t.i64.cast([0,0]),t.i64.cast([0,93]),t.i64.cast([0,0]),void 0,t.i64.cast([0,0])).then(function(e){var t;return t=e,o[10]=t[0],t})},function(e){return o[1]=t.i64.cast([0,0])}]):t.resolve(((function(e){t.logger(e).info(e)})("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] backup opt out flow is not enabled"),o[1]=t.i64.cast([0,1])))},function(e){return o[2]=t.i64.of_float(Date.now()),o[3]=t.i64.random(),o[5]="Finishing execution. Execution time: ",o[6]=t.i64.to_string(t.i64.sub(o[2],o[0])),o[7]=" ms",o[4]="",(function(e){t.logger(e).info(e)})(["[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] ",o[4],o[5],o[4],o[6],o[4],o[7]].join("")),t.i64.eq(t.i64.mod_(o[3],t.i64.cast([0,1e3])),t.i64.cast([0,0]))?(o[8]=",",o[9]=t.createArray(),t.nativeOperation(n("LSLogMebClientEvent.nop"),"LSEncryptedBackupsOptOutOfBackupStoredProcedure",[o[5],o[8],o[6],o[8],o[7]].join(""),o[9],t.i64.cast([0,4]))):t.resolve()},function(e){return a[0]=o[1]}])},function(e){return t.resolve(a)}])}e.__sproc_name__="LSEncryptedBackupsOptOutOfBackupStoredProcedure",e.__tables__=[];var s=e;l.default=s}),98);
__d("LSOptOutOfBackupStoredProcedure",["LSOptOutOfBackup","LSSynchronousPromise","Promise","cr:8709"],(function(t,n,r,o,a,i,l){var e;function s(t,a){var i=t.storedProcedure(r("LSOptOutOfBackup"),a.backupId);return(e||(e=n("Promise"))).resolve(o("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(i))}l.default=s}),98);
__d("MWEncryptedBackupsCreateExtraVirtualDeviceWithRecoveryCodeData",["LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSShape","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t,n,a){var l=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups));if(l==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var s=l.backupId;return s!=null?(await t.runInTransaction(function(e){return r("LSCreateExtraVirtualDeviceWithRecoveryCodeDataStoredProcedure")(r("LSFactory")(e),{actionType:n,backupId:s,recoveryCodeData:o("LSShape").ofRecord(a),traceId:void 0})},"readwrite",void 0,void 0,i.id+":41"),[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").SUCCESS)]):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]}l.initializeCreateExtraVirtualDeviceStoredProcedure=s}),98);
__d("X25519",["$InternalEnum","Promise","WACryptoCurve25519Dependencies","WASignalKeys","WASignalOther","WASignalSignatures"],(function(t,n,r,o,a,i,l){"use strict";var e,s=n("$InternalEnum").Mirrored(["Encryption","Signing"]),u=n("$InternalEnum")({PublicKey:0,PrivateKey:1,Signature:2});function c(e,t){if(t===s.Encryption)return[];var n=1;switch(e){case u.PublicKey:n=1;break;case u.PrivateKey:n=2;break;case u.Signature:n=3;break}return[255,n]}function d(e,t,n){var r=c(t,n),o=r.length;if(o<=0)return e;var a=new Uint8Array(o+e.byteLength);return a.set(Array.from(r)),a.set(e,o),a}function m(e,t,n){var r=c(t,n).length;return e.slice(r)}function p(e,t){return{privateKey:d(e.privateKey,u.PrivateKey,t),publicKey:d(e.publicKey,u.PublicKey,t)}}function _(e){var t=p(o("WASignalKeys").makeKeyPair(),e);return{pk:t.publicKey,sk:t.privateKey}}function f(e,t){if(t===s.Encryption)return 32;switch(e){case u.PublicKey:case u.PrivateKey:return 32;case u.Signature:return 64}}function g(e,t,n){var r=c(t,n),o=r.length,a=f(t,n),i=a!=null?o+a:0;if(e.length!==i)return!1;var l=e.subarray(0,o),s=new Uint8Array(r);return s.length===l.length&&s.every(function(e,t){return e===l[t]})}function h(e,t){if(g(e,u.PublicKey,t))return e}function y(e,t){if(g(e,u.PrivateKey,t))return e}function C(e,t){var n=h(e.pkBytes,t),r=y(e.skBytes,t);if(n!=null&&r!=null)return{pk:n,sk:r}}function b(t,r){var a=m(t,u.PrivateKey,s.Signing);return o("WASignalSignatures").signMsg(o("WASignalKeys").makeKeyPairFrom(o("WASignalOther").ensureSize(a,32)),r).then(function(t){var r=d(t,u.Signature,s.Signing);return(e||(e=n("Promise"))).resolve(r)})}function v(e){if(g(e,u.Signature,s.Signing))return e}function S(e,t,n){var r=m(t,u.PublicKey,s.Signing);return o("WASignalSignatures").verifyMsgSignalVariant(o("WASignalKeys").serializeIdentity(r),n,o("WASignalOther").ensureSize(m(e,u.Signature,s.Signing),64))}function R(t,r){var a=r,i=t;return!g(i,u.PublicKey,s.Encryption)||!g(a,u.PrivateKey,s.Encryption)?(e||(e=n("Promise"))).resolve():o("WACryptoCurve25519Dependencies").calculateAgreement(i,a).then(function(t){return(e||(e=n("Promise"))).resolve(new Uint8Array(t))})}l.KeyPurpose=s,l.generateKeys=_,l.publicKeyFromBytes=h,l.secretKeyFromBytes=y,l.keysFromBytes=C,l.sign=b,l.signatureFromBytes=v,l.verify=S,l.exchangeKeys=R}),98);
__d("PublicKeyCrypto",["Promise","UInt8Array","X25519"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,r){return(e||(e=n("Promise"))).all([t,r]).then(function(t){return(e||(e=n("Promise"))).resolve(t[0]!=null&&t[1]!=null?o("UInt8Array").concatBytes([t[0],t[1]]):void 0)})}function u(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(n,t))}function c(e,t,n){return s(o("X25519").exchangeKeys(n,e),o("X25519").exchangeKeys(t,e))}l.senderDeriveSharedSecret=u,l.receiverDeriveSharedSecret=c}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","error");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQErrorResponseMixin=e}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","bad-request");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",400);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorBadRequestMixin=e}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","feature-not-implemented");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",501);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorFeatureNotImplementedMixin=e}),98);
__d("WASmaxInAbPropsNoRetryErrors",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[t,n])}l.parseNoRetryErrors=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorResponseMixin","WASmaxInAbPropsNoRetryErrors","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInAbPropsNoRetryErrors").parseNoRetryErrors(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorNoRetryErrors:i.value})):i}l.parseGetExperimentConfigResponseErrorNoRetry=e}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"text","internal-server-error");if(!n.success)return n;var r=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrInt,e,"code",500);return r.success?o("WAResultOrError").makeResult({text:n.value,code:r.value}):r}l.parseIQErrorInternalServerErrorMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(r.value);if(!a.success)return a;var i=o("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({errorIQErrorInternalServerErrorMixin:a.value},i.value)):i}l.parseGetExperimentConfigResponseErrorRetry=e}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"config_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"config_value");if(!r.success)return r;var a=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,e,"config_expo_key",0,void 0);return a.success?o("WAResultOrError").makeResult({configCode:n.value,configValue:r.value,configExpoKey:a.value}):a}l.parseExperimentConfigMixin=e}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxParseUtils").attrIntRange(e,"event_code",1,void 0);if(!n.success)return n;var r=o("WASmaxParseUtils").attrIntRange(e,"sampling_weight",-1e4,1e4);return r.success?o("WAResultOrError").makeResult({eventCode:n.value,samplingWeight:r.value}):r}l.parseSamplingConfigMixin=e}),98);
__d("WASmaxInAbPropsConfigs",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"ExperimentConfig",value:t.value});var n=o("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(e);return n.success?o("WAResultOrError").makeResult({name:"SamplingConfig",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["ExperimentConfig","SamplingConfig"],[t,n])}l.parseConfigs=e}),98);
__d("WASmaxInAbPropsEnums",[],(function(t,n,r,o,a,i){var e={false:"false",true:"true"};i.ENUM_FALSE_TRUE=e}),66);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseReference").attrStringFromReference(t,["id"]);if(!r.success)return r;var a=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"id",r.value);if(!a.success)return a;var i=o("WASmaxParseReference").attrStringFromReference(t,["to"]);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"from",i.value);if(!l.success)return l;var s=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,e,"type","result");return s.success?o("WAResultOrError").makeResult({type:s.value}):s}l.parseIQResultResponseMixin=e}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsConfigs","WASmaxInAbPropsEnums","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"prop");if(!t.success)return t;var n=o("WASmaxInAbPropsConfigs").parseConfigs(e);return n.success?o("WAResultOrError").makeResult({configs:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"erid");if(!t.success)return t;var n=o("WASmaxParseUtils").contentBytesRange(e,1,100);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"props");if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"erid",s);if(!i.success)return i;var l=o("WASmaxParseUtils").literal(o("WASmaxParseUtils").attrString,a.value,"protocol","1");if(!l.success)return l;var u=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"ab_key");if(!u.success)return u;var c=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrString,a.value,"hash");if(!c.success)return c;var d=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh",0,void 0);if(!d.success)return d;var m=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrIntRange,a.value,"refresh_id",0,void 0);if(!m.success)return m;var p=o("WASmaxParseUtils").optional(o("WASmaxParseUtils").attrStringEnum,a.value,"delta_update",o("WASmaxInAbPropsEnums").ENUM_FALSE_TRUE);if(!p.success)return p;var _=o("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!_.success)return _;var f=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"prop",0,1/0,e);return f.success?o("WAResultOrError").makeResult(babelHelpers.extends({propsProtocol:l.value,propsAbKey:u.value,propsHash:c.value,propsRefresh:d.value,propsRefreshId:m.value,propsDeltaUpdate:p.value},_.value,{erid:i.value,propsProp:f.value})):f}l.parseGetExperimentConfigResponseSuccessPropsProp=e,l.parseGetExperimentConfigResponseSuccessErid=s,l.parseGetExperimentConfigResponseSuccess=u}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxJsx").smax("iq",{id:o("WAWap").generateId(),type:"get"});return e}function s(t){var n=e();return o("WASmaxMixins").mergeStanzas(t,n)}l.mergeBaseIQGetRequestMixin=s}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.propsHash,n=e.propsRefreshId,r=o("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{xmlns:"abt",to:o("WAWap").S_WHATSAPP_NET},o("WASmaxJsx").smax("props",{protocol:"1",hash:o("WASmaxAttrs").OPTIONAL(o("WAWap").CUSTOM_STRING,t),refresh_id:o("WASmaxAttrs").OPTIONAL(o("WAWap").INT,n)})));return r}l.makeGetExperimentConfigRequest=e}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(r,n);if(a.success)return{name:"GetExperimentConfigResponseSuccess",value:a.value};var i=o("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(r,n);if(i.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:i.value};var l=o("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(r,n);if(l.success)return{name:"GetExperimentConfigResponseErrorRetry",value:l.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:a,ErrorNoRetry:i,ErrorRetry:l}))}l.sendGetExperimentConfigRPC=e}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=await o("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC(t);if(n.name==="GetExperimentConfigResponseSuccess"){var r=n.value,a=r.erid,i=r.propsAbKey,l=r.propsDeltaUpdate,s=r.propsHash,c=r.propsProp,d=r.propsRefresh,m=r.propsRefreshId,p=u(c),_=p.newProps,f=p.samplingConfigs;return o("WAResultOrError").makeResult({abKey:i,hash:s,refresh:d,refreshId:m,props:_,samplingConfigs:f,erid:a==null?void 0:a.elementValue,isDeltaUpdate:l==="true"})}return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""])),n.value),o("WAResultOrError").makeError()}function u(e){var t=[],n=[];return e.forEach(function(e){var r=e.configs;if(r.name==="ExperimentConfig"){var o;t.push({configCode:r.value.configCode,configValue:r.value.configValue,configExpoKey:(o=r.value.configExpoKey)==null?void 0:o.toString()})}else r.name==="SamplingConfig"&&n.push({eventCode:r.value.eventCode,samplingWeight:r.value.samplingWeight})}),{newProps:t,samplingConfigs:n}}l.getAbPropsProtocol=s}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d=o("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},m);function m(e){var t=e.sendHash,n=t===void 0?!0:t;return n==null||n===!1?_(null):o("WAAbProps").getHash().then(function(e){return _(e)})}var p=m;async function _(t){var n=await o("WAGetAbPropsProtocol").getAbPropsProtocol({propsHash:t});if(!n.success)o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"])));else{var r=n.value,a=r.abKey,i=r.hash,l=r.props,u=r.refresh,c=o("WAAbPropsHelpers").parseAbProps(o("WAAbProps").getConfig(),l),d=await f(a,i,u,c);d.success===!1&&(d.error,o("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]))))}var m=await o("WAAbProps").getRefreshSecs();return{seconds:m}}async function f(e,t,n,r){var a=await o("WAAbProps").getAbProps(),i={abKey:e!=null?e:a.abKey,hash:t!=null?t:a.hash,refresh:o("WAAbPropsHelpers").maybeUpdateRefresh(n),lastSyncTime:o("WATimeUtils").unixTime(),propValues:a.propValues,propExpoKeys:a.propExpoKeys,internalExpoKeys:a.internalExpoKeys,expoKeyStr:a.expoKeyStr};if(t==null)return await o("WAAbProps").setAbProps(i),o("WALogger").LOG(u||(u=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]))),o("WAResultOrError").makeError("noHash");o("WALogger").LOG(c||(c=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"])));var l=r.expoKeys,s=r.values,d=o("WAAbPropsHelpers").maybeUpdatePropValues(s,a.propValues,o("WAAbProps").getConfig()),m=o("WAAbPropsHelpers").maybeUpdateExpoKeys(l,a.propExpoKeys,o("WAAbProps").getConfig()),p=m.expoKeysToDelete,_=m.propExpoKeys,f,g,h=o("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(p,a.internalExpoKeys);return h!=null&&(f=h.internalExpoKeys,g=h.expoKeyStr),await o("WAAbProps").setAbProps(babelHelpers.extends({},i,{propValues:d,propExpoKeys:_,internalExpoKeys:f,expoKeyStr:g})),o("WAResultOrError").makeResult()}l.syncAbProps=d,l.syncAbPropsDebug=p}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:i.value})):i}l.parseFetchSelfResponseError=e}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"platform");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function s(e){var t=o("WASmaxParseUtils").assertTag(e,"manufacturer");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function u(e){var t=o("WASmaxParseUtils").assertTag(e,"model");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function c(e){var t=o("WASmaxParseUtils").assertTag(e,"seen");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function d(e){var t=o("WASmaxParseUtils").assertTag(e,"creation");if(!t.success)return t;var n=o("WASmaxParseUtils").contentInt(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function m(e){var t=o("WASmaxParseUtils").assertTag(e,"ip");if(!t.success)return t;var n=o("WASmaxParseUtils").contentString(e);return n.success?o("WAResultOrError").makeResult({elementValue:n.value}):n}function p(e){var t=o("WASmaxParseUtils").assertTag(e,"location");if(!t.success)return t;var n=o("WASmaxParseUtils").attrString(e,"latitude");if(!n.success)return n;var r=o("WASmaxParseUtils").attrString(e,"longitude");if(!r.success)return r;var a=o("WASmaxParseUtils").contentString(e);return a.success?o("WAResultOrError").makeResult({latitude:n.value,longitude:r.value,elementValue:a.value}):a}function _(t){var n=o("WASmaxParseUtils").assertTag(t,"device");if(!n.success)return n;var r=o("WASmaxParseUtils").optionalChildWithTag(t,"platform",e);if(!r.success)return r;var a=o("WASmaxParseUtils").optionalChildWithTag(t,"manufacturer",s);if(!a.success)return a;var i=o("WASmaxParseUtils").optionalChildWithTag(t,"model",u);if(!i.success)return i;var l=o("WASmaxParseUtils").optionalChildWithTag(t,"seen",c);if(!l.success)return l;var _=o("WASmaxParseUtils").optionalChildWithTag(t,"creation",d);if(!_.success)return _;var f=o("WASmaxParseUtils").optionalChildWithTag(t,"ip",m);if(!f.success)return f;var g=o("WASmaxParseUtils").optionalChildWithTag(t,"location",p);if(!g.success)return g;var h=o("WASmaxParseUtils").attrIntRange(t,"id",1,999);if(!h.success)return h;var y=o("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(t);return y.success?o("WAResultOrError").makeResult(babelHelpers.extends({id:h.value},y.value,{platform:r.value,manufacturer:a.value,model:i.value,seen:l.value,creation:_.value,ip:f.value,location:g.value})):y}l.parseDeviceInfoPlatform=e,l.parseDeviceInfoManufacturer=s,l.parseDeviceInfoModel=u,l.parseDeviceInfoSeen=c,l.parseDeviceInfoCreation=d,l.parseDeviceInfoIp=m,l.parseDeviceInfoLocation=p,l.parseDeviceInfoMixin=_}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"device");if(!t.success)return t;var n=o("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(e);return n.success,n}function s(t,n){var r=o("WASmaxParseUtils").assertTag(t,"iq");if(!r.success)return r;var a=o("WASmaxParseUtils").flattenedChildWithTag(t,"self");if(!a.success)return a;var i=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(t,n);if(!i.success)return i;var l=o("WASmaxParseUtils").mapChildrenWithTag(a.value,"device",1,25,e);return l.success?o("WAResultOrError").makeResult(babelHelpers.extends({},i.value,{selfDevice:l.value})):l}l.parseFetchSelfResponseSuccessSelfDevice=e,l.parseFetchSelfResponseSuccess=s}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(){var e=o("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxJsx").smax("self",null)));return e}l.makeFetchSelfRequest=e}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e){var t=o("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest(),n=await o("WAComms").sendSmaxStanza(t,e),r=o("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(n,t);if(r.success)return{name:"FetchSelfResponseSuccess",value:r.value};var a=o("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(n,t);if(a.success)return{name:"FetchSelfResponseError",value:a.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:r,Error:a}))}l.sendFetchSelfRPC=e}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){if(t.isCurrentDevice&&n.isCurrentDevice)return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]))),0;if(t.isCurrentDevice)return-1;if(n.isCurrentDevice)return 1;if(t.lastSeen!=null&&n.lastSeen==null)return-1;if(t.lastSeen==null&&n.lastSeen!=null)return 1;if(t.lastSeen!=null&&n.lastSeen!=null){var r=t.lastSeen,a=n.lastSeen;return a.getTime()-r.getTime()}return 0}async function u(){var e=await o("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC();switch(e.name){case"FetchSelfResponseError":{var t=e.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(t.name){case"RetryableIQError":{var n=t.value.backoff;throw n!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{delay:n,type:"constant"},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{first:o("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1})}default:{t.name;var a=t.value.code;throw r("err")("Failed with an error code "+a)}}}case"FetchSelfResponseSuccess":{var i=o("WAJids").extractDeviceId(o("WAGlobals").getMyDeviceJid());return e.value.selfDevice.map(function(e){var t,n,r,a,l,s=e.creation,u=e.elementValue,c=e.id,d=e.ip,m=e.location,p=e.manufacturer,_=e.model,f=e.platform,g=e.seen;return{creationTime:s==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(s.elementValue)),id:o("WAJids").interpretAsDeviceId(c),identityKey:o("WASignalKeys").serializeIdentity(u),ipAddress:(t=d==null?void 0:d.elementValue)!=null?t:null,isCurrentDevice:c===i,lastSeen:g==null?null:o("WATimeUtils").toDate(o("WATimeUtils").castToUnixTime(g.elementValue)),latitude:m==null?null:parseFloat(m.latitude),location:(n=m==null?void 0:m.elementValue)!=null?n:null,longitude:m==null?null:parseFloat(m.longitude),manufacturer:(r=p==null?void 0:p.elementValue)!=null?r:null,model:(a=_==null?void 0:_.elementValue)!=null?a:null,platform:(l=f==null?void 0:f.elementValue)!=null?l:null}}).sort(s)}default:return r("WAAssertUnreachable")(e.name)}}l.getCurrentUserDeviceList=u}),98);
__d("WAPublishAppDataProtocol",["FBLogger","WABridge","WAEncUserMsg","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAOdsEnums","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WATagsLogger").TAGS(["sendAppDataFanout"]);async function c(t){var n=t.externalId,a=t.identities,i=t.messagePayload,l=a.get(o("WAGlobals").getMyUserJid());if(l==null)throw r("FBLogger")("wmi").mustfixThrow("Missing my user identities");var c=Array.from(l.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n,jid:t}}),d=[{devicesInfo:c,user:o("WAGlobals").getMyUserJid()}],m=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(d,{messageBytes:i.messageBytes,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),p=m.phash,_=!1,f=[];m.participants!=null&&m.participants.forEach(function(e){e.type==="pkmsg"&&(_=!0),f.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var g={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:f},h={peerPeerFanout:g},y=void 0;if(_){var C=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),b=C==null?void 0:C.identityKey;if(b==null)throw u.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),r("FBLogger")("wmi").mustfixThrow("No public identity key");y={deviceIdentityElementValue:b}}var v={appdataDeviceListCheck:"true"},S={appdataId:n,peerMsgTypesArgs:h,deviceIdentityMixinArgs:y,withDeviceListCheckMixinArgs:v},R=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(S);switch(R.name){case"PeerResponseSuccess":{var L,E=(L=R.value.deviceListStaleMixin)==null?void 0:L.phash;return E!=null&&p!=null&&E!==p?(u.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),p,E),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),{type:"success",ts:o("WATimeUtils").castToUnixTime(R.value.t),phash:{type:"mismatch",local:p,server:E},count:null,reportingMeta:null}):{type:"success",ts:o("WATimeUtils").castToUnixTime(R.value.t),phash:{type:"ok"},count:null,reportingMeta:null}}default:throw R.name,r("FBLogger")("wmi").mustfixThrow("Failed to send appdata %s",R.value.error)}}l.publishAppData=c}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(t,n,r,o,a,i,l){"use strict";var e=o("WADbTransactor").makeSignalTransactor({receipts:o("MAWTransactionMode").READWRITE},"saveReceipt",function(e){return(function(t){return e.receipts.put({msgId:t.id.externalId.toString(),permittedIdentitiesPerDevice:t.permittedIdentitiesPerDevice,recipientDevices:t.recipientDevices,waMsgId:o("WAMsg").craftWAMsgIdString(t.id)}).then(function(){})})});l.saveReceipt=e}),98);
__d("WAPublishMessage",["FBLogger","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t){var n=e.identities,r=e.messagePayload,a={author:r.protocolMsgId.author,chat:r.protocolMsgId.chat,externalId:r.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i.value;var l=new Map;for(var s of n){var u=s[0],c=s[1];for(var d of c){var m=d[0],p=d[1];m!==o("WAGlobals").getMyDeviceJid()&&l.set(m,{pubKey:p})}}var _=new Set,f={permittedIdentitiesPerDevice:l,recipientDevices:_,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(f),t.addPoint("save_receipts_end"),f}async function c(t,n){var a=t.identities,i=t.messagePayload,l=t.sendIdentity,s=l===void 0?!1:l;n.addPoint("prepare_receipt_start");var c=await u({messagePayload:i,identities:a},n);n.addPoint("prepare_receipt_end"),n.addPoint("calculate_recipients_start");var p=i.backupDirective,_=i.frankingKey,f=i.frankingVersion,g=i.messageBytes,h=i.messageType,y=i.protocolMsgId,C=d(c.permittedIdentitiesPerDevice),b=h.type==="text"&&h.invitedParticipantUserJid!=null?C.filter(function(e){return e.user===h.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):C;n.addPoint("calculate_recipients_end",{int:{recipientsCount:b.length}});var v=h.type==="text"&&h.invitedParticipantUserJid!=null?h.invitedParticipantUserJid:y.chat,S=y.chat===o("WAGlobals").getMyUserJid();if(b.length===0&&!S)throw r("FBLogger")("wmi").mustfixThrow("Trying to send a message with no recipients");if(b.length===0&&S)return{serverResponse:{type:"success",ts:o("WATimeUtils").unixTime(),phash:{type:"ok"},count:null,reportingMeta:null},encryption:{type:"user",messageTo:o("WAGlobals").getMyUserJid(),participants:[],phash:""}};var R=s?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return m(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,L=await(h.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(g.bytes,_,f)),E=await o("WASendMsgInternal").sendMessageV2({type:"chat",messageBytes:g,chat:v,deviceIdentity:R,messageType:h,protocolMsgId:y,externalId:y.externalId,recipients:b,reportingMeta:L,backupDirective:p},n),k=E.serverResponse;return k.type==="success"&&await o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:k.ts,frankingKey:_,frankingVersion:f,messageBytes:g,backupDirective:p,messageType:h,protocolMsgId:y,waMsgId:o("WAMsg").craftWAMsgIdString({author:y.author,chat:y.chat,externalId:y.externalId})}).catch(function(t){o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),t)}),E}function d(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function m(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.publishMessage=c}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:t.value});var n=o("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(e);return n.success?o("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["IQErrorBadRequest","IQErrorItemNotFound"],[t,n])}l.parseIQErrorBadRequestOrItemNotFoundMixinGroup=e}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxParseUtils").assertTag(e,"error");if(!t.success)return t;var n=o("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(e);return n.success?o("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:n.value}):n}l.parseNonRetryableRemoveDeviceIQErrorMixin=e}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(e);if(t.success)return o("WAResultOrError").makeResult({name:"RetryableIQError",value:t.value});var n=o("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(e);return n.success?o("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:n.value}):o("WASmaxParseUtils").errorMixinDisjunction(e,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[t,n])}l.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=e}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxParseUtils").flattenedChildWithTag(e,"error");if(!r.success)return r;var a=o("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(e,t);if(!a.success)return a;var i=o("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(r.value);return i.success?o("WAResultOrError").makeResult(babelHelpers.extends({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:i.value})):i}l.parseRemoveResponseError=e}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(t,n,r,o,a,i,l){function e(e,t){var n=o("WASmaxParseUtils").assertTag(e,"iq");if(!n.success)return n;var r=o("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(e,t);return r.success,r}l.parseRemoveResponseSuccess=e}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(t,n,r,o,a,i,l){function e(e){var t=e.anyElementValue,n=o("WASmaxJsx").smax("smax$any",null,t);return n}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeKeyDataMixin=s}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(t,n,r,o,a,i,l){function e(e){var t=o("WASmaxJsx").smax("smax$any",null,o("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(o("WASmaxJsx").smax("identity",null),e));return t}function s(t,n){var r=e(n);return o("WASmaxMixins").mergeStanzas(t,r)}l.mergeIdentityKeyMixin=s}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(t,n,r,o,a,i,l){function e(e){var t=e.removeId,n=e.identityKeyMixinArgs,r=o("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(o("WASmaxJsx").smax("iq",{to:o("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},o("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(o("WASmaxJsx").smax("remove",{id:o("WAWap").INT(t)}),n)));return r}l.makeRemoveRequest=e}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(t,n,r,o,a,i,l){async function e(e,t){var n=o("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(e),r=await o("WAComms").sendSmaxStanza(n,t),a=o("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(r,n);if(a.success)return{name:"RemoveResponseSuccess",value:a.value};var i=o("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(r,n);if(i.success)return{name:"RemoveResponseError",value:i.value};throw new(o("WASmaxParsingFailure")).SmaxParsingFailure(o("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:a,Error:i}))}l.sendRemoveRPC=e}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=o("WAPushSafeTypes").unsafeNotNullable(t),r=n.deviceId,a=n.identity,i=o("WASignalOther").sliceBytes(a,1,32),l=await o("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:r,identityKeyMixinArgs:{anyElementValue:i}});if(o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "])),r,l),l.name==="RemoveResponseSuccess")return o("WAResultOrError").makeResult();l.name;var s=l.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(s.name!=="RetryableIQError")return o("WAResultOrError").makeError();s.name;var u=s.value.backoff;throw u!=null?new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"constant",delay:u},jitter:0}):new(o("WAPersistedJobManager")).RetryOnBackoff({algo:{type:"exponential",first:o("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}l.removeDevice=s}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError"],(function(t,n,r,o,a,i,l){"use strict";var e,s=async function(){var t=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo();if(t==null)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]))),o("WAResultOrError").makeResult();var n=t.deviceId,r=t.identityKey,a=await o("WARemoveDevice").removeDevice({deviceId:n,identity:r});return a.success&&await o("WAGlobals").getDependencies().clearSignalAndTempStores(),o("WAResultOrError").makeResult()};l.removeCurrentDevice=s}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","encodeProtobuf"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p,_=o("WATagsLogger").TAGS(["sendAppDataFanout"]),f=24;function g(t){var n=t.checkPhash,r=n===void 0?"checkPhash":n,a=t.contents,i=t.externalId,l=t.permittedIdentitiesPerDevice;return h(a,i,l,r).catch(function(t){var n=o("WAErrorMessage").maybeGetMessageFromError(t);return _.ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""])),n),o("WAResultOrError").makeError("runtime-error")})}async function h(e,t,n,r){r===void 0&&(r="checkPhash"),_.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""])),t);var a=o("WAConvertAppData").convertAppData(e),i={bytes:o("WAAsMessageApplication").castToMessageApplicationBytes(o("encodeProtobuf").encodeProtobuf(o("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"},l=[],g=Array.from(n.entries()).map(function(e){var t=e[0],n=e[1];return{identity:n.pubKey,jid:t}}),h=f;g.length>h&&(_.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"])),g.length),_.ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"])),h),g=g.slice(0,h));var y=[{devicesInfo:g,user:o("WAGlobals").getMyUserJid()}],C=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return o("WAEncUserMsg").encryptUserMsg(y,{messageBytes:i,type:"appdata"},{cryptoManager:t})},{operationType:"encrypt",flush:!0}),b=C.phash,v=!1;C.participants!=null&&C.participants.forEach(function(e){e.type==="pkmsg"&&(v=!0),l.push({toJid:e.to,encTypeIndividualMixinArgs:{encType:e.type,encElementValue:e.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(e.v,10)}})});var S={appdataTo:o("WAGlobals").getMyUserJid(),toArgs:l},R={peerPeerFanout:S},L=void 0;if(v){var E=await o("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo(),k=E==null?void 0:E.identityKey;if(k==null)return _.ERROR(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]))),o("WAResultOrError").makeError("no-public-identity");L={deviceIdentityElementValue:k}}var I={appdataDeviceListCheck:r==="checkPhash"?"true":"false"},T={appdataId:t,peerMsgTypesArgs:R,deviceIdentityMixinArgs:L,withDeviceListCheckMixinArgs:I},D=await o("WASmaxAppdataPublishPeerRPC").sendPeerRPC(T);switch(D.name){case"PeerResponseSuccess":{var x,$=(x=D.value.deviceListStaleMixin)==null?void 0:x.phash;return $!=null&&b!=null&&$!==b?(_.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),b,$),o("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:o("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"}),o("WAResultOrError").makeResult({phashMismatch:!0,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})):o("WAResultOrError").makeResult({phashMismatch:!1,serverTs:o("WATimeUtils").castToUnixTime(D.value.t)})}default:return D.name,_.ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""])),D.value.error),o("WAResultOrError").makeError("ack-failure")}}l.MAX_APPDATA_RECIPIENTS=f,l.sendAppDataToDevicesProtocol=g}),98);
__d("WASendMsgUtilV2",["WADevicesState","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c,d,m,p;function _(e){return Promise.resolve()}function f(e,t){return o("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([e,o("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+t)}function g(t){var n=t.chatJid,r=t.reason;return o("WAJids").switchOnChatJidType(n,{group:function(t){return _(t)},interopUser:function(t){return f(t,r)},lidUser:function(t){return f(t,r)},msgrUser:function(t){return f(t,r)},phoneUser:function(t){return f(t,r)}}).catch(function(t){return o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""])),t),Promise.resolve()})}async function h(e,t){var n=e.loadThreadParticipants,r=e.messagePayload,a={author:r.protocolMsgId.author,chat:r.protocolMsgId.chat,externalId:r.protocolMsgId.externalId},i=await o("WALoadReceiptApi").loadReceipt(a);if(i.success)return i;t.addPoint("get_devices_before_send_start"),await g({chatJid:r.protocolMsgId.chat,reason:"prepareReceipt"}),t.addPoint("get_devices_before_send_end");var l=await n(r.protocolMsgId.chat);t.addPoint("get_identities_start");var u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}),c=[];if(u.size===0)c=[].concat(l);else for(var d of u){var m=d[0],p=d[1];p.size===0&&c.push(m)}c.length>0&&(await o("WADevicesState").getDevicesState().waitForUserDevices(c,"GetDevicesBeforeSend: prepareReceipt",!0),u=await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return t.storage.bulkLoadIdentities(l)},{afterInit:!0,flush:!1,operationType:"prepare_receipt_load_identities"}));var _=new Map;for(var f of u){var h=f[0],y=f[1];for(var C of y){var b=C[0],v=C[1];b!==o("WAGlobals").getMyDeviceJid()&&_.set(b,{pubKey:v})}}t.addPoint("get_identities_end");var S=new Set,R={permittedIdentitiesPerDevice:_,recipientDevices:S,id:a};return t.addPoint("save_receipts_start"),await o("WASaveReceiptApi").saveReceipt(R).catch(function(e){return t.addPoint("save_receipts_fail"),o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""])),e),o("WAResultOrError").makeError("missing-receipt")}),t.addPoint("save_receipts_end"),o("WAResultOrError").makeResult(R)}async function y(e,t){var n=e.isInstamadillo,r=n===void 0?!1:n,a=e.loadThreadParticipants,i=e.messagePayload,l=e.sendIdentity,s=l===void 0?!1:l;t.addPoint("prepare_receipt_start");var p=await h({messagePayload:i,loadThreadParticipants:a},t);if(p.success===!1)return t.addPoint("prepare_receipt_fail"),o("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]))),o("WAResultOrError").makeError({type:"missing-receipt"});t.addPoint("prepare_receipt_end");var _=p.value,f=i.backupDirective,g=i.frankingKey,y=i.frankingVersion,v=i.messageBytes,S=i.messageType,R=i.protocolMsgId,L=C(_.permittedIdentitiesPerDevice),E=S.type==="text"&&S.invitedParticipantUserJid!=null?L.filter(function(e){return e.user===S.invitedParticipantUserJid||e.user===o("WAGlobals").getMyUserJid()}):L;t.addPoint("recipients-calculated",{int:{recipientsCount:E.length},string:{msgType:S.type}});var k=S.type==="text"&&S.invitedParticipantUserJid!=null?S.invitedParticipantUserJid:R.chat,I=R.chat===o("WAGlobals").getMyUserJid();if(E.length===0&&!I)return o("WALogger").ERROR(c||(c=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]))),o("WAResultOrError").makeError({type:"no-recipients",isRetriable:!1});if(E.length===0&&I)return o("WALogger").LOG(d||(d=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients, but it is a self thread"]))),o("WAResultOrError").makeResult({baseKey:null,reportingMeta:null,serverTs:o("WATimeUtils").unixTime()});var T=s?await o("WAGlobals").getWaOneQueue().enqueue(function(e){var t=e.cryptoManager;return b(t)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null,D=await(S.isRevoked===!0?Promise.resolve(null):o("WAGenReportingMeta").genReportingMeta(v.bytes,g,y));return o("WASendMsgInternal").sendMessage({type:"chat",messageBytes:v,chat:k,deviceIdentity:T,messageType:S,protocolMsgId:R,externalId:R.externalId,recipients:E,reportingMeta:D,backupDirective:f},t,r).then(function(e){return e.success?o("WASentBytesCache").sentBytesCache().saveSentBytes({ts:e.value.serverTs,frankingKey:g,frankingVersion:y,messageBytes:v,backupDirective:f,messageType:S,protocolMsgId:R,waMsgId:o("WAMsg").craftWAMsgIdString({author:R.author,chat:R.chat,externalId:R.externalId})}).catch(function(e){o("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),e)}).then(function(){return e}):e})}function C(e){var t=new Map;return e.forEach(function(e,n){var r=e.pubKey,a=o("WAJids").extractUserJid(n),i={identity:r,jid:n},l=t.get(a)||[];l.push(i),t.set(a,l)}),Array.from(t,function(e){var t=e[0],n=e[1];return{devicesInfo:n,user:t}})}async function b(e){try{var t=await e.storage.loadIdentities(o("WAGlobals").getMyUserJid()),n=t.get(o("WAGlobals").getMyDeviceJid());if(n!=null)return n;throw r("err")("missing-identity")}catch(e){o("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),e)}}l.getDevicesBeforeSend=g,l.sendChatMessage=y}),98);
__d("WASetClockSkewApi",["WASetMetaApi"],(function(t,n,r,o,a,i,l){"use strict";var e=function(t){var e=t.clockSkew;return o("WASetMetaApi").setMeta({clockSkew:e})};l.setClockSkew=e}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(){o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]))),o("WAComms").sendPing()}async function u(e){var t=e.clockSkew;o("WATimeUtils").setClockSkew(t),await o("WASetClockSkewApi").setClockSkew({clockSkew:t})}l.sendPing=s,l.updateClockSkew=u}),98);
__d("WASignalDbDump",["WASignalDB","WormDump"],(function(t,n,r,o,a,i,l){"use strict";function e(){var e,t=o("WASignalDB").getDb();return t.dump({contacts:{customFields:{lastSyncTs:(e=o("WormDump")).wormNonSensitiveField},limit:2e3},meta:{customFields:{key:e.wormNonSensitiveField}},prekey:{customFields:{keyId:e.wormNonSensitiveField,isDeleted:e.wormNonSensitiveField}},prekeyGeneration:{customFields:{createdTs:e.wormNonSensitiveField,generationId:e.wormNonSensitiveField,startingId:e.wormNonSensitiveField,endingId:e.wormNonSensitiveField}}})}l.debugGetSignalDbDump=e}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.sendHash;o("WALogger").LOG(e||(e=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]))),await o("WAAbPropsSync").syncAbProps({sendHash:n})}l.syncAbProps=s}),98);
__d("encryptedBackupsOptOutOfBackup",["LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSOptOutOfBackupStoredProcedure","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(t.tables.encrypted_backups)).then(function(n){if(n==null)return[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)];var a=n.backupId;return a!=null?t.runInTransaction(function(e){return r("LSOptOutOfBackupStoredProcedure")(r("LSFactory")(e),{backupId:a})},"readwrite",void 0,void 0,i.id+":32"):[(e||(e=o("LSIntEnum"))).ofNumber(r("LSEncryptedBackupsOpStatus").FAILURE)]})}l.optOutOfBackupStoredProcedure=s}),98);